<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>22Cheney.</title>
  
  
  <link href="http://example.com/atom.xml" rel="self"/>
  
  <link href="http://example.com/"/>
  <updated>2022-05-29T07:17:48.541Z</updated>
  <id>http://example.com/</id>
  
  <author>
    <name>Soulchay</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>éªŒè¯IPåœ°å€</title>
    <link href="http://example.com/2022/05/29/%E9%AA%8C%E8%AF%81IP%E5%9C%B0%E5%9D%80/"/>
    <id>http://example.com/2022/05/29/%E9%AA%8C%E8%AF%81IP%E5%9C%B0%E5%9D%80/</id>
    <published>2022-05-29T07:19:00.000Z</published>
    <updated>2022-05-29T07:17:48.541Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>çºªå¿µä¸€é“ â€œéå¸¸æ²¡æ°´å¹³çš„é¢˜â€ã€‚</p><p>ä»Šå¤©æ˜¯ 2022.5.29ï¼Œä¸€ä¸ªæœˆæ²¡ç¢°ç®—æ³•é¢˜ç›®äº†ï¼Œä»Šå¤©å¿ƒè¡€æ¥æ½®æƒ³åˆ·åˆ·é¢˜ç›®ã€‚</p><p>æ‰“å¼€åŠ›æ‰£æ¯æ—¥ä¸€é¢˜ï¼Œç›´æ¥å¼€å¹²ï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">468. éªŒè¯IPåœ°å€</span><br><span class="line">ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² queryIPã€‚å¦‚æœæ˜¯æœ‰æ•ˆçš„ IPv4 åœ°å€ï¼Œè¿”å› &quot;IPv4&quot; ï¼›å¦‚æœæ˜¯æœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œè¿”å› &quot;IPv6&quot; ï¼›å¦‚æœä¸æ˜¯ä¸Šè¿°ç±»å‹çš„ IP åœ°å€ï¼Œè¿”å› &quot;Neither&quot; ã€‚</span><br><span class="line"></span><br><span class="line">æœ‰æ•ˆçš„IPv4åœ°å€ æ˜¯ â€œx1.x2.x3.x4â€ å½¢å¼çš„IPåœ°å€ã€‚ å…¶ä¸­ 0 &lt;= xi &lt;= 255 ä¸” xi ä¸èƒ½åŒ…å« å‰å¯¼é›¶ã€‚ä¾‹å¦‚: â€œ192.168.1.1â€ ã€ â€œ192.168.1.0â€ ä¸ºæœ‰æ•ˆIPv4åœ°å€ï¼Œ â€œ192.168.01.1â€ ä¸ºæ— æ•ˆIPv4åœ°å€; â€œ192.168.1.00â€ ã€ â€œ192.168@1.1â€ ä¸ºæ— æ•ˆIPv4åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">ä¸€ä¸ªæœ‰æ•ˆçš„IPv6åœ°å€ æ˜¯ä¸€ä¸ªæ ¼å¼ä¸ºâ€œx1:x2:x3:x4:x5:x6:x7:x8â€ çš„IPåœ°å€ï¼Œå…¶ä¸­:</span><br><span class="line">1. 1 &lt;= xi.length &lt;= 4</span><br><span class="line">2. xi æ˜¯ä¸€ä¸ª åå…­è¿›åˆ¶å­—ç¬¦ä¸² ï¼Œå¯ä»¥åŒ…å«æ•°å­—ã€å°å†™è‹±æ–‡å­—æ¯( &#x27;a&#x27; åˆ° &#x27;f&#x27; )å’Œå¤§å†™è‹±æ–‡å­—æ¯( &#x27;A&#x27; åˆ° &#x27;F&#x27; )ã€‚</span><br><span class="line">3. åœ¨ xi ä¸­å…è®¸å‰å¯¼é›¶ã€‚</span><br><span class="line">ä¾‹å¦‚ &quot;2001:0db8:85a3:0000:0000:8a2e:0370:7334&quot; å’Œ &quot;2001:db8:85a3:0:0:8A2E:0370:7334&quot; æ˜¯æœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œè€Œ &quot;2001:0db8:85a3::8A2E:037j:7334&quot; å’Œ &quot;02001:0db8:85a3:0000:0000:8a2e:0370:7334&quot; æ˜¯æ— æ•ˆçš„ IPv6 åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šqueryIP = &quot;172.16.254.1&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;IPv4&quot;</span><br><span class="line">è§£é‡Šï¼šæœ‰æ•ˆçš„ IPv4 åœ°å€ï¼Œè¿”å› &quot;IPv4&quot;</span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šqueryIP = &quot;2001:0db8:85a3:0:0:8A2E:0370:7334&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;IPv6&quot;</span><br><span class="line">è§£é‡Šï¼šæœ‰æ•ˆçš„ IPv6 åœ°å€ï¼Œè¿”å› &quot;IPv6&quot;</span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šqueryIP = &quot;256.256.256.256&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;Neither&quot;</span><br><span class="line">è§£é‡Šï¼šæ—¢ä¸æ˜¯ IPv4 åœ°å€ï¼Œåˆä¸æ˜¯ IPv6 åœ°å€</span><br><span class="line"></span><br><span class="line">æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰</span><br><span class="line">é“¾æ¥ï¼šhttps://leetcode.cn/problems/validate-ip-address</span><br><span class="line">è‘—ä½œæƒå½’é¢†æ‰£ç½‘ç»œæ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»å®˜æ–¹æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</span><br></pre></td></tr></table></figure><p>å¥½å®¶ä¼™ï¼Œæˆ‘ä¸€çœ‹å°±ç¬‘äº†ï¼Œè¿™ä¸å°±æ˜¯å¹³æ—¶å†™ç¨‹åºçš„ <code>if + else if + else</code> å˜›ï¼Œå°±è¿™è¿˜ä¸­ç­‰é¢˜ï¼Ÿ é¢å‘åº”ç”¨ç¼–ç¨‹æ˜¯å­ï¼Ÿ</p><p>ç»“æœè¿‡äº†40å¤šåˆ†é’Ÿæˆ‘æ‰è¿›è¡Œç¬¬ä¸€æ¬¡æäº¤ï¼Œ1å°æ—¶å·¦å³æ‰ACï¼Œåˆ«é—®æˆ‘é‚£20åˆ†é’Ÿæ”¹ä»€ä¹ˆäº†ï¼Œåªèƒ½è¯´å¤ªç²—å¿ƒäº†ğŸ˜­ã€‚</p><p>è€Œä¸”æˆ‘çš„ä»£ç ï¼ŒçœŸçš„æ˜¯åˆè‡­åˆé•¿ğŸ˜‘ï¼Œè´´ä¸Šæ¥ç»™ä½ ä»¬çœ‹çœ‹ã€‚ã€‚ã€‚</p><h2 id="æˆ‘çš„ä»£ç "><a href="#æˆ‘çš„ä»£ç " class="headerlink" title="æˆ‘çš„ä»£ç "></a>æˆ‘çš„ä»£ç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">validIPAddress</span><span class="params">(String queryIP)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(judgeIPv4(queryIP))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;IPv4&quot;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(judgeIPv6(queryIP))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;IPv6&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Neither&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judgeIPv4</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰3ä¸ªç‚¹</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pointCnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;str.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str.charAt(i) == <span class="string">&#x27;.&#x27;</span>) pointCnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pointCnt != <span class="number">3</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†å‰ä¸‰ä¸ªç‚¹å‰é¢çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> str.indexOf(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> str.substring(<span class="number">0</span>,index);</span><br><span class="line">            <span class="keyword">if</span>(!judge4(str1)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//æ›´æ–°str</span></span><br><span class="line">            str = str.substring(index+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†ç¬¬ä¸‰ä¸ªå†’å·åå‰©ä¸‹çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> judge4(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judge4</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//1.é•¿åº¦è¿‡é•¿è¿‡çŸ­æˆ–è€…å‰ç½®ä¸º0åˆ™è¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span>(str.length() &lt; <span class="number">1</span> || str.length() &gt; <span class="number">3</span> || (str.length() &gt; <span class="number">1</span> &amp;&amp; str.indexOf(<span class="string">&quot;0&quot;</span>) == <span class="number">0</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//2.åˆ¤æ–­æ¯ä¸ªå­—ç¬¦æ˜¯å¦éƒ½æ˜¯æ•°å­—</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>; m&lt;str.length(); m++)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(m);</span><br><span class="line">            <span class="keyword">if</span>(c &lt; <span class="string">&#x27;0&#x27;</span> || c &gt; <span class="string">&#x27;9&#x27;</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­æ•°å­—çš„èŒƒå›´æ˜¯å¦åˆæ³•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">strInt</span> <span class="operator">=</span> Integer.parseInt(str);</span><br><span class="line">        <span class="keyword">if</span>(strInt &lt; <span class="number">0</span> || strInt &gt; <span class="number">255</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judgeIPv6</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ¤æ–­æ˜¯å¦æœ‰7ä¸ªå†’å·</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">pointCnt</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;str.length(); i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str.charAt(i) == <span class="string">&#x27;:&#x27;</span>) pointCnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pointCnt != <span class="number">7</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†å‰ä¸ƒä¸ªå†’å·å‰é¢çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> str.indexOf(<span class="string">&#x27;:&#x27;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">str1</span> <span class="operator">=</span> str.substring(<span class="number">0</span>,index);</span><br><span class="line">            <span class="keyword">if</span>(!judge6(str1)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="comment">//æ›´æ–°str</span></span><br><span class="line">            str = str.substring(index+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤„ç†ç¬¬ä¸‰ä¸ªå†’å·åå‰©ä¸‹çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> judge6(str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">judge6</span><span class="params">(String str)</span>&#123;</span><br><span class="line">        <span class="comment">//1.é•¿åº¦è¿‡é•¿åˆ™è¿”å›false</span></span><br><span class="line">        <span class="keyword">if</span>(str.length() &lt; <span class="number">1</span> || str.length() &gt; <span class="number">4</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="comment">//2.åˆ¤æ–­æ¯ä¸ªå­—ç¬¦æ˜¯å¦éƒ½æ˜¯æ•°å­—æˆ–å­—æ¯</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>; m&lt;str.length(); m++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> str.charAt(m);</span><br><span class="line">            <span class="keyword">if</span> (c &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(c &gt;= <span class="string">&#x27;A&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;F&#x27;</span>)&#123;&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c &gt;= <span class="string">&#x27;a&#x27;</span> &amp;&amp; c &lt;= <span class="string">&#x27;f&#x27;</span>)&#123;&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><p>è¯´å®è¯ï¼Œè¿™é“é¢˜çœŸçš„æ˜¯å‡ºçš„â€éå¸¸æ²¡æ°´å¹³â€ï¼Œä½†ç¡®å®æ˜¯æˆ‘ä»¬åœ¨ç¼–å†™ç¨‹åºæ—¶æœ€å¸¸é‡åˆ°çš„æƒ…æ™¯ï¼Œéå¸¸è€ƒéªŒæˆ‘ä»¬æ€ç»´çš„ç¼œå¯†æ€§ã€‚ä»¥æˆ‘çš„ä»£ç ä½œä¸ºåä¾‹ï¼Œå¦‚æœåªè¿½æ±‚æ»¡è¶³éœ€æ±‚å°±å®Œäº‹ï¼Œè€Œä¸è€ƒè™‘å…¶ä»–ä¸€äº›æ›´ä¼˜é›…çš„æ–¹æ³•ï¼Œå†™çš„ä»£ç åªä¼šè¶Šæ¥è¶Š â€œShit å±±â€ã€‚å¥½å˜æˆ‘è¦å»æ”¹æˆ‘çš„ä»£ç äº†ï¼Œæ‹œæ‹œæ‹œæ‹œï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;çºªå¿µä¸€é“ â€œéå¸¸æ²¡æ°´å¹³çš„é¢˜â€ã€‚&lt;/p&gt;
&lt;p&gt;ä»Šå¤©æ˜¯ 2022.5.29ï¼Œä¸€ä¸ªæœˆæ²¡ç¢°ç®—æ³•é¢˜ç›®äº†ï¼Œä»Šå¤©å¿ƒè¡€æ¥æ½®æƒ³åˆ·åˆ·é¢˜ç›®ã€‚&lt;/</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Algorithm" scheme="http://example.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>å­¦é™¢é¡¹ç›®çš„çŸ¥è¯†ç‚¹å·©å›º</title>
    <link href="http://example.com/2022/05/27/%E5%AD%A6%E9%99%A2%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E5%B7%A9%E5%9B%BA/"/>
    <id>http://example.com/2022/05/27/%E5%AD%A6%E9%99%A2%E9%A1%B9%E7%9B%AE%E7%9A%84%E7%9F%A5%E8%AF%86%E7%82%B9%E5%B7%A9%E5%9B%BA/</id>
    <published>2022-05-27T03:20:00.000Z</published>
    <updated>2022-05-29T11:06:25.494Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…"><a href="#1-æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…" class="headerlink" title="1. æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…"></a>1. æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…</h2><p>è‡ªåŠ¨æ³¨å…¥æ’å…¥æ—¶é—´å’Œæ›´æ–°æ—¶é—´</p><p>åœ¨æ—¥å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒDAOå±‚çš„æ•°æ®åº“å®ä½“ç±»(Entity)ä¸­ç»å¸¸ä¼šæœ‰ä¸€äº›å…¬å…±å­—æ®µå¦‚ create_by(åˆ›å»ºäºº)ï¼Œcreate_time(åˆ›å»ºæ—¶é—´) ç­‰å­—æ®µï¼Œä¸ä¸šåŠ¡åŸºæœ¬æ— å…³ä¸”å±äºè®°å½•æœ¬èº«çš„å±æ€§å­—æ®µã€‚è¿™äº›å­—æ®µé€šå¸¸ä¼šå®¹æ˜“è¢«å¤§å®¶å¿½è§†ï¼Œæ¯ä¸ª Entity éƒ½å»å¤„ç†ä¸€éæ¯”è¾ƒéº»çƒ¦è€—æ—¶ï¼›å¦‚æœå¿½ç•¥åˆä¼šé€ æˆè®°å½•æœ¬èº«å±æ€§ä¸å®Œæ•´ã€‚</p><p>å¯ä»¥ä½¿ç”¨ <code>MybatisPlus</code> ä¸­çš„  <code>MetaObjectHandler</code> æ¥è§£å†³ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºæ’å…¥æ—¶å¯¹å…¬å…±å­—æ®µçš„å¡«å……</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”¨äºæ›´æ–°æ—¶å¯¹å…¬å…±å­—æ®µçš„å¡«å……</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªåŠ¨è£…é…é…ç½®:è‡ªåŠ¨æ³¨å…¥æ’å…¥æ—¶é—´å’Œæ›´æ–°æ—¶é—´</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title class_">MetaObjectHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtCreate&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateFill</span><span class="params">(MetaObject metaObject)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setFieldValByName(<span class="string">&quot;gmtModified&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), metaObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="2-Swagger-é…ç½®"><a href="#2-Swagger-é…ç½®" class="headerlink" title="2. Swagger é…ç½®"></a>2. Swagger é…ç½®</h2><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/educationOnline/1.png"></img></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Swaggeré…ç½®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SwaggerConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºAPI</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">webApiConfig</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;webApi&quot;</span>)</span><br><span class="line">            <span class="comment">// ç”¨æ¥åˆ›å»ºè¯¥APIçš„åŸºæœ¬ä¿¡æ¯ï¼Œå±•ç¤ºåœ¨æ–‡æ¡£çš„é¡µé¢ä¸­ï¼ˆè‡ªå®šä¹‰å±•ç¤ºçš„ä¿¡æ¯ï¼‰</span></span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">            <span class="comment">// è®¾ç½®å“ªäº›æ¥å£æš´éœ²ç»™Swaggerå±•ç¤º</span></span><br><span class="line">                .select()</span><br><span class="line">            <span class="comment">//é”™è¯¯è·¯å¾„ä¸ç›‘æ§</span></span><br><span class="line">                .paths(Predicates.not(PathSelectors.regex(<span class="string">&quot;/error.*&quot;</span>)))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æ‘˜è¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">webApiInfo</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;ç½‘ç«™-è¯¾ç¨‹ä¸­å¿ƒAPIæ–‡æ¡£&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;æœ¬æ–‡æ¡£æè¿°äº†è¯¾ç¨‹ä¸­å¿ƒå¾®æœåŠ¡æ¥å£å®šä¹‰&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> <span class="title class_">Contact</span>(<span class="string">&quot;SoulChay&quot;</span>, <span class="string">&quot;http://soulchay.com&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;1837522825@qq.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å¼‚å¸¸å¤„ç†ç±»"><a href="#3-å¼‚å¸¸å¤„ç†ç±»" class="headerlink" title="3. å¼‚å¸¸å¤„ç†ç±»"></a>3. å¼‚å¸¸å¤„ç†ç±»</h2><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>@ControllerAdvice</code> é…åˆ <code>@ExceptionHandler</code> æ¥è®¾ç½®å¤„ç†å…¨å±€å¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span> <span class="comment">//æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªComponentï¼Œä½œç”¨æ˜¯ç»™Controlleræ§åˆ¶å™¨æ·»åŠ ç»Ÿä¸€çš„æ“ä½œæˆ–å¤„ç†ã€‚</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸€èˆ¬å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">error</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().message(<span class="string">&quot;æ‰§è¡Œå…¨å±€å¼‚å¸¸å¤„ç†&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰å¼‚å¸¸</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(SoulException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">error</span><span class="params">(GuliException e)</span>&#123;</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> R.error().code(e.getCode()).message(e.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-GateWay-å¤„ç†è·¨åŸŸ"><a href="#4-GateWay-å¤„ç†è·¨åŸŸ" class="headerlink" title="4. GateWay å¤„ç†è·¨åŸŸ"></a>4. GateWay å¤„ç†è·¨åŸŸ</h2><p>å¯ä»¥ä½¿ç”¨ <code>@CrossOrigin</code> æ¥å¤„ç†è·¨åŸŸï¼Œä½†æ˜¯æ¯ä¸ªè¯·æ±‚éƒ½æ·»åŠ ä¸€éå®åœ¨æ˜¯å¤ªç£¨äººï¼Œæ‰€ä»¥é‡‡ç”¨ GateWay æ¥å¤„ç†è·¨åŸŸã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è§£å†³è·¨åŸŸé—®é¢˜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CorsConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsFilter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">// å…è®¸çš„è¯·æ±‚å¤´</span></span><br><span class="line">        config.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// å…è®¸çš„è¯·æ±‚æº ï¼ˆå¦‚ï¼šhttp://localhost:8080ï¼‰</span></span><br><span class="line">        config.addAllowedOrigin(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// å…è®¸çš„è¯·æ±‚æ–¹æ³• ==&gt; GET, HEAD, POST, PUT, PATCH, DELETE, OPTIONS, TRACE</span></span><br><span class="line">        config.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ·»åŠ URLæ˜ å°„ï¼Œè¿™é‡Œæ‹¦æˆªä¸€åˆ‡è¯·æ±‚</span></span><br><span class="line">        <span class="type">UrlBasedCorsConfigurationSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>(<span class="keyword">new</span> <span class="title class_">PathPatternParser</span>());</span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>, config);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºè·¨åŸŸé…ç½®ä¼šè¿›è¡Œå åŠ ï¼Œä½¿ç”¨ GateWay è¿›è¡Œè·¨åŸŸå¤„ç†åï¼Œéœ€è¦å…³é—­å…¶ä»–è·¨åŸŸçš„å¤„ç†ï¼Œä¸ç„¶å‰ç«¯ä¼šæŠ¥é”™ã€‚ </p><h2 id="5-Cacheable-çš„ä½¿ç”¨"><a href="#5-Cacheable-çš„ä½¿ç”¨" class="headerlink" title="5. @Cacheable çš„ä½¿ç”¨"></a>5. @Cacheable çš„ä½¿ç”¨</h2><p>@Cacheableå¯ä»¥æ ‡è®°åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šï¼Œä¹Ÿå¯ä»¥æ ‡è®°åœ¨ä¸€ä¸ªç±»ä¸Šã€‚å½“æ ‡è®°åœ¨ä¸€ä¸ªæ–¹æ³•ä¸Šæ—¶è¡¨ç¤ºè¯¥æ–¹æ³•æ˜¯æ”¯æŒç¼“å­˜çš„ï¼Œå½“æ ‡è®°åœ¨ä¸€ä¸ªç±»ä¸Šæ—¶åˆ™è¡¨ç¤ºè¯¥ç±»æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯æ”¯æŒç¼“å­˜çš„ã€‚å¯¹äºä¸€ä¸ªæ”¯æŒç¼“å­˜çš„æ–¹æ³•ï¼ŒSpringä¼šåœ¨å…¶è¢«è°ƒç”¨åå°†å…¶è¿”å›å€¼ç¼“å­˜èµ·æ¥ï¼Œä»¥ä¿è¯ä¸‹æ¬¡åˆ©ç”¨åŒæ ·çš„å‚æ•°æ¥æ‰§è¡Œè¯¥æ–¹æ³•æ—¶å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç»“æœï¼Œè€Œä¸éœ€è¦å†æ¬¡æ‰§è¡Œè¯¥æ–¹æ³•ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯å½“ä¸€ä¸ªæ”¯æŒç¼“å­˜çš„æ–¹æ³•åœ¨å¯¹è±¡å†…éƒ¨è¢«è°ƒç”¨æ—¶æ˜¯ä¸ä¼šè§¦å‘ç¼“å­˜åŠŸèƒ½çš„ã€‚</p><p>@Cacheableå¯ä»¥æŒ‡å®šä¸‰ä¸ªå±æ€§ï¼Œvalueã€keyå’Œconditionã€‚</p><p> valueå±æ€§æ˜¯å¿…é¡»æŒ‡å®šçš„ã€‚å…¶è¡¨ç¤ºå½“å‰æ–¹æ³•çš„è¿”å›å€¼æ˜¯ä¼šè¢«ç¼“å­˜åœ¨å“ªä¸ªCacheä¸Šçš„ï¼Œå¯¹åº”Cacheçš„åç§°ã€‚å…¶å¯ä»¥æ˜¯ä¸€ä¸ªCacheä¹Ÿå¯ä»¥æ˜¯å¤šä¸ªCacheï¼Œå½“éœ€è¦æŒ‡å®šå¤šä¸ªCacheæ—¶å…¶æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Cacheable(â€œcache1â€)</span><span class="comment">//Cacheæ˜¯å‘ç”Ÿåœ¨cache1ä¸Šçš„</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Cacheable(&#123;â€œcache1â€, â€œcache2â€&#125;)</span><span class="comment">//Cacheæ˜¯å‘ç”Ÿåœ¨cache1å’Œcache2ä¸Šçš„</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>keyå±æ€§æ˜¯ç”¨æ¥æŒ‡å®šSpringç¼“å­˜æ–¹æ³•çš„è¿”å›ç»“æœæ—¶å¯¹åº”çš„keyçš„ã€‚è¯¥å±æ€§æ”¯æŒSpringELè¡¨è¾¾å¼ã€‚å½“æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šè¯¥å±æ€§æ—¶ï¼ŒSpringå°†ä½¿ç”¨é»˜è®¤ç­–ç•¥ç”Ÿæˆkeyã€‚</p><p>å…ˆæ¥çœ‹çœ‹è‡ªå®šä¹‰ç­–ç•¥ã€‚ è‡ªå®šä¹‰ç­–ç•¥æ˜¯æŒ‡æˆ‘ä»¬å¯ä»¥é€šè¿‡Springçš„ELè¡¨è¾¾å¼æ¥æŒ‡å®šæˆ‘ä»¬çš„keyã€‚è¿™é‡Œçš„ELè¡¨è¾¾å¼å¯ä»¥ä½¿ç”¨æ–¹æ³•å‚æ•°åŠå®ƒä»¬å¯¹åº”çš„å±æ€§ã€‚ä½¿ç”¨æ–¹æ³•å‚æ•°æ—¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨â€œ#å‚æ•°åâ€æˆ–è€…â€œ#på‚æ•°indexâ€ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=â€usersâ€, key=â€#idâ€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Cacheable(value=â€usersâ€, key=â€#p0â€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Cacheable(value=â€usersâ€, key=â€#user.idâ€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="meta">@Cacheable(value=â€usersâ€, key=â€#p0.idâ€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†ä¸Šè¿°ä½¿ç”¨æ–¹æ³•å‚æ•°ä½œä¸ºkeyä¹‹å¤–ï¼ŒSpringè¿˜ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ª root å¯¹è±¡å¯ä»¥ç”¨æ¥ç”Ÿæˆkeyã€‚é€šè¿‡è¯¥rootå¯¹è±¡æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä»¥ä¸‹ä¿¡æ¯ã€‚</p><table><thead><tr><th>å±æ€§åç§°</th><th>æè¿°</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>methodName</td><td>å½“å‰æ–¹æ³•å</td><td>#root.methodName</td></tr><tr><td>method</td><td>å½“å‰æ–¹æ³•</td><td>#root.method.name</td></tr><tr><td>target</td><td>å½“å‰è¢«è°ƒç”¨çš„å¯¹è±¡</td><td>#root.target</td></tr><tr><td>targetClass</td><td>å½“å‰è¢«è°ƒç”¨çš„å¯¹è±¡çš„class</td><td>#root.targetClass</td></tr><tr><td>args</td><td>å½“å‰æ–¹æ³•å‚æ•°ç»„æˆçš„æ•°ç»„</td><td>#root.args[0]</td></tr><tr><td>caches</td><td>å½“å‰è¢«è°ƒç”¨çš„æ–¹æ³•ä½¿ç”¨çš„Cache</td><td>#root.caches[0].name</td></tr></tbody></table><p>å½“æˆ‘ä»¬è¦ä½¿ç”¨rootå¯¹è±¡çš„å±æ€§ä½œä¸ºkeyæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†â€œ#rootâ€çœç•¥ï¼Œå› ä¸ºSpringé»˜è®¤ä½¿ç”¨çš„å°±æ˜¯rootå¯¹è±¡çš„å±æ€§ã€‚å¦‚ï¼š  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&#123;â€œusersâ€, â€œxxxâ€&#125;, key=â€caches[1].nameâ€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰çš„æ—¶å€™æˆ‘ä»¬å¯èƒ½å¹¶ä¸å¸Œæœ›ç¼“å­˜ä¸€ä¸ªæ–¹æ³•æ‰€æœ‰çš„è¿”å›ç»“æœã€‚é€šè¿‡conditionå±æ€§å¯ä»¥å®ç°è¿™ä¸€åŠŸèƒ½ã€‚conditionå±æ€§é»˜è®¤ä¸ºç©ºï¼Œè¡¨ç¤ºå°†ç¼“å­˜æ‰€æœ‰çš„è°ƒç”¨æƒ…å½¢ã€‚å…¶å€¼æ˜¯é€šè¿‡SpringELè¡¨è¾¾å¼æ¥æŒ‡å®šçš„ï¼Œå½“ä¸ºtrueæ—¶è¡¨ç¤ºè¿›è¡Œç¼“å­˜å¤„ç†ï¼›å½“ä¸ºfalseæ—¶è¡¨ç¤ºä¸è¿›è¡Œç¼“å­˜å¤„ç†ï¼Œå³æ¯æ¬¡è°ƒç”¨è¯¥æ–¹æ³•æ—¶è¯¥æ–¹æ³•éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚å¦‚ä¸‹ç¤ºä¾‹è¡¨ç¤ºåªæœ‰å½“userçš„idä¸ºå¶æ•°æ—¶æ‰ä¼šè¿›è¡Œç¼“å­˜ã€‚  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable(value=&#123;â€œusersâ€&#125;, key=â€#user.idâ€, condition=â€#user.id%2==0â€)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">find</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    System.out.println(â€œfind user by user â€œ + user);</span><br><span class="line"> <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-åˆ†é¡µæŸ¥è¯¢"><a href="#6-åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="6. åˆ†é¡µæŸ¥è¯¢"></a>6. åˆ†é¡µæŸ¥è¯¢</h2><p>é…ç½®åˆ†é¡µæ’ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.soul.eduservice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ†é¡µæ’ä»¶</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é«˜ç‰ˆæœ¬çš„SpringBootä¸­, ä¼šæç¤ºè¿™ç§å†™æ³•<b>å·²è¿‡æ—¶</b>, æ‰€ä»¥é‡‡ç”¨å¦ä¸€ç§å†™æ³• <b>MybatisPlusInterceptor</b></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">    interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">PaginationInnerInterceptor</span>(DbType.H2));</span><br><span class="line">    <span class="keyword">return</span> interceptor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ†é¡µä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduTeacherServiceImpl</span> </span><br><span class="line">    <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;EduTeacherMapper, EduTeacher&gt; <span class="keyword">implements</span> <span class="title class_">EduTeacherService</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ†é¡µæŸ¥è¯¢è®²å¸ˆæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title function_">getTeacherFrontList</span><span class="params">(Page&lt;EduTeacher&gt; pageTeacher)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;EduTeacher&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        queryWrapper.orderByDesc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        baseMapper.selectPage(pageTeacher,queryWrapper);</span><br><span class="line"></span><br><span class="line">        List&lt;EduTeacher&gt; records = pageTeacher.getRecords();  <span class="comment">//è·å–å½“å‰é¡µçš„æ•°æ®</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">current</span> <span class="operator">=</span> pageTeacher.getCurrent();  <span class="comment">//å½“å‰é¡µç </span></span><br><span class="line">        <span class="type">long</span> <span class="variable">pages</span> <span class="operator">=</span> pageTeacher.getPages();  <span class="comment">//pageæ•°é‡</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">total</span> <span class="operator">=</span> pageTeacher.getTotal();  <span class="comment">//è·å–æ€»è®°å½•æ•°</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">size</span> <span class="operator">=</span> pageTeacher.getSize();  <span class="comment">//pageå¤§å°</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasPrevious</span> <span class="operator">=</span> pageTeacher.hasPrevious();  <span class="comment">//æ˜¯å¦è¿˜æœ‰ä¸Šä¸€é¡µ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasNext</span> <span class="operator">=</span> pageTeacher.hasNext(); <span class="comment">//æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€é¡µ</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŠŠåˆ†é¡µæ•°æ®å–å‡ºï¼Œæ”¾åˆ°mapé›†åˆ</span></span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;items&quot;</span>,records);</span><br><span class="line">        map.put(<span class="string">&quot;pages&quot;</span>,pages);</span><br><span class="line">        map.put(<span class="string">&quot;current&quot;</span>,current);</span><br><span class="line">        map.put(<span class="string">&quot;total&quot;</span>,total);</span><br><span class="line">        map.put(<span class="string">&quot;size&quot;</span>,size);</span><br><span class="line">        map.put(<span class="string">&quot;hasNext&quot;</span>,hasNext);</span><br><span class="line">        map.put(<span class="string">&quot;hasPrevious&quot;</span>,hasPrevious);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-Feign-è¿œç¨‹è°ƒç”¨"><a href="#7-Feign-è¿œç¨‹è°ƒç”¨" class="headerlink" title="7. Feign è¿œç¨‹è°ƒç”¨"></a>7. Feign è¿œç¨‹è°ƒç”¨</h2><p>å®ç°æ¨¡å—Aè°ƒç”¨æ¨¡å—Bçš„æ–¹æ³•</p><p>â‘ ï¼šå¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æœåŠ¡æ³¨å†Œ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æœåŠ¡è°ƒç”¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šæ¨¡å—Aï¼š</p><p>å¯åŠ¨ç±»æ·»åŠ æ³¨è§£ <code>@EnableFeignClients</code> å¯ç”¨ fegin å®¢æˆ·ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span> <span class="comment">//nacosæ³¨å†Œ</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.soul&quot;&#125;)</span> <span class="comment">//æ·»åŠ æ‰«æConfigåŒ…çš„æ³¨è§£</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span>  <span class="comment">//è¿œç¨‹è°ƒç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EduApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(EduApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®šä¹‰ä¸€ä¸ªå®¢æˆ·ç«¯ç±»æ¥è°ƒç”¨æ¨¡å—Bçš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-order&quot;,fallback = OrdersClientImpl.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrdersClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®è¯¾ç¨‹idå’Œç”¨æˆ·idæŸ¥è¯¢è®¢å•è¡¨ä¸­è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/eduorder/order/isBuyCourse/&#123;courseId&#125;/&#123;memberId&#125;&quot;)</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isBuyCourse</span><span class="params">(<span class="meta">@PathVariable(&quot;courseId&quot;)</span> String courseId, <span class="meta">@PathVariable(&quot;memberId&quot;)</span> String memberId)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¢ï¼šæ¨¡å—Bï¼š</p><p>æ¨¡å—Aæ‰€è°ƒç”¨çš„ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/eduorder/order&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderService orderService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®è¯¾ç¨‹idå’Œç”¨æˆ·idæŸ¥è¯¢è®¢å•è¡¨ä¸­è®¢å•çŠ¶æ€</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;isBuyCourse/&#123;courseId&#125;/&#123;memberId&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBuyCourse</span><span class="params">(<span class="meta">@PathVariable</span> String courseId,<span class="meta">@PathVariable</span> String memberId)</span> &#123;</span><br><span class="line">        QueryWrapper&lt;Order&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;course_id&quot;</span>,courseId);</span><br><span class="line">        wrapper.eq(<span class="string">&quot;member_id&quot;</span>,memberId);</span><br><span class="line">        wrapper.eq(<span class="string">&quot;status&quot;</span>,<span class="number">1</span>);<span class="comment">//æ”¯ä»˜çŠ¶æ€ 1ä»£è¡¨å·²ç»æ”¯ä»˜</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> orderService.count(wrapper);</span><br><span class="line">        <span class="keyword">if</span>(count&gt;<span class="number">0</span>) &#123; <span class="comment">//å·²ç»æ”¯ä»˜</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="8-é…ç½®æ–‡ä»¶çš„è¯»å–"><a href="#8-é…ç½®æ–‡ä»¶çš„è¯»å–" class="headerlink" title="8. é…ç½®æ–‡ä»¶çš„è¯»å–"></a>8. é…ç½®æ–‡ä»¶çš„è¯»å–</h2><p>å®ç°é¡¹ç›®åˆå§‹åŒ–æ—¶å°±å¯¹é…ç½®æ–‡ä»¶è¿›è¡Œè¯»å–ï¼Œéœ€è¦å®ç° <code>InitializingBean</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¯»å–propertiesä¸­æ‰€éœ€çš„å¯†é’¥ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConstantPropertiesUtils</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123; <span class="comment">// é¡¹ç›®åˆå§‹åŒ–æ—¶å°±å¯¹ä¿¡æ¯è¿›è¡Œè¯»å–</span></span><br><span class="line">    <span class="comment">//è¯»å–é…ç½®æ–‡ä»¶å†…å®¹</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.endpoint&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keyid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keyId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.keysecret&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String keySecret;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;aliyun.oss.file.bucketname&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰å…¬å¼€é™æ€å¸¸é‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String END_POIND;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESSS_KEY_ID;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String ACCESSS_KEY_SECRET;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        END_POIND = endpoint;</span><br><span class="line">        ACCESSS_KEY_ID = keyId;</span><br><span class="line">        ACCESSS_KEY_SECRET = keySecret;</span><br><span class="line">        BUCKET_NAME = bucketName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-è®¾ç½®å®šæ—¶ä»»åŠ¡"><a href="#9-è®¾ç½®å®šæ—¶ä»»åŠ¡" class="headerlink" title="9. è®¾ç½®å®šæ—¶ä»»åŠ¡"></a>9. è®¾ç½®å®šæ—¶ä»»åŠ¡</h2><p>â‘ ï¼šåœ¨å¯åŠ¨ç±»ä¸Šæ·»åŠ  <code>@EnableScheduling</code> æ³¨è§£æ¥å¼€å¯å®šæ—¶ä»»åŠ¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.soul&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableScheduling</span> <span class="comment">//å¼€å¯å®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.soul.staservice.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(StaApplication.class,args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šéœ€è¦ä½¿ç”¨ <code>@Scheduled</code> æ³¨è§£ï¼ŒCronè¡¨è¾¾å¼å¯åœ¨ <a href="https://cron.qqe2.com/">åœ¨çº¿Cronè¡¨è¾¾å¼ç”Ÿæˆå™¨ç”Ÿæˆ</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScheduledTask</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StatisticsDailyService staService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åœ¨æ¯å¤©å‡Œæ™¨1ç‚¹ï¼ŒæŠŠå‰ä¸€å¤©æ•°æ®è¿›è¡Œæ•°æ®æŸ¥è¯¢æ·»åŠ </span></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">task2</span><span class="params">()</span> &#123;</span><br><span class="line">        staService.registerCount(DateUtil.formatDate(DateUtil.addDays(<span class="keyword">new</span> <span class="title class_">Date</span>(), -<span class="number">1</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-QQé‚®ç®±çš„ä½¿ç”¨"><a href="#10-QQé‚®ç®±çš„ä½¿ç”¨" class="headerlink" title="10. QQé‚®ç®±çš„ä½¿ç”¨"></a>10. QQé‚®ç®±çš„ä½¿ç”¨</h2><p>â‘ ï¼šå¯¼å…¥ä¾èµ–å¹¶åœ¨é…ç½®æ–‡ä»¶é‡Œé…ç½®ç›¸å…³ï¼ˆpasswordå¦‚ä½•å¾—åˆ°ï¼Ÿä½ å»Googleä¸€ä¸‹å‘—ï¼‰</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é…ç½®</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é‚®ç®±é…ç½®</span></span><br><span class="line"><span class="attr">spring.mail.host</span>=<span class="string">smtp.qq.com</span></span><br><span class="line"><span class="attr">spring.mail.username</span>=<span class="string">1837522825@qq.com</span></span><br><span class="line"><span class="attr">spring.mail.password</span>=<span class="string">akigpratjvhdefbc</span></span><br><span class="line"><span class="attr">spring.mail.default-encoding</span>: <span class="string">UTF-8</span></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šå®ç°ç®€å•é…ç½®è¯»å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.mail.username&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String emailFrom;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getEmailFrom</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> emailFrom;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¢ï¼šç›¸å…³å®ç°ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">EmailService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmailConfig emailConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String,String&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> R <span class="title function_">sendSimpleMail</span><span class="params">(String sendTo)</span> &#123;</span><br><span class="line">        <span class="type">SimpleMailMessage</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleMailMessage</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">code</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            code.append((<span class="type">int</span>)(Math.random()*<span class="number">9</span>));<span class="comment">//éšæœºç”Ÿæˆå…­ä½æ•°éªŒè¯ç </span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> <span class="string">&quot;ç™»å½•éªŒè¯&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> <span class="string">&quot;æ‚¨å¥½ï¼Œæ‚¨çš„éªŒè¯ç ä¸º : &quot;</span> + code;</span><br><span class="line">        <span class="type">String</span> <span class="variable">email</span> <span class="operator">=</span> emailConfig.getEmailFrom();</span><br><span class="line"></span><br><span class="line">        message.setFrom(email);</span><br><span class="line">        message.setTo(sendTo);</span><br><span class="line">        message.setSubject(title);</span><br><span class="line">        message.setText(content);</span><br><span class="line"></span><br><span class="line">        mailSender.send(message);<span class="comment">//å‘é€é‚®ä»¶</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//å­˜åˆ°redisä¸­</span></span><br><span class="line">        redisTemplate.opsForValue().set(email,code.toString(),<span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.ok().message(<span class="string">&quot;éªŒè¯ç å·²å‘é€ï¼Œ5åˆ†é’Ÿå†…æœ‰æ•ˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-é˜¿é‡Œäº‘ossæœåŠ¡"><a href="#11-é˜¿é‡Œäº‘ossæœåŠ¡" class="headerlink" title="11. é˜¿é‡Œäº‘ossæœåŠ¡"></a>11. é˜¿é‡Œäº‘ossæœåŠ¡</h2><p>â‘ ï¼šå¯¼å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é˜¿é‡Œäº‘ossä¾èµ–--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šé…ç½®ç›¸å…³</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜¿é‡Œäº‘ OSS</span></span><br><span class="line"><span class="attr">aliyun.oss.file.endpoint</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.oss.file.keyid</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.oss.file.keysecret</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.oss.file.bucketname</span>=<span class="string">#</span></span><br></pre></td></tr></table></figure><p>â‘¢ï¼šä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">OssService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¸Šä¼ å¤´åƒåˆ°oss</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadFileAvatar</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–å·¥å…·ç±»ä¸­çš„å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">endpoint</span> <span class="operator">=</span> ConstantPropertiesUtils.END_POIND;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accesssKeyId</span> <span class="operator">=</span> ConstantPropertiesUtils.ACCESSS_KEY_ID;</span><br><span class="line">        <span class="type">String</span> <span class="variable">accesssKeySecret</span> <span class="operator">=</span> ConstantPropertiesUtils.ACCESSS_KEY_SECRET;</span><br><span class="line">        <span class="type">String</span> <span class="variable">bucketName</span> <span class="operator">=</span> ConstantPropertiesUtils.BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºOSSå®ä¾‹</span></span><br><span class="line">            <span class="type">OSS</span> <span class="variable">ossClient</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OSSClientBuilder</span>().build(endpoint, accesssKeyId, accesssKeySecret);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//ä¸Šä¼ æ–‡ä»¶æµ</span></span><br><span class="line">            inputStream = file.getInputStream();</span><br><span class="line">            <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//åœ¨æ¯ä¸ªæ–‡ä»¶åå‰æ·»åŠ éšæœºå”¯ä¸€æ•°å€¼ ---&gt; é˜²æ­¢å› æ–‡ä»¶åç›¸åŒè¢«è¦†ç›–</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">//æŠŠæ–‡ä»¶æŒ‰ç…§æ—¥æœŸåˆ†ç±»</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">dateStr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DateTime</span>().toString(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line"></span><br><span class="line">            originalFilename = dateStr + <span class="string">&quot;/&quot;</span> +uuid + originalFilename;</span><br><span class="line"></span><br><span class="line">            ossClient.putObject(bucketName, originalFilename, inputStream);</span><br><span class="line"></span><br><span class="line">            inputStream.close();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//æŠŠä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œæ‹¼æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;https://&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + originalFilename;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡"><a href="#12-é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡" class="headerlink" title="12. é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡"></a>12. é˜¿é‡Œäº‘è§†é¢‘ç‚¹æ’­æœåŠ¡</h2><p>â‘ ï¼šå¼•å…¥ä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun.oss<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-java-sdk-vod<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.aliyun<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aliyun-sdk-vod-upload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šé…ç½®ç›¸å…³</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é˜¿é‡Œäº‘ vod</span></span><br><span class="line"><span class="attr">aliyun.oss.file.endpoint</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.oss.file.bucketname</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.vod.file.keyid</span>=<span class="string">#</span></span><br><span class="line"><span class="attr">aliyun.vod.file.keysecret</span>=<span class="string">#</span></span><br></pre></td></tr></table></figure><p>â‘¡ï¼šä¸Šä¼ è§†é¢‘åˆ°é˜¿é‡Œäº‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VodServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">VodService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¸Šä¼ è§†é¢‘</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">uploadVideo</span><span class="params">(MultipartFile file)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line"></span><br><span class="line">            <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> fileName.substring(<span class="number">0</span>,fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> file.getInputStream();</span><br><span class="line"></span><br><span class="line">            <span class="type">UploadStreamRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadStreamRequest</span>(ConstantVodUtils.ACCESS_KEY_ID,</span><br><span class="line">                    ConstantVodUtils.ACCESS_KEY_SECRET, title, fileName, inputStream);</span><br><span class="line">            <span class="type">UploadVideoImpl</span> <span class="variable">uploader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UploadVideoImpl</span>();</span><br><span class="line">            <span class="type">UploadStreamResponse</span> <span class="variable">response</span> <span class="operator">=</span> uploader.uploadStream(request);</span><br><span class="line">            <span class="type">String</span> <span class="variable">videoId</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (response.isSuccess()) &#123;</span><br><span class="line">                videoId = response.getVideoId();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">//å¦‚æœè®¾ç½®å›è°ƒURLæ— æ•ˆï¼Œä¸å½±å“è§†é¢‘ä¸Šä¼ ï¼Œå¯ä»¥è¿”å›VideoIdåŒæ—¶ä¼šè¿”å›é”™è¯¯ç ã€‚å…¶ä»–æƒ…å†µä¸Šä¼ å¤±è´¥æ—¶ï¼ŒVideoIdä¸ºç©ºï¼Œæ­¤æ—¶éœ€è¦æ ¹æ®è¿”å›é”™è¯¯ç åˆ†æå…·ä½“é”™è¯¯åŸå› </span></span><br><span class="line">                System.out.print(<span class="string">&quot;VideoId=&quot;</span> + response.getVideoId() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                System.out.print(<span class="string">&quot;ErrorCode=&quot;</span> + response.getCode() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">                System.out.print(<span class="string">&quot;ErrorMessage=&quot;</span> + response.getMessage() + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> videoId;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://blog.csdn.net/pengzhisen123/article/details/94409825">Springä¹‹ç¼“å­˜æ³¨è§£@Cacheable</a></p><p><a href="https://blog.csdn.net/qq_41359651/article/details/112260207">Mybatis-Plusä¸­åˆ†é¡µæ’ä»¶PaginationInterceptorï¼Œ MybatisPlusInterceptoråœ¨SpringBootä¸­çš„ä½¿ç”¨</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…&quot;&gt;&lt;a href=&quot;#1-æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…&quot; class=&quot;headerlink&quot; title=&quot;1. æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…&quot;&gt;&lt;/a&gt;1. æ•°æ®åº“å±æ€§è‡ªåŠ¨è£…é…&lt;/h2&gt;&lt;p&gt;è‡ªåŠ¨æ³¨å…¥æ’å…¥æ—¶é—´å’Œæ›´æ–°æ—¶é—´&lt;/p&gt;
&lt;p&gt;åœ¨æ—¥å¸¸çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼ŒD</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>nvm çš„å®‰è£…å’Œä½¿ç”¨</title>
    <link href="http://example.com/2022/05/22/nvm%E6%8C%87%E4%BB%A4/"/>
    <id>http://example.com/2022/05/22/nvm%E6%8C%87%E4%BB%A4/</id>
    <published>2022-05-22T01:19:00.000Z</published>
    <updated>2022-05-24T03:25:42.048Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-å†™åœ¨å‰é¢"><a href="#1-å†™åœ¨å‰é¢" class="headerlink" title="1. å†™åœ¨å‰é¢"></a>1. å†™åœ¨å‰é¢</h2><p>ä¹‹å‰å­¦ä¹ äº†ç½‘ä¸Šä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨çš„ node æ˜¯ <code>10.14.1</code> ç‰ˆæœ¬çš„ï¼Œè€Œéƒ¨ç½²åšå®¢åˆ™éœ€è¦æ›´é«˜ç‰ˆæœ¬çš„ node ï¼Œå¦‚æœæ¯æ¬¡éƒ¨ç½²é¡¹ç›®å’Œéƒ¨ç½²åšå®¢éƒ½è¦å¸è½½ä¸€ä¸ªç‰ˆæœ¬çš„ node ä¸‹è½½å¦ä¸€ä¸ªç‰ˆæœ¬çš„ node ï¼ŒçœŸçš„æ˜¯å¤ªéº»çƒ¦äº†ã€‚äºæ˜¯åœ¨ç½‘ä¸Šæ‰¾å¯ä»¥ç®¡ç† node çš„å·¥å…· nvmã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ <code>nvm-windows</code> çš„ç‰ˆæœ¬ã€‚</p><h2 id="2-nvm-ä¸‹è½½ä¸å®‰è£…"><a href="#2-nvm-ä¸‹è½½ä¸å®‰è£…" class="headerlink" title="2. nvm ä¸‹è½½ä¸å®‰è£…"></a>2. nvm ä¸‹è½½ä¸å®‰è£…</h2><p>ä¸‹è½½åœ°å€ ï¼š<a href="https://github.com/coreybutler/nvm-windows/releases">nvm-windows</a></p><p>â‘ ï¼šå¦‚å›¾æ‰€ç¤ºï¼Œä¸¤ä¸ªå®‰è£…åŒ…éƒ½å¯ä»¥ä¸‹è½½ï¼Œä¸è¿‡ <code>nvm-noinstall.zip</code> éœ€è¦è‡ªè¡Œé…ç½®ç¯å¢ƒå˜é‡ï¼Œè€Œ <code>nvm-setup.zip</code> ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬é…ç½®å¥½ç¯å¢ƒå˜é‡ï¼Œå®‰è£…å¥½åå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚è¿™é‡Œæˆ‘é€‰æ‹©çš„æ˜¯ <code>nvm-setup.zip</code> ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/1.png"></img></p><p>â‘¡ï¼šé¦–å…ˆè¦å¸è½½æ‰ä¹‹å‰ç”µè„‘ä¸Šä¸‹è½½çš„ nodeï¼Œè¿è¡Œä¸‹è½½çš„ <code>nvm-serup.exe</code> æ–‡ä»¶ï¼Œå¼€å§‹å®‰è£…ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/2.png"></img></p><p>è®¾ç½® nvm çš„å®‰è£…ä½ç½®</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/3.png"></img></p><p>è®¾ç½® node çš„å®‰è£…ä½ç½®</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/4.png"></img></p><p>ç„¶åä¸€ç›´ next å³å¯ã€‚</p><p>â‘¢ï¼šå®‰è£…ç»“æŸåï¼Œå¯ä»¥ <code>Win + r</code>ï¼Œè¾“å…¥<code>sysdm.cpl</code> åœ¨ <code>é«˜çº§</code> é‡ŒæŸ¥çœ‹ç¯å¢ƒå˜é‡ï¼Œå‘ç°ç¯å¢ƒå˜é‡å·²ç»å¸®æˆ‘ä»¬é…å¥½äº†ã€‚<code>Path</code>é‡Œä¹Ÿæ·»åŠ äº†è¿™ä¸¤ä¸ªå˜é‡ï¼Œ<code>Path</code> è¿™é‡Œå°±ä¸è´´å›¾äº†ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/5.png"></img></p><p>â‘£ï¼šå®‰è£…å¥½åï¼Œè®°å¾—è¦æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹çš„ä½ç½®è¦ä¸å®‰è£… nvm æ­¥éª¤ä¸­è®¾ç½®çš„ node çš„å®‰è£…ä½ç½®å¯¹åº”ã€‚</p><p>â‘¤ï¼š<code>Win + r</code> ï¼Œè¾“å…¥ <code>cmd</code> è¿›å…¥å‘½ä»¤é¢æ¿ï¼Œè¾“å…¥<code>nvm</code> å‘½ä»¤å³å¯æŸ¥çœ‹ nvm æ˜¯å¦å®‰è£…æˆåŠŸã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/6.png"></img> </p><p>å¦‚å›¾æ‰€ç¤ºï¼Œè¡¨ç¤ºå®‰è£…æˆåŠŸã€‚</p><p>â‘¥ï¼šæ¥ä¸‹æ¥å°±å¯ä»¥å®‰è£…æˆ‘ä»¬æ‰€éœ€è¦çš„ä¸åŒç‰ˆæœ¬çš„ node äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯”å¦‚ 10.14.1 ç‰ˆæœ¬node</span></span><br><span class="line">nvm install 10.14.1</span><br></pre></td></tr></table></figure><p>â‘¦ï¼šå®‰è£…æˆåŠŸåï¼Œå¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ <code>node</code> å’Œ <code>npm</code> ç‰ˆæœ¬ï¼ˆæˆ‘è¿™é‡Œä¹‹å‰å®‰è£…è¿‡äº†ï¼Œå°±ç›´æ¥æŸ¥çœ‹ç‰ˆæœ¬äº†ï¼‰ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/7.png"></img></p><p>å¦‚æœå‡ºç° <code>node ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤ï¼Œä¹Ÿä¸æ˜¯å¯è¿è¡Œçš„ç¨‹åºæˆ–æ‰¹å¤„ç†æ–‡ä»¶</code>ï¼Œå¯ä»¥ä½¿ç”¨ç®¡ç†å‘˜è¿è¡Œã€‚</p><p>â‘§ï¼šä½¿ç”¨å‘½ä»¤æŸ¥çœ‹ç®¡ç†çš„ node çš„ç‰ˆæœ¬ï¼Œå½“å‰ä½¿ç”¨çš„ node ç‰ˆæœ¬å‰ä¼šæœ‰ä¸ª <code>*</code> ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm list</span><br></pre></td></tr></table></figure><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/nvmOrder/8.png"></img></p><p>â‘¨ï¼šåˆ‡æ¢ node ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ¯”å¦‚åˆ‡æ¢åˆ° 16.14.1 ç‰ˆæœ¬</span></span><br><span class="line">nvm use 16.14.1</span><br></pre></td></tr></table></figure><p>å¤§åŠŸå‘Šæˆï¼è¿™æ ·å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚å¾ˆæ–¹ä¾¿çš„åˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„ node äº†ï¼</p><p>æœ¬æ–‡åˆ°æ­¤ä¹Ÿå°±ç»“æŸäº†ï¼Œæœ€åè´´å‡ ä¸ªå¸¸ç”¨å‘½ä»¤ç•™å¾…ä»¥åæŸ¥é˜…ã€‚</p><h2 id="3-nvm-å¸¸ç”¨å‘½ä»¤"><a href="#3-nvm-å¸¸ç”¨å‘½ä»¤" class="headerlink" title="3. nvm å¸¸ç”¨å‘½ä»¤"></a>3. nvm å¸¸ç”¨å‘½ä»¤</h2><p> æ˜¾ç¤ºnvmç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm v     </span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç‰ˆæœ¬åˆ—è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºå·²å®‰è£…çš„ç‰ˆæœ¬ï¼ˆåŒ nvm list installedï¼‰</span></span><br><span class="line">nvm list</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºå·²å®‰è£…çš„ç‰ˆæœ¬</span></span><br><span class="line">nvm list installed</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ˜¾ç¤ºæ‰€æœ‰å¯ä»¥ä¸‹è½½çš„ç‰ˆæœ¬</span></span><br><span class="line">nvm list available </span><br></pre></td></tr></table></figure><p>å®‰è£…æŒ‡å®šç‰ˆæœ¬ node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ¯”å¦‚10.14.2ç‰ˆæœ¬node</span></span><br><span class="line">nvm install 10.14.2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…æœ€æ–°ç‰ˆæœ¬node</span></span><br><span class="line">nvm install latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å®‰è£…æœ€æ–°ç¨³å®šç‰ˆnode.js</span></span><br><span class="line">nvm install stable </span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æŒ‡å®šç‰ˆæœ¬ node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm use 16.14.1</span><br></pre></td></tr></table></figure><p>å¸è½½æŒ‡å®šç‰ˆæœ¬ node</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm uninstall 10.14.2 </span><br></pre></td></tr></table></figure><p>å…³é—­ node ç‰ˆæœ¬ç®¡ç†  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm off                </span><br></pre></td></tr></table></figure><p>å¯ç”¨ node ç‰ˆæœ¬ç®¡ç† </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvm on    </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#1-å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;1. å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;1. å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;ä¹‹å‰å­¦ä¹ äº†ç½‘ä¸Šä¸€ä¸ªé¡¹ç›®ï¼Œä½¿ç”¨çš„ node æ˜¯ &lt;code&gt;10.14.1&lt;/code&gt; ç‰ˆæœ¬çš„ï¼Œè€Œéƒ¨ç½²åš</summary>
      
    
    
    
    
    <category term="å‰ç«¯" scheme="http://example.com/tags/%E5%89%8D%E7%AB%AF/"/>
    
  </entry>
  
  <entry>
    <title>encryptçš„ç›®å½•bug</title>
    <link href="http://example.com/2022/05/10/Encrypt%E7%9A%84%E7%9B%AE%E5%BD%95bug/"/>
    <id>http://example.com/2022/05/10/Encrypt%E7%9A%84%E7%9B%AE%E5%BD%95bug/</id>
    <published>2022-05-10T07:08:00.000Z</published>
    <updated>2022-05-24T03:15:59.276Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h3><p>èµ·åˆæ˜¯ä¸æƒ³æåšæ–‡åŠ å¯†çš„ï¼Œå¥ˆä½•åšå®¢åœ°å€ä¸å°å¿ƒæ³„éœ²ç»™è¡¨å¦¹ï¼Œäºæ˜¯å†³å®šè¿˜æ˜¯è¦æŠ˜è…¾ä¸€ä¸‹è¿™ä¸ªåšæ–‡åŠ å¯†ã€‚</p><p>ï¼ˆğŸ˜ ï¼šè¡¨å¦¹å•Šï¼Œä½ å°±åˆ«æƒ³æ•²è¯ˆæˆ‘äº†ï¼ï¼‰</p><h3 id="å®‰è£…æ’ä»¶"><a href="#å®‰è£…æ’ä»¶" class="headerlink" title="å®‰è£…æ’ä»¶"></a>å®‰è£…æ’ä»¶</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-blog-encrypt</span><br></pre></td></tr></table></figure><h3 id="åŠ å¯†æ–‡ç« "><a href="#åŠ å¯†æ–‡ç« " class="headerlink" title="åŠ å¯†æ–‡ç« "></a>åŠ å¯†æ–‡ç« </h3><p>â‘ ï¼šåœ¨æƒ³è¦åŠ å¯†çš„åšæ–‡å¤´éƒ¨å¢æ·» <code>password</code> , <code>abstract</code> , <code>message</code> å­—æ®µå³å¯ï¼Œä¸‰ä¸ªå­—æ®µå¯åŠ å¯ä¸åŠ ï¼Œä¸åŠ åˆ™é‡‡ç”¨ <code>_config.yml</code> é…ç½®ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Test encrypt</span><br><span class="line">date: 2022-05-09 15:08:00 </span><br><span class="line">tags:</span><br><span class="line">- Java</span><br><span class="line">password: hello</span><br><span class="line">abstract: Welcome to my blog, enter password to read. //åšå®¢éƒ¨åˆ†æ‘˜è¦</span><br><span class="line">message: Welcome to my blog, enter password to read.  //å¯†ç è¾“å…¥æ¡†ä¸Šé¢çš„æè¿°æ€§æ–‡å­—</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>â‘¡ï¼šåœ¨<strong>åšå®¢æ ¹ç›®å½•</strong> çš„<code>_config.yml</code>ä¸­æ·»åŠ é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Security</span></span><br><span class="line"><span class="attr">encrypt:</span></span><br><span class="line">  <span class="attr">silent:</span> <span class="literal">true</span> <span class="comment">#ç¦ç”¨æ—¥å¿—</span></span><br><span class="line">  <span class="attr">theme:</span> <span class="string">xray</span>  <span class="comment">#åŠ å¯†çš„ä¸»é¢˜ï¼ˆä¸æ˜¯hexoä¸»é¢˜ï¼Œå¯åˆ° github ä¸Š probberechts/hexo-theme-cactus çš„ readme.md æŸ¥çœ‹ ï¼‰</span></span><br><span class="line">  <span class="attr">abstract:</span> <span class="string">Please</span> <span class="string">enter</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read</span> <span class="comment">#åšå®¢éƒ¨åˆ†æ‘˜è¦</span></span><br><span class="line">  <span class="attr">message:</span> <span class="string">Please</span> <span class="string">enter</span> <span class="string">password</span> <span class="string">to</span> <span class="string">read</span>  <span class="comment">#å¯†ç è¾“å…¥æ¡†ä¸Šé¢çš„æè¿°æ€§æ–‡å­—</span></span><br><span class="line">  <span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tagName</span>, <span class="attr">password:</span> <span class="string">å¯†ç A</span>&#125;</span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">tagName</span>, <span class="attr">password:</span> <span class="string">å¯†ç B</span>&#125;</span><br><span class="line">  <span class="attr">wrong_pass_message:</span> <span class="literal">no</span> <span class="string">Permissions.</span>  <span class="comment">#å¯†ç é”™è¯¯æç¤º</span></span><br><span class="line">  <span class="attr">wrong_hash_message:</span> <span class="string">can</span> <span class="string">not</span> <span class="string">Verify.</span>  <span class="comment">#å“ˆå¸Œé”™è¯¯æç¤º</span></span><br></pre></td></tr></table></figure><p>â‘¢ï¼š<strong>é…ç½®ä¼˜å…ˆçº§</strong>ï¼šåšæ–‡å¤´éƒ¨é…ç½® &gt; ymlæ–‡ä»¶é…ç½® &gt; é»˜è®¤é…ç½®</p><p>â‘£ï¼šè‹¥æƒ³ç¦ç”¨æ ‡ç­¾<code>(tag)</code>åŠ å¯†ï¼Œåªéœ€å°†<code>password</code>å±æ€§è®¾ç½®ä¸º<code>&quot;&quot;</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Callback Test</span><br><span class="line">date: 2019-12-21 11:54:07</span><br><span class="line">tags:</span><br><span class="line">- A Tag should be encrypted</span><br><span class="line">password: &quot;&quot;</span><br><span class="line">---</span><br><span class="line">Use a &quot;&quot; to disable tag encryption.</span><br></pre></td></tr></table></figure><p>â‘¤ï¼šåŠ å¯†æˆåŠŸæ¼”ç¤ºï¼š</p><ul><li><p>æ–°å»ºä¸€ä¸ª <code>markdown</code> æ–‡æ¡£å¹¶æ¨é€åˆ° github ï¼Œå†…å®¹å¦‚ä¸‹ã€‚</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/1.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>è¢«åŠ å¯†åçš„åšæ–‡ç•Œé¢</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/2.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>è¾“å…¥å¯†ç å¹¶å›è½¦</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/3.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>å†…å®¹æ˜¾ç¤ºæˆåŠŸï¼Œå¹¶ä¸”å¯ä»¥ç‚¹å‡» <code>Encrypt again</code> æŒ‰é’®å›åˆ°åŠ å¯†ç•Œé¢</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/4.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><h3 id="Bug"><a href="#Bug" class="headerlink" title="Bug!"></a>Bug!</h3><p>å½“æˆ‘åœ¨ä¸ºæˆåŠŸå®ç°åšæ–‡åŠ å¯†åŠŸèƒ½æ²¾æ²¾è‡ªå–œï¼ˆğŸ˜ƒï¼‰æ—¶ï¼Œçªç„¶å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>å“æˆ‘ç›®å½•å‘¢ï¼Ÿï¼</strong>ï¼ˆ ğŸ¤¡ ï¼‰</p><h3 id="åˆ†æBug"><a href="#åˆ†æBug" class="headerlink" title="åˆ†æBug"></a>åˆ†æBug</h3><p>â‘ ï¼šæ£€æŸ¥ç›®å½•å¯¹åº”ä»£ç ï¼Œå‘ç°è§£å¯†å‰åç›®å½•æ ‡ç­¾é‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰</p><ul><li><p>è§£å¯†å‰ç•Œé¢</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/5.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>è§£å¯†åç•Œé¢</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/6.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><p>â‘¡ï¼šå› ä¸ºæœ¬äººå‰ç«¯éƒ¨åˆ†åªèƒ½ç®—æ˜¯å°èœé¸¡ï¼Œåªèƒ½ç”¨æœ€ç¬¨çš„åŠæ³•æ ¹æ®æ ‡ç­¾idå»æ–‡ä»¶é‡Œå»æ‰¾äº†ã€‚</p><p>å› ä¸ºæ˜¯æ–‡ç« éƒ¨åˆ†ï¼Œæ‰€ä»¥ç›´æ¥å®šä½åˆ° <code>_partial\post</code>  çš„å„ä¸ª<code>ejs</code>æ–‡ä»¶ï¼Œå¯»æ‰¾çš„æ–¹æ³•å¾ˆç®€å•ï¼Œ<code>CTRL + F</code> æœç´¢ <code>toc</code> å³å¯ã€‚</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/7.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>â‘¢ï¼šæœ€ç»ˆå‘ç° <code>toc</code> åœ¨ <code>actions_desktop.ejs</code> å’Œ <code>actions_mobile.ejs</code>ä¸­å‡ºç°ã€‚è§åçŸ¥æ„ï¼Œä¸€ä¸ªæ˜¯pcç«¯ä¸€ä¸ªæ˜¯ç§»åŠ¨ç«¯å‘—ã€‚</p><p>ä»¥ pcç«¯ä¸ºä¾‹åˆ†æï¼š</p><ul><li><p>å‘ç°åªæœ‰ä¸€å¤„åœ°æ–¹å‡ºç°äº† <code>toc</code></p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/8.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>è€Œç»æŸ¥ç•¥ <a href="https://github.com/D0n9X1n/hexo-blog-encrypt/issues/16">issue</a>ï¼Œäº†è§£åˆ°TOCçš„åŠ è½½åŸç†æ˜¯ï¼š</p><ul><li>åœ¨æ‰§è¡Œ <code>hexo g</code> æ—¶ä¼šæŒ‰ç…§åšæ–‡å†…å®¹ç”Ÿæˆ TOCï¼Œç„¶åé»˜è®¤éšè—ä¸å‡ºç°ã€‚</li><li>åœ¨<code>Encrypt</code> å¯¹æ–‡ç« è¿›è¡ŒåŠ å¯†æ—¶ï¼Œ<code>page.content</code> ä¼šå˜æˆåŠ å¯†åçš„ä¸²ï¼Œæ‰€ä»¥åŸæ¥ TOC ç”Ÿæˆé€»è¾‘å°±ä¼šé’ˆå¯¹åŠ å¯†åçš„å†…å®¹ã€‚</li></ul></li></ul><p>ï¼ˆğŸ¤”ï¼‰</p><h3 id="è§£å†³Bug"><a href="#è§£å†³Bug" class="headerlink" title="è§£å†³Bug"></a>è§£å†³Bug</h3><p>â‘ ï¼šåŸç†äº†è§£åå°±å¯ä»¥åŠ¨æ‰‹è§£å†³Bugäº†</p><ol><li>å¯ä»¥æŠŠæ–‡ç« åŸæ¥çš„å†…å®¹å…ˆä¿å­˜èµ·æ¥ï¼Œæ¯”å¦‚ä¿å­˜è¿› <code>page.origin</code> å­—æ®µ</li><li>ç„¶åå¯ä»¥åˆ¤æ–­æ–‡ç« æ˜¯å¦åŠ å¯†ï¼Œé’ˆå¯¹ä¸åŒçš„å†…å®¹è¿›è¡Œ TOC ç”Ÿæˆã€‚</li><li>ä½†æ˜¯ç”Ÿæˆçš„ TOC æ˜¯åŸºäºåŸæ–‡çš„ï¼Œæ‰€ä»¥é»˜è®¤éšè—ï¼Œéœ€è¦è¾“å…¥å¯†ç åæ‰èƒ½æ˜¾ç¤ºå‡ºæ¥</li></ol><p>â‘¡ï¼šåŠ¨æ‰‹è§£å†³Bug</p><ul><li><p>pcç«¯ï¼ˆactions_desktop.ejsï¼‰ï¼š</p><p>åŸä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc&quot;</span>&gt;</span></span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc&quot;</span> &lt;% <span class="attr">if</span> (<span class="attr">page.encrypt</span> == <span class="string">true)</span> &#123; %&gt;</span>style=&quot;display:none&quot; &lt;% &#125; %&gt;&gt;</span><br><span class="line">&lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.origin) %&gt;</span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>ç§»åŠ¨ç«¯ï¼ˆactions_mobile.ejs ï¼‰</p><p>åŸä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span></span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡ä¿®æ”¹ï¼š</p><p>â€‹<b>ä¸èµ·ä½œç”¨ï¼Œè¿™æ˜¯å› ä¸ºåœ¨æ¯æ¬¡åŠ è½½é¡µé¢æ—¶ï¼Œå¦‚æœåˆ¤æ–­å½“å‰æ˜¯ç§»åŠ¨ç«¯ï¼Œä¼šæœ‰jsä»£ç å¸®æˆ‘ä»¬æŠŠ <code>style=&quot;display:none&quot;</code> ä¿®æ”¹ä¸º<code>style=&quot;display:inline&quot;</code></b>ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span> </span><br><span class="line">&lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.origin) %&gt;</span><br><span class="line">&lt;% &#125; else &#123; %&gt;</span><br><span class="line">&lt;%- toc(page.content) %&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ¬¡ä¿®æ”¹ï¼š</p><p>â€‹<b>çŸ¥é“åŸå› åå°±ç®€å•äº†ï¼Œåœ¨é‡Œé¢å¥—ä¸€ä¸ª <code>&lt;div&gt;</code> æ ‡ç­¾ä¸å°±å¾—å˜ï¼ˆğŸ˜„ï¼‰</b></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span> </span><br><span class="line">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;toc-footer2&quot;</span> &lt;% <span class="attr">if</span> (<span class="attr">page.encrypt</span> == <span class="string">true)</span> &#123; %&gt;</span>style=&quot;display:none&quot; &lt;% &#125; %&gt;&gt;</span><br><span class="line">       &lt;% if (page.encrypt == true) &#123; %&gt;</span><br><span class="line">         &lt;%- toc(page.origin) %&gt;</span><br><span class="line">       &lt;% &#125; else &#123; %&gt;</span><br><span class="line">         &lt;%- toc(page.content) %&gt;</span><br><span class="line">       &lt;% &#125; %&gt;</span><br><span class="line">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><p>â‘¢ï¼šè¿˜å·®æœ€åä¸€æ­¥ï¼Œæ¯æ¬¡ä» åŠ å¯†çŠ¶æ€ -&gt;è§£å¯†çŠ¶æ€ è¿›è¡Œåˆ‡æ¢æ—¶ï¼Œéƒ½éœ€è¦æˆ‘ä»¬è‡ªå·±è°ƒç”¨å‡½æ•°ï¼Œå°†<code>style=&quot;display: none&quot;</code>ä¿®æ”¹ä¸º<code>style=&quot;display: inline&quot;</code>ï¼Œç¡®å®æœ‰ç‚¹éº»çƒ¦å“ˆï¼ˆå‚è€ƒäº<a href="https://github.com/D0n9X1n/hexo-blog-encrypt#about-callback">å®˜æ–¹</a>çš„<code>Callback</code>ï¼‰ã€‚</p><p>åœ¨éœ€è¦åŠ å¯†çš„æ–‡ç« æœ€ååŠ å…¥ä»¥ä¸‹jsä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc&quot;</span>).<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc-footer2&quot;</span>)) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;toc-footer2&quot;</span>).<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">    &#125;  </span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚å›¾ï¼š</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/9.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>â‘£ï¼šæœ€ç»ˆæµ‹è¯•</p><ul><li><p>pcç«¯æœªè§£å¯†ç•Œé¢ï¼šæ²¡æœ‰ç›®å½•</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/10.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>pcç«¯è§£å¯†åç•Œé¢ï¼šå‡ºç°ç›®å½•</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/11.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>ç§»åŠ¨ç«¯æœªè§£å¯†ç•Œé¢ï¼šæ²¡æœ‰ç›®å½•</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/12.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li><li><p>ç§»åŠ¨ç«¯è§£å¯†åç•Œé¢ï¼šå‡ºç°ç›®å½•</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/encrypt/13.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/></li></ul><p>ï¼ˆğŸ˜ï¼‰</p><h3 id="End"><a href="#End" class="headerlink" title="End"></a>End</h3><p>ï¼ˆğŸ¤ºï¼šæœ¬äººåœ¨å‰ç«¯éƒ¨åˆ†åªèƒ½ç®—æ˜¯å°èœé¸¡ï¼Œè‹¥æœ‰é”™è¯¯ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚ï¼‰</p><p>ï¼ˆğŸ˜­ï¼šè¿˜æœ‰å°±æ˜¯ä½¿ç”¨cactusä¸»é¢˜çš„å‰è¾ˆä»¬å®åœ¨å¤ªå°‘äº†ï¼Œæƒ³æ‡’äººå¤§æ³•éƒ½æ‰¾ä¸ç€Cçš„åœ°æ–¹ã€‚ä¸è¿‡è¿™æ¬¡æ‰’ä»£ç ï¼Œè¿˜æ˜¯å¾ˆæœ‰æŸç§æ”¶è·å§ï¼ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h3&gt;&lt;p&gt;èµ·åˆæ˜¯ä¸æƒ³æåšæ–‡åŠ å¯†çš„ï¼Œå¥ˆä½•åšå®¢åœ°å€ä¸å°å¿ƒæ³„éœ²ç»™è¡¨å¦¹ï¼Œäºæ˜¯å†³å®šè¿˜æ˜¯è¦æŠ˜è…¾ä¸€ä¸‹è¿™ä¸ªåšæ–‡åŠ å¯†ã€‚&lt;/p&gt;
&lt;p&gt;ï¼ˆğŸ˜ ï¼šè¡¨å¦¹å•Šï¼Œ</summary>
      
    
    
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
    <category term="Bug" scheme="http://example.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>busuanzi&amp;live2d bug</title>
    <link href="http://example.com/2022/05/09/%E4%B8%8D%E8%92%9C%E5%AD%90&amp;%E7%9C%8B%E6%9D%BF%E5%96%B5bug/"/>
    <id>http://example.com/2022/05/09/%E4%B8%8D%E8%92%9C%E5%AD%90&amp;%E7%9C%8B%E6%9D%BF%E5%96%B5bug/</id>
    <published>2022-05-09T00:48:00.000Z</published>
    <updated>2022-05-24T05:10:34.897Z</updated>
    
    <content type="html"><![CDATA[<h2 id="bugå¼•å…¥"><a href="#bugå¼•å…¥" class="headerlink" title="bugå¼•å…¥"></a>bugå¼•å…¥</h2><p>â€ƒåœ¨å·²ç»ä½¿ç”¨ä¸è’œå­æ’ä»¶å®ç°æµé‡ç»Ÿè®¡çš„Hexoåšå®¢ä¸­å¯¹é¡µé¢è¿›ä¸€æ­¥ç¾åŒ–æ—¶ï¼ŒåŠ å…¥live2dçœ‹æ¿å¨˜å¯¼è‡´ä¸è’œå­å¤±æ•ˆã€‚å®è·µå‘ç°å¯åŠ¨live2dæ’ä»¶åŠŸèƒ½æ—¶ï¼ˆå³é…ç½®æ–‡ä»¶ä¸­<code>enable: true</code>ï¼‰ï¼Œä¸è’œå­å¤±æ•ˆï¼Œå…³é—­æ’ä»¶ï¼ˆ<code>enable: false</code>ï¼‰ï¼Œä¸è’œå­åŠŸèƒ½æ­£å¸¸ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#çœ‹æ¿å–µ</span><br><span class="line">live2d:</span><br><span class="line">  enable: true  #æ˜¯å¦å¯ç”¨live2d</span><br><span class="line">  scriptFrom: local</span><br><span class="line">  model: </span><br><span class="line">    use: live2d-widget-model-hijiki #æ¨¡å‹é€‰æ‹©</span><br><span class="line">  display: </span><br><span class="line">    position: left   </span><br><span class="line">    width: 140       </span><br><span class="line">    height: 280      </span><br><span class="line">  mobile: </span><br><span class="line">    show: false      </span><br></pre></td></tr></table></figure><h2 id="è§£å†³bug"><a href="#è§£å†³bug" class="headerlink" title="è§£å†³bug"></a>è§£å†³bug</h2><p>â‘ ï¼šåˆ†åˆ«å¯¹ä¸è’œå­åŠŸèƒ½æ­£å¸¸å’Œéæ­£å¸¸çŠ¶æ€ä¸‹çš„é¡µé¢ä»£ç è¿›è¡Œåˆ†æï¼Œå‘ç°ä¸è’œå­å¤±æ•ˆæ—¶çš„ä»£ç ä¸­æ˜¾ç¤º<code>style=&quot;display: none;&quot;</code>ï¼Œ</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/(busuanzi&live2d)bug/14.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>è€Œå…³é—­ live2d æ’ä»¶åæ­£å¸¸çŠ¶æ€ä¸‹æ˜¯<code>style=&quot;display: inline;&quot;</code>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src='http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/(busuanzi&live2d)bug/15.png' align='center' style=' width:1888px; border:dashed 1px #008B8B; '/><p>â‘¡ï¼šæŸ¥çœ‹è‡ªå·±æ·»åŠ çš„ä¸è’œå­ä»£ç ï¼Œæœ¬äººæ·»åŠ ä»£ç çš„ä½ç½®ä¸º <code>themes\cactus\layout\_partial\footer.ejs</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸è’œå­ç»Ÿè®¡è®¿é—®é‡ --&gt;</span></span><br><span class="line">&lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥ä¸è’œå­--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>åœ¨ç½‘é¡µä¸­ç›´æ¥æ‰“å¼€æˆ‘ä»¬å¼•å…¥çš„jsï¼Œå¾—åˆ°å®ç°ä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bszCaller,bszTag;!<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> c,d,e,a=!<span class="number">1</span>,b=[];ready=<span class="keyword">function</span>(<span class="params">c</span>)&#123;<span class="keyword">return</span> a||<span class="string">&quot;interactive&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>||<span class="string">&quot;complete&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>?c.<span class="title function_">call</span>(<span class="variable language_">document</span>):b.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> c.<span class="title function_">call</span>(<span class="variable language_">this</span>)&#125;),<span class="variable language_">this</span>&#125;,d=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="number">0</span>,c=b.<span class="property">length</span>;c&gt;a;a++)b[a].<span class="title function_">apply</span>(<span class="variable language_">document</span>);b=[]&#125;,e=<span class="keyword">function</span>(<span class="params"></span>)&#123;a||(a=!<span class="number">0</span>,d.<span class="title function_">call</span>(<span class="variable language_">window</span>),<span class="variable language_">document</span>.<span class="property">removeEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">detachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,e),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(<span class="built_in">clearInterval</span>(c),c=<span class="literal">null</span>)))&#125;,<span class="variable language_">document</span>.<span class="property">addEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="regexp">/loaded|complete/</span>.<span class="title function_">test</span>(<span class="variable language_">document</span>.<span class="property">readyState</span>)&amp;&amp;<span class="title function_">e</span>()&#125;),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(c=<span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;a||<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">&quot;left&quot;</span>)&#125;<span class="keyword">catch</span>(b)&#123;<span class="keyword">return</span>&#125;<span class="title function_">e</span>()&#125;,<span class="number">5</span>)))&#125;(),bszCaller=&#123;<span class="attr">fetch</span>:<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="keyword">var</span> c=<span class="string">&quot;BusuanziCallback_&quot;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1099511627776</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>());<span class="variable language_">window</span>[c]=<span class="variable language_">this</span>.evalCall(b),a=a.<span class="title function_">replace</span>(<span class="string">&quot;=BusuanziCallback&quot;</span>,<span class="string">&quot;=&quot;</span>+c),scriptTag=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;SCRIPT&quot;</span>),scriptTag.<span class="property">type</span>=<span class="string">&quot;text/javascript&quot;</span>,scriptTag.<span class="property">defer</span>=!<span class="number">0</span>,scriptTag.<span class="property">src</span>=a,scriptTag.<span class="property">referrerPolicy</span>=<span class="string">&quot;no-referrer-when-downgrade&quot;</span>,<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;HEAD&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(scriptTag)&#125;,<span class="attr">evalCall</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;<span class="title function_">a</span>(b),scriptTag.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(scriptTag)&#125;<span class="keyword">catch</span>(c)&#123;bszTag.<span class="title function_">hides</span>()&#125;&#125;)&#125;&#125;&#125;,bszCaller.<span class="title function_">fetch</span>(<span class="string">&quot;//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback&quot;</span>,<span class="keyword">function</span>(<span class="params">a</span>)&#123;bszTag.<span class="title function_">texts</span>(a),bszTag.<span class="title function_">shows</span>()&#125;),bszTag=&#123;<span class="attr">bszs</span>:[<span class="string">&quot;site_pv&quot;</span>,<span class="string">&quot;page_pv&quot;</span>,<span class="string">&quot;site_uv&quot;</span>],<span class="attr">texts</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="keyword">var</span> c=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_value_&quot;</span>+b);c&amp;&amp;(c.<span class="property">innerHTML</span>=a[b])&#125;)&#125;,<span class="attr">hides</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;none&quot;</span>)&#125;)&#125;,<span class="attr">shows</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>)&#125;)&#125;&#125;;</span><br></pre></td></tr></table></figure><p>â‘¢ï¼šè€Œè§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œé¦–å…ˆæ˜¯å°†ä¸è’œå­çš„jsæ’ä»¶ä¿å­˜åˆ°æœ¬åœ°ã€‚è¿™ä¸ªä½ç½®å¾ˆé‡è¦ï¼Œåé¢éœ€è¦å¼•å…¥è¿™ä¸ªä½ç½®çš„jsæ–‡ä»¶ã€‚</p><p>åœ¨æˆ‘çš„ä¸»é¢˜ä¸­ä½äº<code>\themes\cactus\source\lib\busuanzi\busuanzi.pure.mini.js</code>ã€‚</p><p>å°†jsæ–‡ä»¶æ›´æ”¹ä¸ºå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bszCaller,bszTag;!<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> c,d,e,a=!<span class="number">1</span>,b=[];ready=<span class="keyword">function</span>(<span class="params">c</span>)&#123;<span class="keyword">return</span> a||<span class="string">&quot;interactive&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>||<span class="string">&quot;complete&quot;</span>===<span class="variable language_">document</span>.<span class="property">readyState</span>?c.<span class="title function_">call</span>(<span class="variable language_">document</span>):b.<span class="title function_">push</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">return</span> c.<span class="title function_">call</span>(<span class="variable language_">this</span>)&#125;),<span class="variable language_">this</span>&#125;,d=<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=<span class="number">0</span>,c=b.<span class="property">length</span>;c&gt;a;a++)b[a].<span class="title function_">apply</span>(<span class="variable language_">document</span>);b=[]&#125;,e=<span class="keyword">function</span>(<span class="params"></span>)&#123;a||(a=!<span class="number">0</span>,d.<span class="title function_">call</span>(<span class="variable language_">window</span>),<span class="variable language_">document</span>.<span class="property">removeEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">removeEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">detachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,e),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(<span class="built_in">clearInterval</span>(c),c=<span class="literal">null</span>)))&#125;,<span class="variable language_">document</span>.<span class="property">addEventListener</span>?<span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;DOMContentLoaded&quot;</span>,e,!<span class="number">1</span>):<span class="variable language_">document</span>.<span class="property">attachEvent</span>&amp;&amp;(<span class="variable language_">document</span>.<span class="title function_">attachEvent</span>(<span class="string">&quot;onreadystatechange&quot;</span>,<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="regexp">/loaded|complete/</span>.<span class="title function_">test</span>(<span class="variable language_">document</span>.<span class="property">readyState</span>)&amp;&amp;<span class="title function_">e</span>()&#125;),<span class="variable language_">window</span>==<span class="variable language_">window</span>.<span class="property">top</span>&amp;&amp;(c=<span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;a||<span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">doScroll</span>(<span class="string">&quot;left&quot;</span>)&#125;<span class="keyword">catch</span>(b)&#123;<span class="keyword">return</span>&#125;<span class="title function_">e</span>()&#125;,<span class="number">5</span>)))&#125;(),bszCaller=&#123;<span class="attr">fetch</span>:<span class="keyword">function</span>(<span class="params">a,b</span>)&#123;<span class="keyword">var</span> c=<span class="string">&quot;BusuanziCallback_&quot;</span>+<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="number">1099511627776</span>*<span class="title class_">Math</span>.<span class="title function_">random</span>());<span class="variable language_">window</span>[c]=<span class="variable language_">this</span>.evalCall(b),a=a.<span class="title function_">replace</span>(<span class="string">&quot;=BusuanziCallback&quot;</span>,<span class="string">&quot;=&quot;</span>+c),scriptTag=<span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;SCRIPT&quot;</span>),scriptTag.<span class="property">type</span>=<span class="string">&quot;text/javascript&quot;</span>,scriptTag.<span class="property">defer</span>=!<span class="number">0</span>,scriptTag.<span class="property">src</span>=a,<span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&quot;HEAD&quot;</span>)[<span class="number">0</span>].<span class="title function_">appendChild</span>(scriptTag)&#125;,<span class="attr">evalCall</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="title function_">ready</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">try</span>&#123;<span class="title function_">a</span>(b),scriptTag.<span class="property">parentElement</span>.<span class="title function_">removeChild</span>(scriptTag)&#125;<span class="keyword">catch</span>(c)&#123;bszTag.<span class="title function_">hides</span>()&#125;&#125;)&#125;&#125;&#125;,bszCaller.<span class="title function_">fetch</span>(<span class="string">&quot;//busuanzi.ibruce.info/busuanzi?jsonpCallback=BusuanziCallback&quot;</span>,<span class="keyword">function</span>(<span class="params">a</span>)&#123;bszTag.<span class="title function_">texts</span>(a),bszTag.<span class="title function_">shows</span>()&#125;),bszTag=&#123;<span class="attr">bszs</span>:[<span class="string">&quot;site_pv&quot;</span>,<span class="string">&quot;page_pv&quot;</span>,<span class="string">&quot;site_uv&quot;</span>],<span class="attr">texts</span>:<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">b</span>)&#123;<span class="keyword">var</span> c=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_value_&quot;</span>+b);c&amp;&amp;(c.<span class="property">innerHTML</span>=a[b])&#125;)&#125;,<span class="attr">hides</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;&quot;</span>)&#125;)&#125;,<span class="attr">shows</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="variable language_">this</span>.<span class="property">bszs</span>.<span class="title function_">map</span>(<span class="keyword">function</span>(<span class="params">a</span>)&#123;<span class="keyword">var</span> b=<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;busuanzi_container_&quot;</span>+a);b&amp;&amp;(b.<span class="property">style</span>.<span class="property">display</span>=<span class="string">&quot;inline&quot;</span>)&#125;)&#125;&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ“ä½œå…¶å®å°±æ˜¯æŠŠå…¶ä¸­çš„<b><code>b.style.display=&quot;none&quot;</code>ä¸­<code>none</code></b>å»æ‰ã€‚</p><p>â‘£ï¼šç„¶ååˆ° æ·»åŠ çš„ä¸è’œå­ä»£ç çš„ä½ç½® ä¿®æ”¹ä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ä¸è’œå­ç»Ÿè®¡è®¿é—®é‡ --&gt;</span></span><br><span class="line">&lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¼•å…¥ä¸è’œå­(è·¯å¾„ä¿®æ”¹ä¸ºè‡ªå·±ä¸‹è½½jsçš„åœ°å€)--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/lib/busuanzi/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>â‘¤ï¼šå¯å‚è€ƒæœ¬äººfooter.ejs å…¨éƒ¨ä»£ç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">id</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-left&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- ç½‘ç«™è¿è¡Œæ—¶é—´ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;timeDate&quot;</span>&gt;</span>è½½å…¥å¤©æ•°...<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;times&quot;</span>&gt;</span>è½½å…¥æ—¶åˆ†ç§’...<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>(); </span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">function</span> <span class="title function_">createtime</span>(<span class="params"></span>) &#123; </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> grt= <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="string">&quot;05/06/2022 22:38:00&quot;</span>);<span class="comment">//å»ºç«™æ—¶é—´ æ ¼å¼ï¼šæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’</span></span></span><br><span class="line"><span class="language-javascript">                now.<span class="title function_">setTime</span>(now.<span class="title function_">getTime</span>()+<span class="number">250</span>); </span></span><br><span class="line"><span class="language-javascript">                days = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> / <span class="number">24</span>; dnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(days); </span></span><br><span class="line"><span class="language-javascript">                hours = (now - grt ) / <span class="number">1000</span> / <span class="number">60</span> / <span class="number">60</span> - (<span class="number">24</span> * dnum); hnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(hours); </span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">if</span>(<span class="title class_">String</span>(hnum).<span class="property">length</span> ==<span class="number">1</span> )&#123;hnum = <span class="string">&quot;0&quot;</span> + hnum;&#125; minutes = (now - grt ) / <span class="number">1000</span> /<span class="number">60</span> - (<span class="number">24</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * hnum); </span></span><br><span class="line"><span class="language-javascript">                mnum = <span class="title class_">Math</span>.<span class="title function_">floor</span>(minutes); <span class="keyword">if</span>(<span class="title class_">String</span>(mnum).<span class="property">length</span> ==<span class="number">1</span> )&#123;mnum = <span class="string">&quot;0&quot;</span> + mnum;&#125; </span></span><br><span class="line"><span class="language-javascript">                seconds = (now - grt ) / <span class="number">1000</span> - (<span class="number">24</span> * <span class="number">60</span> * <span class="number">60</span> * dnum) - (<span class="number">60</span> * <span class="number">60</span> * hnum) - (<span class="number">60</span> * mnum); </span></span><br><span class="line"><span class="language-javascript">                snum = <span class="title class_">Math</span>.<span class="title function_">round</span>(seconds); <span class="keyword">if</span>(<span class="title class_">String</span>(snum).<span class="property">length</span> ==<span class="number">1</span> )&#123;snum = <span class="string">&quot;0&quot;</span> + snum;&#125; </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;timeDate&quot;</span>).<span class="property">innerHTML</span> = <span class="string">&quot;has been running for &quot;</span>+dnum+<span class="string">&quot; d &quot;</span>; </span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;times&quot;</span>).<span class="property">innerHTML</span> = hnum + <span class="string">&quot; h &quot;</span> + mnum + <span class="string">&quot; m &quot;</span> + snum + <span class="string">&quot; s&quot;</span>; </span></span><br><span class="line"><span class="language-javascript">            &#125; </span></span><br><span class="line"><span class="language-javascript">        <span class="built_in">setInterval</span>(<span class="string">&quot;createtime()&quot;</span>,<span class="number">250</span>);</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- ç‰ˆæƒå¹´ä»½ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">          &lt;%= __(&#x27;footer.copyright&#x27;) %&gt; <span class="symbol">&amp;copy;</span></span><br><span class="line">          &lt;% var endYear = (theme.copyright &amp;&amp; theme.copyright.end_year) ? theme.copyright.end_year : new Date().getFullYear() %&gt;</span><br><span class="line">          &lt;% var startYear = (theme.copyright &amp;&amp; theme.copyright.start_year) ? theme.copyright.start_year : new Date().getFullYear() %&gt;</span><br><span class="line">          &lt;%= startYear &gt;= endYear ? endYear : startYear + &quot;-&quot; + endYear %&gt;</span><br><span class="line">          &lt;%= config.author || config.title %&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">       </span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">nav</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- å¯¼èˆªæ  --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;% for (var i in theme.nav) &#123; %&gt;<span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">          --&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(theme.nav[i]) %&gt;&quot;</span>&gt;</span>&lt;%= __(&#x27;nav.&#x27;+i).replace(&quot;nav.&quot;, &quot;&quot;) %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        --&gt;</span>&lt;% &#125; %&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">          <span class="comment">&lt;!-- ä¸è’œå­ç»Ÿè®¡è®¿é—®é‡ --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            &lt;% if (theme.busuanzi &amp;&amp; theme.busuanzi.enable)&#123; %&gt;       </span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-pv&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-eye&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-value&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span>|<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;site-uv&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span> </span><br><span class="line">                  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;busuanzi-user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_uv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;/<span class="name">span</span>&gt;</span>     </span><br><span class="line">            <span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;/lib/busuanzi/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">            &lt;% &#125; %&gt;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br></pre></td></tr></table></figure><p>é—®é¢˜è§£å†³ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;bugå¼•å…¥&quot;&gt;&lt;a href=&quot;#bugå¼•å…¥&quot; class=&quot;headerlink&quot; title=&quot;bugå¼•å…¥&quot;&gt;&lt;/a&gt;bugå¼•å…¥&lt;/h2&gt;&lt;p&gt;â€ƒåœ¨å·²ç»ä½¿ç”¨ä¸è’œå­æ’ä»¶å®ç°æµé‡ç»Ÿè®¡çš„Hexoåšå®¢ä¸­å¯¹é¡µé¢è¿›ä¸€æ­¥ç¾åŒ–æ—¶ï¼ŒåŠ å…¥live2dçœ‹æ¿å¨˜å¯¼è‡´ä¸è’œå­å¤±æ•ˆã€‚å®è·µå‘ç°</summary>
      
    
    
    
    
    <category term="Hexo" scheme="http://example.com/tags/Hexo/"/>
    
    <category term="Bug" scheme="http://example.com/tags/Bug/"/>
    
  </entry>
  
  <entry>
    <title>CMS&amp;G1å…«è‚¡æ–‡</title>
    <link href="http://example.com/2022/04/30/CMS&amp;G1-%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://example.com/2022/04/30/CMS&amp;G1-%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2022-04-30T10:29:31.000Z</published>
    <updated>2022-05-31T04:40:33.952Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Serial-æ”¶é›†å™¨"><a href="#Serial-æ”¶é›†å™¨" class="headerlink" title="Serial  æ”¶é›†å™¨"></a>Serial  æ”¶é›†å™¨</h2><p><img src="https://javaguide.cn/assets/46873026.3a9311ec.png" alt=" Serial æ”¶é›†å™¨ "></p><p>â‘ ï¼šæ˜¯å•çº¿ç¨‹å›æ”¶å™¨ï¼Œå†å²æœ€æ‚ ä¹…</p><p>â‘¡ï¼šå·¥ä½œæ—¶ä¼š â€œStop The Worldâ€ </p><p>â‘¢ï¼šæ–°ç”Ÿä»£é‡‡ç”¨ æ ‡è®° - å¤åˆ¶ ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨ æ ‡è®° - æ•´ç†ç®—æ³•</p><p>â‘£ï¼šç®€å•é«˜æ•ˆï¼Œæœ‰è¾ƒé«˜å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ï¼Œå¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºè€Œè¨€æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</p><p>â‘¤ï¼šèƒ½å¤Ÿä¸ CMS åƒåœ¾æ”¶é›†å™¨é…åˆä½¿ç”¨</p><h2 id="ParNew-æ”¶é›†å™¨"><a href="#ParNew-æ”¶é›†å™¨" class="headerlink" title="ParNew  æ”¶é›†å™¨"></a>ParNew  æ”¶é›†å™¨</h2><p><img src="https://javaguide.cn/assets/22018368.df835851.png" alt="ParNew æ”¶é›†å™¨ "></p><p>â‘ ï¼šSerical çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</p><p>â‘¡ï¼šæ–°ç”Ÿä»£é‡‡ç”¨ æ ‡è®° - å¤åˆ¶ ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨ æ ‡è®° - æ•´ç†ç®—æ³•</p><p>â‘¢ï¼šé»˜è®¤å¼€å§‹çº¿ç¨‹æ•°ä¸CPUæ ¸æ•°ç›¸åŒ</p><p>â‘£ï¼šèƒ½å¤Ÿä¸ CMS åƒåœ¾æ”¶é›†å™¨é…åˆä½¿ç”¨</p><h2 id="Parallel-Scavenge-æ”¶é›†å™¨"><a href="#Parallel-Scavenge-æ”¶é›†å™¨" class="headerlink" title="Parallel Scavenge  æ”¶é›†å™¨"></a>Parallel Scavenge  æ”¶é›†å™¨</h2><p><img src="https://javaguide.cn/assets/22018368.df835851.png" alt="Parallel Scavenge æ”¶é›†å™¨ "></p><p>â‘ ï¼šå…³æ³¨ç‚¹æ˜¯ç³»ç»Ÿååé‡ï¼ˆä»£ç è¿è¡Œæ—¶é—´ &#x2F; CPUæ€»è€—æ—¶æ—¶é—´ï¼‰å’Œé«˜æ•ˆåˆ©ç”¨ CPUï¼Œè€Œ CMS ç­‰åƒåœ¾æ”¶é›†å™¨æ›´å¤šå…³æ³¨çš„æ˜¯ç”¨æˆ·åœé¡¿æ—¶é—´ï¼ˆç”¨æˆ·ä½“éªŒï¼‰</p><p>â‘¡ï¼šæ–°ç”Ÿä»£é‡‡ç”¨ æ ‡è®° - å¤åˆ¶ ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨ æ ‡è®° - æ•´ç†ç®—æ³•</p><h2 id="Serial-Old-æ”¶é›†å™¨"><a href="#Serial-Old-æ”¶é›†å™¨" class="headerlink" title="Serial Old æ”¶é›†å™¨"></a>Serial Old æ”¶é›†å™¨</h2><p>â‘ ï¼šSerial åƒåœ¾æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p>â‘¡ï¼šä½¿ç”¨ æ ‡è®° - æ•´ç† ç®—æ³•</p><p>â‘¡ï¼šä½œä¸ºCMS åƒåœ¾æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆ</p><h2 id="Parallel-Old-æ”¶é›†å™¨"><a href="#Parallel-Old-æ”¶é›†å™¨" class="headerlink" title="Parallel Old  æ”¶é›†å™¨"></a>Parallel Old  æ”¶é›†å™¨</h2><p>â‘ ï¼šParallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</p><p>â‘¡ï¼šä½¿ç”¨å¤šçº¿ç¨‹å’Œ æ ‡è®° - æ•´ç† ç®—æ³•</p><p>â‘¢ï¼šä½œä¸ºCMS åƒåœ¾æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆ</p><h2 id="CMS-æ”¶é›†å™¨"><a href="#CMS-æ”¶é›†å™¨" class="headerlink" title="CMS  æ”¶é›†å™¨"></a>CMS  æ”¶é›†å™¨</h2><p>â‘ ï¼šCMS(Concurrent Mark Sweep)ã€Œå¹¶å‘æ ‡è®°æ¸…é™¤ã€ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡ï¼Œæ³¨é‡ç”¨æˆ·ä½“éªŒï¼Œæ˜¯è€å¹´ä»£çš„æ”¶é›†å™¨</p><p>â‘¡ï¼šHotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œä¸€å®šç¨‹åº¦ä¸Šå®ç°äº†ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹çš„åŒæ—¶å·¥ä½œ</p><p>â‘¢ï¼šä½¿ç”¨ æ ‡è®° - æ¸…é™¤ ç®—æ³•</p><p>â‘£ï¼šå›æ”¶è¿‡ç¨‹ï¼šåˆå§‹æ ‡è®°ã€å¹¶å‘æ ‡è®°ã€å¹¶å‘é¢„æ¸…ç†ã€é‡æ–°æ ‡è®°ä»¥åŠå¹¶å‘æ¸…é™¤</p><p><img src="https://javaguide.cn/assets/CMS%E6%94%B6%E9%9B%86%E5%99%A8.8a4d0487.png" alt="CMS åƒåœ¾æ”¶é›†å™¨ "></p><ol><li>åˆå§‹æ ‡è®°ï¼šæ ‡è®°GCRootsã€Œç›´æ¥å…³è”ã€çš„å¯¹è±¡ä»¥åŠã€Œå¹´è½»ä»£ã€æŒ‡å‘ã€Œè€å¹´ä»£ã€çš„å¯¹è±¡ï¼ˆStop The Worldï¼‰ï¼Œé€Ÿåº¦å¾ˆå¿«</li><li>å¹¶å‘æ ‡è®°ï¼šåŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹ã€‚è¿™ä¸€é˜¶æ®µä¸»è¦æ˜¯ä»GC Rootså‘ä¸‹ã€Œè¿½æº¯ã€ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾çš„å¯¹è±¡ã€‚æ¯”è¾ƒè€—è´¹æ—¶é—´çš„ï¼ˆéœ€è¦è¿½æº¯ï¼‰</li><li>å¹¶å‘é¢„æ¸…ç†ï¼šç›®çš„æ˜¯å‡å°‘ä¸‹ä¸€ä¸ªé˜¶æ®µã€Œé‡æ–°æ ‡è®°ã€æ‰€æ¶ˆè€—çš„æ—¶é—´<ul><li>ã€Œå¹¶å‘æ ‡è®°ã€è¿™ä¸ªé˜¶æ®µç”±äºç”¨æˆ·çº¿ç¨‹æ˜¯æ²¡æœ‰è¢«æŒ‚èµ·çš„ï¼Œæ‰€ä»¥å¯¹è±¡æ˜¯æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ã€‚ å¯èƒ½æœ‰äº›å¯¹è±¡ï¼Œä»æ–°ç”Ÿä»£æ™‹å‡åˆ°äº†è€å¹´ä»£ï¼›ä¹Ÿå¯èƒ½æœ‰äº›å¯¹è±¡ï¼Œç›´æ¥åˆ†é…åˆ°äº†è€å¹´ä»£ï¼ˆå¤§å¯¹è±¡ï¼‰ï¼›ä¹Ÿå¯èƒ½è€å¹´ä»£æˆ–è€…æ–°ç”Ÿä»£çš„å¯¹è±¡å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–â€¦</li><li>é’ˆå¯¹è€å¹´ä»£çš„å¯¹è±¡ï¼Œå¯ä»¥å€ŸåŠ©card tableçš„å­˜å‚¨ï¼ˆå°†è€å¹´ä»£å¯¹è±¡å‘ç”Ÿå˜åŒ–æ‰€å¯¹åº”çš„å¡é¡µæ ‡è®°ä¸ºdirtyï¼‰ã€‚æ‰€ä»¥ã€Œå¹¶å‘é¢„å¤„ç†ã€è¿™ä¸ªé˜¶æ®µä¼šæ‰«æå¯èƒ½ç”±äºã€Œå¹¶å‘æ ‡è®°ã€æ—¶å¯¼è‡´è€å¹´ä»£å‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ï¼Œä¼šå†æ‰«æä¸€éæ ‡è®°ä¸ºdirtyçš„å¡é¡µã€‚å¯¹äºæ–°ç”Ÿä»£çš„å¯¹è±¡ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—éå†æ–°ç”Ÿä»£æ¥çœ‹çœ‹åœ¨ã€Œå¹¶å‘æ ‡è®°ã€è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰å¯¹è±¡å¼•ç”¨äº†è€å¹´ä»£ã€‚ä¸è¿‡JVMé‡Œç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šã€Œå‚æ•°ã€ï¼Œæœ‰å¯èƒ½åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè§¦å‘ä¸€æ¬¡ Minor GCï¼ˆè§¦å‘äº†Minor GC æ˜¯æ„å‘³ç€å°±å¯ä»¥æ›´å°‘åœ°éå†æ–°ç”Ÿä»£çš„å¯¹è±¡ï¼‰</li></ul></li><li>é‡æ–°æ ‡è®°ï¼ˆStop The Worldï¼‰ï¼šè¿™ä¸ªè¿‡ç¨‹çš„åœé¡¿æ—¶é—´å…¶å®å¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºä¸Šé¢ã€Œå¹¶å‘é¢„å¤„ç†ã€é˜¶æ®µï¼Œé‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li>å¹¶å‘æ¸…é™¤ï¼šä¸ä¼šStop The Worldã€‚ä¸€è¾¹ç”¨æˆ·çº¿ç¨‹åœ¨æ‰§è¡Œï¼Œä¸€è¾¹GCçº¿ç¨‹åœ¨å›æ”¶ä¸å¯è¾¾çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½ç”¨æˆ·çº¿ç¨‹åœ¨ä¸æ–­äº§ç”Ÿåƒåœ¾ï¼Œä½†åªèƒ½ç•™åˆ°ä¸‹ä¸€æ¬¡GC è¿›è¡Œå¤„ç†äº†ï¼Œäº§ç”Ÿçš„è¿™äº›åƒåœ¾è¢«å«åš â€œæµ®åŠ¨åƒåœ¾â€ ã€‚</li></ol><p>â‘¤ï¼šä¸»è¦ä¼˜ç‚¹ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿</p><p>â‘¥ï¼šä¸»è¦ç¼ºç‚¹</p><ol><li>ç©ºé—´éœ€è¦é¢„ç•™ï¼šCMSåƒåœ¾æ”¶é›†å™¨å¯ä»¥ä¸€è¾¹å›æ”¶åƒåœ¾ï¼Œä¸€è¾¹å¤„ç†ç”¨æˆ·çº¿ç¨‹ï¼Œé‚£åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦ä¿è¯æœ‰å……è¶³çš„å†…å­˜ç©ºé—´ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚å¦‚æœCMSè¿è¡Œè¿‡ç¨‹ä¸­é¢„ç•™çš„ç©ºé—´ä¸å¤Ÿç”¨äº†ï¼Œå°±ä¼šæŠ¥é”™ï¼Œè¿™æ—¶ä¼šå¯åŠ¨ Serial Oldåƒåœ¾æ”¶é›†å™¨è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼Œä¼šå¯¼è‡´åœé¡¿çš„æ—¶é—´å¾ˆé•¿ã€‚å½“ç„¶ç©ºé—´é¢„ç•™å¤šå°‘ä¹Ÿæ˜¯æœ‰å‚æ•°é…ç½®çš„</li><li>å†…å­˜ç¢ç‰‡é—®é¢˜ï¼šCMSæœ¬è´¨ä¸Šæ˜¯å®ç°äº†ã€Œæ ‡è®°æ¸…é™¤ç®—æ³•ã€çš„æ”¶é›†å™¨ï¼Œè¿™ä¼šæ„å‘³ç€ä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ç”±äºç¢ç‰‡å¤ªå¤šï¼Œåˆå¯èƒ½ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ä¸è¶³æ‰€è§¦å‘Full GCï¼ŒCMSä¸€èˆ¬ä¼šåœ¨è§¦å‘Full GCè¿™ä¸ªè¿‡ç¨‹å¯¹ç¢ç‰‡è¿›è¡Œæ•´ç†ã€‚æ•´ç†æ¶‰åŠåˆ°ã€Œç§»åŠ¨ã€æˆ–ã€Œæ ‡è®°ã€ï¼Œé‚£è¿™ä¸ªè¿‡ç¨‹è‚¯å®šä¼šStop The Worldçš„ï¼Œå¦‚æœå†…å­˜è¶³å¤Ÿå¤§ï¼Œé‚£è¿™ä¸ªè¿‡ç¨‹å¡é¡¿ä¹Ÿæ˜¯éœ€è¦ä¸€å®šçš„æ—¶é—´çš„ã€‚</li></ol><h2 id="G1-æ”¶é›†å™¨"><a href="#G1-æ”¶é›†å™¨" class="headerlink" title="G1 æ”¶é›†å™¨"></a>G1 æ”¶é›†å™¨</h2><p>â‘ ï¼šé¢å‘æœåŠ¡å™¨ï¼Œé’ˆå¯¹å¤§å®¹é‡å†…å­˜çš„æœºå™¨</p><p>â‘¡ï¼šæ»¡è¶³GCåœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶ï¼Œè¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½</p><p>â‘¢ï¼šæ•´ä½“çœ‹é‡‡ç”¨ â€œæ ‡è®° - æ•´ç†â€ ç®—æ³•ï¼Œå±€éƒ¨çœ‹é‡‡ç”¨ â€œæ ‡è®° - å¤åˆ¶â€ ç®—æ³•</p><p>â‘£ï¼šæ–°ç”Ÿä»£ï¼ˆEdenã€S1ã€S0ï¼‰ï¼Œè€å¹´ä»£ï¼ˆOldï¼‰ç­‰ä¸å†æŒ‰ç…§ç‰©ç†åˆ’åˆ†ï¼Œè€Œæ˜¯æŒ‰ç…§é€»è¾‘åˆ’åˆ†ã€‚å°†å †å†…å­˜ã€Œé€»è¾‘ã€åˆ’åˆ†ä¸ºå¤šä¸ªRegionï¼Œå¢æ·»äº†Humongousï¼ˆå¤§å¯¹è±¡åŒºåŸŸï¼‰ï¼Œå…¶å®å°±æ˜¯ç”¨æ¥å­˜å‚¨ç‰¹åˆ«å¤§çš„å¯¹è±¡ï¼ˆå¤§äºRegionå†…å­˜çš„ä¸€åŠï¼‰ï¼Œä¸€æ—¦å‘ç°æ²¡æœ‰å¼•ç”¨æŒ‡å‘å¤§å¯¹è±¡ï¼Œå°±å¯ç›´æ¥åœ¨å¹´è½»ä»£çš„Minor GCä¸­è¢«å›æ”¶æ‰ã€‚</p><img src="https://pic1.zhimg.com/80/v2-669ab989756f3aafe7d85b468d01a2ac_1440w.jpg" alt="img" style="zoom: 50%;" /><p>â‘¤ï¼šä¸ºä»€ä¹ˆè¦å°†ã€Œå †ç©ºé—´ã€è¿›è¡Œã€Œç»†åˆ†ã€å¤šä¸ªå°çš„åŒºåŸŸï¼Ÿ</p><p>å¦‚æœå †ç©ºé—´ï¼ˆå†…å­˜ï¼‰å¤§çš„æ—¶å€™ï¼Œæ¯æ¬¡è¿›è¡Œã€Œåƒåœ¾å›æ”¶ã€éƒ½éœ€è¦å¯¹ä¸€æ•´å—å¤§çš„åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œé‚£æ”¶é›†çš„æ—¶é—´æ˜¯ä¸å¥½æ§åˆ¶çš„ï¼Œè€Œåˆ’åˆ†å¤šä¸ªå°åŒºåŸŸä¹‹åï¼Œé‚£å¯¹è¿™äº›ã€Œå°åŒºåŸŸã€å›æ”¶å°±å®¹æ˜“æ§åˆ¶å®ƒçš„ã€Œæ”¶é›†æ—¶é—´ã€äº†ã€‚</p><p>â‘¥ï¼šMinor GCï¼š</p><ol><li>ç­‰åˆ°EdenåŒºæ»¡äº†ä¹‹åï¼Œä¼šè§¦å‘Minor GCï¼ˆStop The Worldï¼‰</li><li>åœ¨G1çš„ä¸–ç•Œé‡Œï¼Œæ–°ç”Ÿä»£å’Œè€å¹´ä»£æ‰€å å †çš„ç©ºé—´æ˜¯æ²¡é‚£ä¹ˆå›ºå®šçš„ï¼ˆä¼šåŠ¨æ€æ ¹æ®ã€Œæœ€å¤§åœé¡¿æ—¶é—´ã€è¿›è¡Œè°ƒæ•´ï¼‰ï¼Œè¿™å—è¦çŸ¥é“ä¼šç»™æˆ‘ä»¬æä¾›å‚æ•°è¿›è¡Œé…ç½®å°±å¥½äº†ï¼Œæ‰€ä»¥ï¼ŒåŠ¨æ€åœ°æ”¹å˜å¹´è½»ä»£Regionçš„ä¸ªæ•°å¯ä»¥ã€Œæ§åˆ¶ã€Minor GCçš„å¼€é”€</li><li>åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæ ¹æ‰«æã€æ›´æ–°&amp;&amp;å¤„ç† RSetã€å¤åˆ¶å¯¹è±¡<ol><li>æ ¹æ‰«æï¼šä¼š â€œStop The Worldâ€ï¼Œè®°å½•ä¸‹ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿« </li><li>æ›´æ–°&amp;&amp;å¤„ç†RSetï¼š<ul><li>æ¶‰åŠåˆ°ã€ŒRsetã€çš„æ¦‚å¿µï¼šåœ¨CMSä¸­ï¼Œå› ä¸ºMinor GC æ˜¯å›æ”¶å¹´è½»ä»£çš„å¯¹è±¡ï¼Œä½†å¦‚æœè€å¹´ä»£æœ‰å¯¹è±¡å¼•ç”¨ç€å¹´è½»ä»£ï¼Œé‚£è¿™äº›è¢«è€å¹´ä»£å¼•ç”¨çš„å¯¹è±¡ä¹Ÿä¸èƒ½å›æ”¶æ‰ã€‚åŒæ ·çš„ï¼Œåœ¨G1ä¹Ÿæœ‰è¿™ç§é—®é¢˜ï¼ˆæ¯•ç«Ÿæ˜¯Minor GCï¼‰ã€‚CMSä½¿ç”¨çš„æ˜¯å¡è¡¨ï¼Œè€ŒG1è§£å†³ã€Œè·¨ä»£å¼•ç”¨ã€çš„é—®é¢˜çš„å­˜å‚¨ä¸€èˆ¬å«åšRSetï¼ŒRSetè¿™ç§å­˜å‚¨åœ¨æ¯ä¸ªRegionéƒ½ä¼šæœ‰ï¼Œå®ƒè®°å½•ç€ã€Œå…¶ä»–Regionå¼•ç”¨äº†å½“å‰Regionçš„å¯¹è±¡å…³ç³»ã€</li><li>å¯¹äºå¹´è½»ä»£çš„Regionï¼Œå®ƒçš„RSet åªä¿å­˜äº†æ¥è‡ªè€å¹´ä»£çš„å¼•ç”¨ï¼ˆå› ä¸ºå¹´è½»ä»£çš„æ²¡å¿…è¦å­˜å‚¨ï¼Œè‡ªå·±éƒ½è¦åšMinor GCäº†ï¼‰</li><li>è€Œå¯¹äºè€å¹´ä»£çš„ Region æ¥è¯´ï¼Œå®ƒçš„ RSet ä¹Ÿåªä¼šä¿å­˜è€å¹´ä»£å¯¹å®ƒçš„å¼•ç”¨ï¼ˆåœ¨G1åƒåœ¾æ”¶é›†å™¨ï¼Œè€å¹´ä»£å›æ”¶ä¹‹å‰ï¼Œéƒ½ä¼šå…ˆå¯¹å¹´è½»ä»£è¿›è¡Œå›æ”¶ï¼Œæ‰€ä»¥æ²¡å¿…è¦ä¿å­˜å¹´è½»ä»£çš„å¼•ç”¨ï¼‰</li><li>æ‰€ä»¥ç¬¬äºŒæ­¥ä¸»è¦åšçš„äº‹æƒ…ï¼šå¤„ç†RSetçš„ä¿¡æ¯å¹¶ä¸”æ‰«æï¼Œå°†è€å¹´ä»£å¯¹è±¡æŒæœ‰å¹´è½»ä»£å¯¹è±¡çš„ç›¸å…³å¼•ç”¨éƒ½åŠ å…¥åˆ°GC Rootsä¸‹ï¼Œé¿å…è¢«å›æ”¶æ‰</li></ul></li><li>å¤åˆ¶å¯¹è±¡ï¼šæŠŠæ‰«æä¹‹åå­˜æ´»çš„å¯¹è±¡å¾€ã€Œç©ºçš„SurvivoråŒºã€æˆ–è€…ã€Œè€å¹´ä»£ã€å­˜æ”¾ï¼Œå…¶ä»–çš„EdenåŒºè¿›è¡Œæ¸…é™¤<ul><li>è¿™é‡Œè¦æä¸‹çš„æ˜¯ï¼Œåœ¨G1è¿˜æœ‰å¦ä¸€ä¸ªåè¯ï¼Œå«åšCSet(Collection Set)ã€‚å®ƒä¿å­˜äº†ä¸€æ¬¡GCä¸­ã€Œå°†æ‰§è¡Œåƒåœ¾å›æ”¶ã€çš„Regionã€‚CSetä¸­çš„æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½ä¼šè¢«è½¬ç§»åˆ°åˆ«çš„å¯ç”¨Regionä¸Šã€‚åœ¨Minor GC çš„æœ€åï¼Œä¼šå¤„ç†ä¸‹è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰å¼•ç”¨ï¼Œç»“æŸæ”¶é›†</li></ul></li></ol></li></ol><p>â‘¦ï¼šMixed GCï¼š</p><ol><li>å½“å †ç©ºé—´çš„å ç”¨ç‡è¾¾åˆ°ä¸€å®šé˜ˆå€¼åä¼šè§¦å‘Mixed GCï¼ˆé»˜è®¤45%ï¼Œç”±å‚æ•°å†³å®šï¼‰</li><li>Mixed GC ä¾èµ–ã€Œå…¨å±€å¹¶å‘æ ‡è®°ã€ç»Ÿè®¡åçš„Regionæ•°æ®ï¼Œã€Œå…¨å±€å¹¶å‘æ ‡è®°ã€å®ƒçš„è¿‡ç¨‹è·ŸCMSéå¸¸ç±»å‹</li><li>æ­¥éª¤å¤§æ¦‚æ˜¯ï¼šåˆå§‹æ ‡è®°ï¼ˆSTWï¼‰ã€å¹¶å‘æ ‡è®°ã€æœ€ç»ˆæ ‡è®°ï¼ˆSTWï¼‰ä»¥åŠæ¸…ç†ï¼ˆSTWï¼‰<ol><li>åˆå§‹æ ‡è®°ï¼šè¿™ä¸ªè¿‡ç¨‹æ˜¯ã€Œå…±ç”¨ã€äº†Minor GCçš„ Stop The Worldï¼ˆMixed GC ä¸€å®šä¼šå‘ç”Ÿ Minor GCï¼‰ï¼Œå¤ç”¨äº†ã€Œæ‰«æGC Rootsã€çš„æ“ä½œã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè€å¹´ä»£å’Œæ–°ç”Ÿä»£éƒ½ä¼šæ‰«ï¼Œæ€»çš„æ¥è¯´ï¼Œã€Œåˆå§‹æ ‡è®°ã€è¿™ä¸ªè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¿«çš„ï¼Œæ¯•ç«Ÿæ²¡æœ‰è¿½æº¯éå†å˜›</li><li>å¹¶å‘æ ‡è®°ï¼šè¿™ä¸ªé˜¶æ®µä¸ä¼šStop The Worldï¼ŒGCçº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·æ‰§è¡Œï¼ŒGCçº¿ç¨‹è´Ÿè´£æ”¶é›†å„ä¸ª Region çš„å­˜æ´»å¯¹è±¡ä¿¡æ¯ã€‚ä»GC Rootså¾€ä¸‹è¿½æº¯ï¼ŒæŸ¥æ‰¾æ•´ä¸ªå †å­˜æ´»çš„å¯¹è±¡ï¼Œæ¯”è¾ƒè€—æ—¶<ul><li>åœ¨G1ä¸­è§£å†³ã€Œå¹¶å‘æ ‡è®°ã€é˜¶æ®µå¯¼è‡´å¼•ç”¨å˜æ›´çš„é—®é¢˜ï¼Œä½¿ç”¨çš„æ˜¯SATBç®—æ³•ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºï¼šåœ¨GC å¼€å§‹çš„æ—¶å€™ï¼Œå®ƒä¸ºå­˜æ´»çš„å¯¹è±¡åšäº†ä¸€æ¬¡ã€Œå¿«ç…§ã€ï¼Œåœ¨ã€Œå¹¶å‘é˜¶æ®µã€æ—¶ï¼ŒæŠŠæ¯ä¸€æ¬¡å‘ç”Ÿå¼•ç”¨å…³ç³»å˜åŒ–æ—¶æ—§çš„å¼•ç”¨å€¼ç»™è®°ä¸‹æ¥ï¼Œç„¶ååœ¨ã€Œé‡æ–°æ ‡è®°ã€é˜¶æ®µåªæ‰«æç€å—ã€Œå‘ç”Ÿè¿‡å˜åŒ–ã€çš„å¼•ç”¨ï¼Œçœ‹æœ‰æ²¡æœ‰å¯¹è±¡è¿˜æ˜¯å­˜æ´»çš„ï¼ŒåŠ å…¥åˆ°ã€ŒGC Rootsã€ä¸Šï¼Œä¸è¿‡SATBç®—æ³•æœ‰ä¸ªå°çš„é—®é¢˜ï¼Œå°±æ˜¯ï¼šå¦‚æœåœ¨å¼€å§‹æ—¶ï¼ŒG1å°±è®¤ä¸ºå®ƒæ˜¯æ´»çš„ï¼Œé‚£å°±åœ¨æ­¤æ¬¡GCä¸­ä¸ä¼šå¯¹å®ƒå›æ”¶ï¼Œå³ä¾¿å¯èƒ½åœ¨ã€Œå¹¶å‘é˜¶æ®µã€ä¸Šå¯¹è±¡å·²ç»å˜ä¸ºäº†åƒåœ¾ã€‚æ‰€ä»¥ï¼ŒG1ä¹Ÿæœ‰å¯èƒ½ä¼šå­˜åœ¨ã€Œæµ®åŠ¨åƒåœ¾ã€çš„é—®é¢˜ï¼Œä½†æ˜¯æ€»çš„æ¥è¯´ï¼Œå¯¹äºG1è€Œè¨€ï¼Œé—®é¢˜ä¸å¤§ï¼ˆæ¯•ç«Ÿå®ƒä¸æ˜¯è¿½æ±‚ä¸€æ¬¡æŠŠæ‰€æœ‰çš„åƒåœ¾éƒ½æ¸…é™¤æ‰ï¼Œè€Œæ˜¯æ³¨é‡ Stop The Worldæ—¶é—´ï¼‰</li></ul></li><li>æœ€ç»ˆæ ‡è®°ï¼šè·ŸCMSåˆä¸€æ ·ï¼Œæ ‡è®°é‚£äº›åœ¨ã€Œå¹¶å‘æ ‡è®°ã€é˜¶æ®µå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡</li><li>æ¸…ç†ï¼šè¿™ä¸ªé˜¶æ®µä¹Ÿæ˜¯ä¼šStop The Worldçš„ï¼Œä¸»è¦æ¸…ç‚¹å’Œé‡ç½®æ ‡è®°çŠ¶æ€ã€‚ä¼šæ ¹æ®ã€Œåœé¡¿é¢„æµ‹æ¨¡å‹ã€ï¼ˆå…¶å®å°±æ˜¯è®¾å®šçš„åœé¡¿æ—¶é—´ï¼‰ï¼Œæ¥å†³å®šæœ¬æ¬¡GCå›æ”¶å¤šå°‘Regionã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒMixed GCä¼šé€‰å®šæ‰€æœ‰çš„å¹´è½»ä»£Regionï¼Œéƒ¨åˆ†ã€Œå›æ”¶ä»·å€¼é«˜ã€çš„è€å¹´ä»£Regionï¼ˆå›æ”¶ä»·å€¼é«˜å…¶å®å°±æ˜¯åƒåœ¾å¤šï¼‰è¿›è¡Œé‡‡é›†ã€‚æœ€åMixed GC è¿›è¡Œæ¸…é™¤è¿˜æ˜¯é€šè¿‡ã€Œæ‹·è´ã€çš„æ–¹å¼å»å¹²çš„ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡å›æ”¶æœªå¿…æ˜¯å°†æ‰€æœ‰çš„åƒåœ¾è¿›è¡Œå›æ”¶çš„ï¼ŒG1ä¼šä¾æ®åœé¡¿æ—¶é—´åšå‡ºé€‰æ‹©Regionæ•°é‡</li></ol></li></ol><p>â‘§ï¼šFull GCï¼šå¦‚æœåœ¨Mixed GCä¸­æ— æ³•è·Ÿä¸Šç”¨æˆ·çº¿ç¨‹åˆ†é…å†…å­˜çš„é€Ÿåº¦ï¼Œå¯¼è‡´è€å¹´ä»£å¡«æ»¡æ— æ³•ç»§ç»­è¿›è¡ŒMixed GCï¼Œå°±åˆä¼šé™çº§åˆ°Serial Old GCæ¥æ”¶é›†æ•´ä¸ªGC heapã€‚ä¸è¿‡è¿™ä¸ªåœºæ™¯ç›¸è¾ƒäºCMSè¿˜æ˜¯å¾ˆå°‘çš„ï¼Œæ¯•ç«ŸG1æ²¡æœ‰CMSå†…å­˜ç¢ç‰‡è¿™ç§é—®é¢˜ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://javaguide.cn/java/jvm/jvm-garbage-collection.html#%E5%86%99%E5%9C%A8%E5%89%8D%E9%9D%A2">JVM åƒåœ¾å›æ”¶è¯¦è§£</a></p><p><a href="https://zhuanlan.zhihu.com/p/431042318">ç¨³äº†ï¼æˆ‘å‡†å¤‡äº†1ä¸ªæ™šä¸Šçš„CMSåƒåœ¾æ”¶é›†å™¨</a></p><p><a href="https://zhuanlan.zhihu.com/p/431908205">ä»€ä¹ˆï¼Ÿé¢è¯•å®˜é—®æˆ‘G1åƒåœ¾æ”¶é›†å™¨ï¼Ÿ</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;Serial-æ”¶é›†å™¨&quot;&gt;&lt;a href=&quot;#Serial-æ”¶é›†å™¨&quot; class=&quot;headerlink&quot; title=&quot;Serial  æ”¶é›†å™¨&quot;&gt;&lt;/a&gt;Serial  æ”¶é›†å™¨&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;https://javaguide.cn/asset</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
    <category term="å…«è‚¡æ–‡" scheme="http://example.com/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>Rpcå·©å›º</title>
    <link href="http://example.com/2022/03/22/Rpc%E5%B7%A9%E5%9B%BA/"/>
    <id>http://example.com/2022/03/22/Rpc%E5%B7%A9%E5%9B%BA/</id>
    <published>2022-03-21T16:00:00.000Z</published>
    <updated>2022-05-24T03:31:39.099Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-RPCç®€ä»‹"><a href="#1-RPCç®€ä»‹" class="headerlink" title="1.RPCç®€ä»‹"></a>1.RPCç®€ä»‹</h2><p>RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è°ƒç”¨åè®®ã€‚RPCåè®®è§„å®šå…è®¸äº’è”ç½‘ä¸­ä¸€å°ä¸»æœºè°ƒç”¨å¦ä¸€å°ä¸»æœºçš„ç¨‹åºï¼Œè€Œç¨‹åºå‘˜æ— éœ€å¯¹è¿™ä¸ªäº¤äº’è¿‡ç¨‹è¿›è¡Œç¼–ç¨‹ã€‚åœ¨RPCåè®®ä¸­å¼ºè°ƒ<b>å½“Aç¨‹åºè°ƒç”¨Bç¨‹åºä¸­çš„åŠŸèƒ½æˆ–æ–¹æ³•æ—¶ï¼ŒAæ˜¯ä¸çŸ¥é“Bä¸­æ–¹æ³•çš„å®ç°çš„</b>ã€‚</p><p>RPCæ˜¯ä¸Šå±‚åè®®ï¼Œåº•å±‚å¯ä»¥åŸºäºTCPåè®®ï¼Œä¹Ÿå¯ä»¥åŸºäºHTTPåè®®ã€‚ä¸€èˆ¬æˆ‘ä»¬è¯´RPCéƒ½æ˜¯åŸºäºRPCçš„å…·ä½“å®ç°ï¼Œå¦‚ï¼šDubboæ¡†æ¶ã€‚ä»å¹¿ä¹‰ä¸Šæ¥è®²åªè¦æ˜¯æ»¡è¶³ç½‘ç»œä¸­è¿›è¡Œé€šè®¯è°ƒç”¨çš„éƒ½ç»Ÿç§°ä¸ºRPCï¼Œç”šè‡³åŸºäºHTTPåè®®éƒ½å¯ä»¥è¯´æ˜¯RPCçš„å…·ä½“å®ç°ï¼Œä½†æ˜¯å…·ä½“åˆ†ææ¥çœ‹RPCåè®®è¦æ¯”HTTPåè®®æ›´åŠ é«˜æ•ˆï¼ŒåŸºäºRPCçš„æ¡†æ¶åŠŸèƒ½æ›´å¤šã€‚</p><p>RPCåè®®æ˜¯åŸºäºåˆ†å¸ƒå¼æ¶æ„è€Œå‡ºç°çš„ï¼Œæ‰€ä»¥RPCåœ¨åˆ†å¸ƒå¼é¡¹ç›®ä¸­æœ‰å¾—å¤©ç‹¬åšçš„ä¼˜åŠ¿ã€‚</p><h2 id="2-RPCå’ŒHTTPå¯¹æ¯”"><a href="#2-RPCå’ŒHTTPå¯¹æ¯”" class="headerlink" title="2.RPCå’ŒHTTPå¯¹æ¯”"></a>2.RPCå’ŒHTTPå¯¹æ¯”</h2><h3 id="2-1å…·ä½“å®ç°"><a href="#2-1å…·ä½“å®ç°" class="headerlink" title="2.1å…·ä½“å®ç°"></a>2.1å…·ä½“å®ç°</h3><p>RPCï¼šå¯ä»¥åŸºäºTCPåè®®ï¼Œä¹Ÿå¯ä»¥åŸºäºHTTPåè®®ã€‚ï¼ˆä¼ è¾“å±‚ + åº”ç”¨å±‚ï¼‰</p><p>HTTPï¼šåŸºäºHTTPåè®®ã€‚ï¼ˆåº”ç”¨å±‚ï¼‰</p><h3 id="2-2æ•ˆç‡"><a href="#2-2æ•ˆç‡" class="headerlink" title="2.2æ•ˆç‡"></a>2.2æ•ˆç‡</h3><p>RPCï¼šè‡ªå®šä¹‰å…·ä½“å®ç°å¯ä»¥å‡å°‘å¾ˆå¤šæ— ç”¨çš„æŠ¥æ–‡å†…å®¹ï¼Œä½¿å¾—æŠ¥æ–‡ä½“ç§¯æ›´å°ã€‚</p><p>HTTPï¼šå¦‚æœæ˜¯HTTP1.1 æŠ¥æ–‡ä¸­å†…å®¹å›ºå®šï¼Œä¼ é€’çš„æŠ¥æ–‡å¯¹äºå®¢æˆ·ç«¯è€Œè¨€æœ‰äº›æ˜¯æ— ç”¨çš„ã€‚å¦‚æœæ˜¯HTTP2.0 ä»¥åçš„ç‰ˆæœ¬å’ŒRPCç›¸å·®ä¸å¤§ï¼Œæ¯”RPCå°‘çš„å¯èƒ½å°±æ˜¯ä¸€äº›æœåŠ¡æ²»ç†ç­‰åŠŸèƒ½ã€‚</p><h3 id="2-3è¿æ¥æ–¹å¼"><a href="#2-3è¿æ¥æ–¹å¼" class="headerlink" title="2.3è¿æ¥æ–¹å¼"></a>2.3è¿æ¥æ–¹å¼</h3><p>RPCï¼šé•¿è¿æ¥æ”¯æŒ</p><p>HTTPï¼šå‰æœŸä¸æ”¯æŒé•¿è¿æ¥ï¼Œæ¯æ¬¡å»ºç«‹è¿æ¥éƒ½éœ€è¦3æ¬¡æ¡æ‰‹ï¼Œæ–­å¼€è¿æ¥éœ€è¦4æ¬¡æŒ¥æ‰‹ã€‚HTTP2.0åå¢åŠ äº†è¿æ¥æ± ï¼Œå¯ä»¥æ”¯æŒé•¿è¿æ¥ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc/rpc1.png"></img></p><h3 id="2-4æ€§èƒ½"><a href="#2-4æ€§èƒ½" class="headerlink" title="2.4æ€§èƒ½"></a>2.4æ€§èƒ½</h3><p>RPCï¼šå¯ä»¥åŸºäºå¾ˆå¤šåºåˆ—åŒ–æ–¹å¼ï¼ˆå¯ä»¥æ”¯æŒå­—èŠ‚ï¼Œä¹Ÿå¯ä»¥æ”¯æŒæ–‡æœ¬ï¼‰</p><p>HTTPï¼šä¸»è¦æ˜¯é€šè¿‡JSONï¼Œåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ•ˆç‡æ›´ä½ï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ”¯æŒæ–‡æœ¬ï¼‰</p><h3 id="2-5æ³¨å†Œä¸­å¿ƒ"><a href="#2-5æ³¨å†Œä¸­å¿ƒ" class="headerlink" title="2.5æ³¨å†Œä¸­å¿ƒ"></a>2.5æ³¨å†Œä¸­å¿ƒ</h3><p>RPCï¼šä¸€èˆ¬RPCæ¡†æ¶éƒ½å¸¦æœ‰æ³¨å†Œä¸­å¿ƒ</p><p>HTTPï¼šç›´æ¥è¿æ¥</p><h3 id="2-6è´Ÿè½½å‡è¡¡"><a href="#2-6è´Ÿè½½å‡è¡¡" class="headerlink" title="2.6è´Ÿè½½å‡è¡¡"></a>2.6è´Ÿè½½å‡è¡¡</h3><p>RPCï¼šç»å¤§å¤šæ•°RPCæ¡†æ¶éƒ½å¸¦æœ‰è´Ÿè½½å‡è¡¡</p><p>HTTPï¼šä¸€èˆ¬éƒ½éœ€è¦ç¬¬ä¸‰æ–¹å·¥å…·ã€‚å¦‚ï¼šnginx</p><h3 id="2-7æ€»ç»“"><a href="#2-7æ€»ç»“" class="headerlink" title="2.7æ€»ç»“"></a>2.7æ€»ç»“</h3><p>RPCæ¡†æ¶ä¸€èˆ¬éƒ½å¸¦æœ‰ä¸°å¯Œçš„æœåŠ¡æ²»ç†ç­‰åŠŸèƒ½ï¼Œæ›´é€‚åˆä¼ä¸šå†…éƒ¨æ¥å£è°ƒç”¨ã€‚è€ŒHTTPæ›´é€‚åˆå¤šå¹³å°ä¹‹é—´äº’ç›¸è°ƒç”¨ã€‚ä¾‹å¦‚ï¼šæŸäººåœ¨äº¬ä¸œç§’æ€å•†å“ï¼Œé‡‡ç”¨çš„æ˜¯HTTPåè®®ï¼›è€Œç‚¹å‡»ç§’æ€æŒ‰é’®åï¼Œäº¬ä¸œå†…éƒ¨é‡‡ç”¨çš„æ˜¯RPCåè®®ï¼Œæˆ‘ä»¬å¹¶ä¸äº†è§£ç§’æ€æŒ‰é’®çš„å…·ä½“åšäº†ä»€ä¹ˆã€‚</p><h2 id="3-HttpClientå®ç°RPC"><a href="#3-HttpClientå®ç°RPC" class="headerlink" title="3.HttpClientå®ç°RPC"></a>3.HttpClientå®ç°RPC</h2><h3 id="3-1HttpClientç®€ä»‹"><a href="#3-1HttpClientç®€ä»‹" class="headerlink" title="3.1HttpClientç®€ä»‹"></a>3.1HttpClientç®€ä»‹</h3><p>åœ¨JDKä¸­java.netåŒ…ä¸‹æä¾›äº†ç”¨æˆ·HTTPè®¿é—®çš„åŸºæœ¬åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒç¼ºå°‘çµæ´»æ€§æˆ–è®¸å¤šåº”ç”¨æ‰€ç¼ºå°‘çš„åŠŸèƒ½ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºHttpåè®®çš„HttpClientï¼ˆæ¥è‡ªApacheï¼‰æ¥å®ç°ä½¿ç”¨Javaä»£ç å®Œæˆæ ‡å‡†HTTPè¯·æ±‚ä»¥åŠå“åº”ï¼›æ”¯æŒæ± åŒ–ï¼ˆé•¿è¿æ¥ï¼‰</p><h3 id="3-2æ¨¡æ‹Ÿå®ç°"><a href="#3-2æ¨¡æ‹Ÿå®ç°" class="headerlink" title="3.2æ¨¡æ‹Ÿå®ç°"></a>3.2æ¨¡æ‹Ÿå®ç°</h3><h4 id="3-2-1æ— å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ"><a href="#3-2-1æ— å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ" class="headerlink" title="3.2.1æ— å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ"></a>3.2.1æ— å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ</h4><p>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ— å‚æ•°çš„GETè¯·æ±‚*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGetWithoutParams</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line"><span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"><span class="type">HttpGet</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost:8080/test&quot;</span>);<span class="comment">//å£°æ˜getè¯·æ±‚</span></span><br><span class="line"></span><br><span class="line">    <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.execute(get);<span class="comment">//å‘èµ·è¯·æ±‚å¹¶æ¥å—ç»“æœ</span></span><br><span class="line"><span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> response.getEntity();<span class="comment">//è·å–å“åº”ä½“ã€‚å“åº”æ•°æ®æ˜¯ä¸ªåŸºäºHTTPåè®®æ ‡å‡†å­—ç¬¦ä¸²å°è£…çš„å¯¹è±¡ï¼Œå¯èƒ½æœ‰ä¹±ç é—®é¢˜ã€‚</span></span><br><span class="line"><span class="type">String</span> <span class="variable">responseString</span> <span class="operator">=</span> EntityUtils.toString(entity,<span class="string">&quot;UTF-8&quot;</span>);<span class="comment">//é€šè¿‡Httpå®ä½“å·¥å…·ç±»ï¼Œé‡‡å–&quot;UTF-8&quot;æ ¼å¼è½¬æ¢å“åº”ä½“æ•°æ®</span></span><br><span class="line">System.out.println(<span class="string">&quot;æœåŠ¡å™¨å“åº”æ•°æ®æ˜¯ - [&quot;</span> + responseString + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">   </span><br><span class="line">    client.close();<span class="comment">//å…³é—­å®¢æˆ·ç«¯</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/test&quot;,produces = &#123;&quot;application/json;charset=UTF-8&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;msg\&quot;:\&quot;å¤„ç†è¿”å›\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-2å¸¦å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ"><a href="#3-2-2å¸¦å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ" class="headerlink" title="3.2.2å¸¦å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ"></a>3.2.2å¸¦å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿ</h4><p>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æœ‰å‚æ•°çš„GETè¯·æ±‚*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testGetWithParams</span><span class="params">()</span> <span class="keyword">throws</span> URIException&#123;</span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    <span class="comment">/*URIçš„æ„å»ºåˆ†æ˜¯å¦ä½¿ç”¨?æºå¸¦å‚æ•°ï¼Œä»¥ä¸‹ä¸ºä¸ä½¿ç”¨?æºå¸¦å‚æ•°çš„æ–¹å¼*/</span></span><br><span class="line">    <span class="comment">//å¯ä»¥ä½¿ç”¨URIBuilderç±»æ¥æ„å»ºï¼›æˆ–è€…ä½¿ç”¨HttpGetï¼ˆå‚è€ƒæ— å‚æ•°Getè¯·æ±‚æ¨¡æ‹Ÿï¼‰ï¼Œä¸‹é¢ä½¿ç”¨URIBuilderç±»</span></span><br><span class="line">    <span class="type">URIBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;http://localhost:8080/params&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*å‚æ•°ä¼ é€’åˆ†ä¸ºå•å‚æ•°ä¼ é€’å’Œå¤šå‚æ•°ä¼ é€’ï¼ŒäºŒé€‰ä¸€å³å¯*/</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">//åŸºäºå•å‚æ•°ä¼ é€’</span></span><br><span class="line">    <span class="comment">/*buildr.addParameter(&quot;name&quot;,&quot;soul&quot;);</span></span><br><span class="line"><span class="comment">    buildr.addParameter(&quot;password&quot;,&quot;123&quot;);</span></span><br><span class="line"><span class="comment">    URI uri = builder.build();*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åŸºäºå¤šå‚æ•°ä¼ é€’</span></span><br><span class="line">    List&lt;NameValuePair&gt; nvps = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    nvps.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;soul&quot;</span>));</span><br><span class="line">    nvps.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123&quot;</span>));</span><br><span class="line">    builder.addParameters(nvps);</span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> builder.build();</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">responseString</span> <span class="operator">=</span> EntityUtils.toString(client.execute(<span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri)).getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æœåŠ¡å™¨å“åº”æ•°æ®æ˜¯ - [&quot;</span> + responseString + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/params&quot;,produces = &#123;&quot;application/json;charset=UTF-8&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">params</span><span class="params">(String name, String password)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name - &quot;</span> + name + <span class="string">&quot;; password - &quot;</span> + password);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;msg\&quot;:\&quot;ç™»å½•æˆåŠŸ\&quot;,\&quot;user\&quot;:&#123;\&quot;name\&quot;:\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;,\&quot;password\&quot;:\&quot;&quot;</span>+password+<span class="string">&quot;\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-3æ— å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ"><a href="#3-2-3æ— å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ" class="headerlink" title="3.2.3æ— å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ"></a>3.2.3æ— å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ</h4><p>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æ— å‚æ•°çš„POSTè¯·æ±‚*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPostWithParams</span><span class="params">()</span> <span class="keyword">throws</span> URIException&#123;</span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/test&quot;</span>);</span><br><span class="line">    <span class="type">HttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> client.execute(get);</span><br><span class="line">    <span class="type">String</span> <span class="variable">responseString</span> <span class="operator">=</span> EntityUtils.toString(client.execute(<span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri)).getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æœåŠ¡å™¨å“åº”æ•°æ®æ˜¯ - [&quot;</span> + responseString + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/test&quot;,produces = &#123;&quot;application/json;charset=UTF-8&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;msg\&quot;:\&quot;å¤„ç†è¿”å›\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-2-4å¸¦å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ"><a href="#3-2-4å¸¦å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ" class="headerlink" title="3.2.4å¸¦å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ"></a>3.2.4å¸¦å‚æ•°Postè¯·æ±‚æ¨¡æ‹Ÿ</h4><p>å®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*æœ‰å‚æ•°çš„POSTè¯·æ±‚*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPostWithParams</span><span class="params">()</span> <span class="keyword">throws</span> URIException&#123;</span><br><span class="line">    <span class="type">HttpClient</span> <span class="variable">client</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*æ–¹å¼1:ä½¿ç”¨è¯·æ±‚å¤´ä¼ é€’å‚æ•°*/</span></span><br><span class="line">    <span class="comment">/*URIçš„æ„å»ºåˆ†æ˜¯å¦ä½¿ç”¨?æºå¸¦å‚æ•°ï¼Œä»¥ä¸‹ä¸ºä½¿ç”¨?æºå¸¦å‚æ•°çš„æ–¹å¼*/</span></span><br><span class="line">    <span class="type">URIBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;http://localhost:8080/params?name=soul&amp;password=123&quot;</span>);</span><br><span class="line">    <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> builder.build();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*æ–¹å¼2:ä½¿ç”¨è¯·æ±‚ä½“ä¼ é€’ï¼ˆå¯¹è±¡ï¼‰å‚æ•°*/</span></span><br><span class="line">    <span class="type">HttpPost</span> <span class="variable">bodyParamsPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/params&quot;</span>);</span><br><span class="line">    <span class="comment">//å®šä¹‰è¯·æ±‚åè®®ä½“ï¼Œè®¾ç½®è¯·æ±‚å‚æ•°ã€‚ä½¿ç”¨è¯·æ±‚ä½“éœ€è¦å®šä¹‰è¯·æ±‚ä½“æ ¼å¼ï¼Œé»˜è®¤æ˜¯è¡¨å•æ ¼å¼</span></span><br><span class="line">    <span class="comment">//ä½¿ç”¨URIBuilderå¯¹è±¡æ„å»ºçš„URIå¯¹è±¡ï¼Œå°±æ˜¯è¯·æ±‚ä½“ä¼ é€’å‚æ•°çš„</span></span><br><span class="line">     <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(user);<span class="comment">//è¿™é‡Œä½¿ç”¨äº†FastJson</span></span><br><span class="line">    <span class="type">HttpEntity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonString, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    bodyParamsPost.setEntity(entity);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">responseString</span> <span class="operator">=</span> EntityUtils.toString(client.execute(<span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri)).getEntity(),<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æœåŠ¡å™¨å“åº”æ•°æ®æ˜¯ - [&quot;</span> + responseString + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    client.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœåŠ¡ç«¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span>&#123;</span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/params&quot;,produces = &#123;&quot;application/json;charset=UTF-8&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">params</span><span class="params">(String name, String password)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name - &quot;</span> + name + <span class="string">&quot;; password - &quot;</span> + password);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;msg\&quot;:\&quot;ç™»å½•æˆåŠŸ\&quot;,\&quot;user\&quot;:&#123;\&quot;name\&quot;:\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;,\&quot;password\&quot;:\&quot;&quot;</span>+password+<span class="string">&quot;\&quot;&#125;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-RMIå®ç°RPC"><a href="#4-RMIå®ç°RPC" class="headerlink" title="4.RMIå®ç°RPC"></a>4.RMIå®ç°RPC</h2><h3 id="1-RMIç®€ä»‹"><a href="#1-RMIç®€ä»‹" class="headerlink" title="1.RMIç®€ä»‹"></a>1.RMIç®€ä»‹</h3><p>RMIï¼ˆRemote Method Invocationï¼‰ï¼šæ˜¯Javaè¯­è¨€çš„è¿œç¨‹è°ƒç”¨ï¼ˆåŸºäºTCPåè®®ï¼‰ï¼Œæ— æ³•å®ç°è·¨è¯­è¨€ã€‚</p><p>RMIæ˜¯ä»JDK1.2æ¨å‡ºçš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥å®ç°åœ¨ä¸€ä¸ªJavaåº”ç”¨ä¸­å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨å¦ä¸€ä¸ªæœåŠ¡å™¨ä¸­Javaåº”ç”¨ï¼ˆJVMï¼‰çš„å†…å®¹ã€‚</p><h3 id="2-æ‰§è¡Œæµç¨‹"><a href="#2-æ‰§è¡Œæµç¨‹" class="headerlink" title="2.æ‰§è¡Œæµç¨‹"></a>2.æ‰§è¡Œæµç¨‹</h3><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc/rpc2.png"></img></p><p>Registryï¼ˆæ³¨å†Œè¡¨ï¼‰æ˜¯æ”¾ç½®æ‰€æœ‰æœåŠ¡å¯¹è±¡çš„å‘½åç©ºé—´ã€‚</p><p>æ¯æ¬¡æœåŠ¡ç«¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒéƒ½ä¼šä½¿ç”¨bind()æˆ–rebind()æ–¹æ³•æ³¨å†Œè¯¥å¯¹è±¡ã€‚è¿™äº›æ˜¯ä½¿ç”¨ç§°ä¸ºç»‘å®šåç§°çš„å”¯ä¸€åç§°æ³¨å†Œçš„ã€‚</p><p>è¦è°ƒç”¨è¿œç¨‹å¯¹è±¡ï¼Œå®¢æˆ·ç«¯éœ€è¦è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚å³é€šè¿‡æœåŠ¡ç«¯ç»‘å®šçš„åç§°ä»æ³¨å†Œè¡¨ä¸­è·å–ï¼ˆlookup()æ–¹æ³•ï¼‰</p><h3 id="3-å·¥ä½œåŸç†"><a href="#3-å·¥ä½œåŸç†" class="headerlink" title="3.å·¥ä½œåŸç†"></a>3.å·¥ä½œåŸç†</h3><h4 id="3-1åŸºç¡€çŸ¥è¯†è¡¥å……"><a href="#3-1åŸºç¡€çŸ¥è¯†è¡¥å……" class="headerlink" title="3.1åŸºç¡€çŸ¥è¯†è¡¥å……"></a>3.1åŸºç¡€çŸ¥è¯†è¡¥å……</h4><p><b>Java IDL</b>æ˜¯ä¸€ç§ç”¨äºåˆ†å¸ƒå¼å¯¹è±¡çš„æŠ€æœ¯ï¼Œå³å¯¹è±¡åœ¨ç½‘ç»œä¸Šçš„ä¸åŒå¹³å°ä¸Šè¿›è¡Œäº¤äº’ã€‚Java IDLä½¿å¯¹è±¡èƒ½å¤Ÿè¿›è¡Œäº¤äº’ï¼Œè€Œä¸ç®¡å®ƒä»¬æ˜¯ä»¥Javaç¼–ç¨‹è¯­è¨€è¿˜æ˜¯Cï¼ŒC ++ï¼ŒCOBOLæˆ–å…¶ä»–è¯­è¨€ç¼–å†™çš„ã€‚è¿™æ˜¯å¯èƒ½çš„ï¼Œå› ä¸ºJava IDLåŸºäº<b>é€šç”¨å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„ï¼ˆCORBAï¼‰</b>ï¼Œå³è¡Œä¸šæ ‡å‡†çš„åˆ†å¸ƒå¼å¯¹è±¡æ¨¡å‹ã€‚CORBAçš„ä¸»è¦åŠŸèƒ½æ˜¯IDLï¼Œä¸€ç§ä¸è¯­è¨€æ— å…³çš„æ¥å£å®šä¹‰è¯­è¨€ã€‚æ¯ç§æ”¯æŒCORBAçš„è¯­è¨€éƒ½æœ‰è‡ªå·±çš„IDLæ˜ å°„ã€‚é¡¾åæ€ä¹‰ï¼ŒJava IDLæ”¯æŒJavaæ˜ å°„ã€‚ä¸ºäº†æ”¯æŒå•ç‹¬ç¨‹åºä¸­å¯¹è±¡ä¹‹é—´çš„äº¤äº’ï¼ŒJava IDLæä¾›äº†ä¸€ä¸ªå¯¹è±¡è¯·æ±‚ä»£ç†æˆ–ORBï¼ˆObject Request Brokerï¼‰ã€‚ORBæ˜¯ä¸€ä¸ªç±»åº“ï¼Œå¯åœ¨Java IDLåº”ç”¨ç¨‹åºä¸å…¶ä»–ç¬¦åˆCORBAçš„åº”ç”¨ç¨‹åºä¹‹é—´è¿›è¡Œä½å±‚çº§çš„é€šä¿¡ã€‚</p><p><b>CORBA</b>ï¼ŒCommon ObjectRequest Broker Architectureï¼ˆå…¬å…±å¯¹è±¡è¯·æ±‚ä»£ç†ä½“ç³»ç»“æ„ï¼‰ï¼Œæ˜¯ç”±OMGç»„ç»‡åˆ¶è®¢çš„ä¸€ç§æ ‡å‡†çš„é¢å‘å¯¹è±¡åº”ç”¨ç¨‹åºä½“ç³»è§„èŒƒã€‚CORBAä½¿ç”¨æ¥å£å®šä¹‰è¯­è¨€ï¼ˆIDLï¼‰ï¼Œç”¨äºæŒ‡å®šå¯¹è±¡æä¾›ç»™å¤–éƒ¨çš„æ¥å£ã€‚ç„¶åï¼ŒCORBAæŒ‡å®šä»IDLåˆ°ç‰¹å®šå®ç°è¯­è¨€ï¼ˆå¦‚Javaï¼‰çš„æ˜ å°„ã€‚CORBAè§„èŒƒè§„å®šåº”æœ‰ä¸€ä¸ªå¯¹è±¡è¯·æ±‚ä»£ç†ï¼ˆORBï¼‰ï¼Œé€šè¿‡è¯¥å¯¹è±¡åº”ç”¨ç¨‹åºä¸å…¶ä»–å¯¹è±¡è¿›è¡Œäº¤äº’ã€‚é€šç”¨InterORBåè®®ï¼ˆGIOPï¼‰æ‘˜è¦åè®®çš„åˆ›å»ºæ˜¯ä¸ºäº†å…è®¸ORBé—´çš„é€šä¿¡ï¼Œå¹¶æä¾›äº†å‡ ç§å…·ä½“çš„åè®®ï¼ŒåŒ…æ‹¬Internet InterORBåè®®ï¼ˆIIOPï¼‰ï¼Œå®ƒæ˜¯GIOPçš„å®ç°ï¼Œå¯ç”¨äºInternetï¼Œå¹¶æä¾›GIOPæ¶ˆæ¯å’ŒTCP&#x2F;IPå±‚ä¹‹é—´çš„æ˜ å°„ã€‚</p><p><b>IIOP</b>ï¼ŒInternet Inter-ORB Protocol(äº’è”ç½‘å†…éƒ¨å¯¹è±¡è¯·æ±‚ä»£ç†åè®®)ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºCORBA 2.0åŠå…¼å®¹å¹³å°ä¸Šçš„åè®®ï¼›ç”¨æ¥åœ¨CORBAå¯¹è±¡è¯·æ±‚ä»£ç†ä¹‹é—´äº¤æµçš„åè®®ã€‚Javaä¸­ä½¿å¾—ç¨‹åºå¯ä»¥å’Œå…¶ä»–è¯­è¨€çš„CORBAå®ç°äº’æ“ä½œæ€§çš„åè®®ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc/rpc3.png"></img></p><p><b>RMI-IIOP</b>å‡ºç°ä»¥å‰ï¼Œåªæœ‰RMIå’ŒCORBAä¸¤ç§é€‰æ‹©æ¥è¿›è¡Œåˆ†å¸ƒå¼ç¨‹åºè®¾è®¡ï¼ŒäºŒè€…ä¹‹é—´ä¸èƒ½åä½œã€‚RMI-IIOPç»¼åˆäº†RMI å’ŒCORBAçš„ä¼˜ç‚¹ï¼Œå…‹æœäº†ä»–ä»¬çš„ç¼ºç‚¹ï¼Œä½¿å¾—ç¨‹åºå‘˜èƒ½æ›´æ–¹ä¾¿çš„ç¼–å†™åˆ†å¸ƒå¼ç¨‹åºè®¾è®¡ï¼Œå®ç°åˆ†å¸ƒå¼è®¡ç®—ã€‚RMI-IIOPç»¼åˆäº†<b>RMIçš„ç®€å•æ€§</b>&gt;å’Œ<b>CORBAçš„å¤šè¯­è¨€æ€§å…¼å®¹æ€§</b>ï¼ŒRMI-IIOPå…‹æœäº†RMIåªèƒ½ç”¨äºJavaçš„ç¼ºç‚¹å’ŒCORBAçš„å¤æ‚æ€§ã€‚</p><p><b>JRMP</b>ï¼šJavaè¿œç¨‹æ–¹æ³•åè®®ï¼ˆJava Remote Method Protocolï¼‰ï¼Œé€‚ç”¨äºRMIè¿‡ç¨‹ä¸­çš„åè®®ï¼Œåªæœ‰ä½¿ç”¨è¿™ä¸ªåè®®ï¼Œæ–¹æ³•è°ƒç”¨åŒæ–¹æ‰èƒ½æ­£å¸¸è¿›è¡Œæ•°æ®äº¤æµã€‚</p><h4 id="3-2Client-amp-Server"><a href="#3-2Client-amp-Server" class="headerlink" title="3.2Client&amp;Server"></a>3.2Client&amp;Server</h4><p>ä»ç°åœ¨å¼€å§‹å¿˜æ‰æ³¨å†Œä¸­å¿ƒï¼Œå‡è®¾æ³¨å†Œä¸­å¿ƒä»ç°åœ¨å¼€å§‹ä¸å­˜åœ¨<br>ç°åœ¨æˆ‘ä»¬çš„éœ€æ±‚æ˜¯è¿™æ ·çš„ï¼šclientæƒ³æ‰§è¡Œä¸€ä¸ªåœ¨è¿œç¨‹æœºå™¨ä¸Šserverçš„ä¸€ä¸ªæ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ï¼ŸJava RMI ä¼šå¤„ç†è¿™äº›é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆè‚¯å®šä¼šæ¶‰åŠåˆ°socketç½‘ç»œç¼–ç¨‹ï¼Œå› ä¸ºserverè¿è¡Œåœ¨è¿œç¨‹æœºå™¨ä¸Šï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®ç‚¹åœ¨äºä¸¤ç‚¹ï¼š</p><ul><li>å®¢æˆ·ç«¯å¦‚ä½•ä»å¤„ç†ç½‘ç»œè¿æ¥ä¸­è§£è€¦å¼€æ¥</li><li>å®¢æˆ·ç«¯å¦‚ä½•èƒ½å°±åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·æ¥è°ƒç”¨è¿œç¨‹æœºå™¨ä¸Šçš„æ–¹æ³•</li></ul><p>å› æ­¤RMI çš„å¼€å‘äººå‘˜å°±å¼•å…¥äº† Stub å’Œ Skeletonæ¨¡å‹ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc/rpc4.png"></img></p><p>æ‰€æœ‰ä¸ç½‘ç»œç›¸å…³çš„ä»£ç éƒ½æ”¾åœ¨äº†Stubå’ŒSkeletonä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å°±ä¸éœ€è¦å¤„ç†ç½‘ç»œç›¸å…³çš„ä»£ç äº†ã€‚</p><p>Stub åŒæ ·ä¹Ÿå®ç°äº†å’ŒæœåŠ¡ç«¯åŒæ · java.rmi.Remoteæ¥å£ï¼Œè¿™æ ·å½“ Client æƒ³è°ƒç”¨ Server ä¸Šæ–¹æ³•çš„æ—¶å€™ï¼Œå°±å¯ä»¥è°ƒç”¨Stub ä¸Šçš„ç›¸åŒçš„æ–¹æ³•ï¼Œä½†æ˜¯Stubé‡Œé¢åªæœ‰å’Œç½‘ç»œç›¸å…³çš„å¤„ç†é€»è¾‘ï¼Œå¹¶æ²¡æœ‰å¯¹åº”çš„ä¸šåŠ¡å¤„ç†é€»è¾‘ã€‚æ¯”å¦‚è¯´ Server ä¸Šæœ‰ä¸€ä¸ªadd()æ–¹æ³•ï¼ŒStub ä¸­åŒæ ·ä¹Ÿæœ‰ä¸€ä¸ªadd()æ–¹æ³•ï¼Œä½†æ˜¯Stub ä¸Šçš„è¿™ä¸ªadd()æ–¹æ³•å¹¶ä¸åŒ…å«æ·»åŠ çš„é€»è¾‘å®ç°ï¼Œå®ƒä»…ä»…åŒ…å«å¦‚ä½•è¿æ¥åˆ°è¿œç¨‹çš„ Skeletonã€è°ƒç”¨æ–¹æ³•çš„è¯¦ç»†ä¿¡æ¯ã€å‚æ•°ã€è¿”å›å€¼ç­‰ç­‰ã€‚</p><h4 id="3-3RMIRegistry"><a href="#3-3RMIRegistry" class="headerlink" title="3.3RMIRegistry"></a>3.3RMIRegistry</h4><p>åœ¨socketå±‚é€šä¿¡çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>Server åœ¨è¿œç¨‹æœºå™¨ä¸Šç›‘å¬ä¸€ä¸ªç«¯å£ã€‚</li><li>Clientå¹¶ä¸çŸ¥é“Server ç›‘å¬å“ªä¸ªç«¯å£ï¼Œä½†æ˜¯Stub çŸ¥é“ï¼Œè¿™æ ·Clientå¯ä»¥è°ƒç”¨Stub ä¸Šä»–æƒ³è°ƒç”¨çš„ä»»ä½•æ–¹æ³•ã€‚</li><li>Clientè°ƒç”¨Stub ä¸Šçš„æ–¹æ³•</li><li>Stubé“¾æ¥Server ç›‘å¬çš„ç«¯å£å¹¶å‘é€å‚æ•°ï¼Œè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š<ol><li>Clientè¿æ¥Server ç›‘å¬çš„ç«¯å£</li><li>Server æ”¶åˆ°è¯·æ±‚å¹¶åˆ›å»ºä¸€ä¸ªSocketæ¥å¤„ç†è¿™ä¸ªé“¾æ¥</li><li>Server ç»§ç»­ç›‘å¬è¯·æ±‚</li><li>ä½¿ç”¨åŒæ–¹åå®šçš„ä¿¡æ¯ï¼Œä¼ é€å‚æ•°å’Œç»“æœ</li><li>åè®®å¯ä»¥æ˜¯JRMPæˆ–è€… iiop</li></ol></li><li>æ–¹æ³•åœ¨è¿œç¨‹Server ä¸Šæ‰§è¡Œï¼Œå¹¶å‘æ‰§è¡Œç»“æœè¿”å›ç»™Stub</li><li>Stubè¿”å›ç»“æœç»™Clientï¼Œå°±å¥½åƒæ˜¯Stubæ‰§è¡Œäº†è¿™ä¸ªæ–¹æ³•ä¸€æ ·ã€‚</li></ol><p>è¿™æ ·æ•´ä¸ªè¿‡ç¨‹å°±ç»“æŸäº†ï¼Œä½†æ˜¯ç­‰ä¸€ä¸‹ï¼å›å¤´å†çœ‹ç¬¬2ç‚¹ï¼Œè¯´StubçŸ¥é“Serveråœ¨å“ªï¼Œä»–ç›‘å¬çš„ç«¯å£ï¼Œè¿™æ€ä¹ˆå¯èƒ½ï¼Ÿå¦‚æœClientä¸çŸ¥é“Serverçš„hostå’Œportï¼Œä»–æ€ä¹ˆèƒ½åˆ›å»ºä¸€ä¸ªçŸ¥é“æ‰€æœ‰è¿™ä¸€åˆ‡çš„Stubå¯¹è±¡å‘¢ï¼Ÿæ›´ä½•å†µæ˜¯åœ¨æœåŠ¡ç«¯ç«¯å£æ˜¯éšæœºé€‰æ‹©çš„ã€‚</p><p>è¿™å°±æ˜¯ RMIRegistry å­˜åœ¨çš„å¿…è¦äº†ã€‚RMIRegistry å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªhashMapï¼Œé‡Œé¢æ˜¯ public_name, Stub_object åå€¼å¯¹ã€‚æ¯”å¦‚æˆ‘æœ‰ä¸€ä¸ªè¿œç¨‹æœåŠ¡å¯¹è±¡å«åš Scientific_Calculatorï¼Œç„¶åæˆ‘æƒ³æŠŠè¿™ä¸ªæœåŠ¡å¯¹å¤–å…¬å¸ƒä¸º calcï¼Œè¿™æ ·ä¼šåœ¨Serverä¸Šåˆ›å»ºä¸€ä¸ªStubå¯¹è±¡ï¼Œç„¶åæŠŠä»–æ³¨å†Œåˆ°RMIRegistry ï¼Œè¿™æ ·Clientå°±å¯ä»¥ä»RMIRegistry ä¸­å¾—åˆ°è¿™ä¸ªStubå¯¹è±¡äº†ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªå·¥å…·ç±» java.rmi.Naming æ¥æ–¹ä¾¿çš„æ“ä½œæ³¨å†Œå’Œæ“ä½œã€‚</p><h3 id="4-æ¨¡æ‹Ÿå®ç°"><a href="#4-æ¨¡æ‹Ÿå®ç°" class="headerlink" title="4.æ¨¡æ‹Ÿå®ç°"></a>4.æ¨¡æ‹Ÿå®ç°</h3><h4 id="4-1æœåŠ¡ç«¯æ¥å£"><a href="#4-1æœåŠ¡ç«¯æ¥å£" class="headerlink" title="4.1æœåŠ¡ç«¯æ¥å£"></a>4.1æœåŠ¡ç«¯æ¥å£</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰ä¸€ä¸ªè¿œç¨‹æœåŠ¡æ¥å£.RMIå¼ºåˆ¶è¦æ±‚å¿…é¡»æ˜¯Remoteæ¥å£çš„å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FirstInterface</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="comment">//RMIå¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„è¿œç¨‹è°ƒç”¨æ–¹æ³•(åŒ…æ‹¬æ„é€ æ–¹æ³•)éƒ½å¿…é¡»æŠ›å‡ºRemoteException</span></span><br><span class="line">    String <span class="title function_">first</span><span class="params">(String name)</span> <span class="keyword">throw</span> RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-2æœåŠ¡ç«¯å®ç°ç±»"><a href="#4-2æœåŠ¡ç«¯å®ç°ç±»" class="headerlink" title="4.2æœåŠ¡ç«¯å®ç°ç±»"></a>4.2æœåŠ¡ç«¯å®ç°ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®ç°è¿œç¨‹æœåŠ¡æ¥å£ã€‚æ‰€æœ‰çš„è¿œç¨‹æœåŠ¡å®ç°ï¼Œå¿…é¡»æ˜¯Remoteæ¥å£ç›´æ¥å®ç°ç±»æˆ–é—´æ¥å®ç°ç±»</span></span><br><span class="line"><span class="comment">//å¦‚æœä¸ä¼šåˆ›å»ºåŸºäºRMIæœåŠ¡çš„æ ‡å‡†å®ç°ï¼Œå¯ä»¥ç»§æ‰¿UnicastRemoteObjectç±»ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FirstRMIImpl</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">FirstInterface</span>, Remote &#123;</span><br><span class="line">    <span class="comment">//RMIå¼ºåˆ¶è¦æ±‚æ‰€æœ‰çš„è¿œç¨‹è°ƒç”¨æ–¹æ³•(åŒ…æ‹¬æ„é€ æ–¹æ³•)éƒ½å¿…é¡»æŠ›å‡ºRemoteException</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FirstRMIImpl</span><span class="params">()</span> <span class="keyword">throw</span> RemoteException&#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">first</span><span class="params">(String name)</span> <span class="keyword">throw</span> RemoteException&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;ä½ å¥½&quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-3æœåŠ¡ç«¯ä¸»æ–¹æ³•"><a href="#4-3æœåŠ¡ç«¯ä¸»æ–¹æ³•" class="headerlink" title="4.3æœåŠ¡ç«¯ä¸»æ–¹æ³•"></a>4.3æœåŠ¡ç«¯ä¸»æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RMIçš„Registryåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶å‡çº§æˆå®ˆæŠ¤çº¿ç¨‹ã€‚æä¾›æŒä¹…çš„æœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">         <span class="type">FirstInterface</span> <span class="variable">first</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//åˆ›å»ºæœåŠ¡å¯¹è±¡</span></span><br><span class="line">            first = <span class="keyword">new</span> <span class="title class_">FirstRMIImpl</span>();</span><br><span class="line">            <span class="comment">//æ³¨å†Œåˆ°Registry</span></span><br><span class="line">            LocateRegistry.createRegistry(<span class="number">9999</span>);</span><br><span class="line">            <span class="comment">//ç»‘å®šä¸€ä¸ªæœåŠ¡åˆ°æ³¨å†Œä¸­å¿ƒã€‚æä¾›å‘½åï¼Œæ ¼å¼ä¸ºï¼šrim://ip:port/åˆ«åï¼Œå‘½åå†²çªæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="comment">//Naming.bind(&quot;rim://localhost:9999/first&quot;,first);</span></span><br><span class="line">            <span class="comment">//ä¹Ÿå¯ä»¥ä½¿ç”¨rebind()æ–¹æ³•ï¼Œå’Œbind()çš„åŒºåˆ«æ˜¯å‘½åå†²çªä¼šç›´æ¥è¦†ç›–ï¼Œ</span></span><br><span class="line">            Naming.rebind(<span class="string">&quot;rim://localhost:9999/first&quot;</span>,first);</span><br><span class="line">            </span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-4å®¢æˆ·ç«¯ä¸»æ–¹æ³•"><a href="#4-4å®¢æˆ·ç«¯ä¸»æ–¹æ³•" class="headerlink" title="4.4å®¢æˆ·ç«¯ä¸»æ–¹æ³•"></a>4.4å®¢æˆ·ç«¯ä¸»æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RMIçš„Registryåœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå­çº¿ç¨‹ï¼Œå¹¶å‡çº§æˆå®ˆæŠ¤çº¿ç¨‹ã€‚æä¾›æŒä¹…çš„æœåŠ¡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">         <span class="comment">//ä»£ç†å¯¹è±¡çš„åˆ›å»º</span></span><br><span class="line">         <span class="type">FirstInterface</span> <span class="variable">first</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">//ä½¿ç”¨ lookup é€šè¿‡åå­—æ‰¾æœåŠ¡ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</span></span><br><span class="line">            <span class="comment">//ç±»å‹æ˜¯Objectç±»å‹ï¼Œå¯¹è±¡ä¸€å®šæ˜¯Proxyçš„å­ç±»å‹ï¼Œä¸”ä¸€å®šå®ç°äº†æœåŠ¡æ¥å£</span></span><br><span class="line">            first = (FirstInterface) Naming.lookup(<span class="string">&quot;rim://localhost:9999/first&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> first.first(<span class="string">&quot;soul&quot;</span>);</span><br><span class="line">            System.out.println(res);</span><br><span class="line">        &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-è‡ªå®šä¹‰-RPC-æ¡†æ¶"><a href="#5-è‡ªå®šä¹‰-RPC-æ¡†æ¶" class="headerlink" title="5. è‡ªå®šä¹‰ RPC æ¡†æ¶"></a>5. è‡ªå®šä¹‰ RPC æ¡†æ¶</h2><ol><li><a href="">åŸºäº Zookeeper&amp;RMI çš„ Rpc æ¡†æ¶</a></li><li><a href="">åŸºäº Netty çš„ Rpc æ¡†æ¶</a></li></ol><h2 id="6-å‚è€ƒ"><a href="#6-å‚è€ƒ" class="headerlink" title="6.å‚è€ƒ"></a>6.å‚è€ƒ</h2><p><a href="https://www.jianshu.com/p/2c78554a3f36">æ·±å…¥ç†è§£ RMI åŸç†</a></p><p><a href="https://paper.seebug.org/1105/">å…³äº Java ä¸­çš„ RMI-IIOP</a></p><p><a href="https://www.bilibili.com/video/BV1y54y187cf/?spm_id_from=333.788.video.desc.click">å°šå­¦å ‚ç¼–ç¨‹ä¿±ä¹éƒ¨</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-RPCç®€ä»‹&quot;&gt;&lt;a href=&quot;#1-RPCç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;1.RPCç®€ä»‹&quot;&gt;&lt;/a&gt;1.RPCç®€ä»‹&lt;/h2&gt;&lt;p&gt;RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è°ƒç”¨åè®®ã€‚RPCåè®®è§„å®šå…è®¸äº’è”ç½‘ä¸­ä¸€å°ä¸»æœº</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>RPC(Zookeeper &amp; RMI)</title>
    <link href="http://example.com/2022/03/13/RPC(Zookeeper%20&amp;%20RMI)/"/>
    <id>http://example.com/2022/03/13/RPC(Zookeeper%20&amp;%20RMI)/</id>
    <published>2022-03-12T16:00:00.000Z</published>
    <updated>2022-05-24T03:28:37.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>å‰å‡ å¤©æƒ³èµ·è‡ªå·±åŸºäºï¼ˆNetty &amp; Nacosï¼‰æ­å»ºçš„ Rpc æ¡†æ¶ä½¿ç”¨çš„æ˜¯å•ä½“æ¶æ„ï¼Œä¸€ç›´æƒ³æ­ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„çš„Rpcè½®å­ã€‚äºæ˜¯å‚è€ƒ <a href="https://space.bilibili.com/701029654?spm_id_from=333.788.b_765f7570696e666f.1">å°šå­¦å ‚ç¼–ç¨‹ä¿±ä¹éƒ¨</a> çš„ Rpc ä»£ç ï¼Œå°è¯•äº†ä¸€æ¬¡åŸºäºï¼ˆZookeeper &amp; RMIï¼‰çš„åˆ†å¸ƒå¼æ¶æ„çš„ Rpc æ­å»ºã€‚ä»¥ä¸‹ä¸ºæœ¬äººæ•´ç†çš„æ­å»ºè¿‡ç¨‹ï¼ˆç”±äºå†™è¿™ç¯‡æ–‡ç« æ—¶æ—¶é—´ç´§å¼ ï¼Œæ¨¡å—çš„åˆ›å»ºåœ¨æ–‡ç« ä¸­æ²¡æœ‰æŒ‡æ˜ï¼Œé‚£å°±è´´ä¸ªtreeå§ï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">D:.</span><br><span class="line">â”‚  pom.xml</span><br><span class="line">â”‚  RpcCnted.iml</span><br><span class="line">â”‚  </span><br><span class="line">â”œâ”€.idea</span><br><span class="line">â”‚      .gitignore</span><br><span class="line">â”‚      compiler.xml</span><br><span class="line">â”‚      jarRepositories.xml</span><br><span class="line">â”‚      misc.xml</span><br><span class="line">â”‚      workspace.xml</span><br><span class="line">â”‚      </span><br><span class="line">â”œâ”€my_rpc</span><br><span class="line">â”‚  â”‚  pom.xml</span><br><span class="line">â”‚  â”‚  </span><br><span class="line">â”‚  â”œâ”€my_rpc_api</span><br><span class="line">â”‚  â”‚  â”‚  pom.xml</span><br><span class="line">â”‚  â”‚  â”‚  </span><br><span class="line">â”‚  â”‚  â””â”€src</span><br><span class="line">â”‚  â”‚      â””â”€main</span><br><span class="line">â”‚  â”‚          â””â”€java</span><br><span class="line">â”‚  â”‚              â””â”€com</span><br><span class="line">â”‚  â”‚                  â””â”€soul</span><br><span class="line">â”‚  â”‚                      â””â”€service</span><br><span class="line">â”‚  â”‚                              CustomerService.java</span><br><span class="line">â”‚  â”‚                              UserService.java</span><br><span class="line">â”‚  â”‚                              </span><br><span class="line">â”‚  â”œâ”€my_rpc_client</span><br><span class="line">â”‚  â”‚  â”‚  pom.xml</span><br><span class="line">â”‚  â”‚  â”‚  </span><br><span class="line">â”‚  â”‚  â””â”€src</span><br><span class="line">â”‚  â”‚      â””â”€main</span><br><span class="line">â”‚  â”‚          â”œâ”€java</span><br><span class="line">â”‚  â”‚          â”‚  â””â”€com</span><br><span class="line">â”‚  â”‚          â”‚      â””â”€soul</span><br><span class="line">â”‚  â”‚          â”‚              TestRpcClient.java</span><br><span class="line">â”‚  â”‚          â”‚              </span><br><span class="line">â”‚  â”‚          â””â”€resources</span><br><span class="line">â”‚  â”‚                  soul-rpc.properties</span><br><span class="line">â”‚  â”‚                  </span><br><span class="line">â”‚  â””â”€my_rpc_server</span><br><span class="line">â”‚      â”‚  pom.xml</span><br><span class="line">â”‚      â”‚  </span><br><span class="line">â”‚      â””â”€src</span><br><span class="line">â”‚          â””â”€main</span><br><span class="line">â”‚              â”œâ”€java</span><br><span class="line">â”‚              â”‚  â””â”€com</span><br><span class="line">â”‚              â”‚      â””â”€soul</span><br><span class="line">â”‚              â”‚          â”‚  ServerApplication.java</span><br><span class="line">â”‚              â”‚          â”‚  </span><br><span class="line">â”‚              â”‚          â””â”€service</span><br><span class="line">â”‚              â”‚              â””â”€impl</span><br><span class="line">â”‚              â”‚                      CustomerServiceImpl.java</span><br><span class="line">â”‚              â”‚                      UserServiceImpl.java</span><br><span class="line">â”‚              â”‚                      </span><br><span class="line">â”‚              â””â”€resources</span><br><span class="line">â”‚                      soul-rpc-services.properties</span><br><span class="line">â”‚                      soul-rpc.properties</span><br><span class="line">â”‚                      </span><br><span class="line">â””â”€rpc_soul_framework</span><br><span class="line">    â”‚  pom.xml</span><br><span class="line">    â”‚  </span><br><span class="line">    â””â”€src</span><br><span class="line">        â””â”€main</span><br><span class="line">            â”œâ”€java</span><br><span class="line">            â”‚  â””â”€com</span><br><span class="line">            â”‚      â””â”€soul</span><br><span class="line">            â”‚          â””â”€rpc</span><br><span class="line">            â”‚              â”‚  SoulRpcFactory.java</span><br><span class="line">            â”‚              â”‚  </span><br><span class="line">            â”‚              â”œâ”€connection</span><br><span class="line">            â”‚              â”‚      ZkConnection.java</span><br><span class="line">            â”‚              â”‚      </span><br><span class="line">            â”‚              â””â”€registry</span><br><span class="line">            â”‚                      SoulRpcRegistry.java</span><br><span class="line">            â”‚                      </span><br><span class="line">            â””â”€resources</span><br><span class="line">                    soul-rpc.properties</span><br><span class="line">                    </span><br></pre></td></tr></table></figure><h2 id="1-RMI-æœåŠ¡ç«¯"><a href="#1-RMI-æœåŠ¡ç«¯" class="headerlink" title="1. RMI æœåŠ¡ç«¯"></a>1. RMI æœåŠ¡ç«¯</h2><p>é¦–å…ˆæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªæœåŠ¡ç«¯æ¥å£ä¸å…¶å®ç°ç±»ã€‚å¾ˆ easy æ˜¯å§ï¼</p><h3 id="1-1å®šä¹‰æ¥å£"><a href="#1-1å®šä¹‰æ¥å£" class="headerlink" title="1.1å®šä¹‰æ¥å£"></a>1.1å®šä¹‰æ¥å£</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RMI çš„æ¥å£éœ€è¦ç»§æ‰¿ Remote ï¼Œæ–¹æ³•éƒ½éœ€è¦æŠ›å‡º RemoteException</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®ç”¨æˆ·åæŸ¥è¯¢ç”¨æˆ·ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²</span></span><br><span class="line">    String <span class="title function_">getUser</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-2å®šä¹‰æ¥å£çš„å®ç°ç±»"><a href="#1-2å®šä¹‰æ¥å£çš„å®ç°ç±»" class="headerlink" title="1.2å®šä¹‰æ¥å£çš„å®ç°ç±»"></a>1.2å®šä¹‰æ¥å£çš„å®ç°ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”¨æˆ·æœåŠ¡å®ç°ç±»</span></span><br><span class="line"><span class="comment">// RMI çš„æ¥å£å®ç°ç±»åˆ™ç»§æ‰¿ UnicastRemoteObject å°±å¥½ ï¼Œæ–¹æ³•ä¹Ÿéœ€è¦æŠ›å‡º RemoteException</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">(String name)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¦æŸ¥è¯¢çš„ç”¨æˆ·æ˜¯ï¼š&quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;&quot;</span>+name+<span class="string">&quot;\&quot;,\&quot;age\&quot;:20,\&quot;gender\&quot;,\&quot;ç”·\&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException&#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-æ³¨å†Œ-RMI-æœåŠ¡"><a href="#2-æ³¨å†Œ-RMI-æœåŠ¡" class="headerlink" title="2. æ³¨å†Œ RMI æœåŠ¡"></a>2. æ³¨å†Œ RMI æœåŠ¡</h2><p>æœ€ç®€å•çš„ç¬¬ä¸€æ­¥åšå®Œäº†ï¼è¿ˆå‡ºç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸä¸€åŠäº†ï¼æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦æŠŠ RMI çš„æœåŠ¡ç»™æ³¨å†Œåˆ°å®ƒçš„ <b>RMIRegistry</b> ä¸­ã€‚é‚£æˆ‘ä»¬å°±å®šä¹‰ä¸€ä¸ªç±»æ¥ä¸“é—¨æ³¨å†ŒRMI çš„æœåŠ¡å§ï¼</p><p>é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼ŒRMIRegistry å­˜å‚¨æœåŠ¡çš„keyæ˜¯ä¸€ä¸ªå›ºå®šæ ¼å¼çš„å­—ç¬¦ä¸²ã€‚</p><p>å®ƒçš„åŸºæœ¬æ ¼å¼ä¸º ï¼šrmiæ ¼å¼ä¸ºï¼š<code>&quot;rmi://ip:port/interface&quot;</code> , æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠ ip å’Œ port å®šä¹‰å‡ºæ¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoulRpcRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OKï¼æˆ‘ä»¬å¼€å§‹æ³¨å†Œï¼Œæ·»åŠ ä¸€ä¸ªæ³¨å†ŒæœåŠ¡çš„æ–¹æ³•ï¼Œå‚æ•°å½“ç„¶æ˜¯æœåŠ¡ <code>interface</code> äº†ã€‚è¿™é‡Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ RMI ï¼Œå®šä¹‰çš„æœåŠ¡ç«¯æ¥å£éƒ½æ˜¯Remoteçš„å­ç±»ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä½¿ç”¨æ³›å‹äº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span>ï¼Œ</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoulRpcRegistry</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String ip;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†ŒæœåŠ¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceInterface - æœåŠ¡æ¥å£ç±»çš„å¯¹è±¡ã€‚ å¦‚ï¼šcom.soul.service.UserService.class</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serviceObject    - æœåŠ¡ç±»å®ç°ç±»å‹çš„å¯¹è±¡ã€‚ å¦‚ï¼šcom.soul.service.impl.USerServiceImpl.class</span></span><br><span class="line"><span class="comment">     *  </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registryService</span><span class="params">(Class&lt;? extends Remote&gt; serviceInterface, Remote serviceObject)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//rmi = rmi://ip:port/com.soul.service.UserService</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">rmi</span> <span class="operator">=</span> <span class="string">&quot;rmi://&quot;</span> + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/&quot;</span> + serviceInterface.getName();</span><br><span class="line">        <span class="comment">//æ³¨å†ŒæœåŠ¡å¯¹è±¡</span></span><br><span class="line">        Naming.rebind(rmi, serviceObject);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬çš„ RMI æ³¨å†ŒæœåŠ¡ä¹Ÿå®Œæˆäº†ï¼</p><h2 id="3-è¿æ¥Zookeeper"><a href="#3-è¿æ¥Zookeeper" class="headerlink" title="3. è¿æ¥Zookeeper"></a>3. è¿æ¥Zookeeper</h2><p>æˆ‘ä»¬æƒ³è¦æŠŠ RMI ä¸­å­˜å‚¨çš„æœåŠ¡ç«¯ä¿¡æ¯ å­˜åˆ° Zookeeper ä¸­ï¼Œé¦–å…ˆå°±è¦è¿æ¥Zookeeperã€‚</p><p>æ—¢ç„¶æ˜¯Zookeeperçš„è¿æ¥ç±»ï¼Œå°±éœ€è¦ Zookeeper çš„è¿æ¥åœ°å€ï¼Œè¿˜æœ‰è¿æ¥çš„æœ€å¤§è¶…æ—¶æ—¶é—´ã€‚æ•™ç»ƒæ•™ç»ƒï¼Œè¿™ä¸ªæˆ‘ä¼šï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZkConnection</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿å­˜zkçš„åœ°å€ï¼Œæ ¼å¼ä¸ºï¼šip:portã€‚å¦‚ï¼š192.168.169.130ï¼š2181</span></span><br><span class="line">    <span class="keyword">private</span> String zkServer;</span><br><span class="line">    <span class="comment">//è¿æ¥è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> sessionTimeout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨æ„é€ æ–¹æ³•é‡Œåˆå§‹åŒ–è¿™ä¸¤ä¸ªå‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½® Zookeeperè¿æ¥</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ZkConnection</span><span class="params">(String zkServer, <span class="type">int</span> sessionTimeout)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.zkServer = zkServer;</span><br><span class="line">    <span class="built_in">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">//è®¾ç½®æ— å‚æ•° Zookeeperè¿æ¥ï¼Œç»™å®šé»˜è®¤å€¼ã€‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ZkConnection</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    <span class="built_in">this</span>.zkServer = <span class="string">&quot;localhost:2181&quot;</span>;</span><br><span class="line">    <span class="built_in">this</span>.sessionTimeout = <span class="number">10</span> * <span class="number">1000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åä¸ Zookeeper è¿›è¡Œè¿æ¥ ï¼Œè¿”å›å€¼ç±»å‹Zookeeperã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ZooKeeper <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ZooKeeper</span>(zkServer, sessionTimeout, <span class="keyword">new</span> <span class="title class_">Watcher</span>() &#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">(WatchedEvent watchedEvent)</span> &#123;</span><br><span class="line">            <span class="comment">//ä¸çŸ¥é“å†™å•¥å°±å…ˆç©ºç€å‘—</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Zookeeperæ³¨å†Œ"><a href="#4-Zookeeperæ³¨å†Œ" class="headerlink" title="4. Zookeeperæ³¨å†Œ"></a>4. Zookeeperæ³¨å†Œ</h2><p>æˆ‘ä»¬å·²ç»æŠŠæœåŠ¡æ³¨å†Œåˆ° RMI çš„ Registry ä¸­äº†ï¼Œç°åœ¨åªéœ€è¦æŠŠ RMI ä¸­å­˜å‚¨çš„ è®¿é—®åœ°å€ URI å­˜å‚¨åˆ° Zookeeper ä¸­ã€‚</p><p>æ—¢ç„¶è¦æ³¨å†Œï¼Œå¿…ç„¶éœ€è¦æˆ‘ä»¬ä¸Šä¸€æ­¥çš„å®šä¹‰çš„ <code>ZkConnection</code> æ¥å¸®æˆ‘ä»¬è¿æ¥ Zookeeperï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ <code>SoulRpcRegistry</code> ä¸­å¢åŠ  <code>ZkConnection</code> å±æ€§ï¼Œå¹¶ä¿®æ”¹ <code>registryService</code> æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Zookeeperè¿æ¥å¯¹è±¡</span></span><br><span class="line"><span class="keyword">private</span> ZkConnection connection;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³¨å†ŒæœåŠ¡çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> * 1.æ‹¼æ¥RMIçš„è®¿é—®åœ°å€URI</span></span><br><span class="line"><span class="comment"> * 2.æŠŠè®¿é—®åœ°å€URIå­˜å‚¨åœ¨Zookeeper</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceInterface - æœåŠ¡æ¥å£ç±»çš„å¯¹è±¡ã€‚ å¦‚ï¼šcom.soul.service.UserService.class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> serviceObject - æœåŠ¡ç±»å®ç°ç±»å‹çš„å¯¹è±¡ã€‚ å¦‚ï¼šcom.soul.service.impl.USerServiceImpl.class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception - æŠ›å‡ºå¼‚å¸¸ä»£è¡¨æ³¨å†Œå¤±è´¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registryService</span><span class="params">(Class&lt;? extends Remote&gt; serviceInterface, Remote serviceObject)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException &#123;</span><br><span class="line">    <span class="comment">//rmi = rmi://ip:port/com.soul.service.UserService</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">rmi</span> <span class="operator">=</span> <span class="string">&quot;rmi://&quot;</span> + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/&quot;</span> + serviceInterface.getName();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æŠŠæœåŠ¡å¯¹è±¡åœ¨RMIçš„registryä¸­æ³¨å†Œ</span></span><br><span class="line">    Naming.rebind(rmi, serviceObject);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//æ‹¼æ¥ä¸€ä¸ªæœ‰è§„åˆ™çš„zkå­˜å‚¨èŠ‚ç‚¹å‘½å</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/soul/rpc/&quot;</span> + serviceInterface.getName();</span><br><span class="line">    connection.getConnection().create(path, rmi.getBytes(),</span><br><span class="line">                                      ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±å¤§åŠŸå‘Šæˆäº†ï¼Ÿno no noï¼æˆ‘ä»¬åªåœ¨ Zookeeper ä¸­å­˜æœåŠ¡è¿›å»å¯ä¸è¡Œï¼Œä¹Ÿå¾—å–å‡ºæ¥ç”¨å‘€ï¼Œä¸ç„¶æˆ‘è¿™ä¸ç™½å­˜å•¦ï¼Ÿ</p><p>é‚£æˆ‘ä»¬å°±åœ¨ <code>SoulRpcRegistry</code> ä¸­æ·»åŠ ä¸€ä¸ªå–çš„æ–¹æ³•ï¼Œé¦–å…ˆæ‹¿åˆ°èŠ‚ç‚¹æ•°æ®ï¼Œç„¶åå†å» <code>RMIRegistry</code> ä¸­æ‹¿åˆ°å®¢æˆ·ç«¯çš„ä»£ç†å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ ¹æ®æœåŠ¡æ¥å£ç±»å‹è®¿é—®zkï¼Œè·å–RMIçš„è¿œç¨‹ä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="comment"> * 1.æ‹¼æ¥ä¸€ä¸ªzkä¸­çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="comment"> * 2.è®¿é—®zkï¼ŒæŸ¥è¯¢èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ•°æ®</span></span><br><span class="line"><span class="comment"> * 3.æ ¹æ®æŸ¥è¯¢çš„ç»“æœï¼Œåˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Remote</span>&gt; T <span class="title function_">getServiceProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException, NotBoundException &#123;</span><br><span class="line">    <span class="comment">//æ‹¼æ¥zkä¸­çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/soul/rpc/&quot;</span> + serviceInterface.getName();</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢èŠ‚ç‚¹ä¸­å­˜å‚¨çš„æ•°æ®</span></span><br><span class="line">    <span class="type">byte</span>[] datas = connection.getConnection().getData(path, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//æŠŠæŸ¥è¯¢çš„å­—èŠ‚æ•°ç»„ï¼Œç¿»è¯‘æˆRMIçš„è®¿é—®åœ°å€</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">rmi</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(datas);</span><br><span class="line">    <span class="comment">//è¿”å›ä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> (T) Naming.lookup(rmi);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ•´ä¸ªæ³¨å†Œå™¨æˆ‘ä»¬å°±å†™å¥½å•¦ï¼</p><h2 id="5-åˆå§‹åŒ–å‚æ•°"><a href="#5-åˆå§‹åŒ–å‚æ•°" class="headerlink" title="5. åˆå§‹åŒ–å‚æ•°"></a>5. åˆå§‹åŒ–å‚æ•°</h2><h3 id="5-1-å‚æ•°é…ç½®æ–‡ä»¶"><a href="#5-1-å‚æ•°é…ç½®æ–‡ä»¶" class="headerlink" title="5.1 å‚æ•°é…ç½®æ–‡ä»¶"></a>5.1 å‚æ•°é…ç½®æ–‡ä»¶</h3><p>æˆ‘ä»¬çŸ¥é“ ï¼Œæ— è®ºæ˜¯ RMI è¿˜æ˜¯ Zookeeper ï¼Œéƒ½éœ€è¦ä¸€äº›å›ºå®šæ ¼å¼çš„å‚æ•°æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚ ipã€portç­‰ã€‚è¿™äº›å‚æ•°ä¸€æ—¦å‘ç”Ÿå˜åŒ–ï¼Œæˆ‘ä»¬æƒ³è¦ä¿®æ”¹å°±ä¼šå˜å¾—å¾ˆéº»çƒ¦ï¼Œéœ€è¦å»ä»£ç é‡Œé¢ç–¯ç‹‚ Ctrl + F ï¼Œæ‰€ä»¥æœ€å¥½ä½¿ç”¨ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å­˜å‚¨è¿™äº›å‚æ•°çš„å€¼ã€‚</p><p>å®šä¹‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ (.properties) ï¼š</p><p><code>soul-rpc.properties:</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">registry.ip</span>=<span class="string">127.0.0.1</span></span><br><span class="line"><span class="attr">registry.port</span>=<span class="string">9999</span></span><br><span class="line"><span class="attr">zk.server</span>=<span class="string">192.168.169.130:2181</span></span><br><span class="line"><span class="attr">zk.sessionTimeout</span>=<span class="string">20000</span></span><br></pre></td></tr></table></figure><h3 id="5-2-åŠ è½½é…ç½®æ–‡ä»¶"><a href="#5-2-åŠ è½½é…ç½®æ–‡ä»¶" class="headerlink" title="5.2 åŠ è½½é…ç½®æ–‡ä»¶"></a>5.2 åŠ è½½é…ç½®æ–‡ä»¶</h3><p>å¥½å˜ï¼Œæˆ‘ä»¬å‚æ•°çš„é…ç½®æ–‡ä»¶å®šä¹‰å¥½äº†ï¼Œæ¥ä¸‹æ¥æœ‰ä¸ªæ–°é—®é¢˜ï¼šä»€ä¹ˆæ—¶å€™åŠ è½½é…ç½®æ–‡ä»¶å‘¢ï¼Ÿé‚£è‚¯å®šæ˜¯åœ¨ä½¿ç”¨ Zookeeper æˆ– RMI ä¹‹å‰å‘€ï¼</p><p>é‚£æˆ‘ä»¬å°±å®šä¹‰ä¸€ä¸ªæœåŠ¡ç«¯çš„å…¥å£ç±»å‘—ï¼Œåœ¨å…¥å£ç±»çš„ä»£ç å—æˆ–è€…æ„é€ æ–¹æ³•ä¸­åŠ è½½é…ç½®æ–‡ä»¶ä¸å°±å¾—äº†ï¼è€Œä¸”è¦è®°å¾—æˆ‘ä»¬ RMI çš„æ³¨å†Œå™¨ä¹Ÿè¿˜æ²¡åˆ›å»ºå‘¢ï¼Œå¯ä»¥åœ¨è¿™ä¸ªå…¥å£ç±»ä¸­ä¸€å¹¶åˆ›å»ºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoulRpcFactory</span> &#123;</span><br><span class="line">    <span class="comment">//ä¿å­˜é…ç½®ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Properties</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    <span class="comment">//è¿æ¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ZkConnection connection;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> SoulRpcRegistry registry;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆå§‹åŒ–è¿‡ç¨‹ã€‚</span></span><br><span class="line"><span class="comment">     * å›ºå®šé€»è¾‘ï¼šåœ¨classpathä¸‹ï¼Œé…ç½®æ–‡ä»¶ã€‚å‘½åä¸º: soul-rpc.properties</span></span><br><span class="line"><span class="comment">     * é…ç½®æ–‡ä»¶ç»“æ„å›ºåŒ–ï¼š</span></span><br><span class="line"><span class="comment">     *  registry.ip = æœåŠ¡ç«¯Ipåœ°å€ï¼Œé»˜è®¤ä¸º localhost</span></span><br><span class="line"><span class="comment">     *  registry.port = æœåŠ¡ç«¯ç«¯å£å·ï¼Œé»˜è®¤ä¸º 9090</span></span><br><span class="line"><span class="comment">     *  zk.server = Zookeeperè®¿é—®åœ°å€ï¼Œé»˜è®¤ä¸º localhost:2181</span></span><br><span class="line"><span class="comment">     *  zk.sessionTimeout = Zookeeperè¿æ¥ä¼šè¯è¶…æ—¶ï¼Œé»˜è®¤10s</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//è·å–classpathç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶è¾“å…¥æµ</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> SoulRpcFactory.class.getClassLoader().getResourceAsStream(<span class="string">&quot;soul-rpc.properties&quot;</span>);</span><br><span class="line">            <span class="comment">//è¯»å–é…ç½®æ–‡ä»¶ï¼Œåˆå§‹åŒ–é…ç½®å¯¹è±¡</span></span><br><span class="line">            config.load(input);</span><br><span class="line">            <span class="comment">//è·å–æœåŠ¡ç«¯ip</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">serverIp</span> <span class="operator">=</span> config.getProperty(<span class="string">&quot;registry.ip&quot;</span>) == <span class="literal">null</span> </span><br><span class="line">                ? <span class="string">&quot;localhost&quot;</span> : config.getProperty(<span class="string">&quot;registry.ip&quot;</span>);</span><br><span class="line">            <span class="comment">//è·å–æœåŠ¡ç«¯port</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">serverPort</span> <span class="operator">=</span> config.getProperty(<span class="string">&quot;registry.port&quot;</span>)  == <span class="literal">null</span> </span><br><span class="line">                ? <span class="number">9090</span> : Integer.parseInt(config.getProperty(<span class="string">&quot;registry.port&quot;</span>));</span><br><span class="line">            <span class="comment">//è·å–zkæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">zkServer</span> <span class="operator">=</span> config.getProperty(<span class="string">&quot;zk.server&quot;</span>) == <span class="literal">null</span> </span><br><span class="line">                ? <span class="string">&quot;localhost:2181&quot;</span> : config.getProperty(<span class="string">&quot;zk.server&quot;</span>);</span><br><span class="line">            <span class="comment">//è·å–zkå®¢æˆ·ç«¯ä¼šè¯è¶…æ—¶æ—¶é—´</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">zkSessionTimeout</span> <span class="operator">=</span> config.getProperty(<span class="string">&quot;zk.sessionTimeout&quot;</span>) == <span class="literal">null</span> </span><br><span class="line">                ? <span class="number">10000</span> : Integer.parseInt(config.getProperty(<span class="string">&quot;zk.sessionTimeout&quot;</span>));</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ›å»ºè¿æ¥å¯¹è±¡</span></span><br><span class="line">            connection = <span class="keyword">new</span> <span class="title class_">ZkConnection</span>(zkServer,zkSessionTimeout);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//åˆ›å»ºæ³¨å†Œå™¨å¯¹è±¡</span></span><br><span class="line">            registry = <span class="keyword">new</span> <span class="title class_">SoulRpcRegistry</span>(serverIp,serverPort,connection);</span><br><span class="line">            <span class="comment">//åˆ›å»ºRMIçš„æ³¨å†Œå™¨</span></span><br><span class="line">            LocateRegistry.createRegistry(serverPort);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">//åˆå§‹åŒ–ä»£ç å—å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œä¸­æ–­è™šæ‹Ÿæœº</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionInInitializerError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶æ˜¯å…¥å£ç±»ï¼Œé‚£æˆ‘ä»¬å¯ä»¥æŠŠ <code>SoulRpcRegistry</code> çš„æ³¨å†ŒæœåŠ¡çš„æ–¹æ³• å’Œ è·å–ä»£ç†å¯¹è±¡çš„æ–¹æ³• ä¹Ÿäº¤ç»™è¿™ä¸ªå…¥å£ç±»ç®¡ç†ï¼Œé‚£å°±ç®€ç®€å•å•åœ¨è¿™ä¸ªç±»ä¸­æ·»åŠ ä¸¤ä¸ªæ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æä¾›ä¸€ä¸ªå¿«é€Ÿçš„æ³¨å†ŒæœåŠ¡çš„é™æ€å·¥å…·æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">registerService</span><span class="params">(Class&lt;? extends Remote&gt; serviceInterface, Remote serviceObject)</span> <span class="keyword">throws</span> InterruptedException, IOException, KeeperException &#123;</span><br><span class="line">    registry.registryService(serviceInterface,serviceObject);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æä¾›ä¸€ä¸ªå¿«é€Ÿçš„æ‹¿åˆ°å®¢æˆ·ç«¯ä»£ç†å¯¹è±¡çš„é™æ€å·¥å…·æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Remote</span>&gt; T <span class="title function_">getServiceProxy</span><span class="params">(Class&lt;T&gt; serviceInterface)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="keyword">return</span> registry.getServiceProxy(serviceInterface);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>OK! å°åŠŸå‘Šæˆï¼æ¥ä¸‹æ¥æµ‹è¯•ä¸€ä¸‹æœåŠ¡ç«¯èƒ½å¦ä½¿ç”¨å§ï¼</p><h2 id="6-æµ‹è¯•æœåŠ¡ç«¯"><a href="#6-æµ‹è¯•æœåŠ¡ç«¯" class="headerlink" title="6. æµ‹è¯•æœåŠ¡ç«¯"></a>6. æµ‹è¯•æœåŠ¡ç«¯</h2><p>å†™ä¸ªæµ‹è¯•ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªæœåŠ¡å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        <span class="comment">//æ³¨å†Œ</span></span><br><span class="line">        SoulRpcFactory.registerService(UserService.class, userService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ï¼ğŸ˜­ï¼šå‘ç°æŠ¥é”™</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/1.png"></img></p><p>åŸæ¥æ˜¯çˆ¶èŠ‚ç‚¹æ²¡åˆ›å»ºå‘€ï¼Œæä»€ä¹ˆå•Šï¼Œå°±è¿™ï¼Ÿç›´æ¥åŠ ä¸ªåˆ¤æ–­è§£å†³å®ƒï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//--æ­¤å¤„ä»£ç çœç•¥--</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–zkä¸­çš„çˆ¶èŠ‚ç‚¹/soul/rpc</span></span><br><span class="line">        List&lt;String&gt; children = connection.getConnection().getChildren(<span class="string">&quot;/&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// ä¸å­˜åœ¨å­èŠ‚ç‚¹ /soul</span></span><br><span class="line">        <span class="keyword">if</span>(!children.contains(<span class="string">&quot;soul&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// åˆ›å»ºèŠ‚ç‚¹/soul</span></span><br><span class="line">            connection.getConnection()</span><br><span class="line">                .create(<span class="string">&quot;/soul&quot;</span>, <span class="literal">null</span>, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;String&gt; soulChildren = connection.getConnection().getChildren(<span class="string">&quot;/soul&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">if</span>(!soulChildren.contains(<span class="string">&quot;rpc&quot;</span>))&#123;</span><br><span class="line">            connection.getConnection()</span><br><span class="line">                .create(<span class="string">&quot;/soul/rpc&quot;</span>, <span class="literal">null</span>, ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="comment">//åˆå§‹åŒ–ä»£ç å—å‘ç”Ÿå¼‚å¸¸çš„æ—¶å€™ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œä¸­æ–­è™šæ‹Ÿæœº</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionInInitializerError</span>(e);</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œç¾å¯åŠ¨</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/2.png"></img></p><p>æ¥ä¸‹æ¥å»Zookeeper ç…ç…ï¼Œå‘ç°æˆåŠŸå­˜å…¥ã€‚é‚£å°±æŸ¥çœ‹ä¸€ä¸‹valueå€¼ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/3.png"></img></p><h2 id="7-æœåŠ¡ç«¯å¯åŠ¨é—®é¢˜"><a href="#7-æœåŠ¡ç«¯å¯åŠ¨é—®é¢˜" class="headerlink" title="7. æœåŠ¡ç«¯å¯åŠ¨é—®é¢˜"></a>7. æœåŠ¡ç«¯å¯åŠ¨é—®é¢˜</h2><h3 id="7-1-å¢åŠ æœåŠ¡é…ç½®æ–‡ä»¶"><a href="#7-1-å¢åŠ æœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="7.1 å¢åŠ æœåŠ¡é…ç½®æ–‡ä»¶"></a>7.1 å¢åŠ æœåŠ¡é…ç½®æ–‡ä»¶</h3><p>åœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬çš„æœåŠ¡ç«¯å¯åŠ¨æˆåŠŸäº†ï¼Œä½†æ˜¯æœ‰ä¸ªå°é—®é¢˜å“ˆï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªæœ‰ä¸€ä¸ª <code>UserService</code> æœåŠ¡ã€‚å½“æˆ‘ä»¬æœ‰å¤šä¸ªæœåŠ¡æ—¶ï¼Œæˆ‘ä»¬éš¾é“è¦ä¸€ä¸ªä¸ªåœ¨æœåŠ¡ç«¯ä¸€ä¸ªä¸ªçš„æ³¨å†Œè°ƒç”¨å—ï¼Ÿè¿™ä¹Ÿå¤ªéº»çƒ¦äº†å§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»ç„¶æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="7-1-1-æœåŠ¡é…ç½®æ–‡ä»¶"><a href="#7-1-1-æœåŠ¡é…ç½®æ–‡ä»¶" class="headerlink" title="7.1.1 æœåŠ¡é…ç½®æ–‡ä»¶"></a>7.1.1 æœåŠ¡é…ç½®æ–‡ä»¶</h4><p><code>soul-rpc-services.properties:</code></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é…ç½®æ–‡ä»¶æ ¼å¼æ˜¯ï¼šæ¥å£å…¨å‘½å=å®ç°ç±»å…¨å‘½å</span></span><br><span class="line"><span class="attr">com.soul.service.UserService</span>=<span class="string">com.soul.service.impl.UserServiceImpl</span></span><br><span class="line"><span class="attr">com.soul.service.CustomerService</span>=<span class="string">com.soul.service.impl.CustomerServiceImpl</span></span><br></pre></td></tr></table></figure><h4 id="7-1-2-åŠ è½½é…ç½®æ–‡ä»¶"><a href="#7-1-2-åŠ è½½é…ç½®æ–‡ä»¶" class="headerlink" title="7.1.2 åŠ è½½é…ç½®æ–‡ä»¶"></a>7.1.2 åŠ è½½é…ç½®æ–‡ä»¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoulRpcFactory</span> &#123;</span><br><span class="line">    <span class="comment">//ä»£ç çœç•¥</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨äºè¯»å–åˆå§‹åŒ–çš„é…ç½®å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Properties</span> <span class="variable">services</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//ä»£ç çœç•¥</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//æ‹¿åˆ°é…ç½®æ–‡ä»¶(soul-rpc-services.properties)ã€‚å¦‚æœæœ‰åˆ™è‡ªåŠ¨åˆå§‹åŒ–ï¼Œæ²¡æœ‰åˆ™å¿½ç•¥åç»­é€»è¾‘</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">servicesInput</span> <span class="operator">=</span> SoulRpcFactory.class</span><br><span class="line">                    .getClassLoader().getResourceAsStream(<span class="string">&quot;soul-rpc-services.properties&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (servicesInput != <span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="comment">//æœ‰é…ç½® åˆå§‹åŒ–</span></span><br><span class="line">                services.load(servicesInput);</span><br><span class="line">                <span class="comment">//éå†é›†åˆservices</span></span><br><span class="line">                <span class="keyword">for</span>(Map.Entry&lt;Object,Object&gt; entry : services.entrySet())&#123;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">key</span> <span class="operator">=</span> entry.getKey();</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> services.get(key);</span><br><span class="line">                    Class&lt;Remote&gt; serviceInterface = (Class&lt;Remote&gt;) Class.forName(key.toString());</span><br><span class="line">                    <span class="type">Remote</span> <span class="variable">serviceObject</span> <span class="operator">=</span> (Remote) Class.forName(value.toString()).newInstance();</span><br><span class="line">                    <span class="comment">//æœ‰äº†æ¥å£çš„ç±»å¯¹è±¡ä»¥åŠæœåŠ¡çš„å¯¹è±¡åï¼Œå¯ä»¥å¼€å§‹æ³¨å†Œ</span></span><br><span class="line">                    registry.registryService(serviceInterface,serviceObject);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExceptionInInitializerError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä»£ç çœç•¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-1-3-ä¿®æ”¹å¯åŠ¨ç±»"><a href="#7-1-3-ä¿®æ”¹å¯åŠ¨ç±»" class="headerlink" title="7.1.3 ä¿®æ”¹å¯åŠ¨ç±»"></a>7.1.3 ä¿®æ”¹å¯åŠ¨ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        Class.forName(<span class="string">&quot;com.soul.rpc.SoulRpcFactory&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="7-2-èŠ‚ç‚¹å·²åˆ›å»ºé—®é¢˜"><a href="#7-2-èŠ‚ç‚¹å·²åˆ›å»ºé—®é¢˜" class="headerlink" title="7.2 èŠ‚ç‚¹å·²åˆ›å»ºé—®é¢˜"></a>7.2 èŠ‚ç‚¹å·²åˆ›å»ºé—®é¢˜</h3><p>å¦‚æœæˆ‘ä»¬é‡å¤åˆ›å»ºåŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šæŠ¥è¿™ä¸ªé”™è¯¯ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/4.png"></img></p><p>é‚£å°±æƒ³ç­–ç•¥å§ï¼šæ¯æ¬¡åˆ›å»ºå‰å…ˆè¿›è¡Œä¸€æ¬¡æŸ¥è¯¢åˆ¤æ–­ï¼Œå¦‚æœè¦åˆ›å»ºçš„èŠ‚ç‚¹å·²ç»å­˜åœ¨äº†ï¼Œå°±å…ˆåˆ é™¤æ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œç„¶åé‡æ–°åˆ›å»ºæ–°çš„èŠ‚ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SoulRpcRegistry</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä»£ç çœç•¥</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registryService</span><span class="params">(Class&lt;? extends Remote&gt; serviceInterface, Remote serviceObject)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">//rmi = rmi://ip:port/com.soul.service.UserService</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">rmi</span> <span class="operator">=</span> <span class="string">&quot;rmi://&quot;</span> + ip + <span class="string">&quot;:&quot;</span> + port + <span class="string">&quot;/&quot;</span> + serviceInterface.getName();</span><br><span class="line">        <span class="comment">//æ‹¼æ¥ä¸€ä¸ªæœ‰è§„åˆ™çš„zkå­˜å‚¨èŠ‚ç‚¹å‘½å</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/soul/rpc/&quot;</span> + serviceInterface.getName();</span><br><span class="line">        <span class="comment">//æŠŠæœåŠ¡å¯¹è±¡åœ¨RMIçš„registryä¸­æ³¨å†Œ</span></span><br><span class="line">        Naming.rebind(rmi, serviceObject);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; children = connection.getConnection().getChildren(<span class="string">&quot;/soul/rpc&quot;</span>, <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//å¦‚æœèŠ‚ç‚¹å·²ç»å­˜åœ¨ï¼Œåˆ é™¤æ‰</span></span><br><span class="line">        <span class="keyword">if</span> (children.contains(serviceInterface.getName()))&#123;</span><br><span class="line">            <span class="type">Stat</span> <span class="variable">stat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stat</span>();</span><br><span class="line">            connection.getConnection().getData(path,<span class="literal">false</span>,stat);</span><br><span class="line">            connection.getConnection().delete(path,stat.getCversion());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ³¨å†Œåˆ°Zookeeper</span></span><br><span class="line">        connection.getConnection().create(path, rmi.getBytes(),</span><br><span class="line">                ZooDefs.Ids.OPEN_ACL_UNSAFE, CreateMode.PERSISTENT);    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//ä»£ç çœç•¥</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ¬¡å¯åŠ¨ï¼ŒæˆåŠŸè¿è¡Œï¼</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/5.png"></img></p><h2 id="8-RMI-å®¢æˆ·ç«¯"><a href="#8-RMI-å®¢æˆ·ç«¯" class="headerlink" title="8. RMI å®¢æˆ·ç«¯"></a>8. RMI å®¢æˆ·ç«¯</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•åŸºäºè‡ªå®šä¹‰Rpcæ¡†æ¶çš„å®¢æˆ·ç«¯å¼€å‘</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestRpcClient</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡è‡ªå®šä¹‰æ¡†æ¶ï¼Œè¿æ¥zkï¼Œè·å–æ¥å£çš„åŠ¨æ€ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> SoulRpcFactory.getServiceProxy(UserService.class);</span><br><span class="line">            System.out.println(userService.getClass().getName());</span><br><span class="line">            <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> userService.getUser(<span class="string">&quot;SoulChay&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;è¿œç¨‹æœåŠ¡è¿”å›æŸ¥è¯¢ç»“æœï¼š&quot;</span> + res);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥å¯åŠ¨ï¼Œç›´æ¥æˆåŠŸï¼ï¼ˆä¸æˆåŠŸçš„ä¹Ÿä¸ä¼šæ”¾ä¸Šæ¥æ˜¯å­ï¼‰</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/rpc(z&r)/6.png"></img></p><h2 id="å†™åœ¨æœ€å"><a href="#å†™åœ¨æœ€å" class="headerlink" title="å†™åœ¨æœ€å"></a>å†™åœ¨æœ€å</h2><p>è¿™æ ·æˆ‘ä»¬åŸºäº (Zookeeper &amp; RMI) çš„ç®€å•RPCæ¡†æ¶å°±æ­å»ºå¥½äº†ã€‚</p><p>ä¹‹åæˆ‘ä¼šæŠŠå®ƒå®Œå–„ä¸€ä¸‹æ”¾åœ¨GitHubä¸Šï¼Œæ–‡ç« æœ‰ä¸å¯¹çš„åœ°æ–¹æˆ–è€…æ‚¨æœ‰ä»€ä¹ˆæƒ³æ³•éƒ½æ¬¢è¿è¯„è®ºç•™è¨€ã€‚</p><p>æ„Ÿè°¢é˜…è¯»åˆ°æœ€åï¼</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;å‰å‡ å¤©æƒ³èµ·è‡ªå·±åŸºäºï¼ˆNetty &amp;amp; Nacosï¼‰æ­å»ºçš„ Rpc æ¡†æ¶ä½¿ç”¨çš„æ˜¯å•ä½“æ¶æ„ï¼Œä¸€ç›´æƒ³æ­ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„çš„Rpc</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Zookeeper-note</title>
    <link href="http://example.com/2022/03/10/Zookeeper/"/>
    <id>http://example.com/2022/03/10/Zookeeper/</id>
    <published>2022-03-09T16:00:00.000Z</published>
    <updated>2022-05-24T04:56:32.551Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-Zookeeperä»‹ç»"><a href="#1-Zookeeperä»‹ç»" class="headerlink" title="1.Zookeeperä»‹ç»"></a>1.Zookeeperä»‹ç»</h2><ul><li>Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›åè°ƒæœåŠ¡çš„Apacheé¡¹ç›®ã€‚</li><li>Zookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼šæ˜¯åŸºäºè§‚å¯Ÿè€…æ¨¡å¼è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒè´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶å…³å¿ƒçš„æ•°æ®ï¼Œç„¶åæ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeperå°±å°†è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„ååº”ã€‚</li></ul><h3 id="1-1-Zookeeperç»“æ„"><a href="#1-1-Zookeeperç»“æ„" class="headerlink" title="1.1 Zookeeperç»“æ„"></a>1.1 Zookeeperç»“æ„</h3><p>Zookeeper æ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹åšæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°ä½œä¸€ä¸ªZNodeã€‚æ¯ä¸€ä¸ªZNodeé»˜è®¤èƒ½å¤Ÿå­˜å‚¨1MBçš„æ•°æ®ï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†ã€‚</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper1.png"></img></p><h3 id="1-2-é…ç½®-Zookeeper"><a href="#1-2-é…ç½®-Zookeeper" class="headerlink" title="1.2 é…ç½® Zookeeper"></a>1.2 é…ç½® Zookeeper</h3><p>Zookeeper åœ¨å¯åŠ¨æ—¶ä¼šå» conf ç›®å½•ä¸‹å¯»æ‰¾ zoo.cfg çš„é…ç½®æ–‡ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›å…¥åˆ°confç›®å½•æ‹·è´ä¸€ä¸ªzoo_sample.cfgå¹¶å®Œæˆé…ç½® ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿›å…¥åˆ°confç›®å½•</span></span><br><span class="line">cd /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ‹·è´</span></span><br><span class="line">cp  zoo_sample.cfg  zoo.cfg</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹zoo.cfg ä¸­çš„ dataDir</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /opt/zooKeeper/apache-zooKeeper-3.5.6-bin/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">dataDir=/opt/zookeeper/zkdata</span><br></pre></td></tr></table></figure><h3 id="1-3-Zookeeperå¸¸ç”¨å‘½ä»¤"><a href="#1-3-Zookeeperå¸¸ç”¨å‘½ä»¤" class="headerlink" title="1.3 Zookeeperå¸¸ç”¨å‘½ä»¤"></a>1.3 Zookeeperå¸¸ç”¨å‘½ä»¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è¿æ¥ZooKeeperæœåŠ¡ç«¯</span></span><br><span class="line">./zkCli.sh â€“server ip:port</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ–­å¼€è¿æ¥</span></span><br><span class="line">quit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹èŠ‚ç‚¹</span></span><br><span class="line">ls ç›®å½•</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºèŠ‚ç‚¹</span></span><br><span class="line">create /èŠ‚ç‚¹path value</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è·å–èŠ‚ç‚¹å€¼</span></span><br><span class="line">get /èŠ‚ç‚¹path</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">è®¾ç½®èŠ‚ç‚¹å€¼</span></span><br><span class="line">set /èŠ‚ç‚¹path value</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ é™¤å•ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">delete /èŠ‚ç‚¹path</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span></span><br><span class="line">deleteall /èŠ‚ç‚¹path</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹</span></span><br><span class="line">create -e /èŠ‚ç‚¹path value</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">åˆ›å»ºé¡ºåºèŠ‚ç‚¹</span></span><br><span class="line">create -s /èŠ‚ç‚¹path value</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">æŸ¥è¯¢èŠ‚ç‚¹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">ls â€“s /èŠ‚ç‚¹path </span><br></pre></td></tr></table></figure><h2 id="2-Curator-API"><a href="#2-Curator-API" class="headerlink" title="2.Curator API"></a>2.Curator API</h2><p>æˆ‘ä»¬åœ¨Javaå®¢æˆ·ç«¯æ“ä½œ Zookeeper æœ‰ä¸¤ç§æ–¹å¼ï¼šâ‘ ä½¿ç”¨åŸç”Ÿä»£ç ï¼›â‘¡ä½¿ç”¨Curatorã€‚</p><p>è¿™é‡Œä»‹ç»Curatorï¼ŒZookeeperåŸç”Ÿä»£ç çš„ä½¿ç”¨å¯å‚è€ƒæˆ‘å¦ä¸€ç¯‡æ–‡ç«  RPC(Zookeeper &amp; RMI)ã€‚</p><ul><li>Curator æ˜¯ä¸€å¥—å¼€æºçš„ Zookeeperå®¢æˆ·ç«¯æ¡†æ¶ã€‚</li><li>å®ƒå¸®åŠ©æˆ‘ä»¬åœ¨ZookeeperåŸç”ŸAPIåŸºç¡€ä¸Šè¿›è¡Œå°è£…ï¼Œå®ç°ä¸€äº›å¼€å‘ç»†èŠ‚ã€‚åŒ…æ‹¬æ¥è¿é‡è¿ã€åå¤æ³¨å†ŒWatcherå’ŒNodeExistsExceptionç­‰ã€‚</li><li>é™¤æ­¤ä¹‹å¤–ï¼ŒCuratorè¿˜æä¾›äº†Zookeeperçš„å„ç§åº”ç”¨åœºæ™¯ï¼šRecipeã€å…±äº«é”æœåŠ¡ã€Masteré€‰ä¸¾æœºåˆ¶å’Œåˆ†å¸ƒå¼è®¡æ•°å™¨ç­‰ã€‚</li></ul><h3 id="2-1-å»ºç«‹è¿æ¥"><a href="#2-1-å»ºç«‹è¿æ¥" class="headerlink" title="2.1 å»ºç«‹è¿æ¥"></a>2.1 å»ºç«‹è¿æ¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//å…ˆå£°æ˜é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);<span class="comment">//ç¡3ç§’å°è¯•ä¸€æ¬¡è¿æ¥,æœ€å¤šå°è¯•10æ¬¡</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ–¹å¼ä¸€</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * @param connectString        è¿æ¥å­—ç¬¦ä¸²: &quot;192.168.169.130:2181,192.168.169.131:2181&quot;</span></span><br><span class="line"><span class="comment">         * @param sessionTimeoutMs     ä¼šè¯è¶…æ—¶æ—¶é—´,å•ä½æ¯«ç§’</span></span><br><span class="line"><span class="comment">         * @param connectionTimeoutMs  è¿æ¥è¶…æ—¶æ—¶é—´,å•ä½æ¯«ç§’</span></span><br><span class="line"><span class="comment">         * @param retryPolicy          é‡è¯•ç­–ç•¥</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">CuratorFramework</span> <span class="variable">client1</span> <span class="operator">=</span> CuratorFrameworkFactory</span><br><span class="line">                .newClient(<span class="string">&quot;192.168.169.130:2181&quot;</span>, <span class="number">60</span> * <span class="number">1000</span>, <span class="number">15</span> * <span class="number">1000</span>, retryPolicy);</span><br><span class="line">        <span class="comment">//å¼€å¯è¿æ¥</span></span><br><span class="line">        client1.start();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ–¹å¼äºŒ</span></span><br><span class="line">        <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-2-åˆ›å»ºèŠ‚ç‚¹"><a href="#2-2-åˆ›å»ºèŠ‚ç‚¹" class="headerlink" title="2.2 åˆ›å»ºèŠ‚ç‚¹"></a>2.2 åˆ›å»ºèŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å»ºç«‹è¿æ¥</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);<span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åˆ›å»ºèŠ‚ç‚¹ æŒä¹…/ä¸´æ—¶  é¡ºåº/éé¡ºåº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCreate</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.åŸºæœ¬åˆ›å»º</span></span><br><span class="line">        <span class="comment">//å¦‚æœåˆ›å»ºèŠ‚ç‚¹æ²¡æœ‰æŒ‡å®šæ•°æ®,åˆ™é»˜è®¤å°†å½“å‰å®¢æˆ·ç«¯çš„ipä½œä¸ºæ•°æ®å­˜å‚¨</span></span><br><span class="line">        client.create().forPath(<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.åˆ›å»ºèŠ‚ç‚¹,å¸¦æœ‰æ•°æ®</span></span><br><span class="line">        client.create().forPath(<span class="string">&quot;/app2&quot;</span>,<span class="string">&quot;SOUL&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.åˆ›å»ºèŠ‚ç‚¹,å¸¦æœ‰èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line">        <span class="comment">//èŠ‚ç‚¹é»˜è®¤æŒä¹…åŒ–</span></span><br><span class="line">        client.create().withMode(CreateMode.PERSISTENT).forPath(<span class="string">&quot;/app3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.åˆ›å»ºå¤šçº§èŠ‚ç‚¹</span></span><br><span class="line">        <span class="comment">//creatingParentsIfNeeded():å¦‚æœçˆ¶èŠ‚ç‚¹ä¸å­˜åœ¨åˆ™åˆ›å»ºçˆ¶èŠ‚ç‚¹</span></span><br><span class="line">        client.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT).forPath(<span class="string">&quot;/app4/p1&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-3-æŸ¥è¯¢èŠ‚ç‚¹"><a href="#2-3-æŸ¥è¯¢èŠ‚ç‚¹" class="headerlink" title="2.3 æŸ¥è¯¢èŠ‚ç‚¹"></a>2.3 æŸ¥è¯¢èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//æŸ¥è¯¢æ•°æ®,å¯¹åº”linux:get</span></span><br><span class="line">        <span class="type">byte</span>[] data = client.getData().forPath(<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å­èŠ‚ç‚¹,å¯¹åº”linux:ls</span></span><br><span class="line">        List&lt;String&gt; path = client.getChildren().forPath(<span class="string">&quot;/app4&quot;</span>);</span><br><span class="line">        System.out.println(path);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//æŸ¥è¯¢å­èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯,å¯¹åº”linux:ls -s</span></span><br><span class="line">        <span class="type">Stat</span> <span class="variable">status</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stat</span>();</span><br><span class="line">        client.getData().storingStatIn(status).forPath(<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line">        System.out.println(status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4-ä¿®æ”¹èŠ‚ç‚¹"><a href="#2-4-ä¿®æ”¹èŠ‚ç‚¹" class="headerlink" title="2.4 ä¿®æ”¹èŠ‚ç‚¹"></a>2.4 ä¿®æ”¹èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.åŸºæœ¬ä¿®æ”¹</span></span><br><span class="line">        client.setData().forPath(<span class="string">&quot;/app1&quot;</span>,<span class="string">&quot;soul1&quot;</span>.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.æ ¹æ®ç‰ˆæœ¬ä¿®æ”¹ï¼šä¸ºäº†é¿å…å¤šä¸ªå®¢æˆ·ç«¯ä¿®æ”¹å†²çªé—®é¢˜ï¼Œéœ€è¦åŠ å…¥èŠ‚ç‚¹çŠ¶æ€ä¿¡æ¯ä¸­çš„version</span></span><br><span class="line">        <span class="type">Stat</span> <span class="variable">status</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stat</span>();</span><br><span class="line">        client.getData().storingStatIn(status).forPath(<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">version</span> <span class="operator">=</span> status.getVersion();</span><br><span class="line">        client.setData().withVersion(version).forPath(<span class="string">&quot;/app1&quot;</span>,<span class="string">&quot;soul2&quot;</span>.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5-åˆ é™¤èŠ‚ç‚¹"><a href="#2-5-åˆ é™¤èŠ‚ç‚¹" class="headerlink" title="2.5 åˆ é™¤èŠ‚ç‚¹"></a>2.5 åˆ é™¤èŠ‚ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testConnect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.åˆ é™¤å•ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        client.delete().forPath(<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line">        <span class="comment">//2.åˆ é™¤å¸¦æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹</span></span><br><span class="line">        client.delete().deletingChildrenIfNeeded().forPath(<span class="string">&quot;/app4&quot;</span>);</span><br><span class="line">        <span class="comment">//3.ä¿è¯åˆ é™¤èŠ‚ç‚¹</span></span><br><span class="line">        client.delete().guaranteed().forPath(<span class="string">&quot;/app2&quot;</span>);</span><br><span class="line">        <span class="comment">//4.å¸¦æœ‰å›è°ƒå‡½æ•°çš„åˆ é™¤</span></span><br><span class="line">        client.delete().guaranteed().inBackground(<span class="keyword">new</span> <span class="title class_">BackgroundCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processResult</span><span class="params">(CuratorFramework curatorFramework,</span></span><br><span class="line"><span class="params">                                      CuratorEvent curatorEvent)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;è¢«åˆ é™¤äº†= =&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).forPath(<span class="string">&quot;/app3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-6-Watchäº‹åŠ¡ç›‘å¬"><a href="#2-6-Watchäº‹åŠ¡ç›‘å¬" class="headerlink" title="2.6 Watchäº‹åŠ¡ç›‘å¬"></a>2.6 Watchäº‹åŠ¡ç›‘å¬</h3><p>Zookeeper å…è®¸ç”¨æˆ·åœ¨æŒ‡å®šèŠ‚ç‚¹ä¸Šæ³¨å†Œä¸€äº›Watcherï¼Œå¹¶ä¸”åœ¨ä¸€äº›ç‰¹å®šäº‹ä»¶è§¦å‘çš„æ—¶å€™ï¼ŒZooKeeperæœåŠ¡ç«¯ä¼šå°†äº‹ä»¶é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å®¢æˆ·ç«¯ä¸Šå»ï¼Œè¯¥æœºåˆ¶æ˜¯ZooKeeperå®ç°åˆ†å¸ƒå¼åè°ƒæœåŠ¡çš„é‡è¦ç‰¹æ€§</p><p>ZooKeeper ä¸­å¼•å…¥äº†Watcheræœºåˆ¶æ¥å®ç°äº†å‘å¸ƒ&#x2F;è®¢é˜…åŠŸèƒ½ï¼Œèƒ½å¤Ÿè®©å¤šä¸ªè®¢é˜…è€…åŒæ—¶ç›‘å¬æŸä¸€ä¸ªå¯¹è±¡ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è‡ªèº«çŠ¶æ€å˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è®¢é˜…è€…ã€‚</p><p>Curator APIä¸­å¼•å…¥äº† Cache æ¥å®ç°å¯¹ ZooKeeper æœåŠ¡ç«¯äº‹ä»¶çš„ç›‘å¬ã€‚</p><p>Zookeeper ä¸‹æœ‰å‡ ä¸ªå®¢æˆ·ç«¯ï¼Œä»–ä»¬é€šè¿‡ Curator æ¥è¿›è¡Œä¸€ç³»åˆ—çš„æ“ä½œ</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper2.png"></img></p><p>Zookeeperæä¾›äº†ä¸‰ç§Watcherï¼š</p><ul><li>NodeCacheï¼šç›‘å¬æŒ‡å®šçš„ZNodeèŠ‚ç‚¹ã€‚</li><li>PathChildrenCacheï¼šç›‘å¬æŒ‡å®šZNodeèŠ‚ç‚¹çš„å­èŠ‚ç‚¹ï¼ˆä¸åŒ…å«æŒ‡å®šèŠ‚ç‚¹ï¼‰ã€‚</li><li>TreeCacheï¼šç›‘å¬æŒ‡å®šèŠ‚ç‚¹åŠå…¶å­å­™èŠ‚ç‚¹ã€‚</li></ul><h4 id="2-6-1-NodeCache"><a href="#2-6-1-NodeCache" class="headerlink" title="2.6.1 NodeCache"></a>2.6.1 NodeCache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorWatcherTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//NodeCache:ç»™æŒ‡å®šä¸€ä¸ªèŠ‚ç‚¹æ³¨å†Œç›‘å¬å™¨</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testNodeCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºNodeCacheå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">NodeCache</span> <span class="variable">nodeCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NodeCache</span>(client,<span class="string">&quot;/app1&quot;</span>);</span><br><span class="line">        <span class="comment">//æ³¨å†Œç›‘å¬</span></span><br><span class="line">        nodeCache.getListenable().addListener(<span class="keyword">new</span> <span class="title class_">NodeCacheListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">nodeChanged</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Node changed&quot;</span>);</span><br><span class="line">                <span class="comment">//è·å–ä¿®æ”¹èŠ‚ç‚¹åçš„æ•°æ®</span></span><br><span class="line">                <span class="type">byte</span>[] data = nodeCache.getCurrentData().getData();</span><br><span class="line">                System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å¯ç›‘å¬: å¦‚æœè®¾ç½®ä¸ºtrue,åˆ™å¼€å¯ç›‘å¬æ—¶ï¼ŒåŠ è½½ç¼“å†²æ•°æ®</span></span><br><span class="line">        nodeCache.start(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å› ä¸ºæ‰§è¡Œè¿™ä¸ªæ–¹æ³•åè¿æ¥æ–­å¼€ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•æ—¶ä½¿ç”¨å¾ªç¯ä¿è¯è¿™ä¸ªè¿æ¥ä¸ä¼šæ–­å¼€</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-6-1-PathChildrenCache"><a href="#2-6-1-PathChildrenCache" class="headerlink" title="2.6.1 PathChildrenCache"></a>2.6.1 PathChildrenCache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorWatcherTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//PathChildrenCache:ç›‘å¬æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰å­èŠ‚ç‚¹(ä¸åŒ…æ‹¬è¢«ç›‘å¬çš„èŠ‚ç‚¹)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPathChildrenCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºPathChildrenCacheå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">PathChildrenCache</span> <span class="variable">pathChildrenCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathChildrenCache</span>(client,<span class="string">&quot;/app2&quot;</span>,<span class="literal">true</span>);<span class="comment">//æ˜¯å¦ç¼“å­˜ä¸€äº›çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">        <span class="comment">//ç»‘å®šç›‘å¬å™¨</span></span><br><span class="line">        pathChildrenCache.getListenable().addListener(<span class="keyword">new</span> <span class="title class_">PathChildrenCacheListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">childEvent</span><span class="params">(CuratorFramework curatorFramework,</span></span><br><span class="line"><span class="params">                                   PathChildrenCacheEvent event)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                System.out.println(event);</span><br><span class="line"></span><br><span class="line">                <span class="comment">//ç›‘å¬å­èŠ‚ç‚¹çš„æ•°æ®å˜æ›´ï¼Œå¹¶ä¸”æ‹¿åˆ°å˜æ›´åçš„æ•°æ®</span></span><br><span class="line">                <span class="comment">//1.è·å–ç±»å‹</span></span><br><span class="line">                PathChildrenCacheEvent.<span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> event.getType();</span><br><span class="line">                <span class="comment">//2.åˆ¤æ–­ç±»å‹æ˜¯å¦æ˜¯update</span></span><br><span class="line">                <span class="keyword">if</span> (type.equals(PathChildrenCacheEvent.Type.CHILD_UPDATED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node updated&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] data = event.getData().getData();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (type.equals(PathChildrenCacheEvent.Type.CHILD_ADDED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node added&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] data = event.getData().getData();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (type.equals(PathChildrenCacheEvent.Type.CHILD_REMOVED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node removed&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¼€å¯ç›‘å¬</span></span><br><span class="line">        pathChildrenCache.start();</span><br><span class="line">        <span class="comment">//å› ä¸ºæ‰§è¡Œè¿™ä¸ªæ–¹æ³•åè¿æ¥æ–­å¼€ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•æ—¶ä½¿ç”¨å¾ªç¯ä¿è¯è¿™ä¸ªè¿æ¥ä¸ä¼šæ–­å¼€</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-6-3-TreeCache"><a href="#2-6-3-TreeCache" class="headerlink" title="2.6.3 TreeCache"></a>2.6.3 TreeCache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CuratorWatcherTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> CuratorFramework client;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">connect</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//é‡è¯•ç­–ç•¥</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">        client = CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).namespace(<span class="string">&quot;soul&quot;</span>).build(); <span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TreeCache:ç›‘å¬æŸä¸ªèŠ‚ç‚¹åŠå…¶æ‰€æœ‰å­èŠ‚ç‚¹(åŒ…æ‹¬è¢«ç›‘å¬çš„èŠ‚ç‚¹)</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testTreeCache</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºPathChildrenCacheå¯¹è±¡</span></span><br><span class="line">        <span class="keyword">final</span> <span class="type">TreeCache</span> <span class="variable">treeCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeCache</span>(client,<span class="string">&quot;/app3&quot;</span>);</span><br><span class="line">        <span class="comment">//ç»‘å®šç›‘å¬å™¨</span></span><br><span class="line">        treeCache.getListenable().addListener(<span class="keyword">new</span> <span class="title class_">TreeCacheListener</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">childEvent</span><span class="params">(CuratorFramework curatorFramework, </span></span><br><span class="line"><span class="params">                                   TreeCacheEvent event)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Node changed&quot;</span>);</span><br><span class="line">                System.out.println(event);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">//ç›‘å¬å­èŠ‚ç‚¹çš„æ•°æ®å˜æ›´ï¼Œå¹¶ä¸”æ‹¿åˆ°å˜æ›´åçš„æ•°æ®</span></span><br><span class="line">                <span class="comment">//1.è·å–ç±»å‹</span></span><br><span class="line">                TreeCacheEvent.<span class="type">Type</span> <span class="variable">type</span> <span class="operator">=</span> event.getType();</span><br><span class="line">                <span class="comment">//2.åˆ¤æ–­ç±»å‹æ˜¯å¦æ˜¯update</span></span><br><span class="line">                <span class="keyword">if</span> (type.equals(TreeCacheEvent.Type.NODE_UPDATED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node updated&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] data = event.getData().getData();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (type.equals(TreeCacheEvent.Type.NODE_ADDED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node added&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] data = event.getData().getData();</span><br><span class="line">                    System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data));</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (type.equals(TreeCacheEvent.Type.NODE_REMOVED))&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Node removed&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//å¼€å¯ç›‘å¬</span></span><br><span class="line">        treeCache.start();</span><br><span class="line">        <span class="comment">//å› ä¸ºæ‰§è¡Œè¿™ä¸ªæ–¹æ³•åè¿æ¥æ–­å¼€ï¼Œæ‰€ä»¥åœ¨æµ‹è¯•æ—¶ä½¿ç”¨å¾ªç¯ä¿è¯è¿™ä¸ªè¿æ¥ä¸ä¼šæ–­å¼€</span></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>)&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (client!=<span class="literal">null</span>)&#123;</span><br><span class="line">            client.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-7-Zookeeperåˆ†å¸ƒå¼é”"><a href="#2-7-Zookeeperåˆ†å¸ƒå¼é”" class="headerlink" title="2.7  Zookeeperåˆ†å¸ƒå¼é”"></a>2.7  Zookeeperåˆ†å¸ƒå¼é”</h3><h4 id="2-7-1-åˆ†å¸ƒå¼é”å¼•å…¥"><a href="#2-7-1-åˆ†å¸ƒå¼é”å¼•å…¥" class="headerlink" title="2.7.1 åˆ†å¸ƒå¼é”å¼•å…¥"></a>2.7.1 åˆ†å¸ƒå¼é”å¼•å…¥</h4><p>åœ¨æˆ‘ä»¬è¿›è¡Œå•æœºåº”ç”¨å¼€å‘ï¼Œæ¶‰åŠå¹¶å‘åŒæ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨synchronizedæˆ–è€…lockçš„æ–¹å¼æ¥è§£å†³å¤šçº¿ç¨‹ä¹‹é—´ä»£ç åŒæ­¥çš„é—®é¢˜ï¼Œè¿™æ—¶å¤šçº¿ç¨‹çš„è¿è¡Œéƒ½æ˜¯åœ¨åŒä¸€ä¸ªJVMä¹‹ä¸‹ï¼Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚</p><p>ä½†æ˜¯å½“æˆ‘ä»¬çš„åº”ç”¨æ˜¯åˆ†å¸ƒå¼é›†ç¾¤å·¥ä½œçš„æƒ…å†µä¸‹ï¼Œæ•°æ®å¤šJVMä¸‹çš„å·¥ä½œç¯å¢ƒï¼Œè·¨JVMä¹‹é—´å·²ç»æ— æ³•é€šè¿‡å¤šçº¿ç¨‹çš„é”æ¥è§£å†³é—®é¢˜ï¼Œé‚£å°±éœ€è¦ä¸€ç§æ›´åŠ é«˜çº§çš„é”æœºåˆ¶æ¥å¤„ç†<b>è·¨æœºå™¨çš„è¿›ç¨‹ä¹‹é—´çš„æ•°æ®åŒæ­¥é—®é¢˜</b>â€”â€”è¿™å°±æ˜¯åˆ†å¸ƒå¼é”ã€‚</p><p>å•ä¸€JVMä¸‹çš„å·¥ä½œç¯å¢ƒï¼š</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper3.png"></img></p><p>è·¨JVMä¸‹çš„å·¥ä½œç¯å¢ƒï¼š</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper4.png"></img></p><p>åˆ†å¸ƒå¼é”æœ‰ä»¥ä¸‹å‡ ç§å®ç°æ–¹å¼ï¼š</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper5.png"></img></p><h4 id="2-7-2-åˆ†å¸ƒå¼é”åŸç†"><a href="#2-7-2-åˆ†å¸ƒå¼é”åŸç†" class="headerlink" title="2.7.2 åˆ†å¸ƒå¼é”åŸç†"></a>2.7.2 åˆ†å¸ƒå¼é”åŸç†</h4><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper6.png"></img></p><p>æ ¸å¿ƒæ€æƒ³ï¼šå½“å®¢æˆ·ç«¯è¦è·å–é”ï¼Œåˆ™åˆ›å»ºä¸€èŠ‚ç‚¹ï¼Œä½¿ç”¨å®Œé”ï¼Œåˆ™åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚</p><p>1.å®¢æˆ·ç«¯è·å–é”çš„æ—¶å€™ï¼Œåœ¨lockèŠ‚ç‚¹ä¸‹åˆ›å»º<b>ä¸´æ—¶é¡ºåº</b>èŠ‚ç‚¹ã€‚</p><p>2.ç„¶åè·å–lockä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹ï¼Œå®¢æˆ·ç«¯è·å–åˆ°æ‰€æœ‰çš„å­èŠ‚ç‚¹åï¼Œå¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„å­èŠ‚ç‚¹åºå·æœ€å°ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¯¥å®¢æˆ·ç«¯è·å–åˆ°äº†é”ã€‚ä½¿ç”¨å®Œé”åï¼Œå°†è¯¥èŠ‚ç‚¹åˆ é™¤ã€‚</p><p>3.å¦‚æœå‘ç°è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹å¹¶élockæ‰€æœ‰èŠ‚ç‚¹ä¸­æœ€å°çš„ï¼Œè¯´æ˜è‡ªå·±è¿˜æ²¡æœ‰è·å–åˆ°é”ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯éœ€è¦æ‰¾åˆ°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹ï¼ŒåŒæ—¶å¯¹å…¶æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨æ¥ç›‘å¬è¿™ä¸ªèŠ‚ç‚¹çš„åˆ é™¤äº‹ä»¶ã€‚</p><p>4.å¦‚æœå‘ç°æ¯”è‡ªå·±å°çš„é‚£ä¸ªèŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåˆ™å®¢æˆ·ç«¯çš„Watcherä¼šæ”¶åˆ°ç›¸åº”çš„é€šçŸ¥ï¼Œæ­¤æ—¶å†æ¬¡åˆ¤æ–­è‡ªå·±åˆ›å»ºçš„èŠ‚ç‚¹æ˜¯å¦æ˜¯lockèŠ‚ç‚¹ä¸­åºå·æœ€å°çš„ï¼Œå¦‚æœæ˜¯åˆ™è·å–åˆ°äº†é”ï¼›å¦‚æœä¸æ˜¯åˆ™é‡å¤ä»¥ä¸Šæ­¥éª¤ç»§ç»­è·å–æ¯”è‡ªå·±å°çš„èŠ‚ç‚¹å¹¶å¯¹å…¶æ³¨å†Œä¸€ä¸ªåˆ é™¤ç›‘å¬ã€‚</p><h4 id="2-7-3-åˆ†å¸ƒå¼é”çš„åº”ç”¨"><a href="#2-7-3-åˆ†å¸ƒå¼é”çš„åº”ç”¨" class="headerlink" title="2.7.3 åˆ†å¸ƒå¼é”çš„åº”ç”¨"></a>2.7.3 åˆ†å¸ƒå¼é”çš„åº”ç”¨</h4><p>12306è´­ç¥¨æ¡ˆä¾‹</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper7.png"></img></p><h5 id="2-7-3-1-å®¢æˆ·ç«¯å…·ä½“å®ç°"><a href="#2-7-3-1-å®¢æˆ·ç«¯å…·ä½“å®ç°" class="headerlink" title="2.7.3.1 å®¢æˆ·ç«¯å…·ä½“å®ç°"></a>2.7.3.1 å®¢æˆ·ç«¯å…·ä½“å®ç°</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tickets12306</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">tickets</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">private</span> InterProcessMutex lock;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Tickets12306</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">3000</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.builder()</span><br><span class="line">                .connectString(<span class="string">&quot;192.168.169.130:2181&quot;</span>)</span><br><span class="line">                .sessionTimeoutMs(<span class="number">60</span> * <span class="number">1000</span>)</span><br><span class="line">                .connectionTimeoutMs(<span class="number">15</span> * <span class="number">1000</span>)</span><br><span class="line">                .retryPolicy(retryPolicy).build();<span class="comment">//å¯ä»¥åŠ ä¸Šå‘½åç©ºé—´,è¡¨ç¤ºèŠ‚ç‚¹çš„æ ¹ç›®å½•</span></span><br><span class="line">        client.start();</span><br><span class="line">        <span class="comment">//åˆ›å»ºåˆ†å¸ƒå¼é”</span></span><br><span class="line">        lock = <span class="keyword">new</span> <span class="title class_">InterProcessMutex</span>(client,<span class="string">&quot;/lock&quot;</span>); <span class="comment">//å‚æ•°ï¼šclient + path</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">//çº¿ç¨‹è·å–é”ï¼ˆæ¯3sè·å–ä¸€æ¬¡é”ï¼‰</span></span><br><span class="line">                lock.acquire(<span class="number">3</span>, TimeUnit.SECONDS);</span><br><span class="line">                <span class="keyword">if</span> (tickets &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                    System.out.println(Thread.currentThread() + <span class="string">&quot;:&quot;</span> + tickets);</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                    tickets--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">//çº¿ç¨‹é‡Šæ”¾é”</span></span><br><span class="line">                    lock.release();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="2-7-3-2-å®¢æˆ·ç«¯çš„è°ƒç”¨"><a href="#2-7-3-2-å®¢æˆ·ç«¯çš„è°ƒç”¨" class="headerlink" title="2.7.3.2 å®¢æˆ·ç«¯çš„è°ƒç”¨"></a>2.7.3.2 å®¢æˆ·ç«¯çš„è°ƒç”¨</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LockTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Tickets12306</span> <span class="variable">tickets12306</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tickets12306</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(tickets12306,<span class="string">&quot;é£çŒª&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(tickets12306,<span class="string">&quot;æºç¨‹&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-Zookeeperé›†ç¾¤"><a href="#3-Zookeeperé›†ç¾¤" class="headerlink" title="3  Zookeeperé›†ç¾¤"></a>3  Zookeeperé›†ç¾¤</h2><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper8.png"></img></p><h3 id="3-1-Leader-é€‰ä¸¾"><a href="#3-1-Leader-é€‰ä¸¾" class="headerlink" title="3.1 Leader é€‰ä¸¾"></a>3.1 Leader é€‰ä¸¾</h3><p>Leaderé€‰ä¸¾æ˜¯ä¿è¯åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„å…³é”®æ‰€åœ¨ã€‚å½“Zookeeperé›†ç¾¤ä¸­çš„ä¸€å°æœåŠ¡å™¨å‡ºç°ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¹‹ä¸€æ—¶ï¼Œéœ€è¦è¿›å…¥Leaderé€‰ä¸¾ï¼š(1) æœåŠ¡å™¨åˆå§‹åŒ–å¯åŠ¨ï¼›(2) æœåŠ¡å™¨è¿è¡ŒæœŸé—´æ— æ³•å’ŒLeaderä¿æŒè¿æ¥ã€‚</p><h4 id="3-1-1-é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€"><a href="#3-1-1-é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€" class="headerlink" title="3.1.1 é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€"></a>3.1.1 é›†ç¾¤ä¸­çš„æœåŠ¡å™¨çŠ¶æ€</h4><ul><li><b>LOOKING</b> ï¼šå¯»æ‰¾ LeaderçŠ¶æ€ã€‚å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰ Leaderï¼Œå› æ­¤éœ€è¦è¿›å…¥Leaderé€‰ä¸¾çŠ¶æ€ã€‚</li><li><b>LEADING</b> ï¼šé¢†å¯¼è€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Leaderã€‚</li><li><b>FOLLOWING</b> ï¼šè·Ÿéšè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Followerã€‚</li><li><b>OBSERVING</b> ï¼šè§‚å¯Ÿè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯Observerã€‚è¯¥èŠ‚ç‚¹ä¸å‚ä¸ Leader é€‰ä¸¾ã€‚</li></ul><h4 id="3-1-2-å¯åŠ¨æ—¶æœŸLeaderé€‰ä¸¾"><a href="#3-1-2-å¯åŠ¨æ—¶æœŸLeaderé€‰ä¸¾" class="headerlink" title="3.1.2 å¯åŠ¨æ—¶æœŸLeaderé€‰ä¸¾"></a>3.1.2 å¯åŠ¨æ—¶æœŸLeaderé€‰ä¸¾</h4><p>ã€€è‹¥è¿›è¡ŒLeaderé€‰ä¸¾ï¼Œåˆ™è‡³å°‘éœ€è¦ä¸¤å°æœºå™¨ï¼Œè¿™é‡Œé€‰å–3å°æœºå™¨ç»„æˆçš„æœåŠ¡å™¨é›†ç¾¤ä¸ºä¾‹ã€‚åœ¨é›†ç¾¤åˆå§‹åŒ–é˜¶æ®µï¼Œå½“æœ‰ä¸€å°æœåŠ¡å™¨Server1å¯åŠ¨æ—¶ï¼Œå…¶å•ç‹¬æ— æ³•è¿›è¡Œå’Œå®ŒæˆLeaderé€‰ä¸¾ï¼Œå½“ç¬¬äºŒå°æœåŠ¡å™¨Server2å¯åŠ¨æ—¶ï¼Œæ­¤æ—¶ä¸¤å°æœºå™¨å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæ¯å°æœºå™¨éƒ½è¯•å›¾æ‰¾åˆ°Leaderï¼Œäºæ˜¯è¿›å…¥Leaderé€‰ä¸¾è¿‡ç¨‹ã€‚é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹</p><ol><li><b>æ¯ä¸ªServerå‘å‡ºä¸€ä¸ªæŠ•ç¥¨</b>ã€‚ç”±äºæ˜¯åˆå§‹æƒ…å†µï¼ŒServer1å’ŒServer2éƒ½ä¼šå°†è‡ªå·±ä½œä¸ºLeaderæœåŠ¡å™¨æ¥è¿›è¡ŒæŠ•ç¥¨ï¼Œæ¯æ¬¡æŠ•ç¥¨ä¼šåŒ…å«æ‰€æ¨ä¸¾çš„æœåŠ¡å™¨çš„ <b>myid(æœåŠ¡å™¨id)Â </b> å’Œ <b>ZXIDï¼ˆæ•°æ®æƒé‡idï¼‰</b>ï¼Œä½¿ç”¨(myid, ZXID)æ¥è¡¨ç¤ºï¼Œæ­¤æ—¶Server1çš„æŠ•ç¥¨ä¸º(1, 0)ï¼ŒServer2çš„æŠ•ç¥¨ä¸º(2, 0)ï¼Œç„¶åå„è‡ªå°†è¿™ä¸ªæŠ•ç¥¨å‘ç»™é›†ç¾¤ä¸­å…¶ä»–æœºå™¨ã€‚</li><li><b>æ¥å—æ¥è‡ªå„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨</b>ã€‚é›†ç¾¤çš„æ¯ä¸ªæœåŠ¡å™¨æ”¶åˆ°æŠ•ç¥¨åï¼Œé¦–å…ˆåˆ¤æ–­è¯¥æŠ•ç¥¨çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æ£€æŸ¥æ˜¯å¦æ˜¯æœ¬è½®æŠ•ç¥¨ã€æ˜¯å¦æ¥è‡ªLOOKINGçŠ¶æ€çš„æœåŠ¡å™¨ã€‚</li><li><b>å¤„ç†æŠ•ç¥¨</b>ã€‚é’ˆå¯¹æ¯ä¸€ä¸ªæŠ•ç¥¨ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦å°†åˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨è¿›è¡ŒPKï¼ŒPKè§„åˆ™å¦‚ä¸‹<ol><li>ä¼˜å…ˆæ£€æŸ¥ <b>ZXID</b>ã€‚ZXIDæ¯”è¾ƒå¤§çš„æœåŠ¡å™¨ä¼˜å…ˆä½œä¸ºLeaderã€‚</li><li>å¦‚æœZXIDç›¸åŒï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒ <b>myid</b>ã€‚myidè¾ƒå¤§çš„æœåŠ¡å™¨ä½œä¸ºLeaderæœåŠ¡å™¨ã€‚</li><li>å¯¹äºServer1è€Œè¨€ï¼Œå®ƒçš„æŠ•ç¥¨æ˜¯(1, 0)ï¼Œæ¥æ”¶Server2çš„æŠ•ç¥¨ä¸º(2, 0)ï¼Œé¦–å…ˆä¼šæ¯”è¾ƒä¸¤è€…çš„ZXIDï¼Œå‡ä¸º0ï¼Œå†æ¯”è¾ƒmyidï¼Œæ­¤æ—¶Server2çš„myidæœ€å¤§ï¼Œäºæ˜¯æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ä¸º(2, 0)ï¼Œç„¶åé‡æ–°æŠ•ç¥¨ï¼Œå¯¹äºServer2è€Œè¨€ï¼Œå…¶æ— é¡»æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ï¼Œåªæ˜¯å†æ¬¡å‘é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨å‘å‡ºä¸Šä¸€æ¬¡æŠ•ç¥¨ä¿¡æ¯å³å¯ã€‚</li></ol></li><li><b>ç»Ÿè®¡æŠ•ç¥¨</b>ã€‚æ¯æ¬¡æŠ•ç¥¨åï¼ŒæœåŠ¡å™¨éƒ½ä¼šç»Ÿè®¡æŠ•ç¥¨ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰è¿‡åŠæœºå™¨æ¥å—åˆ°ç›¸åŒçš„æŠ•ç¥¨ä¿¡æ¯ï¼Œå¯¹äºServer1ã€Server2è€Œè¨€ï¼Œéƒ½ç»Ÿè®¡å‡ºé›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤å°æœºå™¨æ¥å—äº†(2, 0)çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œæ­¤æ—¶ä¾¿è®¤ä¸ºå·²ç»é€‰å‡ºäº†Leaderã€‚</li><li><b>æ”¹å˜æœåŠ¡å™¨çŠ¶æ€</b>ã€‚ä¸€æ—¦ç¡®å®šäº†Leaderï¼Œæ¯ä¸ªæœåŠ¡å™¨å°±ä¼šæ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯Followerï¼Œé‚£ä¹ˆå°±å˜æ›´ä¸ºFOLLOWINGï¼Œå¦‚æœæ˜¯Leaderï¼Œå°±å˜æ›´ä¸ºLEADINGã€‚</li></ol><h4 id="3-1-3-è¿è¡Œæ—¶æœŸLeaderé€‰ä¸¾"><a href="#3-1-3-è¿è¡Œæ—¶æœŸLeaderé€‰ä¸¾" class="headerlink" title="3.1.3 è¿è¡Œæ—¶æœŸLeaderé€‰ä¸¾"></a>3.1.3 è¿è¡Œæ—¶æœŸLeaderé€‰ä¸¾</h4><p>åœ¨Zookeeperè¿è¡ŒæœŸé—´ï¼ŒLeaderä¸éLeaderæœåŠ¡å™¨å„å¸å…¶èŒï¼Œå³ä¾¿å½“æœ‰éLeaderæœåŠ¡å™¨å®•æœºæˆ–æ–°åŠ å…¥ï¼Œæ­¤æ—¶ä¹Ÿä¸ä¼šå½±å“Leaderï¼Œä½†æ˜¯ä¸€æ—¦LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°†æš‚åœå¯¹å¤–æœåŠ¡ï¼Œè¿›å…¥æ–°ä¸€è½®Leaderé€‰ä¸¾ï¼Œå…¶è¿‡ç¨‹å’Œå¯åŠ¨æ—¶æœŸçš„Leaderé€‰ä¸¾è¿‡ç¨‹åŸºæœ¬ä¸€è‡´ã€‚</p><h4 id="3-1-4-Leaderé€‰ä¸¾ç®—æ³•åˆ†æ"><a href="#3-1-4-Leaderé€‰ä¸¾ç®—æ³•åˆ†æ" class="headerlink" title="3.1.4 Leaderé€‰ä¸¾ç®—æ³•åˆ†æ"></a>3.1.4 Leaderé€‰ä¸¾ç®—æ³•åˆ†æ</h4><p>åœ¨3.4.0åçš„Zookeeperçš„ç‰ˆæœ¬åªä¿ç•™äº†TCPç‰ˆæœ¬çš„FastLeaderElectioné€‰ä¸¾ç®—æ³•ã€‚å½“ä¸€å°æœºå™¨è¿›å…¥Leaderé€‰ä¸¾æ—¶ï¼Œå½“å‰é›†ç¾¤å¯èƒ½ä¼šå¤„äºä»¥ä¸‹ä¸¤ç§çŠ¶æ€ï¼š</p><p>â‘  é›†ç¾¤ä¸­å·²ç»å­˜åœ¨Leaderï¼šå¯¹äºé›†ç¾¤ä¸­å·²ç»å­˜åœ¨Leaderè€Œè¨€ï¼Œæ­¤ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯æŸå°æœºå™¨å¯åŠ¨å¾—è¾ƒæ™šï¼Œåœ¨å…¶å¯åŠ¨ä¹‹å‰ï¼Œé›†ç¾¤å·²ç»åœ¨æ­£å¸¸å·¥ä½œï¼Œå¯¹è¿™ç§æƒ…å†µï¼Œè¯¥æœºå™¨è¯•å›¾å»é€‰ä¸¾Leaderæ—¶ï¼Œä¼šè¢«å‘ŠçŸ¥å½“å‰æœåŠ¡å™¨çš„Leaderä¿¡æ¯ï¼Œå¯¹äºè¯¥æœºå™¨è€Œè¨€ï¼Œä»…ä»…éœ€è¦å’ŒLeaderæœºå™¨å»ºç«‹èµ·è¿æ¥ï¼Œå¹¶è¿›è¡ŒçŠ¶æ€åŒæ­¥å³å¯ã€‚</p><p>â‘¡ é›†ç¾¤ä¸­ä¸å­˜åœ¨Leaderï¼šåœ¨é›†ç¾¤ä¸­ä¸å­˜åœ¨Leaderæƒ…å†µä¸‹åˆ™ä¼šç›¸å¯¹å¤æ‚ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹</p><ol><li><p><strong>ç¬¬ä¸€æ¬¡æŠ•ç¥¨</strong>ã€‚æ— è®ºå“ªç§å¯¼è‡´è¿›è¡ŒLeaderé€‰ä¸¾ï¼Œé›†ç¾¤çš„æ‰€æœ‰æœºå™¨éƒ½å¤„äºè¯•å›¾é€‰ä¸¾å‡ºä¸€ä¸ªLeaderçš„çŠ¶æ€ï¼Œå³LOOKINGçŠ¶æ€ï¼ŒLOOKINGæœºå™¨ä¼šå‘æ‰€æœ‰å…¶ä»–æœºå™¨å‘é€æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯ç§°ä¸ºæŠ•ç¥¨ã€‚æŠ•ç¥¨ä¸­åŒ…å«äº†SIDï¼ˆæœåŠ¡å™¨çš„å”¯ä¸€æ ‡è¯†ï¼‰å’ŒZXIDï¼ˆäº‹åŠ¡IDï¼‰ï¼Œ(SID, ZXID)å½¢å¼æ¥æ ‡è¯†ä¸€æ¬¡æŠ•ç¥¨ä¿¡æ¯ã€‚å‡å®šZookeeperç”±5å°æœºå™¨ç»„æˆï¼ŒSIDåˆ†åˆ«ä¸º1ã€2ã€3ã€4ã€5ï¼ŒZXIDåˆ†åˆ«ä¸º9ã€9ã€9ã€8ã€8ï¼Œå¹¶ä¸”æ­¤æ—¶SIDä¸º2çš„æœºå™¨æ˜¯Leaderæœºå™¨ï¼ŒæŸä¸€æ—¶åˆ»ï¼Œ1ã€2æ‰€åœ¨æœºå™¨å‡ºç°æ•…éšœï¼Œå› æ­¤é›†ç¾¤å¼€å§‹è¿›è¡ŒLeaderé€‰ä¸¾ã€‚åœ¨ç¬¬ä¸€æ¬¡æŠ•ç¥¨æ—¶ï¼Œæ¯å°æœºå™¨éƒ½ä¼šå°†è‡ªå·±ä½œä¸ºæŠ•ç¥¨å¯¹è±¡ï¼Œäºæ˜¯SIDä¸º3ã€4ã€5çš„æœºå™¨æŠ•ç¥¨æƒ…å†µåˆ†åˆ«ä¸º(3, 9)ï¼Œ(4, 8)ï¼Œ (5, 8)ã€‚</p></li><li><p><strong>å˜æ›´æŠ•ç¥¨</strong>ã€‚æ¯å°æœºå™¨å‘å‡ºæŠ•ç¥¨åï¼Œä¹Ÿä¼šæ”¶åˆ°å…¶ä»–æœºå™¨çš„æŠ•ç¥¨ï¼Œæ¯å°æœºå™¨ä¼šæ ¹æ®ä¸€å®šè§„åˆ™æ¥å¤„ç†æ”¶åˆ°çš„å…¶ä»–æœºå™¨çš„æŠ•ç¥¨ï¼Œå¹¶ä»¥æ­¤æ¥å†³å®šæ˜¯å¦éœ€è¦å˜æ›´è‡ªå·±çš„æŠ•ç¥¨ï¼Œè¿™ä¸ªè§„åˆ™ä¹Ÿæ˜¯æ•´ä¸ªLeaderé€‰ä¸¾ç®—æ³•çš„æ ¸å¿ƒæ‰€åœ¨ï¼Œå…¶ä¸­æœ¯è¯­æè¿°å¦‚ä¸‹</p><ul><li><b>vote_sid</b>ï¼šæ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¸­æ‰€æ¨ä¸¾LeaderæœåŠ¡å™¨çš„SIDã€‚</li><li><b>vote_zxid</b>ï¼šæ¥æ”¶åˆ°çš„æŠ•ç¥¨ä¸­æ‰€æ¨ä¸¾LeaderæœåŠ¡å™¨çš„ZXIDã€‚</li><li><b>self_sid</b>ï¼šå½“å‰æœåŠ¡å™¨è‡ªå·±çš„SIDã€‚</li><li><b>self_zxid</b>ï¼šå½“å‰æœåŠ¡å™¨è‡ªå·±çš„ZXIDã€‚</li></ul><p>æ¯æ¬¡å¯¹æ”¶åˆ°çš„æŠ•ç¥¨çš„å¤„ç†ï¼Œéƒ½æ˜¯å¯¹(vote_sid, vote_zxid) å’Œ (self_sid, self_zxid)å¯¹æ¯”çš„è¿‡ç¨‹ã€‚</p><ul><li>è§„åˆ™ä¸€ï¼šå¦‚æœvote_zxidå¤§äºself_zxidï¼Œå°±è®¤å¯å½“å‰æ”¶åˆ°çš„æŠ•ç¥¨ï¼Œå¹¶å†æ¬¡å°†è¯¥æŠ•ç¥¨å‘é€å‡ºå»ã€‚</li><li>è§„åˆ™äºŒï¼šå¦‚æœvote_zxidå°äºself_zxidï¼Œé‚£ä¹ˆåšæŒè‡ªå·±çš„æŠ•ç¥¨ï¼Œä¸åšä»»ä½•å˜æ›´ã€‚</li><li>è§„åˆ™ä¸‰ï¼šå¦‚æœvote_zxidç­‰äºself_zxidï¼Œé‚£ä¹ˆå°±å¯¹æ¯”ä¸¤è€…çš„SIDï¼Œå¦‚æœvote_sidå¤§äºself_sidï¼Œé‚£ä¹ˆå°±è®¤å¯å½“å‰æ”¶åˆ°çš„æŠ•ç¥¨ï¼Œå¹¶å†æ¬¡å°†è¯¥æŠ•ç¥¨å‘é€å‡ºå»ã€‚</li><li>è§„åˆ™å››ï¼šå¦‚æœvote_zxidç­‰äºself_zxidï¼Œå¹¶ä¸”vote_sidå°äºself_sidï¼Œé‚£ä¹ˆåšæŒè‡ªå·±çš„æŠ•ç¥¨ï¼Œä¸åšä»»ä½•å˜æ›´ã€‚</li></ul><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/zookeeper/zookeeper9.png"></img></p></li><li><p><strong>ç¡®å®šLeader</strong>ã€‚ç»è¿‡ç¬¬äºŒè½®æŠ•ç¥¨åï¼Œé›†ç¾¤ä¸­çš„æ¯å°æœºå™¨éƒ½ä¼šå†æ¬¡æ¥æ”¶åˆ°å…¶ä»–æœºå™¨çš„æŠ•ç¥¨ï¼Œç„¶åå¼€å§‹ç»Ÿè®¡æŠ•ç¥¨ï¼Œå¦‚æœä¸€å°æœºå™¨æ”¶åˆ°äº†è¶…è¿‡åŠæ•°çš„ç›¸åŒæŠ•ç¥¨ï¼Œé‚£ä¹ˆè¿™ä¸ªæŠ•ç¥¨å¯¹åº”çš„SIDæœºå™¨å³ä¸ºLeaderã€‚æ­¤æ—¶Server3å°†æˆä¸ºLeaderã€‚</p></li></ol><p>ç”±ä¸Šé¢è§„åˆ™å¯çŸ¥ï¼Œé€šå¸¸é‚£å°æœåŠ¡å™¨ä¸Šçš„æ•°æ®è¶Šæ–°ï¼ˆZXIDä¼šè¶Šå¤§ï¼‰ï¼Œå…¶æˆä¸ºLeaderçš„å¯èƒ½æ€§è¶Šå¤§ï¼Œä¹Ÿå°±è¶Šèƒ½å¤Ÿä¿è¯æ•°æ®çš„æ¢å¤ã€‚å¦‚æœZXIDç›¸åŒï¼Œåˆ™SIDè¶Šå¤§æœºä¼šè¶Šå¤§ã€‚</p><h4 id="3-1-5-è¿‡åŠæœºåˆ¶é˜²æ­¢è„‘è£‚"><a href="#3-1-5-è¿‡åŠæœºåˆ¶é˜²æ­¢è„‘è£‚" class="headerlink" title="3.1.5 è¿‡åŠæœºåˆ¶é˜²æ­¢è„‘è£‚"></a>3.1.5 è¿‡åŠæœºåˆ¶é˜²æ­¢è„‘è£‚</h4><p><b>ä½•ä¸ºé›†ç¾¤è„‘è£‚ï¼Ÿ</b></p><p>å¯¹äºä¸€ä¸ªé›†ç¾¤ï¼Œé€šå¸¸å¤šå°æœºå™¨ä¼šéƒ¨ç½²åœ¨ä¸åŒæœºæˆ¿ï¼Œæ¥æé«˜è¿™ä¸ªé›†ç¾¤çš„å¯ç”¨æ€§ã€‚ä¿è¯å¯ç”¨æ€§çš„åŒæ—¶ï¼Œä¼šå‘ç”Ÿä¸€ç§æœºæˆ¿é—´ç½‘ç»œçº¿è·¯æ•…éšœï¼Œå¯¼è‡´æœºæˆ¿é—´ç½‘ç»œä¸é€šï¼Œè€Œé›†ç¾¤è¢«å‰²è£‚æˆå‡ ä¸ªå°é›†ç¾¤ã€‚è¿™æ—¶å€™å­é›†ç¾¤å„è‡ªé€‰ä¸»å¯¼è‡´â€œè„‘è£‚â€çš„æƒ…å†µã€‚</p><p>ä¸¾ä¾‹è¯´æ˜ï¼šæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç”± 6 å°æœåŠ¡å™¨æ‰€ç»„æˆçš„ä¸€ä¸ªé›†ç¾¤ï¼Œéƒ¨ç½²åœ¨äº† 2 ä¸ªæœºæˆ¿ï¼Œæ¯ä¸ªæœºæˆ¿ 3 å°ã€‚æ­£å¸¸æƒ…å†µä¸‹åªæœ‰ 1 ä¸ª leaderï¼Œä½†æ˜¯å½“ä¸¤ä¸ªæœºæˆ¿ä¸­é—´ç½‘ç»œæ–­å¼€çš„æ—¶å€™ï¼Œæ¯ä¸ªæœºæˆ¿çš„ 3 å°æœåŠ¡å™¨éƒ½ä¼šè®¤ä¸ºå¦ä¸€ä¸ªæœºæˆ¿çš„ 3 å°æœåŠ¡å™¨ä¸‹çº¿ï¼Œè€Œé€‰å‡ºè‡ªå·±çš„ leader å¹¶å¯¹å¤–æä¾›æœåŠ¡ã€‚è‹¥æ²¡æœ‰è¿‡åŠæœºåˆ¶ï¼Œå½“ç½‘ç»œæ¢å¤çš„æ—¶å€™ä¼šå‘ç°æœ‰ 2 ä¸ª leaderã€‚ä»¿ä½›æ˜¯ 1 ä¸ªå¤§è„‘ï¼ˆleaderï¼‰åˆ†æ•£æˆäº† 2 ä¸ªå¤§è„‘ï¼Œè¿™å°±å‘ç”Ÿäº†è„‘è£‚ç°è±¡ã€‚è„‘è£‚æœŸé—´ 2 ä¸ªå¤§è„‘éƒ½å¯èƒ½å¯¹å¤–æä¾›äº†æœåŠ¡ï¼Œè¿™å°†ä¼šå¸¦æ¥æ•°æ®ä¸€è‡´æ€§ç­‰é—®é¢˜ã€‚</p><p><b>è¿‡åŠæœºåˆ¶æ˜¯å¦‚ä½•é˜²æ­¢è„‘è£‚ç°è±¡äº§ç”Ÿçš„ï¼Ÿ</b></p><p>ZooKeeper çš„è¿‡åŠæœºåˆ¶å¯¼è‡´ä¸å¯èƒ½äº§ç”Ÿ 2 ä¸ª leaderï¼Œå› ä¸ºå°‘äºç­‰äºä¸€åŠæ˜¯ä¸å¯èƒ½äº§ç”Ÿ leader çš„ï¼Œè¿™å°±ä½¿å¾—ä¸è®ºæœºæˆ¿çš„æœºå™¨å¦‚ä½•åˆ†é…éƒ½ä¸å¯èƒ½å‘ç”Ÿè„‘è£‚ã€‚</p><h3 id="3-2-Zookeeperé›†ç¾¤æ­å»º"><a href="#3-2-Zookeeperé›†ç¾¤æ­å»º" class="headerlink" title="3.2 Zookeeperé›†ç¾¤æ­å»º"></a>3.2 Zookeeperé›†ç¾¤æ­å»º</h3><h4 id="3-2-1æ­å»ºè¦æ±‚"><a href="#3-2-1æ­å»ºè¦æ±‚" class="headerlink" title="3.2.1æ­å»ºè¦æ±‚"></a>3.2.1æ­å»ºè¦æ±‚</h4><p>çœŸå®çš„é›†ç¾¤æ˜¯éœ€è¦éƒ¨ç½²åœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šçš„ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬æµ‹è¯•æ—¶åŒæ—¶å¯åŠ¨å¾ˆå¤šä¸ªè™šæ‹Ÿæœº(ip)å†…å­˜ä¼šåƒä¸æ¶ˆï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šæ­å»º<strong>ä¼ªé›†ç¾¤</strong>ï¼Œä¹Ÿå°±æ˜¯æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½æ­å»ºåœ¨ä¸€å°è™šæ‹Ÿæœºä¸Šï¼Œç”¨ç«¯å£(port)è¿›è¡ŒåŒºåˆ†ã€‚</p><p>æˆ‘ä»¬è¿™é‡Œæ­å»ºä¸€ä¸ªä¸‰ä¸ªèŠ‚ç‚¹çš„Zookeeperé›†ç¾¤ï¼ˆä¼ªé›†ç¾¤ï¼‰ã€‚</p><h4 id="3-2-2-å‡†å¤‡å·¥ä½œ"><a href="#3-2-2-å‡†å¤‡å·¥ä½œ" class="headerlink" title="3.2.2  å‡†å¤‡å·¥ä½œ"></a>3.2.2  å‡†å¤‡å·¥ä½œ</h4><p>é‡æ–°éƒ¨ç½²ä¸€å°è™šæ‹Ÿæœºä½œä¸ºæˆ‘ä»¬æ­å»ºé›†ç¾¤çš„æµ‹è¯•æœåŠ¡å™¨ã€‚</p><p>ï¼ˆ1ï¼‰Zookeeperå‹ç¼©åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨<br>ï¼ˆ2ï¼‰å°†Zookeeperè§£å‹ ï¼Œå»ºç«‹&#x2F;usr&#x2F;local&#x2F;zookeeper-clusterç›®å½•ï¼Œå°†è§£å‹åçš„Zookeeperå¤åˆ¶åˆ°ä»¥ä¸‹ä¸‰ä¸ªç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# mkdir /usr/local/zookeeper-cluster</span><br><span class="line">[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-1</span><br><span class="line">[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-2</span><br><span class="line">[root@localhost ~]# cp -r  apache-zookeeper-3.5.6-bin /usr/local/zookeeper-cluster/zookeeper-3</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰åˆ›å»ºdataç›®å½• ï¼Œå¹¶ä¸”å°† confä¸‹zoo_sample.cfg æ–‡ä»¶æ”¹åä¸º zoo.cfg</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir /usr/local/zookeeper-cluster/zookeeper-1/data</span><br><span class="line">mkdir /usr/local/zookeeper-cluster/zookeeper-2/data</span><br><span class="line">mkdir /usr/local/zookeeper-cluster/zookeeper-3/data</span><br><span class="line"></span><br><span class="line">mv  /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg</span><br><span class="line">mv  /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg</span><br><span class="line">mv  /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo_sample.cfg  /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg</span><br></pre></td></tr></table></figure><p>ï¼ˆ5ï¼‰ é…ç½®æ¯ä¸€ä¸ªZookeeper çš„dataDir å’Œ clientPort åˆ†åˆ«ä¸º2181  2182  2183</p><p>Zookeeper â‘ ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">clientPort=2181</span><br><span class="line">dataDir=/usr/local/zookeeper-cluster/zookeeper-1/data</span><br></pre></td></tr></table></figure><p>Zookeeper â‘¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">clientPort=2182</span><br><span class="line">dataDir=/usr/local/zookeeper-cluster/zookeeper-2/data</span><br></pre></td></tr></table></figure><p>Zookeeper â‘¢ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">clientPort=2183</span><br><span class="line">dataDir=/usr/local/zookeeper-cluster/zookeeper-3/data</span><br></pre></td></tr></table></figure><h4 id="3-2-3-é…ç½®é›†ç¾¤"><a href="#3-2-3-é…ç½®é›†ç¾¤" class="headerlink" title="3.2.3 é…ç½®é›†ç¾¤"></a>3.2.3 é…ç½®é›†ç¾¤</h4><p>ï¼ˆ1ï¼‰åœ¨æ¯ä¸ªzookeeperçš„ data ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª myid æ–‡ä»¶ï¼Œå†…å®¹åˆ†åˆ«æ˜¯1ã€2ã€3 ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„ID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt;/usr/local/zookeeper-cluster/zookeeper-1/data/myid</span><br><span class="line">echo 2 &gt;/usr/local/zookeeper-cluster/zookeeper-2/data/myid</span><br><span class="line">echo 3 &gt;/usr/local/zookeeper-cluster/zookeeper-3/data/myid</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰åœ¨æ¯ä¸€ä¸ªzookeeper çš„ zoo.cfgé…ç½®å®¢æˆ·ç«¯è®¿é—®ç«¯å£ï¼ˆclientPortï¼‰å’Œé›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨ã€‚</p><p>é›†ç¾¤æœåŠ¡å™¨IPåˆ—è¡¨å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-1/conf/zoo.cfg</span><br><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-2/conf/zoo.cfg</span><br><span class="line">vim /usr/local/zookeeper-cluster/zookeeper-3/conf/zoo.cfg</span><br><span class="line"></span><br><span class="line">æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½æ·»åŠ ï¼š</span><br><span class="line">server.1=192.168.149.135:2881:3881</span><br><span class="line">server.2=192.168.149.135:2882:3882</span><br><span class="line">server.3=192.168.149.135:2883:3883</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šserver.æœåŠ¡å™¨ID&#x3D;æœåŠ¡å™¨IPåœ°å€ï¼šæœåŠ¡å™¨ä¹‹é—´é€šä¿¡ç«¯å£ï¼šæœåŠ¡å™¨ä¹‹é—´æŠ•ç¥¨é€‰ä¸¾ç«¯å£ </p><h4 id="3-2-4-å¯åŠ¨é›†ç¾¤"><a href="#3-2-4-å¯åŠ¨é›†ç¾¤" class="headerlink" title="3.2.4 å¯åŠ¨é›†ç¾¤"></a>3.2.4 å¯åŠ¨é›†ç¾¤</h4><p>å¯åŠ¨é›†ç¾¤å°±æ˜¯åˆ†åˆ«å¯åŠ¨æ¯ä¸ªå®ä¾‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start</span><br></pre></td></tr></table></figure><h4 id="3-2-5-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸æƒ…å†µ"><a href="#3-2-5-æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸æƒ…å†µ" class="headerlink" title="3.2.5 æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸æƒ…å†µ"></a>3.2.5 æ¨¡æ‹Ÿé›†ç¾¤å¼‚å¸¸æƒ…å†µ</h4><p>ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬å…ˆæµ‹è¯•å¦‚æœæ˜¯ä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œä¼šæ€ä¹ˆæ ·ã€‚æŠŠ3å·æœåŠ¡å™¨åœæ‰ï¼Œè§‚å¯Ÿ1å·å’Œ2å·ï¼Œå‘ç°çŠ¶æ€å¹¶æ²¡æœ‰å˜åŒ–ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh stop</span><br><span class="line"></span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status</span><br></pre></td></tr></table></figure><p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œä»æœåŠ¡å™¨æŒ‚æ‰ï¼Œé›†ç¾¤æ­£å¸¸</p><p>ï¼ˆ2ï¼‰æˆ‘ä»¬å†æŠŠ1å·æœåŠ¡å™¨ï¼ˆä»æœåŠ¡å™¨ï¼‰ä¹Ÿåœæ‰ï¼ŒæŸ¥çœ‹2å·ï¼ˆä¸»æœåŠ¡å™¨ï¼‰çš„çŠ¶æ€ï¼Œå‘ç°å·²ç»åœæ­¢è¿è¡Œäº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh stop</span><br><span class="line"></span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status</span><br></pre></td></tr></table></figure><p>ç”±æ­¤å¾—å‡ºç»“è®ºï¼Œ3ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œ2ä¸ªä»æœåŠ¡å™¨éƒ½æŒ‚æ‰ï¼Œä¸»æœåŠ¡å™¨ä¹Ÿæ— æ³•è¿è¡Œã€‚å› ä¸ºå¯è¿è¡Œçš„æœºå™¨æ²¡æœ‰è¶…è¿‡é›†ç¾¤æ€»æ•°é‡çš„åŠæ•°ã€‚</p><p>ï¼ˆ3ï¼‰æˆ‘ä»¬å†æ¬¡æŠŠ1å·æœåŠ¡å™¨å¯åŠ¨èµ·æ¥ï¼Œå‘ç°2å·æœåŠ¡å™¨åˆå¼€å§‹æ­£å¸¸å·¥ä½œäº†ã€‚è€Œä¸”ä¾ç„¶æ˜¯é¢†å¯¼è€…ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status </span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰æˆ‘ä»¬æŠŠ3å·æœåŠ¡å™¨ä¹Ÿå¯åŠ¨èµ·æ¥ï¼ŒæŠŠ2å·æœåŠ¡å™¨åœæ‰,åœæ‰åè§‚å¯Ÿ1å·å’Œ3å·çš„çŠ¶æ€ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh start</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh stop</span><br><span class="line"></span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-1/bin/zkServer.sh status</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status </span><br></pre></td></tr></table></figure><p>å‘ç°æ–°çš„leaderäº§ç”Ÿäº†ã€‚</p><p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é›†ç¾¤ä¸­çš„ä¸»æœåŠ¡å™¨æŒ‚äº†ï¼Œé›†ç¾¤ä¸­çš„å…¶ä»–æœåŠ¡å™¨ä¼šè‡ªåŠ¨è¿›è¡Œé€‰ä¸¾çŠ¶æ€ï¼Œç„¶åäº§ç”Ÿæ–°å¾—leader </p><p>ï¼ˆ5ï¼‰æˆ‘ä»¬å†æ¬¡æµ‹è¯•ï¼Œå½“æˆ‘ä»¬æŠŠ2å·æœåŠ¡å™¨é‡æ–°å¯åŠ¨èµ·æ¥å¯åŠ¨åï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ2å·æœåŠ¡å™¨ä¼šå†æ¬¡æˆä¸ºæ–°çš„é¢†å¯¼å—ï¼Ÿæˆ‘ä»¬çœ‹ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh start</span><br><span class="line"></span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-2/bin/zkServer.sh status</span><br><span class="line">/usr/local/zookeeper-cluster/zookeeper-3/bin/zkServer.sh status </span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œ2å·æœåŠ¡å™¨å¯åŠ¨åä¾ç„¶æ˜¯è·Ÿéšè€…ï¼ˆä»æœåŠ¡å™¨ï¼‰ï¼Œ3å·æœåŠ¡å™¨ä¾ç„¶æ˜¯é¢†å¯¼è€…ï¼ˆä¸»æœåŠ¡å™¨ï¼‰ï¼Œæ²¡æœ‰æ’¼åŠ¨3å·æœåŠ¡å™¨çš„é¢†å¯¼åœ°ä½ã€‚</p><p>ç”±æ­¤æˆ‘ä»¬å¾—å‡ºç»“è®ºï¼Œå½“é¢†å¯¼è€…äº§ç”Ÿåï¼Œå†æ¬¡æœ‰æ–°æœåŠ¡å™¨åŠ å…¥é›†ç¾¤ï¼Œä¸ä¼šå½±å“åˆ°ç°ä»»é¢†å¯¼è€…ã€‚</p><h2 id="4-å‚è€ƒ"><a href="#4-å‚è€ƒ" class="headerlink" title="4.å‚è€ƒ"></a>4.å‚è€ƒ</h2><p><a href="https://www.cnblogs.com/leesf456/p/6107600.html">Zookeeperçš„Leaderé€‰ä¸¾</a></p><p><a href="https://www.bilibili.com/video/BV1M741137qY?p=22&spm_id_from=pageDriver">é»‘é©¬ç¨‹åºå‘˜å¿«é€Ÿå…¥é—¨zookeeperæŠ€æœ¯</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1-Zookeeperä»‹ç»&quot;&gt;&lt;a href=&quot;#1-Zookeeperä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1.Zookeeperä»‹ç»&quot;&gt;&lt;/a&gt;1.Zookeeperä»‹ç»&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œ</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="notebook" scheme="http://example.com/tags/notebook/"/>
    
  </entry>
  
  <entry>
    <title>Jvmå†…å­˜æ¨¡å‹å…«è‚¡æ–‡</title>
    <link href="http://example.com/2022/03/08/Jvm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://example.com/2022/03/08/Jvm%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2022-03-08T06:49:34.000Z</published>
    <updated>2022-05-31T09:13:15.623Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ <a href="https://javaguide.cn/java/jvm/memory-area.html#%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F">JavaGuide</a>ï¼Œæ–¹ä¾¿æŸ¥é˜…è®°å¿†æ•´ç†å‡ºæ¥çš„ã€‚</p><h2 id="JVM-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"><a href="#JVM-è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ" class="headerlink" title="JVM è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ"></a>JVM è¿è¡Œæ—¶æ•°æ®åŒºåŸŸ</h2><ul><li>çº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ï¼Œè™šæ‹Ÿæœºæ ˆ</li><li>çº¿ç¨‹å…±äº«ï¼šå †ï¼Œæ–¹æ³•åŒºï¼Œ</li></ul><p><strong>JDK 1.8 ä¹‹å‰</strong> ï¼š</p><p><img src="https://javaguide.cn/assets/JVM%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9F.5f095134.png" alt="img"></p><p><strong>JDK 1.8</strong> ï¼š</p><p><img src="https://javaguide.cn/assets/Java%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E5%9F%9FJDK1.8.dbbe1f77.png" alt="img"></p><h2 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h2><p>â‘ ï¼šæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œéšçº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œéšçº¿ç¨‹æ¶ˆäº¡è€Œæ¶ˆäº¡</p><p>â‘¡ï¼šä½œç”¨ï¼š</p><ul><li>å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œå®ç°äº†ä»£ç çš„æµç¨‹æ§åˆ¶</li><li>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯ä»¥ä¿å­˜çº¿ç¨‹æ‰§è¡Œä½ç½®ï¼Œå¾…çº¿ç¨‹åˆ‡æ¢å›æ¥æ—¶ç»§ç»­æ‰§è¡Œ</li></ul><h2 id="è™šæ‹Ÿæœºæ ˆ"><a href="#è™šæ‹Ÿæœºæ ˆ" class="headerlink" title="è™šæ‹Ÿæœºæ ˆ"></a>è™šæ‹Ÿæœºæ ˆ</h2><p>â‘ ï¼šæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œéšçº¿ç¨‹åˆ›å»ºè€Œåˆ›å»ºï¼Œéšçº¿ç¨‹æ¶ˆäº¡è€Œæ¶ˆäº¡</p><p>â‘¡ï¼šæ–¹æ³•è°ƒç”¨æ•°æ®éœ€è¦é€šè¿‡æ ˆè¿›è¡Œä¼ é€’ï¼Œæ¯æ¬¡è°ƒç”¨æ–¹æ³•éƒ½ä¼šæœ‰å¯¹åº”æ ˆå¸§è¢«å‹å…¥æ ˆä¸­ã€‚</p><p>â‘¢ï¼šæ ˆç”±ä¸€ä¸ªä¸ªæ ˆå¸§ç»„æˆï¼Œè€Œæ¯ä¸ªæ ˆå¸§ä¸­éƒ½æ‹¥æœ‰ï¼šå±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•è¿”å›åœ°å€ã€‚</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbcyHniaRwicrGicpibemBIsib8lsEA62IBDdRchsYDHXOf5icUia1Du9bFicYa8Lx6f4IrPPNftTibDwX4vhQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 50%;" /><ul><li>å±€éƒ¨å˜é‡è¡¨ï¼šä¸»è¦å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„å„ç§æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceï¼‰</li><li>æ“ä½œæ•°æ ˆï¼šä¸»è¦å­˜å‚¨æ–¹æ³•è¿è¡Œæ—¶äº§ç”Ÿçš„ä¸­é—´è®¡ç®—ç»“æœã€‚å¦å¤–ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å˜é‡ä¹Ÿä¼šæ”¾åœ¨æ“ä½œæ•°æ ˆä¸­ã€‚</li><li>åŠ¨æ€é“¾æ¥ï¼šå°†ç¬¦å·å¼•ç”¨è½¬åŒ–ä¸ºå†…å­˜ä¸­çš„ç›´æ¥å¼•ç”¨ï¼ˆJavaæºæ–‡ä»¶è¢«ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶æ—¶ï¼Œæ‰€æœ‰å˜é‡å’Œæ–¹æ³•å¼•ç”¨éƒ½ä¼šä½œä¸ºç¬¦å·å¼•ç”¨å­˜æ”¾åœ¨Classæ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä¸­ï¼Œå¦‚æœæƒ³è°ƒç”¨è¿™äº›æ–¹æ³•ï¼Œå°±éœ€è¦å†æŠŠç¬¦å·å¼•ç”¨è½¬æ¢å›ç›´æ¥å¼•ç”¨ï¼‰</li></ul><h2 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h2><p>â‘ ï¼šè·Ÿè™šæ‹Ÿæœºæ ˆåŸºæœ¬ä¸€è‡´</p><p>â‘¡ï¼šè™šæ‹Ÿæœºæ ˆä¸º <code>Java </code> æ–¹æ³•æœåŠ¡ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¸º <code>native</code> æ–¹æ³•æœåŠ¡ã€‚</p><h2 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h2><p>â‘ ï¼šå†…å­˜å…±äº«</p><p>â‘¡ï¼šå­˜æ”¾å¯¹è±¡å®ä¾‹çš„åœ°æ–¹</p><p>â‘¢ï¼šæ˜¯åƒåœ¾ç®¡ç†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œGCå †ã€‚Javaå †å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œå†ç»†è‡´ä¸€ç‚¹æœ‰ï¼šEdenã€Survivorã€Old ç­‰ç©ºé—´ã€‚è¿›ä¸€æ­¥åˆ’åˆ†çš„ç›®çš„æ˜¯æ›´å¥½çš„å›æ”¶å†…å­˜ï¼Œæˆ–è€…æ›´å¿«çš„åˆ†é…å†…å­˜ã€‚</p><p> åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p>è€Œåœ¨JDK 8 ç‰ˆæœ¬å PermGen(æ°¸ä¹…ä»£) å·²è¢« Metaspace(å…ƒç©ºé—´) å–ä»£ï¼Œå…ƒç©ºé—´ä½¿ç”¨çš„æ˜¯ç›´æ¥å†…å­˜ </p><p><img src="https://javaguide.cn/assets/hotspot-heap-structure.784465da.png" alt="hotspot-heap-structure"></p><p>å¤§éƒ¨åˆ†æƒ…å†µï¼Œå¯¹è±¡éƒ½ä¼šé¦–å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œåœ¨ä¸€æ¬¡æ–°ç”Ÿä»£åƒåœ¾å›æ”¶åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œåˆ™ä¼šè¿›å…¥ S0 æˆ–è€… S1ï¼Œå¹¶ä¸”å¯¹è±¡çš„å¹´é¾„è¿˜ä¼šåŠ  1(Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1)ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>-XX:MaxTenuringThreshold</code> æ¥è®¾ç½®ã€‚å½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„çš„å¯¹è±¡çš„æ•°ç›®å¤§å°è¶…è¿‡äº† survivor åŒºçš„ä¸€åŠæ—¶ï¼Œå–è¿™ä¸ªå¹´é¾„å’Œ <code>MaxTenuringThreshold</code> ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼ã€‚</p><h2 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h2><p>â‘ ï¼šçº¿ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œä¸»è¦æ˜¯ç”¨æ¥å­˜æ”¾å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ã€Œç±»ç›¸å…³ä¿¡æ¯ã€ï¼šåŒ…æ‹¬ç±»ä¿¡æ¯ã€å¸¸é‡æ± </p><p>â‘¡ï¼šå½“è™šæ‹Ÿæœºè¦ä½¿ç”¨ä¸€ä¸ªç±»æ—¶ï¼Œä¼šè¯»å–å¹¶è§£æ Class æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯å­˜åˆ°æ–¹æ³•åŒºä¸­ï¼Œæ–¹æ³•åŒºä¸­ä¼šå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰æ•°æ®ã€‚</p><p>â‘¢ï¼šæ–¹æ³•åŒºå’Œæ°¸ä¹…ä»£ã€å…ƒç©ºé—´çš„å…³ç³»ï¼šæ–¹æ³•åŒºç›¸å½“äºæ˜¯ä¸ªæ¦‚å¿µï¼Œè€Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´æ˜¯æ–¹æ³•åŒºçš„å®ç°</p><p>â‘£ï¼šæŠŠæ°¸ä¹…ä»£æ¢æˆå…ƒç©ºé—´çš„å› ç´ ï¼š</p><ul><li>æ°¸ä¹…ä»£å­˜æ”¾åœ¨JVMä¸­ï¼Œå—åˆ°JVMè®¾ç½®çš„å›ºå®šå¤§å°ä¸Šé™ã€‚è€Œå…ƒç©ºé—´å­˜æ”¾åœ¨ç›´æ¥å†…å­˜ä¸­ï¼Œæº¢å‡ºçš„å¯èƒ½æ€§æ›´å°ã€‚</li><li>åˆå¹¶ HotSpot å’Œ JRockit çš„ä»£ç æ—¶ï¼ŒJRockit æ²¡æœ‰æ°¸ä¹…ä»£è¿™ä¸ªä¸œè¥¿ã€‚</li></ul><p>â‘¤ï¼šæ–¹æ³•åŒºå¸¸ç”¨å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-XX:MetaspaceSize=N <span class="comment">//è®¾ç½® Metaspace çš„åˆå§‹ï¼ˆå’Œæœ€å°å¤§å°ï¼‰</span></span><br><span class="line">-XX:MaxMetaspaceSize=N <span class="comment">//è®¾ç½® Metaspace çš„æœ€å¤§å¤§å°</span></span><br></pre></td></tr></table></figure><h2 id="å¸¸é‡æ± "><a href="#å¸¸é‡æ± " class="headerlink" title="å¸¸é‡æ± "></a>å¸¸é‡æ± </h2><p>Javaä¸­çš„å¸¸é‡æ± ï¼Œå®é™…ä¸Šåˆ†ä¸ºä¸¤ç§å½¢æ€ï¼šé™æ€å¸¸é‡æ± å’Œè¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><h3 id="é™æ€å¸¸é‡æ± "><a href="#é™æ€å¸¸é‡æ± " class="headerlink" title="é™æ€å¸¸é‡æ± "></a>é™æ€å¸¸é‡æ± </h3><p>â‘ ï¼šæ‰€è°“é™æ€å¸¸é‡æ± ï¼Œå³ <code>*.class</code> æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ï¼Œå­—èŠ‚ç æ–‡ä»¶ä¸­çš„å¸¸é‡æ± ä¸ä»…ä»…åŒ…å«å­—ç¬¦ä¸²(æ•°å­—)å­—é¢é‡ï¼Œè¿˜åŒ…å«ç±»ã€æ–¹æ³•çš„ä¿¡æ¯ï¼Œå ç”¨å­—èŠ‚ç æ–‡ä»¶çš„ç»å¤§éƒ¨åˆ†ç©ºé—´ã€‚å®ƒä»¬åªæ˜¯ä¸€ä¸ªç±»çš„æè¿°ä¿¡æ¯è€Œå·²ï¼Œè¿˜æ²¡æœ‰å…·å¤‡è¢«æ‰§è¡Œçš„èƒ½åŠ›</p><p>â‘¡ï¼šï¼šClass æ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨çš„å¸¸é‡æ± è¡¨</p><p>â‘¡ï¼šå¸¸é‡æ± è¡¨ä¼šåœ¨åŠ è½½åå­˜æ”¾åˆ°æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­</p><h3 id="è¿è¡Œæ—¶å¸¸é‡æ± "><a href="#è¿è¡Œæ—¶å¸¸é‡æ± " class="headerlink" title="è¿è¡Œæ—¶å¸¸é‡æ± "></a>è¿è¡Œæ—¶å¸¸é‡æ± </h3><p>â‘ ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œåˆ™æ˜¯è™šæ‹Ÿæœºåœ¨å®Œæˆç±»è£…è½½æ“ä½œåï¼Œå°†å­—èŠ‚ç æ–‡ä»¶ä¸­çš„å¸¸é‡æ± è½½å…¥åˆ°å†…å­˜å¹¶å­˜å…¥æ–¹æ³•åŒºçš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¸¸è¯´çš„å¸¸é‡æ± ï¼Œå°±æ˜¯æŒ‡æ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</p><p>â‘¡ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ç›¸å¯¹äºé™æ€å¸¸é‡æ± çš„å¦å¤–ä¸€ä¸ªé‡è¦ç‰¹å¾å°±æ˜¯å…·å¤‡åŠ¨æ€æ€§ï¼ŒJavaè¯­è¨€å¹¶ä¸è¦æ±‚å¸¸é‡ä¸€å®šåªæœ‰åœ¨ç¼–è¯‘æœŸæ‰èƒ½äº§ç”Ÿï¼Œä¹Ÿå°±æ˜¯å¹¶éé¢„ç½®å…¥Classæ–‡ä»¶ä¸­å¸¸é‡æ± çš„å†…å®¹æ‰èƒ½è¿›å…¥æ–¹æ³•åŒºè¿è¡Œæ—¶å¸¸é‡æ± ï¼Œè¿è¡ŒæœŸé—´ä¹Ÿå¯èƒ½å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ï¼Œè¿™ç§ç‰¹æ€§è¢«å¼€å‘äººå‘˜åˆ©ç”¨å¾—æ¯”è¾ƒå¤šçš„ä¾¿æ˜¯Stringç±»çš„ <code>intern()</code> æ–¹æ³•.</p><p>â‘¢ï¼šå­—ç¬¦ä¸²å¸¸é‡æ±  æ˜¯ JVM ä¸ºäº†æå‡æ€§èƒ½å’Œå‡å°‘å†…å­˜æ¶ˆè€—é’ˆå¯¹å­—ç¬¦ä¸²ï¼ˆString ç±»ï¼‰ä¸“é—¨å¼€è¾Ÿçš„ä¸€å—åŒºåŸŸï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†é¿å…å­—ç¬¦ä¸²çš„é‡å¤åˆ›å»ºã€‚JDK 8 åå­˜æ”¾åœ¨å †ä¸­</p><img src="https://javaguide.cn/assets/method-area-jdk1.8.b19d81f7.png" alt="img" style="zoom: 80%;" /><h2 id="ç›´æ¥å†…å­˜"><a href="#ç›´æ¥å†…å­˜" class="headerlink" title="ç›´æ¥å†…å­˜"></a>ç›´æ¥å†…å­˜</h2><p>â‘ ï¼šç›´æ¥å†…å­˜å¹¶ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯è™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å†…å­˜ä¹Ÿè¢«é¢‘ç¹åœ°ä½¿ç”¨ã€‚è€Œä¸”ä¹Ÿå¯èƒ½å¯¼è‡´ <code>OutOfMemoryError</code> é”™è¯¯å‡ºç°ã€‚</p><p>â‘¡ï¼šæœ¬æœºç›´æ¥å†…å­˜çš„åˆ†é…ä¸ä¼šå—åˆ° Java å †çš„é™åˆ¶ï¼Œä½†æ˜¯ï¼Œæ—¢ç„¶æ˜¯å†…å­˜å°±ä¼šå—åˆ°æœ¬æœºæ€»å†…å­˜å¤§å°ä»¥åŠå¤„ç†å™¨å¯»å€ç©ºé—´çš„é™åˆ¶</p><h2 id="å¼‚å¸¸è§£é‡Š"><a href="#å¼‚å¸¸è§£é‡Š" class="headerlink" title="å¼‚å¸¸è§£é‡Š"></a>å¼‚å¸¸è§£é‡Š</h2><p>â‘ ï¼š<code>StackOverFlowError</code>ï¼š è‹¥æ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰ Java è™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡º <code>StackOverFlowError</code> é”™è¯¯ã€‚</p><p>â‘¡ï¼š<code>OutOfMemoryError</code>ï¼šå¦‚æœæ ˆçš„å†…å­˜å¤§å°å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œ å¦‚æœè™šæ‹Ÿæœºåœ¨åŠ¨æ€æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º<code>OutOfMemoryError</code> é”™è¯¯ã€‚</p><h2 id="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"><a href="#å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹" class="headerlink" title="å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹"></a>å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</h2><ol><li><p>æ£€æŸ¥ç±»åŠ è½½ï¼šæ£€æŸ¥æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­å®šä½åˆ°è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œå¹¶æ£€æŸ¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ã€è§£æè¿‡ã€åˆå§‹åŒ–è¿‡ã€‚è‹¥æ²¡æœ‰åˆ™å…ˆè¿›è¡Œç±»çš„åŠ è½½è¿‡ç¨‹</p></li><li><p>åˆ†é…å†…å­˜ï¼š </p><p>â‘ ï¼šä¸¤ç§æ–¹å¼</p><ul><li>æŒ‡é’ˆç¢°æ’<ul><li>é€‚ç”¨åœºåˆ ï¼šå †å†…å­˜è§„æ•´ï¼ˆå³æ²¡æœ‰å†…å­˜ç¢ç‰‡ï¼‰çš„æƒ…å†µä¸‹ã€‚</li><li>åŸç† ï¼šç”¨è¿‡çš„å†…å­˜å…¨éƒ¨æ•´åˆåˆ°ä¸€è¾¹ï¼Œæ²¡æœ‰ç”¨è¿‡çš„å†…å­˜æ”¾åœ¨å¦ä¸€è¾¹ï¼Œä¸­é—´æœ‰ä¸€ä¸ªåˆ†ç•ŒæŒ‡é’ˆï¼Œåªéœ€è¦å‘ç€æ²¡ç”¨è¿‡çš„å†…å­˜æ–¹å‘å°†è¯¥æŒ‡é’ˆç§»åŠ¨å¯¹è±¡å†…å­˜å¤§å°ä½ç½®å³å¯ã€‚</li><li>ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šSerial, ParNew</li></ul></li><li>ç©ºé—²åˆ—è¡¨<ul><li>é€‚ç”¨åœºåˆ ï¼š å †å†…å­˜ä¸è§„æ•´çš„æƒ…å†µä¸‹ã€‚</li><li>åŸç† ï¼šè™šæ‹Ÿæœºä¼šç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨ä¸­ä¼šè®°å½•å“ªäº›å†…å­˜å—æ˜¯å¯ç”¨çš„ï¼Œåœ¨åˆ†é…çš„æ—¶å€™ï¼Œæ‰¾ä¸€å—å„¿è¶³å¤Ÿå¤§çš„å†…å­˜å—å„¿æ¥åˆ’åˆ†ç»™å¯¹è±¡å®ä¾‹ï¼Œæœ€åæ›´æ–°åˆ—è¡¨è®°å½•ã€‚</li><li>ä½¿ç”¨è¯¥åˆ†é…æ–¹å¼çš„ GC æ”¶é›†å™¨ï¼šCMS</li></ul></li></ul><p>â‘¡ï¼šå†…å­˜åˆ†é…å¹¶å‘é—®é¢˜</p><ul><li>TLABï¼šä¸ºæ¯ä¸ªçº¿ç¨‹é¢„å…ˆåœ¨EdenåŒºåˆ†é…ä¸€å—å†…å­˜ï¼ŒJVM åœ¨ç»™çº¿ç¨‹ä¸­çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œé¦–å…ˆåœ¨ TLAB åˆ†é…ï¼Œå½“å¯¹è±¡å¤§å°å¤§äº TLAB çš„å‰©ä½™å†…å­˜æˆ–è€… TLAB å·²ç”¨å°½æ—¶ï¼Œé‡‡ç”¨CAS + å¤±è´¥é‡è¯•ç­–ç•¥</li><li>CAS + å¤±è´¥é‡è¯•ï¼š CAS æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ã€‚æ‰€è°“ä¹è§‚é”å°±æ˜¯ï¼Œæ¯æ¬¡ä¸åŠ é”è€Œæ˜¯å‡è®¾æ²¡æœ‰å†²çªè€Œå»å®ŒæˆæŸé¡¹æ“ä½œï¼Œå¦‚æœå› ä¸ºå†²çªå¤±è´¥å°±é‡è¯•ï¼Œç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚è™šæ‹Ÿæœºé‡‡ç”¨ CAS é…ä¸Šå¤±è´¥é‡è¯•çš„æ–¹å¼ä¿è¯æ›´æ–°æ“ä½œçš„åŸå­æ€§ã€‚</li></ul></li><li><p>åˆå§‹åŒ–é›¶å€¼ï¼šå°†å¯¹è±¡çš„å®ä¾‹å­—æ®µåˆå§‹åŒ–ä¸ºè¿™äº›å­—æ®µå¯¹åº”ç±»å‹çš„é›¶å€¼</p></li><li><p>è®¾ç½®å¯¹è±¡å¤´ï¼šå¯¹è±¡å¤´åˆ†ä¸ºä¸¤éƒ¨åˆ†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|--------------------------------------------------------------|</span><br><span class="line">|                     Object Header (64 bits)                  |</span><br><span class="line">|------------------------------------|-------------------------|</span><br><span class="line">|        Mark Word (32 bits)         |    Klass Word (32 bits) |</span><br><span class="line">|------------------------------------|-------------------------|</span><br></pre></td></tr></table></figure><ul><li>Mark Wordï¼šä¸»è¦ä¿å­˜ é”ã€Hashã€è¿˜æœ‰åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯</li><li>KClass Wordï¼šä¸»è¦å­˜æ”¾ä¿å­˜ç±»å…ƒä¿¡æ¯ï¼ˆå­˜åœ¨äºæ–¹æ³•åŒºï¼‰çš„æŒ‡é’ˆ</li></ul></li><li><p>æ‰§è¡Œ init æ–¹æ³•</p></li></ol><h2 id="å¯¹è±¡çš„è®¿é—®å®šä½"><a href="#å¯¹è±¡çš„è®¿é—®å®šä½" class="headerlink" title="å¯¹è±¡çš„è®¿é—®å®šä½"></a>å¯¹è±¡çš„è®¿é—®å®šä½</h2><ol><li><p>ä½¿ç”¨å¥æŸ„ï¼šåœ¨å †ä¸­å¼€è¾Ÿä¸€å—å†…å­˜ä½œä¸ºå¥æŸ„æ± ï¼Œå­˜å‚¨å¯¹è±¡å®ä¾‹æ•°æ®å’Œå¯¹è±¡ç±»å‹æ•°æ®çš„æŒ‡é’ˆ</p><p><img src="https://javaguide.cn/assets/%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D-%E4%BD%BF%E7%94%A8%E5%8F%A5%E6%9F%84.1cf25227.png" alt="å¯¹è±¡çš„è®¿é—®å®šä½-ä½¿ç”¨å¥æŸ„"></p></li><li><p>ç›´æ¥æŒ‡é’ˆï¼šå¯¹è±¡å®ä¾‹æ•°æ®ä¸­åŒ…å«æœ‰å¯¹è±¡æ•°æ®ç±»å‹çš„æŒ‡é’ˆ</p></li></ol><p><img src="https://javaguide.cn/assets/%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%AE%BF%E9%97%AE%E5%AE%9A%E4%BD%8D-%E7%9B%B4%E6%8E%A5%E6%8C%87%E9%92%88.9bfd6702.png" alt="å¯¹è±¡çš„è®¿é—®å®šä½-ç›´æ¥æŒ‡é’ˆ"></p><p>è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼æœ€å¤§çš„å¥½å¤„å°±æ˜¯é€Ÿåº¦å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ &lt;a href=&quot;https://javaguide.cn/java/jvm/memory-area.htm</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
    <category term="å…«è‚¡æ–‡" scheme="http://example.com/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>åƒåœ¾å›æ”¶æœºåˆ¶</title>
    <link href="http://example.com/2022/03/08/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"/>
    <id>http://example.com/2022/03/08/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/</id>
    <published>2022-03-08T03:20:54.000Z</published>
    <updated>2022-05-31T08:40:12.264Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ<a href="https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5Mg==&mid=2247485557&idx=1&sn=f04951ebdf495cb16e4ead2b7725b310&scene=21#wechat_redirect">ã€Šå¯¹çº¿é¢è¯•å®˜ã€‹åƒåœ¾å›æ”¶æœºåˆ¶</a>ï¼Œæ–¹ä¾¿æŸ¥é˜…è®°å¿†æ•´ç†å‡ºæ¥çš„ã€‚</p><h2 id="å †å†…å­˜çš„åˆ’åˆ†"><a href="#å †å†…å­˜çš„åˆ’åˆ†" class="headerlink" title="å †å†…å­˜çš„åˆ’åˆ†"></a>å †å†…å­˜çš„åˆ’åˆ†</h2><p>å †åˆ†äº†ã€Œæ–°ç”Ÿä»£ã€å’Œã€Œè€å¹´ä»£ã€ï¼Œã€Œæ–°ç”Ÿä»£ã€åˆåˆ†ä¸ºã€ŒEdenã€å’Œã€ŒSurvivorã€åŒºï¼Œã€ŒSurvivorã€åŒºåˆåˆ†ä¸ºã€ŒFrom Survivorã€å’Œã€ŒTo Survivorã€åŒº</p><p><img src="C:\Users\18375\AppData\Roaming\Typora\typora-user-images\image-20220531145501981.png" alt="image-20220531145501981"></p><h2 id="åˆ¤æ–­å¯¹è±¡å·²ç»æ­»äº¡"><a href="#åˆ¤æ–­å¯¹è±¡å·²ç»æ­»äº¡" class="headerlink" title="åˆ¤æ–­å¯¹è±¡å·²ç»æ­»äº¡"></a>åˆ¤æ–­å¯¹è±¡å·²ç»æ­»äº¡</h2><p>åªè¦å¯¹è±¡ä¸å†è¢«ä½¿ç”¨äº†ï¼Œé‚£æˆ‘ä»¬å°±è®¤ä¸ºè¯¥å¯¹è±¡å°±æ˜¯åƒåœ¾ï¼Œå¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´å°±å¯ä»¥è¢«å›æ”¶ã€‚åˆ¤æ–­å¯¹è±¡æ˜¯å¦å·²ç»æ­»äº¡æœ‰ä¸¤ç§æ–¹æ³•</p><ol><li><p>ã€Œå¼•ç”¨è®¡æ•°æ³•ã€</p><ul><li>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼›å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1ï¼›ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</li><li>è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜</li><li>å› ä¸ºå®ƒæœ€æ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯ï¼šå¦‚æœå¯¹è±¡å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œé‚£å°±æ— æ³•å®šä½è¯¥å¯¹è±¡æ˜¯å¦åº”è¯¥è¢«å›æ”¶ï¼ˆAä¾èµ–Bï¼ŒBä¾èµ–Aï¼‰</li></ul></li><li><p>ã€Œå¯è¾¾æ€§åˆ†ææ³•ã€</p><ul><li><p>ä»ã€ŒGC Rootsã€å¼€å§‹å‘ä¸‹æœç´¢ï¼Œå½“å¯¹è±¡åˆ°ã€ŒGC Rootsã€éƒ½æ²¡æœ‰ä»»ä½•å¼•ç”¨ç›¸è¿æ—¶ï¼Œè¯´æ˜å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ï¼Œå¯ä»¥è¢«å›æ”¶</p></li><li><p>ã€ŒGC Rootsã€æ˜¯ä¸€ç»„å¿…é¡»ã€Œæ´»è·ƒã€çš„å¼•ç”¨ã€‚ä»ã€ŒGC Rootã€å‡ºå‘ï¼Œç¨‹åºé€šè¿‡ç›´æ¥å¼•ç”¨æˆ–è€…é—´æ¥å¼•ç”¨ï¼Œèƒ½å¤Ÿæ‰¾åˆ°å¯èƒ½æ­£åœ¨è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚å¯ä»¥ä½œä¸ºã€ŒGC Rootsã€çš„å¯¹è±¡ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆ(æ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆ(Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ‰€æœ‰è¢«åŒæ­¥é”æŒæœ‰çš„å¯¹è±¡</li></ul></li><li><p>JVMç”¨çš„å°±æ˜¯ã€Œå¯è¾¾æ€§åˆ†æç®—æ³•ã€æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦åƒåœ¾</p></li></ul></li></ol><h2 id="åˆ¤æ–­ç±»æ˜¯å¦å·²ç»æ— ç”¨"><a href="#åˆ¤æ–­ç±»æ˜¯å¦å·²ç»æ— ç”¨" class="headerlink" title="åˆ¤æ–­ç±»æ˜¯å¦å·²ç»æ— ç”¨"></a>åˆ¤æ–­ç±»æ˜¯å¦å·²ç»æ— ç”¨</h2><ol><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</li><li>åŠ è½½è¯¥ç±»çš„ <code>ClassLoader</code> å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ol><h2 id="åƒåœ¾æ”¶é›†ç®—æ³•"><a href="#åƒåœ¾æ”¶é›†ç®—æ³•" class="headerlink" title="åƒåœ¾æ”¶é›†ç®—æ³•"></a>åƒåœ¾æ”¶é›†ç®—æ³•</h2><h3 id="æ ‡è®°-æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°-æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°-æ¸…é™¤ç®—æ³•"></a>æ ‡è®°-æ¸…é™¤ç®—æ³•</h3><p>åƒåœ¾å›æ”¶çš„ç¬¬ä¸€æ­¥å°±æ˜¯ã€Œæ ‡è®°ã€ï¼Œæ ‡è®°å“ªäº›æ²¡æœ‰è¢«ã€ŒGC Rootsã€å¼•ç”¨çš„å¯¹è±¡ï¼Œæ ‡è®°å®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©ç›´æ¥ã€Œæ¸…é™¤ã€ï¼Œåªè¦ä¸è¢«ã€ŒGC Rootsã€å…³è”çš„ï¼Œéƒ½å¯ä»¥æ¸…ç†æ‰ï¼Œä½†ä¹Ÿå­˜åœ¨å¾ˆæ˜æ˜¾çš„é—®é¢˜ï¼Œç›´æ¥æ¸…é™¤ä¼šæœ‰ã€Œå†…å­˜ç¢ç‰‡ã€çš„é—®é¢˜ï¼šå¯èƒ½æˆ‘æœ‰10Mçš„ç©ºä½™å†…å­˜ï¼Œä½†ç¨‹åºç”³è¯·9Må†…å­˜ç©ºé—´å´ç”³è¯·ä¸ä¸‹æ¥ï¼ˆ10Mçš„å†…å­˜ç©ºé—´æ˜¯åƒåœ¾æ¸…é™¤åçš„ï¼Œä¸è¿ç»­çš„ï¼‰</p><h3 id="æ ‡è®°-å¤åˆ¶ç®—æ³•"><a href="#æ ‡è®°-å¤åˆ¶ç®—æ³•" class="headerlink" title="æ ‡è®°-å¤åˆ¶ç®—æ³•"></a>æ ‡è®°-å¤åˆ¶ç®—æ³•</h3><p>é‚£è§£å†³ã€Œå†…å­˜ç¢ç‰‡ã€çš„é—®é¢˜ä¹Ÿæ¯”è¾ƒç®€å•ç²—æš´ï¼Œã€Œæ ‡è®°ã€å®Œï¼Œä¸ç›´æ¥ã€Œæ¸…é™¤ã€ã€‚æˆ‘æŠŠã€Œæ ‡è®°ã€å­˜æ´»çš„å¯¹è±¡ã€Œå¤åˆ¶ã€åˆ°å¦ä¸€å—ç©ºé—´ï¼Œå¤åˆ¶å®Œäº†ä¹‹åï¼Œç›´æ¥æŠŠåŸæœ‰çš„æ•´å—ç©ºé—´ç»™å¹²æ‰ï¼è¿™æ ·å°±æ²¡æœ‰å†…å­˜ç¢ç‰‡çš„é—®é¢˜äº†</p><p>è¿™ç§åšæ³•ç¼ºç‚¹åˆå¾ˆæ˜æ˜¾ï¼šå†…å­˜åˆ©ç”¨ç‡ä½ï¼Œå¾—æœ‰ä¸€å—æ–°çš„åŒºåŸŸç»™æˆ‘å¤åˆ¶è¿‡å»</p><h3 id="æ ‡è®°-æ•´ç†ç®—æ³•"><a href="#æ ‡è®°-æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°-æ•´ç†ç®—æ³•"></a>æ ‡è®°-æ•´ç†ç®—æ³•</h3><p>è¿˜æœ‰ä¸€ç§ã€ŒæŠ˜ä¸­ã€çš„åŠæ³•ï¼Œæˆ‘æœªå¿…è¦æœ‰ä¸€å—ã€Œå¤§çš„å®Œæ•´ç©ºé—´ã€æ‰èƒ½è§£å†³å†…å­˜ç¢ç‰‡çš„é—®é¢˜ï¼Œæˆ‘åªè¦èƒ½åœ¨ã€Œå½“å‰åŒºåŸŸã€å†…è¿›è¡Œç§»åŠ¨å°±è¡Œã€‚</p><p>æŠŠå­˜æ´»çš„å¯¹è±¡ç§»åˆ°ä¸€è¾¹ï¼ŒæŠŠåƒåœ¾ç§»åˆ°ä¸€è¾¹ï¼Œé‚£å†å°†åƒåœ¾ä¸€èµ·åˆ é™¤æ‰ï¼Œä¸å°±æ²¡æœ‰å†…å­˜ç¢ç‰‡äº†å˜›ã€‚</p><p>è¿™ç§ä¸“ä¸šçš„æœ¯è¯­å°±å«åšã€Œæ•´ç†ã€</p><h2 id="åŒºåŸŸåˆ†ä»£"><a href="#åŒºåŸŸåˆ†ä»£" class="headerlink" title="åŒºåŸŸåˆ†ä»£"></a>åŒºåŸŸåˆ†ä»£</h2><p>â‘ ï¼šã€Œåƒåœ¾å›æ”¶ã€ä¼šå¯¼è‡´ã€ŒSTOP  THE  WORLDã€</p><p>â‘¡ï¼šç†è§£ã€ŒSTOP  THE  WORLDã€ï¼šå›æ”¶åƒåœ¾çš„æ—¶å€™ï¼Œç¨‹åºæ˜¯éœ€è¦æœ‰çŸ­æš‚çš„æ—¶é—´ä¸èƒ½æ­£å¸¸ç»§ç»­è¿ä½œå•Šã€‚ä¸ç„¶JVMåœ¨å›æ”¶çš„æ—¶å€™ï¼Œç”¨æˆ·çº¿ç¨‹è¿˜ç»§ç»­åˆ†é…ä¿®æ”¹å¼•ç”¨ï¼ŒJVMæ€ä¹ˆæï¼Ÿ</p><p>â‘¢ï¼šä¸ºäº†ä½¿ã€ŒSTOP  THE  WORLDã€æŒç»­çš„æ—¶é—´å°½å¯èƒ½çŸ­ä»¥åŠæé«˜å¹¶å‘å¼GCæ‰€èƒ½åº”ä»˜çš„å†…å­˜åˆ†é…é€Ÿç‡ï¼Œåœ¨å¾ˆå¤šçš„åƒåœ¾æ”¶é›†å™¨ä¸Šéƒ½ä¼šåœ¨ã€Œç‰©ç†ã€æˆ–è€…ã€Œé€»è¾‘ã€ä¸Šï¼ŒæŠŠè¿™ä¸¤ç±»å¯¹è±¡è¿›è¡ŒåŒºåˆ†ï¼Œæ­»å¾—å¿«çš„å¯¹è±¡æ‰€å çš„åŒºåŸŸå«åšã€Œå¹´è½»ä»£ã€ï¼Œæ´»å¾—ä¹…çš„å¯¹è±¡æ‰€å çš„åŒºåŸŸå«åšã€Œè€å¹´ä»£ã€</p><h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><p>â‘ ï¼šã€Œå¹´è½»ä»£ã€çš„åƒåœ¾æ”¶é›†å™¨æœ‰ï¼šSeriaã€Parallel Scavengeã€ParNew</p><p>â‘¡ï¼šã€Œè€å¹´ä»£ã€çš„åƒåœ¾æ”¶é›†å™¨æœ‰ï¼šSerial Oldã€Parallel Oldã€CMSã€G1</p><p>â‘¢ï¼šå‚è€ƒ <a href="https://soulchay.com/2022/04/30/CMS&G1-%E5%85%AB%E8%82%A1%E6%96%87/">CMS&amp;G1å…«è‚¡æ–‡</a></p><p>â‘£ï¼šæ–°åˆ›å»ºçš„å¯¹è±¡ä¸€èˆ¬æ˜¯åœ¨ã€Œæ–°ç”Ÿä»£ã€ï¼Œé‚£åœ¨ä»€ä¹ˆæ—¶å€™ä¼šåˆ°ã€Œè€å¹´ä»£ã€ä¸­å‘¢ï¼Ÿ</p><ul><li>å¦‚æœå¯¹è±¡å¤ªå¤§äº†ï¼Œå°±ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ï¼ˆå¯¹è±¡åˆ›å»ºæ—¶å°±å¾ˆå¤§ | SurvivoråŒºæ²¡åŠæ³•å­˜ä¸‹è¯¥å¯¹è±¡ï¼‰</li><li>å¦‚æœå¯¹è±¡å¤ªè€äº†ï¼Œé‚£å°±ä¼šæ™‹å‡è‡³è€å¹´ä»£ï¼ˆæ¯å‘ç”Ÿä¸€æ¬¡Minor GC ï¼Œå­˜æ´»çš„å¯¹è±¡å¹´é¾„+1ï¼Œè¾¾åˆ°é»˜è®¤å€¼15 | åŠ¨æ€å¯¹è±¡å¹´é¾„åˆ¤å®š å¯ä»¥è¿›å…¥è€å¹´ä»£ï¼‰</li></ul><p>â‘¤ï¼šå½“EdenåŒºç©ºé—´ä¸è¶³æ—¶ï¼Œå°±ä¼šè§¦å‘Minor GC</p><p>â‘¥ï¼šMinor GC ç›¸å½“äºæ˜¯ã€Œå¹´è½»ä»£ã€çš„GCï¼Œé‚£åœ¨ã€Œå¹´è½»ä»£ã€GCçš„æ—¶å€™ï¼Œä»GC Rootså‡ºå‘ï¼Œé‚£ä¸ä¹Ÿä¼šæ‰«æåˆ°ã€Œè€å¹´ä»£ã€çš„å¯¹è±¡å—ï¼Ÿé‚£ä¸å°±ç›¸å½“äºå…¨å †æ‰«æå—ï¼Ÿ</p><p>HotSpot è™šæ‹Ÿæœºã€Œè€çš„GCã€ï¼ˆG1ä»¥ä¸‹ï¼‰æ˜¯è¦æ±‚æ•´ä¸ªGCå †åœ¨è¿ç»­çš„åœ°å€ç©ºé—´ä¸Šã€‚æ‰€ä»¥ä¼šæœ‰ä¸€æ¡åˆ†ç•Œçº¿ï¼ˆä¸€ä¾§æ˜¯è€å¹´ä»£ï¼Œå¦ä¸€ä¾§æ˜¯å¹´è½»ä»£ï¼‰ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ã€Œç‰©ç†åœ°å€ã€å°±å¯ä»¥åˆ¤æ–­å¯¹è±¡åœ¨å“ªä¸ªåˆ†ä»£ä¸Šã€‚å½“ Minor GCçš„æ—¶å€™ï¼Œä»GC Rootså‡ºå‘ï¼Œå¦‚æœå‘ç°ã€Œè€å¹´ä»£ã€çš„å¯¹è±¡ï¼Œé‚£å°±ä¸å¾€ä¸‹èµ°äº†ã€‚</p><p>â‘¦ï¼šMinor GCæ—¶ï¼Œå¦‚æœã€Œå¹´è½»ä»£ã€çš„å¯¹è±¡è¢«ã€Œè€å¹´ä»£ã€å¼•ç”¨äº†ï¼Œé‚£ä¹ˆåœ¨æ ‡è®°å­˜æ´»å¯¹è±¡çš„æ—¶å€™ï¼Œå°±éœ€è¦æ‰«æè€å¹´ä»£çš„å¯¹è±¡ï¼Œå¦‚æœè¯¥å¯¹è±¡æ‹¥æœ‰å¯¹æ–°ç”Ÿä»£å¯¹è±¡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ä¹Ÿä¼šè¢«ä½œä¸º GC Rootsã€‚è¿™ç›¸å½“äºå°±åšäº† <b>å…¨å †æ‰«æ</b>ã€‚è¿™ä¸ªæ—¶å€™JVMæ˜¯æ€ä¹ˆåšåˆ°é¿å…å…¨å †æ‰«æçš„ï¼Ÿ</p><p>HotSpotè™šæ‹Ÿæœºä¸‹ æœ‰ã€Œcard tableã€ï¼ˆå¡è¡¨ï¼‰æ¥é¿å…å…¨å±€æ‰«æã€Œè€å¹´ä»£ã€å¯¹è±¡ã€‚ã€Œå †å†…å­˜ã€çš„æ¯ä¸€å°å—åŒºåŸŸå½¢æˆã€Œå¡é¡µã€ï¼Œå¡è¡¨å®é™…ä¸Šå°±æ˜¯å¡é¡µçš„é›†åˆã€‚å½“åˆ¤æ–­ä¸€ä¸ªå¡é¡µä¸­æœ‰å­˜åœ¨å¯¹è±¡çš„è·¨ä»£å¼•ç”¨æ—¶ï¼Œå°†è¿™ä¸ªé¡µæ ‡è®°ä¸ºã€Œè„é¡µã€ã€‚æ¯æ¬¡Minor GC çš„æ—¶å€™åªéœ€è¦å»ã€Œå¡è¡¨ã€æ‰¾åˆ°ã€Œè„é¡µã€ï¼Œå¹¶å°†ã€Œè„é¡µã€ä¸­çš„è€å¹´ä»£æŒ‡å‘æ–°ç”Ÿä»£çš„ã€Œå¼•ç”¨ã€åŠ å…¥åˆ° Minor GCçš„GC Rootsé‡Œã€‚å½“å®Œæˆæ‰€æœ‰ã€Œè„é¡µã€çš„æ‰«æä¹‹åï¼ŒJava è™šæ‹Ÿæœºä¾¿ä¼šå°†æ‰€æœ‰ã€Œè„é¡µã€çš„æ ‡è¯†ä½æ¸…é›¶ã€‚è¿™æ ·è™šæ‹Ÿæœºä»¥ç©ºé—´æ¢æ—¶é—´ï¼Œé¿å…äº†å…¨è¡¨æ‰«æã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5M</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
    <category term="å…«è‚¡æ–‡" scheme="http://example.com/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>ä»£ç åˆ°æ‰§è¡Œ&amp;&amp;åŒäº²å§”æ´¾</title>
    <link href="http://example.com/2022/03/07/%E4%BB%A3%E7%A0%81%E5%88%B0%E6%89%A7%E8%A1%8C&amp;&amp;%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/"/>
    <id>http://example.com/2022/03/07/%E4%BB%A3%E7%A0%81%E5%88%B0%E6%89%A7%E8%A1%8C&amp;&amp;%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE/</id>
    <published>2022-03-06T20:29:34.000Z</published>
    <updated>2022-05-31T11:54:16.220Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ<a href="https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5Mg==&mid=2247485469&idx=1&sn=cf732a462ea5fce2ce74d548add591ab&scene=21#wechat_redirect">ã€Šå¯¹çº¿é¢è¯•å®˜ã€‹Javaç¼–è¯‘åˆ°æ‰§è¡Œçš„è¿‡ç¨‹</a>ï¼Œæ–¹ä¾¿æŸ¥é˜…è®°å¿†æ•´ç†å‡ºæ¥çš„ã€‚</p><h2 id="å¦‚ä½•ç†è§£-Java-è·¨å¹³å°"><a href="#å¦‚ä½•ç†è§£-Java-è·¨å¹³å°" class="headerlink" title="å¦‚ä½•ç†è§£ Java è·¨å¹³å°"></a>å¦‚ä½•ç†è§£ Java è·¨å¹³å°</h2><p>â‘ ï¼šè¿è¡Œä»£ç æ—¶ï¼ŒJavaæºä»£ç ä¼šè¢«ç¼–è¯‘ä¸º classæ–‡ä»¶ï¼Œclassæ–‡ä»¶ æ˜¯è¿è¡Œåœ¨JVMä¹‹ä¸Šçš„ã€‚</p><p>â‘¢ï¼šJVMæ˜¯é¢å‘æ“ä½œç³»ç»Ÿçš„ï¼Œå®ƒè´Ÿè´£æŠŠClasså­—èŠ‚ç è§£é‡Šæˆç³»ç»Ÿæ‰€èƒ½è¯†åˆ«çš„æŒ‡ä»¤å¹¶æ‰§è¡Œï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£ç¨‹åºè¿è¡Œæ—¶å†…å­˜çš„ç®¡ç†ã€‚æ‰€ä»¥ Javaæ˜¯ä¸€é—¨ã€Œè·¨å¹³å°ã€çš„è¯­è¨€ï¼Œæ˜¯å¯ä»¥ã€Œä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œã€çš„ã€‚</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbOame2icwJQQ3T4kzKicxu9SgWuxw9klljCBOnqac2dWDicY28xmNWVPRWtXMiaI4iaRkxyjIwUGnhSzA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 50%;" /><h2 id="ä»æºç æ–‡ä»¶åˆ°ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹"><a href="#ä»æºç æ–‡ä»¶åˆ°ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹" class="headerlink" title="ä»æºç æ–‡ä»¶åˆ°ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹"></a>ä»æºç æ–‡ä»¶åˆ°ä»£ç æ‰§è¡Œçš„è¿‡ç¨‹</h2><p>ä»Java æºä»£ç åˆ°æ‰§è¡Œåˆ†ä¸ºå››ä¸ªè¿‡ç¨‹ï¼šç¼–è¯‘ã€åŠ è½½ã€è§£é‡Šã€æ‰§è¡Œ</p><ol><li>ç¼–è¯‘ï¼šå°†æºç æ–‡ä»¶ç¼–è¯‘æˆJVMå¯ä»¥è§£é‡Šçš„classæ–‡ä»¶ã€‚ç¼–è¯‘è¿‡ç¨‹ä¼šå¯¹æºä»£ç ç¨‹åºåš ã€Œè¯­æ³•åˆ†æã€ã€Œè¯­ä¹‰åˆ†æã€ã€Œæ³¨è§£å¤„ç†ã€ç­‰ç­‰å¤„ç†ï¼Œæœ€åæ‰ç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ã€‚æ¯”å¦‚å¯¹æ³›å‹çš„æ“¦é™¤å’Œæˆ‘ä»¬ç»å¸¸ç”¨çš„Lombokå°±æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µå¹²çš„ã€‚</li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbOame2icwJQQ3T4kzKicxu9SpW2xVhxg2LgpxP11wXYbiapstK1TEdXCibBW20icWGGic2jk6x9b6iamZag/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡"></p><ol start="2"><li><p>åŠ è½½ï¼šå°†ç¼–è¯‘åçš„classæ–‡ä»¶åŠ è½½åˆ°JVMä¸­ã€‚åœ¨åŠ è½½é˜¶æ®µåˆå¯ä»¥ç»†åŒ–å‡ ä¸ªæ­¥éª¤ï¼šè£…è½½ã€è¿æ¥ã€åˆå§‹åŒ–</p><ul><li><p>è£…è½½</p><ul><li>ã€è£…è½½æ—¶æœºã€‘ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„ç±»éƒ½è£…è½½è‡³JVMï¼Œè€Œæ˜¯ç­‰åˆ°ã€Œæœ‰éœ€è¦ã€çš„æ—¶å€™æ‰è¿›è¡Œè£…è½½ï¼ˆæ¯”å¦‚newå’Œåå°„ç­‰ç­‰ï¼‰</li><li>ã€è£…è½½å‘ç”Ÿã€‘classæ–‡ä»¶æ˜¯é€šè¿‡ã€Œç±»åŠ è½½å™¨ã€è£…è½½åˆ°jvmä¸­çš„ï¼Œä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å‡ºç°å¤šä»½åŒæ ·çš„å­—èŠ‚ç ï¼Œä½¿ç”¨äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼ˆå®ƒä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼‰</li><li>ã€è£…è½½è§„åˆ™ã€‘JDK ä¸­çš„æœ¬åœ°æ–¹æ³•ç±»ä¸€èˆ¬ç”±æ ¹åŠ è½½å™¨ï¼ˆBootstrp loaderï¼‰è£…è½½ï¼ŒJDK ä¸­å†…éƒ¨å®ç°çš„æ‰©å±•ç±»ä¸€èˆ¬ç”±æ‰©å±•åŠ è½½å™¨ï¼ˆExtClassLoader ï¼‰å®ç°è£…è½½ï¼Œè€Œç¨‹åºä¸­çš„ç±»æ–‡ä»¶åˆ™ç”±ç³»ç»ŸåŠ è½½å™¨ï¼ˆAppClassLoader ï¼‰å®ç°è£…è½½ã€‚</li><li>è£…è½½è¿™ä¸ªé˜¶æ®µå®ƒåšçš„äº‹æƒ…å¯ä»¥æ€»ç»“ä¸ºï¼šæŸ¥æ‰¾å¹¶åŠ è½½ç±»çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œåœ¨JVMã€Œå †ã€ä¸­åˆ›å»ºä¸€ä¸ªjava.lang.Classç±»çš„å¯¹è±¡ï¼Œå¹¶å°†ç±»ç›¸å…³çš„ä¿¡æ¯å­˜å‚¨åœ¨JVMã€Œæ–¹æ³•åŒºã€ä¸­</li><li>é€šè¿‡ã€Œè£…è½½ã€è¿™ä¸ªæ­¥éª¤åï¼Œç°åœ¨å·²ç»æŠŠclassæ–‡ä»¶è£…è½½åˆ°JVMä¸­äº†ï¼Œå¹¶åˆ›å»ºå‡ºå¯¹åº”çš„Classå¯¹è±¡ä»¥åŠç±»ä¿¡æ¯å­˜å‚¨è‡³æ–¹æ³•åŒºäº†ã€‚</li></ul></li><li><p>è¿æ¥ï¼šå¯¹classçš„ä¿¡æ¯è¿›è¡ŒéªŒè¯ã€ä¸ºã€Œç±»å˜é‡ã€åˆ†é…å†…å­˜ç©ºé—´å¹¶å¯¹å…¶èµ‹é»˜è®¤å€¼ã€‚</p><ul><li>éªŒè¯ï¼šéªŒè¯ç±»æ˜¯å¦ç¬¦åˆ Java è§„èŒƒå’Œ JVM è§„èŒƒ</li><li>å‡†å¤‡ï¼šä¸ºç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œåˆå§‹åŒ–ä¸ºç³»ç»Ÿçš„åˆå§‹å€¼</li><li>è§£æï¼šå°†ç¬¦å·å¼•ç”¨è½¬ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</li><li>é€šè¿‡ã€Œè¿æ¥ã€è¿™ä¸ªæ­¥éª¤åï¼Œç°åœ¨å·²ç»å¯¹classä¿¡æ¯åšæ ¡éªŒå¹¶åˆ†é…äº†å†…å­˜ç©ºé—´å’Œé»˜è®¤å€¼</li></ul></li><li><p>åˆå§‹åŒ–ï¼šä¸ºç±»çš„é™æ€å˜é‡èµ‹äºˆæ­£ç¡®çš„åˆå§‹å€¼ã€‚è¿‡ç¨‹å¤§æ¦‚å°±æ˜¯æ”¶é›†classçš„é™æ€å˜é‡ã€é™æ€ä»£ç å—ã€é™æ€æ–¹æ³•è‡³()æ–¹æ³•ï¼Œéšåä»ä¸Šå¾€ä¸‹å¼€å§‹æ‰§è¡Œã€‚å¦‚æœã€Œå®ä¾‹åŒ–å¯¹è±¡ã€åˆ™ä¼šè°ƒç”¨æ–¹æ³•å¯¹å®ä¾‹å˜é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„æ„é€ æ–¹æ³•å†…çš„ä»£ç ã€‚åˆå§‹åŒ–å®Œæˆä¹‹åï¼Œå½“æˆ‘ä»¬å°è¯•æ‰§è¡Œä¸€ä¸ªç±»çš„æ–¹æ³•æ—¶ï¼Œä¼šæ‰¾åˆ°å¯¹åº”æ–¹æ³•çš„å­—èŠ‚ç çš„ä¿¡æ¯ï¼Œç„¶åè§£é‡Šå™¨ä¼šæŠŠå­—èŠ‚ç ä¿¡æ¯è§£é‡Šæˆç³»ç»Ÿèƒ½è¯†åˆ«çš„æŒ‡ä»¤ç ã€‚</p><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbOame2icwJQQ3T4kzKicxu9SBmevOSicQwP5JPH5K7RYdibxiaib4HiajfKKVyGc0J5hJSCWSOYEiaruicibnQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡"></p></li></ul></li><li><p>è§£é‡Šï¼šæŠŠå­—èŠ‚ç è½¬æ¢ä¸ºæ“ä½œç³»ç»Ÿè¯†åˆ«çš„æŒ‡ä»¤</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbOame2icwJQQ3T4kzKicxu9SK1jbxou3bCCxRQ1ZDNuVwibyv1Z9ndsdicJKEfI2Eo7ZYjYVxPRmqEyw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom:67%;" /><ul><li>åœ¨è§£é‡Šé˜¶æ®µä¼šæœ‰ä¸¤ç§æ–¹å¼æŠŠå­—èŠ‚ç ä¿¡æ¯è§£é‡Šæˆæœºå™¨æŒ‡ä»¤ç ï¼Œä¸€ä¸ªæ˜¯å­—èŠ‚ç è§£é‡Šå™¨ã€ä¸€ä¸ªæ˜¯å³æ—¶ç¼–è¯‘å™¨(JIT)ã€‚</li><li>JVMä¼šå¯¹ã€Œçƒ­ç‚¹ä»£ç ã€åšç¼–è¯‘ï¼Œéçƒ­ç‚¹ä»£ç ç›´æ¥è¿›è¡Œè§£é‡Šã€‚å½“JVMå‘ç°æŸä¸ªæ–¹æ³•æˆ–ä»£ç å—çš„è¿è¡Œç‰¹åˆ«é¢‘ç¹çš„æ—¶å€™ï¼Œå°±æœ‰å¯èƒ½æŠŠè¿™éƒ¨åˆ†ä»£ç è®¤å®šä¸ºã€Œçƒ­ç‚¹ä»£ç ã€</li><li>ä½¿ç”¨ã€Œçƒ­ç‚¹æ¢æµ‹ã€æ¥æ£€æµ‹æ˜¯å¦ä¸ºçƒ­ç‚¹ä»£ç ã€‚ã€Œçƒ­ç‚¹æ¢æµ‹ã€ä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼Œè®¡æ•°å™¨å’ŒæŠ½æ ·ã€‚HotSpotä½¿ç”¨çš„æ˜¯ã€Œè®¡æ•°å™¨ã€çš„æ–¹å¼è¿›è¡Œæ¢æµ‹ï¼Œä¸ºæ¯ä¸ªæ–¹æ³•å‡†å¤‡äº†ä¸¤ç±»è®¡æ•°å™¨ï¼šæ–¹æ³•è°ƒç”¨è®¡æ•°å™¨å’Œå›è¾¹è®¡æ•°å™¨</li><li>è¿™ä¸¤ä¸ªè®¡æ•°å™¨éƒ½æœ‰ä¸€ä¸ªç¡®å®šçš„é˜ˆå€¼ï¼Œå½“è®¡æ•°å™¨è¶…è¿‡é˜ˆå€¼æº¢å‡ºäº†ï¼Œå°±ä¼šè§¦å‘JITç¼–è¯‘ã€‚å³æ—¶ç¼–è¯‘å™¨æŠŠçƒ­ç‚¹æ–¹æ³•çš„æŒ‡ä»¤ç ä¿å­˜èµ·æ¥ï¼Œä¸‹æ¬¡æ‰§è¡Œçš„æ—¶å€™å°±æ— éœ€é‡å¤çš„è¿›è¡Œè§£é‡Šï¼Œç›´æ¥æ‰§è¡Œç¼“å­˜çš„æœºå™¨è¯­è¨€</li></ul></li><li><p>æ‰§è¡Œï¼šæ“ä½œç³»ç»ŸæŠŠè§£é‡Šå™¨è§£æå‡ºæ¥çš„æŒ‡ä»¤ç ï¼Œè°ƒç”¨ç³»ç»Ÿçš„ç¡¬ä»¶æ‰§è¡Œæœ€ç»ˆçš„ç¨‹åºæŒ‡ä»¤ã€‚</p></li></ol><p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKbOame2icwJQQ3T4kzKicxu9SdB2NN0BqiaWMKnVeITd5EIrFYrdzeBYWicv6GePLZaGtPVNwPCCZQQ7g/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡"></p><h2 id="åŒäº²å§”æ´¾æ¨¡å¼"><a href="#åŒäº²å§”æ´¾æ¨¡å¼" class="headerlink" title="åŒäº²å§”æ´¾æ¨¡å¼"></a>åŒäº²å§”æ´¾æ¨¡å¼</h2><p>classæ–‡ä»¶æ˜¯é€šè¿‡ã€Œç±»åŠ è½½å™¨ã€è£…è½½è‡³JVMä¸­çš„ã€‚ä¸ºäº†é˜²æ­¢å†…å­˜ä¸­å­˜åœ¨å¤šä»½åŒæ ·çš„å­—èŠ‚ç ï¼Œä½¿ç”¨äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼ˆå®ƒä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½ç±»ï¼Œè€Œæ˜¯æŠŠè¯·æ±‚å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨å»å®Œæˆï¼Œä¾æ¬¡å‘ä¸Šï¼‰</p><p>JDK ä¸­çš„æœ¬åœ°æ–¹æ³•ç±»ä¸€èˆ¬ç”±æ ¹åŠ è½½å™¨ï¼ˆBootstrp loaderï¼‰è£…è½½ï¼ŒJDK ä¸­å†…éƒ¨å®ç°çš„æ‰©å±•ç±»ä¸€èˆ¬ç”±æ‰©å±•åŠ è½½å™¨ï¼ˆExtClassLoader ï¼‰å®ç°è£…è½½ï¼Œè€Œç¨‹åºä¸­çš„ç±»æ–‡ä»¶åˆ™ç”±ç³»ç»ŸåŠ è½½å™¨ï¼ˆAppClassLoaderï¼‰å®ç°è£…è½½ã€‚</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKYexQU7CgibSMw73fSprowKUmaW11tqgereKoayUuRvweArpdRypXYtf6loflDBqCLq7VialCY3zr5Q/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 50%;" /><h3 id="å¦‚ä½•ç†è§£æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"><a href="#å¦‚ä½•ç†è§£æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="å¦‚ä½•ç†è§£æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶"></a>å¦‚ä½•ç†è§£æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶</h3><p>â‘ ï¼šå¾ˆå¥½ç†è§£å•Šï¼Œæ„æ€å°±æ˜¯ï¼šåªè¦åŠ è½½ç±»çš„æ—¶å€™ï¼Œä¸æ˜¯æŒ‰ç…§ <code>APPClassLoader-&gt;Ext ClassLoader-&gt;BootStrap ClassLoader</code> è¿™ä¸ªé¡ºåºæ‰¾ï¼Œé‚£å°±ç®—æ˜¯æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ã€‚</p><p>â‘¡ï¼šå› ä¸ºåŠ è½½classæ ¸å¿ƒçš„æ–¹æ³•åœ¨LoaderClassç±»çš„ <code>loadClass() </code>æ–¹æ³•ä¸Šï¼ˆåŒäº²å§”æ´¾æœºåˆ¶çš„æ ¸å¿ƒå®ç°ï¼‰ã€‚é‚£åªè¦æˆ‘è‡ªå®šä¹‰ä¸ªClassLoaderï¼Œé‡å†™loadClassæ–¹æ³•ï¼ˆä¸ä¾ç…§å¾€ä¸Šå¼€å§‹å¯»æ‰¾ç±»åŠ è½½å™¨ï¼‰ï¼Œé‚£å°±ç®—æ˜¯æ‰“ç ´åŒäº²å§”æ´¾æœºåˆ¶äº†ã€‚</p><h3 id="ç ´ååŒäº²å§”æ´¾æœºåˆ¶åœºæ™¯"><a href="#ç ´ååŒäº²å§”æ´¾æœºåˆ¶åœºæ™¯" class="headerlink" title="ç ´ååŒäº²å§”æ´¾æœºåˆ¶åœºæ™¯"></a>ç ´ååŒäº²å§”æ´¾æœºåˆ¶åœºæ™¯</h3><h4 id="1-Tomcat"><a href="#1-Tomcat" class="headerlink" title="1.Tomcat"></a>1.Tomcat</h4><p>â‘ ï¼šåœ¨åˆå­¦æ—¶éƒ¨ç½²é¡¹ç›®ï¼Œæˆ‘ä»¬æ˜¯æŠŠ war åŒ…æ”¾åˆ° Tomcat çš„ webappä¸‹ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ª tomcat å¯ä»¥è¿è¡Œå¤šä¸ª Webåº”ç”¨ç¨‹åºã€‚é‚£å‡è®¾æˆ‘ç°åœ¨æœ‰ä¸¤ä¸ªWebåº”ç”¨ç¨‹åºï¼Œå®ƒä»¬éƒ½æœ‰ä¸€ä¸ªç±»ï¼Œå«åšUserï¼Œå¹¶ä¸”å®ƒä»¬çš„ç±»å…¨é™å®šåéƒ½ä¸€æ ·ï¼Œæ¯”å¦‚éƒ½æ˜¯com.soul.Userã€‚ä½†æ˜¯ä»–ä»¬çš„å…·ä½“å®ç°æ˜¯ä¸ä¸€æ ·çš„ã€‚é‚£ä¹ˆTomcatæ˜¯å¦‚ä½•ä¿è¯å®ƒä»¬æ˜¯ä¸ä¼šå†²çªçš„å‘¢ï¼ŸTomcat ç»™æ¯ä¸ª Web åº”ç”¨åˆ›å»ºä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹<b>ï¼ˆWebAppClassLoaderï¼‰</b>&gt;ï¼Œè¯¥åŠ è½½å™¨é‡å†™äº† <code>loadClass()</code> æ–¹æ³•ï¼Œä¼˜å…ˆåŠ è½½å½“å‰åº”ç”¨ç›®å½•ä¸‹çš„ç±»ï¼Œå¦‚æœå½“å‰æ‰¾ä¸åˆ°äº†ï¼Œæ‰ä¸€å±‚ä¸€å±‚å¾€ä¸Šæ‰¾ï¼Œè¿™æ ·å°±åšåˆ°äº†Webåº”ç”¨å±‚çº§çš„éš”ç¦»</p><p>â‘¡ï¼šTomcat å…¶ä»–ç±»åŠ è½½å™¨</p><ol><li><p>é¦–å…ˆå¹¶ä¸æ˜¯Webåº”ç”¨ç¨‹åºä¸‹çš„æ‰€æœ‰ä¾èµ–éƒ½éœ€è¦éš”ç¦»çš„ï¼Œæ¯”å¦‚Rediså°±å¯ä»¥Webåº”ç”¨ç¨‹åºä¹‹é—´å…±äº«ï¼ˆå¦‚æœæœ‰éœ€è¦çš„è¯ï¼‰ï¼Œå› ä¸ºå¦‚æœç‰ˆæœ¬ç›¸åŒï¼Œæ²¡å¿…è¦æ¯ä¸ªWebåº”ç”¨ç¨‹åºéƒ½ç‹¬è‡ªåŠ è½½ä¸€ä»½ã€‚åšæ³•ä¹Ÿå¾ˆç®€å•ï¼ŒTomcatå°±åœ¨ <code>WebAppClassLoader</code> ä¸ŠåŠ äº†ä¸ª çˆ¶ç±»åŠ è½½å™¨<b>ï¼ˆSharedClassLoaderï¼‰</b>ï¼Œå¦‚æœ <code>WebAppClassLoader</code> è‡ªèº«æ²¡æœ‰åŠ è½½åˆ°æŸä¸ªç±»ï¼Œé‚£å°±å§”æ‰˜ <code>SharedClassLoader</code> å»åŠ è½½ã€‚ï¼ˆæ— éå°±æ˜¯æŠŠéœ€è¦åº”ç”¨ç¨‹åºä¹‹é—´éœ€è¦å…±äº«çš„ç±»æ”¾åˆ°ä¸€ä¸ªå…±äº«ç›®å½•ä¸‹å˜›ï¼‰</p></li><li><p>ä¸ºäº†éš”ç»Webåº”ç”¨ç¨‹åºä¸Tomcatæœ¬èº«çš„ç±»ï¼Œåˆæœ‰ç±»åŠ è½½å™¨ <b>(CatalinaClassLoader)Â </b>æ¥è£…è½½Tomcatæœ¬èº«çš„ä¾èµ–</p></li><li><p>å¦‚æœTomcatæœ¬èº«çš„ä¾èµ–å’ŒWebåº”ç”¨è¿˜éœ€è¦å…±äº«ï¼Œé‚£ä¹ˆè¿˜æœ‰ç±»åŠ è½½å™¨ <b>(CommonClassLoader)Â </b>æ¥è£…è½½è¿›è€Œè¾¾åˆ°å…±äº«</p></li></ol><p>å„ä¸ªç±»åŠ è½½å™¨çš„åŠ è½½ç›®å½•å¯ä»¥åˆ° Tomcat çš„ <code>catalina.properties</code> é…ç½®æ–‡ä»¶ä¸ŠæŸ¥çœ‹</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKYexQU7CgibSMw73fSprowKUmPt3awtOIESGe0zYKThJx7hia0qUGqMClVOXahMNepiczaHYT7iaTwWhw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 80%;" /><h4 id="2-JDBC"><a href="#2-JDBC" class="headerlink" title="2.JDBC"></a>2.JDBC</h4><p>â‘ ï¼šJDBCå®šä¹‰äº†æ¥å£ï¼Œå…·ä½“å®ç°ç±»ç”±å„ä¸ªå‚å•†è¿›è¡Œå®ç°å˜›(æ¯”å¦‚MySQL)</p><p>â‘¡ï¼šç±»åŠ è½½æœ‰ä¸ªè§„åˆ™ï¼šå¦‚æœä¸€ä¸ªç±»ç”±ç±»åŠ è½½å™¨AåŠ è½½ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„ä¾èµ–ç±»ä¹Ÿæ˜¯ç”±ã€Œç›¸åŒçš„ç±»åŠ è½½å™¨ã€åŠ è½½ã€‚</p><p>â‘¢ï¼šæˆ‘ä»¬ç”¨JDBCçš„æ—¶å€™ï¼Œæ˜¯ä½¿ç”¨ <code>DriverManager</code> è¿›è€Œè·å–è¿æ¥ï¼Œ<code>DriverManager</code> åœ¨ <code>java.sql</code> åŒ…ä¸‹ï¼Œæ˜¾ç„¶æ˜¯ç”± <code>BootStrap</code> ç±»åŠ è½½å™¨è¿›è¡Œè£…è½½ã€‚æ‰€ä»¥å½“æˆ‘ä»¬ä½¿ç”¨<code>DriverManager.getConnection()</code>æ—¶ï¼Œå¾—åˆ°çš„ä¸€å®šæ˜¯å‚å•†å®ç°çš„ç±»ã€‚ä½†æ˜¯ <code>BootStrap ClassLoader</code> åŠ è½½ä¸åˆ°å„ä¸ªå‚å•†å®ç°çš„ç±»ï¼Œå› ä¸ºè¿™äº›å®ç°ç±»å¹¶ä¸åœ¨javaåŒ…ä¸­ã€‚</p><p>â‘£ï¼šè§£å†³æ–¹æ¡ˆå°±æ˜¯ï¼Œåœ¨ <code>DriverManager</code> åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå¾—åˆ°ã€Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€</p><p>â‘¤ï¼šè¿™æ ·å»è·å– <code>Connection</code> çš„æ—¶å€™ï¼Œæ˜¯ä½¿ç”¨ã€Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€å»åŠ è½½çš„ï¼Œè€Œè¿™é‡Œçš„çº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨å®é™…ä¸Šæ˜¯<code>App ClassLoader</code>ã€‚æ‰€ä»¥åœ¨è·å–è¿æ¥çš„æ—¶å€™ï¼Œè¿˜æ˜¯å…ˆæ‰¾ <code>Ext ClassLoader</code> å’Œ <code>BootStrap ClassLoader</code> ï¼Œåªä¸è¿‡è¿™ä¿©åŠ è½½å™¨è‚¯å®šæ˜¯åŠ è½½ä¸åˆ°çš„ï¼Œæœ€ç»ˆä¼šç”± <code>App ClassLoader</code> è¿›è¡ŒåŠ è½½</p><p>â‘¥ï¼šé‚£è¿™ç§æƒ…å†µï¼Œæœ‰çš„äººè§‰å¾—ç ´åäº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå› ä¸ºæœ¬æ¥æ˜æ˜åº”è¯¥æ˜¯ç”±<code>BootStrap ClassLoader</code>è¿›è¡ŒåŠ è½½çš„ï¼Œç»“æœä½ æ¥äº†ä¸€æ‰‹ã€Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€ï¼Œæ”¹æ‰äº†ã€Œç±»åŠ è½½å™¨ã€ã€‚æœ‰çš„äººè§‰å¾—æ²¡ç ´ååŒäº²å§”æ´¾æœºåˆ¶ï¼Œåªæ˜¯æ”¹æˆç”±ã€Œçº¿ç¨‹ä¸Šä¸‹æ–‡åŠ è½½å™¨ã€è¿›è¡Œç±»åŠ è½½ï¼Œä½†è¿˜æ˜¯éµå®ˆç€ï¼šã€Œä¾æ¬¡å¾€ä¸Šæ‰¾çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œéƒ½æ‰¾ä¸åˆ°æ—¶æ‰ç”±è‡ªèº«åŠ è½½ã€ã€‚è®¤ä¸ºâ€åŸåˆ™â€ä¸Šæ˜¯æ²¡å˜çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5M</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
    <category term="å…«è‚¡æ–‡" scheme="http://example.com/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>å››ç§å¼•ç”¨</title>
    <link href="http://example.com/2022/02/28/%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8/"/>
    <id>http://example.com/2022/02/28/%E5%9B%9B%E7%A7%8D%E5%BC%95%E7%94%A8/</id>
    <published>2022-02-28T08:04:20.000Z</published>
    <updated>2022-05-31T00:23:58.045Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å¼•ç”¨ï¼ˆReferenceç±»ï¼‰"><a href="#å¼•ç”¨ï¼ˆReferenceç±»ï¼‰" class="headerlink" title="å¼•ç”¨ï¼ˆReferenceç±»ï¼‰"></a>å¼•ç”¨ï¼ˆReferenceç±»ï¼‰</h2><ul><li>å…ˆåœ¨è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰ã€å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰ã€å¹»è±¡å¼•ç”¨ï¼ˆPhantomReferenceï¼‰éƒ½æ˜¯java.lang.ref.Referenceçš„å­ç±»ï¼Œè¿™ä¸ªReferenceç±»ä¸»è¦æœ‰4ä¸ªæ–¹æ³•<ul><li>void clean(); æ¸…é™¤æ­¤å‚è€ƒå¯¹è±¡ã€‚ï¼ˆæ­¤æ–¹æ³•ä»…ç”±Javaä»£ç è°ƒç”¨; å½“åƒåœ¾æ”¶é›†å™¨æ¸…é™¤å¼•ç”¨æ—¶ï¼Œå®ƒç›´æ¥æ‰§è¡Œï¼Œè€Œä¸è°ƒç”¨æ­¤æ–¹æ³•ã€‚ï¼‰</li><li>boolean enqueue(); å°†æ­¤å¼•ç”¨å¯¹è±¡æ·»åŠ åˆ°å…¶æ³¨å†Œçš„é˜Ÿåˆ—ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚</li><li>T get(); è¿”å›æ­¤å¼•ç”¨å¯¹è±¡çš„æŒ‡ç¤ºã€‚(é€šè¿‡è¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›Referenceæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼Œå¯ä»¥é‡æ–°å˜æˆå¼ºå¼•ç”¨) ä¾‹å¦‚ï¼šè½¯å¼•ç”¨å¼•ç”¨çš„ä¸€ä¸ªå¯¹è±¡</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyObject</span> <span class="variable">aRef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyObject</span>();</span><br><span class="line">SoftReference aSoftRef=<span class="keyword">new</span> <span class="title class_">SoftReference</span>(aRef);</span><br><span class="line">aRef = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">//ç°åœ¨åªæœ‰ä¸€ä¸ªè½¯å¼•ç”¨æŒ‡å‘MyObjectçš„è¿™ä¸ªå¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="comment">//å¦‚æœè¿™ä¸ªå¯¹è±¡è¿˜æ²¡æœ‰è¢«å›æ”¶ï¼Œå¯ä»¥æŠŠä»–å†æ¬¡å˜ä¸ºå¼ºå¼•ç”¨</span></span><br><span class="line"><span class="keyword">if</span>(aSoftRef.get() != <span class="literal">null</span>)</span><br><span class="line">  <span class="type">MyObject</span> <span class="variable">bRef</span> <span class="operator">=</span> aSoftRef.get();</span><br><span class="line"><span class="comment">//è¿™ä¸ªæ—¶å€™MyObjectè¿™ä¸ªå¯¹è±¡åˆå˜æˆå¼ºå¼•ç”¨</span></span><br><span class="line">å¤åˆ¶ä»£ç </span><br></pre></td></tr></table></figure><ul><li>boolean isEnqueued();é€šè¿‡ç¨‹åºæˆ–åƒåœ¾æ”¶é›†å™¨æ¥å‘ŠçŸ¥è¿™ä¸ªå¼•ç”¨å¯¹è±¡æ˜¯å¦å·²ç»å…¥é˜Ÿ;</li><li>å…¶ä¸­enqueue å’Œ isEnqueued è¿™ä¸¤ä¸ªæ–¹æ³•æ¶‰åŠåˆ°å¼•ç”¨é˜Ÿåˆ—ã€‚</li></ul><h2 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h2><ul><li>å¼ºå¼•ç”¨ï¼šå½¢å¦‚ <code>Object object = new Object()</code> ï¼›è¿™æ ·å°±æ˜¯å…¸å‹çš„å¼ºå¼•ç”¨ï¼Œè¢«å¼ºå¼•ç”¨å¼•ç”¨çš„å¯¹è±¡ä¸ä¼šè¢«åƒåœ¾æ”¶é›†å™¨ä¸»åŠ¨å›æ”¶ï¼ŒJVMå®æ„¿æŠ›å‡º <code>OutOfMemoryError</code> è¿è¡Œæ—¶é”™è¯¯ï¼ˆOOMï¼‰ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„â€œå­˜æ´»â€å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³çš„é—®é¢˜ã€‚å¯¹äºä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–çš„å¼•ç”¨å…³ç³»ï¼Œåªè¦è¶…è¿‡äº†å¼•ç”¨çš„ä½œç”¨åŸŸæˆ–è€…æ˜¾å¼åœ°å°†ç›¸åº”å¼ºå¼•ç”¨èµ‹å€¼ä¸º nullï¼Œè¿™ä¸ªè¢«å¼•ç”¨çš„å¯¹è±¡å°±æ˜¯å¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„(å…·ä½“å›æ”¶æ—¶æœºè¿˜æ˜¯è¦çœ‹åƒåœ¾æ”¶é›†ç­–ç•¥)ã€‚</li></ul><h2 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h2><ul><li><p>è½¯å¼•ç”¨é€šè¿‡ <code>SoftReference</code> ç±»å®ç°ã€‚è½¯å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”å¼ºå¼•ç”¨çŸ­ä¸€äº›ã€‚åªæœ‰å½“ JVM è®¤ä¸ºå†…å­˜ä¸è¶³æ—¶ï¼Œæ‰ä¼šå»è¯•å›¾å›æ”¶è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼šå³JVM ä¼šç¡®ä¿åœ¨æŠ›å‡º <code>OutOfMemoryError</code> ä¹‹å‰ï¼Œæ¸…ç†è½¯å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ã€‚è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨ï¼ˆæ³¨æ„æ˜¯å¼•ç”¨æœ¬èº«è¿™ä¸ªå¯¹è±¡åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚åç»­ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ReferenceQueueçš„ <code>poll()</code> æ–¹æ³•æ¥æ£€æŸ¥æ˜¯å¦æœ‰å®ƒæ‰€å…³å¿ƒçš„å¯¹è±¡è¢«å›æ”¶ï¼ˆå› ä¸ºåœ¨è¿™ä¸ªé˜Ÿåˆ—é‡Œé¢çš„å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡éƒ½è¢«å›æ”¶äº†ï¼‰ã€‚å¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œå°†è¿”å›ä¸€ä¸ªnullï¼Œå¦åˆ™è¯¥æ–¹æ³•è¿”å›é˜Ÿåˆ—ä¸­å‰é¢çš„ä¸€ä¸ªReferenceå¯¹è±¡ã€‚</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šè½¯å¼•ç”¨é€šå¸¸ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚å¦‚æœè¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œå°±å¯ä»¥æš‚æ—¶ä¿ç•™ç¼“å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶æ¸…ç†æ‰ï¼Œè¿™æ ·å°±ä¿è¯äº†ä½¿ç”¨ç¼“å­˜çš„åŒæ—¶ï¼Œä¸ä¼šè€—å°½å†…å­˜ã€‚</p></li></ul><h2 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h2><ul><li><p>å¼±å¼•ç”¨é€šè¿‡ <code>WeakReference</code> ç±»å®ç°ã€‚ å¼±å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”è½¯å¼•ç”¨çŸ­ã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†å…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚ç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œå› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å›æ”¶å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ï¼ˆå’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨åŒä¸Šé¢çš„è½¯å¼•ç”¨ï¼‰ã€‚</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šå¼±åº”ç”¨åŒæ ·å¯ç”¨äºå†…å­˜æ•æ„Ÿçš„ç¼“å­˜ã€‚</p></li></ul><h2 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h2><ul><li><p>è™šå¼•ç”¨ä¹Ÿå«å¹»è±¡å¼•ç”¨ï¼Œé€šè¿‡ <code>PhantomReference</code> ç±»æ¥å®ç°ã€‚æ— æ³•é€šè¿‡è™šå¼•ç”¨è®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§æˆ–å‡½æ•°ã€‚è™šå¼•ç”¨ä»…ä»…æ˜¯æä¾›äº†ä¸€ç§ç¡®ä¿å¯¹è±¡è¢« finalize ä»¥åï¼ŒåšæŸäº›äº‹æƒ…çš„æœºåˆ¶ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ã€‚è™šå¼•ç”¨<b>å¿…é¡»</b>å’Œå¼•ç”¨é˜Ÿåˆ— ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰æˆ–è€…å·²ç»å›æ”¶ä¹‹åï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚å¦‚æœç¨‹åºå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–ä¸€äº›ç¨‹åºè¡ŒåŠ¨ï¼ˆå’Œå¼•ç”¨é˜Ÿåˆ—ä¸€èµ·ä½¿ç”¨åŒä¸Šé¢è½¯å¼•ç”¨è·Ÿå¼±å¼•ç”¨ï¼‰ã€‚</p></li><li><p>åº”ç”¨åœºæ™¯ï¼šå¯ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶çš„æ´»åŠ¨ï¼Œå½“ä¸€ä¸ªè™šå¼•ç”¨å…³è”çš„å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹‹å‰ä¼šæ”¶åˆ°ä¸€æ¡ç³»ç»Ÿé€šçŸ¥</p></li></ul><h2 id="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"><a href="#å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰" class="headerlink" title="å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰"></a>å¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰</h2><ul><li><code>Reference</code> å¯¹è±¡å·²ç»ä¸å†å…·æœ‰å­˜åœ¨çš„ä»·å€¼ï¼Œéœ€è¦ä¸€ä¸ªé€‚å½“çš„æ¸…é™¤æœºåˆ¶ï¼Œé¿å…å¤§é‡SoftReferenceå¯¹è±¡å¸¦æ¥çš„å†…å­˜æ³„æ¼ã€‚åœ¨java.lang.refåŒ…é‡Œè¿˜æä¾›äº† <code>ReferenceQueue</code>ã€‚</li><li>å‰é¢è¯´åˆ°åœ¨ä½¿ç”¨è½¯å¼•ç”¨ã€è™šå¼•ç”¨ã€å¹»è±¡å¼•ç”¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼Œåœ¨å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶åå¼•ç”¨æœ¬èº«å°±ä¼šè¿›å…¥å¼•ç”¨é˜Ÿåˆ—ã€‚<ul><li>ä½¿ç”¨ä¾‹å­å¦‚ä¸‹</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line"><span class="type">SoftReference</span> <span class="variable">ref</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SoftReference</span>(aMyObject,queue);</span><br></pre></td></tr></table></figure><ul><li>é€šè¿‡å¼•ç”¨é˜Ÿåˆ—å¯ä»¥çœ‹åˆ°å“ªäº›Referenceå¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡å·²ç»è¢«å›æ”¶ï¼Œå½“è°ƒç”¨å¼•ç”¨é˜Ÿåˆ—çš„ <code>poll()</code> æ–¹æ³•å°±å¯ä»¥è¿”å›é™¤é˜Ÿåˆ—ä¸­çš„å¤±å»æ‰€å¼•ç”¨å¯¹è±¡çš„Referenceå¯¹è±¡</li><li>åˆ©ç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å“ªä¸ªSoftReferenceæ‰€è½¯å¼•ç”¨çš„å¯¹è±¡å·²ç»è¢«å›æ”¶ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠè¿™äº›å¤±å»æ‰€è½¯å¼•ç”¨çš„å¯¹è±¡çš„SoftReferenceå¯¹è±¡æ¸…é™¤æ‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SoftReference</span> <span class="variable">ref</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">while</span> ((ref = (EmployeeRef) q.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line"><span class="comment">// æ¸…é™¤ref</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ‘˜è‡ª"><a href="#æ‘˜è‡ª" class="headerlink" title="æ‘˜è‡ª"></a>æ‘˜è‡ª</h2><p><a href="https://juejin.cn/post/6844903728500178952">javaçš„å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€å¹»è±¡å¼•ç”¨ï¼Œå¼•ç”¨é˜Ÿåˆ—æ€»ç»“</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å¼•ç”¨ï¼ˆReferenceç±»ï¼‰&quot;&gt;&lt;a href=&quot;#å¼•ç”¨ï¼ˆReferenceç±»ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;å¼•ç”¨ï¼ˆReferenceç±»ï¼‰&quot;&gt;&lt;/a&gt;å¼•ç”¨ï¼ˆReferenceç±»ï¼‰&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;å…ˆåœ¨è¿™é‡Œè¯´ä¸€ä¸‹ï¼Œè½¯å¼•ç”¨ï¼ˆSoft</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
  </entry>
  
  <entry>
    <title>Jvm è°ƒä¼˜å…«è‚¡æ–‡</title>
    <link href="http://example.com/2022/02/11/Jvm-%E8%B0%83%E4%BC%98%E5%85%AB%E8%82%A1%E6%96%87/"/>
    <id>http://example.com/2022/02/11/Jvm-%E8%B0%83%E4%BC%98%E5%85%AB%E8%82%A1%E6%96%87/</id>
    <published>2022-02-11T11:23:34.000Z</published>
    <updated>2022-05-31T08:54:45.158Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><p>æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ<a href="https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5Mg==&mid=2247485647&idx=1&sn=65c82c1e3bf4bd9bf926d14dfd3e06fb&scene=21#wechat_redirect">ã€Šå¯¹çº¿é¢è¯•å®˜ã€‹JVMè°ƒä¼˜</a>ï¼Œæ–¹ä¾¿æŸ¥é˜…è®°å¿†æ•´ç†å‡ºæ¥çš„ã€‚</p><h2 id="JVMè°ƒä¼˜"><a href="#JVMè°ƒä¼˜" class="headerlink" title="JVMè°ƒä¼˜"></a>JVMè°ƒä¼˜</h2><p>JVMè°ƒä¼˜æŒ‡æ ‡ï¼šã€ååé‡ã€ã€ã€åœé¡¿æ—¶é—´ã€å’Œã€åƒåœ¾å›æ”¶é¢‘ç‡ã€ã€‚åŸºäºè¿™äº›æŒ‡æ ‡ï¼Œå°±æœ‰å¯èƒ½éœ€è¦è°ƒæ•´ï¼š</p><ol><li><p>å†…å­˜åŒºåŸŸå¤§å°ä»¥åŠç›¸å…³ç­–ç•¥ï¼ˆæ¯”å¦‚æ•´å—å †å†…å­˜å å¤šå°‘ã€æ–°ç”Ÿä»£å å¤šå°‘ã€è€å¹´ä»£å å¤šå°‘ã€Survivorå å¤šå°‘ã€æ™‹å‡è€å¹´ä»£çš„æ¡ä»¶ç­‰ç­‰ï¼‰ï¼Œæ¯”å¦‚ï¼ˆ<code>-Xmx</code>ï¼šè®¾ç½®å †çš„æœ€å¤§å€¼ã€<code>-Xms</code>ï¼šè®¾ç½®å †çš„åˆå§‹å€¼ã€<code>-Xmn</code>ï¼šè¡¨ç¤ºå¹´è½»ä»£çš„å¤§å°ã€-XX:SurvivorRatioï¼šä¼Šç”¸åŒºå’Œå¹¸å­˜åŒºçš„æ¯”ä¾‹ç­‰ç­‰ï¼‰ï¼ŒæŒ‰ç»éªŒæ¥è¯´ï¼šIOå¯†é›†å‹çš„å¯ä»¥ç¨å¾®æŠŠã€Œå¹´è½»ä»£ã€ç©ºé—´åŠ å¤§äº›ï¼Œå› ä¸ºå¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯åœ¨å¹´è½»ä»£å°±ä¼šç­äº¡ã€‚å†…å­˜è®¡ç®—å¯†é›†å‹çš„å¯ä»¥ç¨å¾®æŠŠã€Œè€å¹´ä»£ã€ç©ºé—´åŠ å¤§äº›ï¼Œå¯¹è±¡å­˜æ´»æ—¶é—´ä¼šæ›´é•¿äº›ï¼‰</p></li><li><p>åƒåœ¾å›æ”¶å™¨ï¼ˆé€‰æ‹©åˆé€‚çš„åƒåœ¾å›æ”¶å™¨ï¼Œä»¥åŠå„ä¸ªåƒåœ¾å›æ”¶å™¨çš„å„ç§è°ƒä¼˜å‚æ•°ï¼‰ï¼Œæ¯”å¦‚ï¼ˆ<code>-XX:+UseG1GC</code>ï¼šæŒ‡å®š JVM ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨ä¸º G1ã€<code>-XX:MaxGCPauseMillis</code>ï¼šè®¾ç½®ç›®æ ‡åœé¡¿æ—¶é—´ã€<code>-XX:InitiatingHeapOccupancyPercent</code>ï¼šå½“æ•´ä¸ªå †å†…å­˜ä½¿ç”¨è¾¾åˆ°ä¸€å®šæ¯”ä¾‹ï¼Œå…¨å±€å¹¶å‘æ ‡è®°é˜¶æ®µ å°±ä¼šè¢«å¯åŠ¨ç­‰ç­‰ï¼‰ï¼Œè¿™äº›éƒ½æ˜¯å› åœ°åˆ¶å®œï¼Œå…·ä½“é—®é¢˜å…·ä½“åˆ†æã€‚åœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼ŒJVM å·²ç»èƒ½å¤Ÿè¾¾åˆ°ã€Œå¼€ç®±å³ç”¨ã€</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKYzo9uu6cXtN7SVaZKBS66YCS9zG7gicGZYwhkyDl2BCjpibSibMiahh6ibOIn5iclCibNDwfIL3c6alLibVA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 67%;" /></li></ol><h2 id="JVM-è°ƒä¼˜å·¥å…·"><a href="#JVM-è°ƒä¼˜å·¥å…·" class="headerlink" title="JVM è°ƒä¼˜å·¥å…·"></a>JVM è°ƒä¼˜å·¥å…·</h2><ol><li><p>é€šè¿‡ <code>jps</code> å‘½ä»¤æŸ¥çœ‹Javaè¿›ç¨‹ã€ŒåŸºç¡€ã€ä¿¡æ¯ï¼ˆè¿›ç¨‹å·ã€ä¸»ç±»ï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨çš„å°±æ˜¯ç”¨æ¥çœ‹å½“å‰æœåŠ¡å™¨æœ‰å¤šå°‘Javaè¿›ç¨‹åœ¨è¿è¡Œï¼Œå®ƒä»¬çš„è¿›ç¨‹å·å’ŒåŠ è½½ä¸»ç±»æ˜¯å•¥</p></li><li><p>é€šè¿‡ <code>jstat</code> å‘½ä»¤æŸ¥çœ‹Javaè¿›ç¨‹ã€Œç»Ÿè®¡ç±»ã€ç›¸å…³çš„ä¿¡æ¯ï¼ˆç±»åŠ è½½ã€ç¼–è¯‘ç›¸å…³ä¿¡æ¯ç»Ÿè®¡ï¼Œå„ä¸ªå†…å­˜åŒºåŸŸGCæ¦‚å†µå’Œç»Ÿè®¡ï¼‰ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨äºçœ‹GCçš„æƒ…å†µ</p></li><li><p>é€šè¿‡ <code>jinfo</code> å‘½ä»¤æ¥æŸ¥çœ‹å’Œè°ƒæ•´Javaè¿›ç¨‹çš„ã€Œè¿è¡Œå‚æ•°ã€ã€‚</p></li><li><p>é€šè¿‡ <code>jmap</code> å‘½ä»¤æ¥æŸ¥çœ‹Javaè¿›ç¨‹çš„ã€Œå†…å­˜ä¿¡æ¯ã€ã€‚è¿™ä¸ªå‘½ä»¤å¾ˆå¸¸ç”¨äºæŠŠJVMå†…å­˜ä¿¡æ¯dumpåˆ°æ–‡ä»¶ï¼Œç„¶åå†ç”¨MAT( Memory Analyzer tool å†…å­˜è§£æå·¥å…·)æŠŠæ–‡ä»¶è¿›è¡Œåˆ†æ</p></li><li><p>é€šè¿‡ <code>jstack</code> å‘½ä»¤æ¥æŸ¥çœ‹JVMã€Œçº¿ç¨‹ä¿¡æ¯ã€ã€‚è¿™ä¸ªå‘½ä»¤ç”¨å¸¸ç”¨è¯­æ’æŸ¥æ­»é”ç›¸å…³çš„é—®é¢˜</p></li><li><p>è¿˜æœ‰è¿‘æœŸæ¯”è¾ƒçƒ­é—¨çš„ Arthasï¼ˆé˜¿é‡Œå¼€æºçš„è¯Šæ–­å·¥å…·ï¼‰ï¼Œæ¶µç›–äº†ä¸Šé¢å¾ˆå¤šå‘½ä»¤çš„åŠŸèƒ½ä¸”è‡ªå¸¦å›¾å½¢åŒ–ç•Œé¢ã€‚è¿™ä¹Ÿæ˜¯æˆ‘è¿™è¾¹å¸¸ç”¨çš„æ’æŸ¥å’Œåˆ†æå·¥å…·</p><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKYzo9uu6cXtN7SVaZKBS66YzxPCkwNP5tPPl4stotywsZ2f8GiaSrRxn0vejopVzPVE5nibO7hy2b3w/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom:80%;" /></li></ol><h2 id="JITä¼˜åŒ–æŠ€æœ¯"><a href="#JITä¼˜åŒ–æŠ€æœ¯" class="headerlink" title="JITä¼˜åŒ–æŠ€æœ¯"></a>JITä¼˜åŒ–æŠ€æœ¯</h2><p>JITä¼˜åŒ–æŠ€æœ¯æ¯”è¾ƒå‡ºåçš„æœ‰ä¸¤ç§ï¼šæ–¹æ³•å†…è”å’Œé€ƒé€¸åˆ†æ</p><ol><li><p>æ–¹æ³•å†…è”</p><ol><li>æ‰€è°“æ–¹æ³•å†…è”å°±æ˜¯æŠŠã€Œç›®æ ‡æ–¹æ³•ã€çš„ä»£ç å¤åˆ¶åˆ°ã€Œè°ƒç”¨çš„æ–¹æ³•ã€ä¸­ï¼Œé¿å…å‘ç”ŸçœŸå®çš„æ–¹æ³•è°ƒç”¨</li><li>å› ä¸ºæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šç”Ÿæˆæ ˆå¸§ï¼ˆå‹æ ˆå‡ºæ ˆè®°å½•æ–¹æ³•è°ƒç”¨ä½ç½®ç­‰ç­‰ï¼‰ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œæ‰€ä»¥ã€Œæ–¹æ³•å†…è”ã€çš„ä¼˜åŒ–å¯ä»¥æé«˜ä¸€å®šçš„æ€§èƒ½</li><li>åœ¨JVMä¸­ä¹Ÿæœ‰ç›¸å…³çš„å‚æ•°ç»™äºˆæˆ‘ä»¬æŒ‡å®šï¼ˆ-XX:MaxFreqInlineSizeã€-XX:MaxInlineSizeï¼‰</li></ol></li><li><p>é€ƒé€¸åˆ†æ</p><p>ã€Œé€ƒé€¸åˆ†æã€åˆ™æ˜¯åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦è¢«å¤–éƒ¨æ–¹æ³•å¼•ç”¨æˆ–å¤–éƒ¨çº¿ç¨‹è®¿é—®çš„åˆ†ææŠ€æœ¯ï¼Œå¦‚æœã€Œæ²¡æœ‰è¢«å¼•ç”¨ã€ï¼Œå°±å¯ä»¥å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚è¯´ï¼š</p><ol><li>é”æ¶ˆé™¤ï¼ˆåŒæ­¥å¿½ç•¥ï¼‰ï¼šè¯¥å¯¹è±¡åªåœ¨æ–¹æ³•å†…éƒ¨è¢«è®¿é—®ï¼Œä¸ä¼šè¢«åˆ«çš„åœ°æ–¹å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æŠŠé”ç›¸å…³çš„ä»£ç ç»™å¿½ç•¥æ‰</li><li>æ ˆä¸Šåˆ†é…ï¼šè¯¥å¯¹è±¡åªä¼šåœ¨æ–¹æ³•å†…éƒ¨è¢«è®¿é—®ï¼Œç›´æ¥å°†å¯¹è±¡åˆ†é…åœ¨ã€Œæ ˆã€ä¸­ï¼ˆJavaé»˜è®¤æ˜¯å°†å¯¹è±¡åˆ†é…åœ¨ã€Œå †ã€ä¸­ï¼Œæ˜¯éœ€è¦é€šè¿‡JVMåƒåœ¾å›æ”¶æœŸè¿›è¡Œå›æ”¶ï¼Œéœ€è¦æŸè€—ä¸€å®šçš„æ€§èƒ½ï¼Œè€Œæ ˆå†…åˆ†é…åˆ™å¿«å¾ˆå¤šï¼‰</li><li>æ ‡é‡æ›¿æ¢&#x2F;åˆ†ç¦»å¯¹è±¡ï¼šå½“ç¨‹åºçœŸæ­£æ‰§è¡Œçš„æ—¶å€™å¯ä»¥ä¸åˆ›å»ºè¿™ä¸ªå¯¹è±¡ï¼Œè€Œç›´æ¥åˆ›å»ºå®ƒçš„æˆå‘˜å˜é‡æ¥ä»£æ›¿ã€‚å°†å¯¹è±¡æ‹†åˆ†åï¼Œå¯ä»¥åˆ†é…å¯¹è±¡çš„æˆå‘˜å˜é‡åœ¨æ ˆæˆ–å¯„å­˜å™¨ä¸Šï¼ŒåŸæœ¬çš„å¯¹è±¡å°±æ— éœ€åˆ†é…å†…å­˜ç©ºé—´äº†</li></ol></li></ol><img src="https://mmbiz.qpic.cn/mmbiz_jpg/E44aHibktsKYzo9uu6cXtN7SVaZKBS66Yjv2NNf5hTde0tvxFxEYAdZLjxZevOHicm5aCDzZhQK3E8Xsm6seGszQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1" alt="å›¾ç‰‡" style="zoom: 80%;" />]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;a href=&quot;#å†™åœ¨å‰é¢&quot; class=&quot;headerlink&quot; title=&quot;å†™åœ¨å‰é¢&quot;&gt;&lt;/a&gt;å†™åœ¨å‰é¢&lt;/h2&gt;&lt;p&gt;æ–‡ç« ä¸ºæœ¬äººå‚è€ƒ&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MzU4NzA3MTc5M</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Jvm" scheme="http://example.com/tags/Jvm/"/>
    
    <category term="å…«è‚¡æ–‡" scheme="http://example.com/tags/%E5%85%AB%E8%82%A1%E6%96%87/"/>
    
  </entry>
  
  <entry>
    <title>åŠ¨æ€è§„åˆ’å…¥é—¨é¢˜</title>
    <link href="http://example.com/2022/01/25/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%85%A5%E9%97%A8%E9%A2%98/"/>
    <id>http://example.com/2022/01/25/%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92%E5%85%A5%E9%97%A8%E9%A2%98/</id>
    <published>2022-01-24T16:00:00.000Z</published>
    <updated>2022-05-30T06:05:53.818Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PREFACE"><a href="#PREFACE" class="headerlink" title="PREFACE"></a>PREFACE</h2><p>æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚</p><h2 id="QUESTION-amp-ANSWER"><a href="#QUESTION-amp-ANSWER" class="headerlink" title="QUESTION &amp; ANSWER"></a>QUESTION &amp; ANSWER</h2><h3 id="509-æ–æ³¢é‚£å¥‘æ•°"><a href="#509-æ–æ³¢é‚£å¥‘æ•°" class="headerlink" title="509.æ–æ³¢é‚£å¥‘æ•°"></a>509.æ–æ³¢é‚£å¥‘æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">æ–æ³¢é‚£å¥‘æ•°Â ï¼ˆé€šå¸¸ç”¨Â F(n) è¡¨ç¤ºï¼‰å½¢æˆçš„åºåˆ—ç§°ä¸º æ–æ³¢é‚£å¥‘æ•°åˆ— ã€‚è¯¥æ•°åˆ—ç”±Â 0 å’Œ 1 å¼€å§‹ï¼Œåé¢çš„æ¯ä¸€é¡¹æ•°å­—éƒ½æ˜¯å‰é¢ä¸¤é¡¹æ•°å­—çš„å’Œã€‚ä¹Ÿå°±æ˜¯ï¼š</span><br><span class="line">F(0) = 0ï¼ŒF(1)Â = 1</span><br><span class="line">F(n) = F(n - 1) + F(n - 2)ï¼Œå…¶ä¸­ n &gt; 1</span><br><span class="line">ç»™å®šÂ n ï¼Œè¯·è®¡ç®— F(n) ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šn = 2</span><br><span class="line">è¾“å‡ºï¼š1</span><br><span class="line">è§£é‡Šï¼šF(2) = F(1) + F(0) = 1 + 0 = 1</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fib</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span> || n==<span class="number">0</span>) <span class="keyword">return</span> n;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> a;</span><br><span class="line">            b = a + b;</span><br><span class="line">            a = b - tmp;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="70-çˆ¬æ¥¼æ¢¯"><a href="#70-çˆ¬æ¥¼æ¢¯" class="headerlink" title="70.çˆ¬æ¥¼æ¢¯"></a>70.çˆ¬æ¥¼æ¢¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ nÂ é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</span><br><span class="line">æ¯æ¬¡ä½ å¯ä»¥çˆ¬ 1 æˆ– 2 ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šn = 2</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼šæœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶ã€‚</span><br><span class="line">1. 1 é˜¶ + 1 é˜¶</span><br><span class="line">2. 2 é˜¶</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            dp[i] = dp[i-<span class="number">1</span>] + dp[i-<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"><a href="#746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯" class="headerlink" title="746.ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"></a>746.ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ cost ï¼Œå…¶ä¸­ cost[i] æ˜¯ä»æ¥¼æ¢¯ç¬¬ i ä¸ªå°é˜¶å‘ä¸Šçˆ¬éœ€è¦æ”¯ä»˜çš„è´¹ç”¨ã€‚ä¸€æ—¦ä½ æ”¯ä»˜æ­¤è´¹ç”¨ï¼Œå³å¯é€‰æ‹©å‘ä¸Šçˆ¬ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå°é˜¶ã€‚</span><br><span class="line">ä½ å¯ä»¥é€‰æ‹©ä»ä¸‹æ ‡ä¸º 0 æˆ–ä¸‹æ ‡ä¸º 1 çš„å°é˜¶å¼€å§‹çˆ¬æ¥¼æ¢¯ã€‚</span><br><span class="line">è¯·ä½ è®¡ç®—å¹¶è¿”å›è¾¾åˆ°æ¥¼æ¢¯é¡¶éƒ¨çš„æœ€ä½èŠ±è´¹ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šcost = [10,15,20]</span><br><span class="line">è¾“å‡ºï¼š15</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cost.length;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = dp[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">            dp[i] = Math.min(dp[i - <span class="number">1</span>] + cost[i - <span class="number">1</span>], dp[i - <span class="number">2</span>] + cost[i - <span class="number">2</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="62-ä¸åŒè·¯å¾„"><a href="#62-ä¸åŒè·¯å¾„" class="headerlink" title="62.ä¸åŒè·¯å¾„"></a>62.ä¸åŒè·¯å¾„</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ª m x nÂ ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œStartâ€ ï¼‰ã€‚</span><br><span class="line">æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œFinishâ€ ï¼‰ã€‚</span><br><span class="line">é—®æ€»å…±æœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</span><br></pre></td></tr></table></figure><p><b>ç¤ºä¾‹1</b>ï¼š</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/algorithm/algorithm2.png"></img></p><p><b>è¾“å…¥ï¼šm &#x3D; 3, n &#x3D; 7 </b></p><p><b>è¾“å‡ºï¼š28</b></p><p>â‘ ï¼šå®šä¹‰dpæ•°ç»„é•¿åº¦ä¸ºm,nï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;m; i++) dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;n; i++) dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;m; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>; j&lt;n; j++)&#123;</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡ï¼šå®šä¹‰dpæ•°ç»„é•¿åº¦ä¸ºm+1,n+1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePaths</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=m; i++) dp[i][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; i++) dp[<span class="number">1</span>][i] = <span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>; i&lt;=m; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">2</span>; j&lt;=n; j++)&#123;</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="63-ä¸åŒè·¯å¾„-II"><a href="#63-ä¸åŒè·¯å¾„-II" class="headerlink" title="63.ä¸åŒè·¯å¾„ II"></a>63.ä¸åŒè·¯å¾„ II</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¸€ä¸ªæœºå™¨äººä½äºä¸€ä¸ªÂ m x nÂ ç½‘æ ¼çš„å·¦ä¸Šè§’ ï¼ˆèµ·å§‹ç‚¹åœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œStartâ€ ï¼‰ã€‚</span><br><span class="line">æœºå™¨äººæ¯æ¬¡åªèƒ½å‘ä¸‹æˆ–è€…å‘å³ç§»åŠ¨ä¸€æ­¥ã€‚æœºå™¨äººè¯•å›¾è¾¾åˆ°ç½‘æ ¼çš„å³ä¸‹è§’ï¼ˆåœ¨ä¸‹å›¾ä¸­æ ‡è®°ä¸º â€œFinishâ€ï¼‰ã€‚</span><br><span class="line">ç°åœ¨è€ƒè™‘ç½‘æ ¼ä¸­æœ‰éšœç¢ç‰©ã€‚é‚£ä¹ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’å°†ä¼šæœ‰å¤šå°‘æ¡ä¸åŒçš„è·¯å¾„ï¼Ÿ</span><br><span class="line">ç½‘æ ¼ä¸­çš„éšœç¢ç‰©å’Œç©ºä½ç½®åˆ†åˆ«ç”¨ 1 å’Œ 0 æ¥è¡¨ç¤ºã€‚</span><br></pre></td></tr></table></figure><p><b>ç¤ºä¾‹1</b>ï¼š</p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/algorithm/algorithm5.png"></img></p><p><b>è¾“å…¥ï¼šm &#x3D; 3, n &#x3D; 7 </b></p><p><b>è¾“å‡ºï¼š28</b></p><p>â‘ ï¼šå®šä¹‰dpæ•°ç»„é•¿åº¦ä¸ºm,nï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePathsWithObstacles</span><span class="params">(<span class="type">int</span>[][] obstacleGrid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> obstacleGrid.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="type">int</span> dp[][] = <span class="keyword">new</span> <span class="title class_">int</span>[m][n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;m;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[i][<span class="number">0</span>] == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (obstacleGrid[<span class="number">0</span>][i] == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            dp[<span class="number">0</span>][i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> a=<span class="number">1</span>; a&lt;m; a++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> b=<span class="number">1</span>;b&lt;n;b++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (obstacleGrid[a][b] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">                dp[a][b] = dp[a-<span class="number">1</span>][b] + dp[a][b-<span class="number">1</span>];    </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m-<span class="number">1</span>][n-<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>â‘¡ï¼šå®šä¹‰dpæ•°ç»„é•¿åº¦ä¸ºm+1,n+1ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">uniquePathsWithObstacles</span><span class="params">(<span class="type">int</span>[][] obstacleGrid)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> obstacleGrid.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> obstacleGrid[<span class="number">0</span>].length;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[m+<span class="number">1</span>][n+<span class="number">1</span>];</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=m; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(obstacleGrid[i-<span class="number">1</span>][<span class="number">0</span>] == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            dp[i][<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>; i&lt;=n; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(obstacleGrid[<span class="number">0</span>][i-<span class="number">1</span>] == <span class="number">1</span>) <span class="keyword">break</span>;</span><br><span class="line">            dp[<span class="number">1</span>][i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>; i&lt;=m; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">2</span>; j&lt;=n; j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(obstacleGrid[i-<span class="number">1</span>][j-<span class="number">1</span>] == <span class="number">1</span>) <span class="keyword">continue</span>;</span><br><span class="line">                dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[m][n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="343-æ•´æ•°æ‹†åˆ†"><a href="#343-æ•´æ•°æ‹†åˆ†" class="headerlink" title="343.æ•´æ•°æ‹†åˆ†"></a>343.æ•´æ•°æ‹†åˆ†</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªæ­£æ•´æ•°Â nÂ ï¼Œå°†å…¶æ‹†åˆ†ä¸º k ä¸ª æ­£æ•´æ•° çš„å’Œï¼ˆÂ k &gt;= 2Â ï¼‰ï¼Œå¹¶ä½¿è¿™äº›æ•´æ•°çš„ä¹˜ç§¯æœ€å¤§åŒ–ã€‚</span><br><span class="line">è¿”å› ä½ å¯ä»¥è·å¾—çš„æœ€å¤§ä¹˜ç§¯Â ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: n = 2</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line">è§£é‡Š: 2 = 1 + 1, 1 Ã— 1 = 1ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">integerBreak</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="comment">//dp[i]ä¸ºæ­£æ•´æ•°iæ‹†åˆ†ç»“æœçš„æœ€å¤§ä¹˜ç§¯</span></span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>]; </span><br><span class="line">        dp[<span class="number">2</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">3</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; i - <span class="number">1</span>; ++j) &#123;</span><br><span class="line">                <span class="comment">//j*(i-j)ä»£è¡¨æŠŠiæ‹†åˆ†ä¸ºjå’Œi-jä¸¤ä¸ªæ•°ç›¸ä¹˜</span></span><br><span class="line">                <span class="comment">//j*dp[i-j]ä»£è¡¨æŠŠiæ‹†åˆ†æˆjå’Œç»§ç»­æŠŠ(i-j)è¿™ä¸ªæ•°æ‹†åˆ†ï¼Œå–(i-j)æ‹†åˆ†ç»“æœä¸­çš„æœ€å¤§ä¹˜ç§¯ä¸jç›¸ä¹˜</span></span><br><span class="line">                dp[i] = Math.max(dp[i], Math.max(j * (i - j), j * dp[i - j]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘"><a href="#96-ä¸åŒçš„äºŒå‰æœç´¢æ ‘" class="headerlink" title="96.ä¸åŒçš„äºŒå‰æœç´¢æ ‘"></a>96.ä¸åŒçš„äºŒå‰æœç´¢æ ‘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªæ•´æ•° n ï¼Œæ±‚æ°ç”± n ä¸ªèŠ‚ç‚¹ç»„æˆä¸”èŠ‚ç‚¹å€¼ä» 1 åˆ° n äº’ä¸ç›¸åŒçš„ äºŒå‰æœç´¢æ ‘ æœ‰å¤šå°‘ç§ï¼Ÿè¿”å›æ»¡è¶³é¢˜æ„çš„äºŒå‰æœç´¢æ ‘çš„ç§æ•°ã€‚</span><br></pre></td></tr></table></figure><p><b>ç¤ºä¾‹ 1ï¼š</b></p><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/algorithm/algorithm4.png"></img></p><p><b>è¾“å…¥ï¼šn &#x3D; 3 </b></p><p><b>è¾“å‡ºï¼š5</b></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">æ¥çœ‹çœ‹n=3æ—¶ï¼Œæœ‰å“ªå‡ ç§æƒ…å†µã€‚</span><br><span class="line">å½“1ä¸ºå¤´ç»“ç‚¹çš„æ—¶å€™ï¼Œå…¶å³å­æ ‘æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å¸ƒå±€ä¸ n ä¸º2çš„æ—¶å€™ä¸¤æ£µæ ‘çš„å¸ƒå±€æ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line">å½“3ä¸ºå¤´ç»“ç‚¹çš„æ—¶å€™ï¼Œå…¶å·¦å­æ ‘æœ‰ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å¸ƒå±€ä¸ n ä¸º2çš„æ—¶å€™ä¸¤æ£µæ ‘çš„å¸ƒå±€æ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line">å½“2ä¸ºå¤´ç»“ç‚¹çš„æ—¶å€™ï¼Œå…¶å·¦å³å­æ ‘éƒ½åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¸ƒå±€å’Œ n ä¸º1çš„æ—¶å€™åªæœ‰ä¸€æ£µæ ‘çš„å¸ƒå±€ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚</span><br><span class="line"></span><br><span class="line">æ€è€ƒåˆ°è¿™é‡Œï¼Œè¿™é“é¢˜ç›®å°±æœ‰çœ‰ç›®äº†ã€‚</span><br><span class="line">dp[3]å°±æ˜¯: å…ƒç´ 1ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ + å…ƒç´ 2ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ + å…ƒç´ 3ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ã€‚</span><br><span class="line">å…ƒç´ 1ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ = å³å­æ ‘æœ‰2ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ * å·¦å­æ ‘æœ‰0ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ã€‚</span><br><span class="line">å…ƒç´ 2ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ = å³å­æ ‘æœ‰1ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ * å·¦å­æ ‘æœ‰1ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ã€‚</span><br><span class="line">å…ƒç´ 3ä¸ºå¤´ç»“ç‚¹æœç´¢æ ‘çš„æ•°é‡ = å³å­æ ‘æœ‰0ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ * å·¦å­æ ‘æœ‰2ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡ã€‚</span><br><span class="line"></span><br><span class="line">æœ‰2ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡å°±æ˜¯dp[2]ã€‚</span><br><span class="line">æœ‰1ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡å°±æ˜¯dp[1]ã€‚</span><br><span class="line">æœ‰0ä¸ªå…ƒç´ çš„æœç´¢æ ‘æ•°é‡å°±æ˜¯dp[0]ã€‚</span><br><span class="line">æ‰€ä»¥dp[3] = dp[2] * dp[0] + dp[1] * dp[1] + dp[0] * dp[2]</span><br></pre></td></tr></table></figure><p><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos/algorithm/algorithm6.png"></img></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numTrees</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] dp = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">2</span>;i&lt;dp.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt;= i; j++) &#123;</span><br><span class="line">                dp[i] += dp[j - <span class="number">1</span>] * dp[i - j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[n];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;PREFACE&quot;&gt;&lt;a href=&quot;#PREFACE&quot; class=&quot;headerlink&quot; title=&quot;PREFACE&quot;&gt;&lt;/a&gt;PREFACE&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;QUESTION-a</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Algorithm" scheme="http://example.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>åŒæŒ‡é’ˆç®—æ³•é¢˜å‹</title>
    <link href="http://example.com/2021/11/28/%E5%8F%8C%E6%8C%87%E9%92%88%E7%AE%97%E6%B3%95/"/>
    <id>http://example.com/2021/11/28/%E5%8F%8C%E6%8C%87%E9%92%88%E7%AE%97%E6%B3%95/</id>
    <published>2021-11-28T02:34:00.000Z</published>
    <updated>2022-05-30T13:37:33.018Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PREFACE"><a href="#PREFACE" class="headerlink" title="PREFACE"></a>PREFACE</h2><p>æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚</p><h2 id="QUESTION-amp-ANSWER"><a href="#QUESTION-amp-ANSWER" class="headerlink" title="QUESTION &amp; ANSWER"></a>QUESTION &amp; ANSWER</h2><h3 id="27-ç§»é™¤å…ƒç´ "><a href="#27-ç§»é™¤å…ƒç´ " class="headerlink" title="27. ç§»é™¤å…ƒç´ "></a>27. ç§»é™¤å…ƒç´ </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">27. ç§»é™¤å…ƒç´ </span><br><span class="line">ç»™ä½ ä¸€ä¸ªæ•°ç»„ nums å’Œä¸€ä¸ªå€¼ valï¼Œä½ éœ€è¦ åŸåœ° ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº val çš„å…ƒç´ ï¼Œå¹¶è¿”å›ç§»é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</span><br><span class="line">ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»ä»…ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´å¹¶ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ã€‚</span><br><span class="line"></span><br><span class="line">å…ƒç´ çš„é¡ºåºå¯ä»¥æ”¹å˜ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [3,2,2,3], val = 3</span><br><span class="line">è¾“å‡ºï¼š2, nums = [2,2]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2, å¹¶ä¸” nums ä¸­çš„å‰ä¸¤ä¸ªå…ƒç´ å‡ä¸º 2ã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°è¿”å›çš„æ–°é•¿åº¦ä¸º 2 ï¼Œè€Œ nums = [2,2,3,3] æˆ– nums = [2,2,0,0]ï¼Œä¹Ÿä¼šè¢«è§†ä½œæ­£ç¡®ç­”æ¡ˆã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [0,1,2,2,3,0,4,2], val = 2</span><br><span class="line">è¾“å‡ºï¼š5, nums = [0,1,4,0,3]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5, å¹¶ä¸” nums ä¸­çš„å‰äº”ä¸ªå…ƒç´ ä¸º 0, 1, 3, 0, 4ã€‚æ³¨æ„è¿™äº”ä¸ªå…ƒç´ å¯ä¸ºä»»æ„é¡ºåºã€‚ä½ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos\algorithm\algorithm7.gif"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(fast &lt; nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[fast] != val)&#123;</span><br><span class="line">                nums[slow] = nums[fast];</span><br><span class="line">                slow++;</span><br><span class="line">            &#125;</span><br><span class="line">            fast++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="26-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"><a href="#26-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" class="headerlink" title="26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"></a>26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªå‡åºæ’åˆ—æ•°ç»„ nums ï¼Œè¯·ä½ åŸåœ°åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ åªå‡ºç°ä¸€æ¬¡ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</span><br><span class="line">ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨åŸåœ°ä¿®æ”¹è¾“å…¥æ•°ç»„ å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [1,1,2]</span><br><span class="line">è¾“å‡ºï¼š2, nums = [1,2]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 2 ï¼Œå¹¶ä¸”åŸæ•°ç»„ nums çš„å‰ä¸¤ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 2 ã€‚ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [0,0,1,1,1,2,2,3,3,4]</span><br><span class="line">è¾“å‡ºï¼š5, nums = [0,1,2,3,4]</span><br><span class="line">è§£é‡Šï¼šå‡½æ•°åº”è¯¥è¿”å›æ–°çš„é•¿åº¦ 5 ï¼Œ å¹¶ä¸”åŸæ•°ç»„ nums çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 1, 2, 3, 4 ã€‚ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(fast &lt; nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[slow] != nums[fast])&#123;</span><br><span class="line">                slow++;</span><br><span class="line">                nums[slow] = nums[fast];</span><br><span class="line">            &#125;</span><br><span class="line">            fast++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slow + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="283-ç§»åŠ¨é›¶"><a href="#283-ç§»åŠ¨é›¶" class="headerlink" title="283. ç§»åŠ¨é›¶"></a>283. ç§»åŠ¨é›¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªæ•°ç»„ numsï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ 0 ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹:</span><br><span class="line">è¾“å…¥: [0,1,0,3,12]</span><br><span class="line">è¾“å‡º: [1,3,12,0,0]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ€è·¯ä¸€: é0æ•°è¦†ç›– 0 ï¼Œéœ€è¦å¤„ç†slowåé¢çš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">//å¿«æ…¢æŒ‡é’ˆ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">fastIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slowIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(nums.length&lt;=<span class="number">1</span>) <span class="keyword">return</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(fastIndex &lt; nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[fastIndex] != <span class="number">0</span>)&#123;</span><br><span class="line">                nums[slowIndex++] = nums[fastIndex++];</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                fastIndex++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//åé¢çš„å…ƒç´ å…¨éƒ¨ç½®ä¸º0</span></span><br><span class="line">        <span class="keyword">while</span>(slowIndex &lt; nums.length)&#123;</span><br><span class="line">            nums[slowIndex++] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ€è·¯äºŒ: äº¤æ¢ 0 å’Œ é0æ•°çš„ä½ç½®</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">slow</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(slow &lt; nums.length &amp;&amp; nums[slow]!=<span class="number">0</span>)  slow++;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fast</span> <span class="operator">=</span> slow;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span>(fast &lt; nums.length)&#123;    </span><br><span class="line">            <span class="keyword">if</span>(nums[fast]!=<span class="number">0</span>)&#123;</span><br><span class="line">                change(fast,slow,nums);</span><br><span class="line">                slow++;</span><br><span class="line">            &#125;</span><br><span class="line">            fast++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span> fastIndex,<span class="type">int</span> slowIndex,<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[fastIndex];</span><br><span class="line">        nums[fastIndex] = nums[slowIndex];</span><br><span class="line">        nums[slowIndex] = tmp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="844-æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²"><a href="#844-æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²" class="headerlink" title="844. æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²"></a>844. æ¯”è¾ƒå«é€€æ ¼çš„å­—ç¬¦ä¸²</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®š s å’Œ t ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼Œå½“å®ƒä»¬åˆ†åˆ«è¢«è¾“å…¥åˆ°ç©ºç™½çš„æ–‡æœ¬ç¼–è¾‘å™¨åï¼Œè¯·ä½ åˆ¤æ–­äºŒè€…æ˜¯å¦ç›¸ç­‰ã€‚# ä»£è¡¨é€€æ ¼å­—ç¬¦ã€‚</span><br><span class="line">å¦‚æœç›¸ç­‰ï¼Œè¿”å› true ï¼›å¦åˆ™ï¼Œè¿”å› false ã€‚</span><br><span class="line">æ³¨æ„ï¼šå¦‚æœå¯¹ç©ºæ–‡æœ¬è¾“å…¥é€€æ ¼å­—ç¬¦ï¼Œæ–‡æœ¬ç»§ç»­ä¸ºç©ºã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šs = &quot;ab#c&quot;, t = &quot;ad#c&quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šS å’Œ T éƒ½ä¼šå˜æˆ â€œacâ€ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šs = &quot;ab##&quot;, t = &quot;c#d#&quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šs å’Œ t éƒ½ä¼šå˜æˆ â€œâ€ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">backspaceCompare</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> handle(s.toCharArray()).equals(handle(t.toCharArray()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">handle</span><span class="params">(<span class="type">char</span>[] strArr)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &lt; strArr.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(strArr[right] != <span class="string">&#x27;#&#x27;</span>)&#123;</span><br><span class="line">                strArr[left] = strArr[right];</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(left &gt; <span class="number">0</span>)&#123;<span class="comment">//è¿™ä¸€æ­¥å¾ˆå…³é”®</span></span><br><span class="line">                left--;</span><br><span class="line">            &#125;</span><br><span class="line">            right++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;left; i++)&#123;</span><br><span class="line">           res += strArr[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="977-æœ‰åºæ•°ç»„çš„å¹³æ–¹"><a href="#977-æœ‰åºæ•°ç»„çš„å¹³æ–¹" class="headerlink" title="977. æœ‰åºæ•°ç»„çš„å¹³æ–¹"></a>977. æœ‰åºæ•°ç»„çš„å¹³æ–¹</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªæŒ‰ éé€’å‡é¡ºåº æ’åºçš„æ•´æ•°æ•°ç»„ numsï¼Œè¿”å› æ¯ä¸ªæ•°å­—çš„å¹³æ–¹ ç»„æˆçš„æ–°æ•°ç»„ï¼Œè¦æ±‚ä¹ŸæŒ‰ éé€’å‡é¡ºåº æ’åºã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [-4,-1,0,3,10]</span><br><span class="line">è¾“å‡ºï¼š[0,1,9,16,100]</span><br><span class="line">è§£é‡Šï¼šå¹³æ–¹åï¼Œæ•°ç»„å˜ä¸º [16,1,0,9,100]</span><br><span class="line">æ’åºåï¼Œæ•°ç»„å˜ä¸º [0,1,9,16,100]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [-7,-3,2,3,11]</span><br><span class="line">è¾“å‡ºï¼š[4,9,9,49,121]</span><br></pre></td></tr></table></figure><img src="http://fastly.jsdelivr.net/gh/SoulChay/figureBed/blogPhotos\algorithm\algorithm8.gif"><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortedSquares(<span class="type">int</span>[] nums) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> nums.length -<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">leftMulti</span> <span class="operator">=</span> nums[left] * nums[left];</span><br><span class="line">            <span class="type">int</span> <span class="variable">rightMulti</span> <span class="operator">=</span> nums[right] * nums[right];</span><br><span class="line">            <span class="keyword">if</span>(leftMulti &gt; rightMulti)&#123;</span><br><span class="line">                res[index--] = leftMulti;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                res[index--] = rightMulti;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;PREFACE&quot;&gt;&lt;a href=&quot;#PREFACE&quot; class=&quot;headerlink&quot; title=&quot;PREFACE&quot;&gt;&lt;/a&gt;PREFACE&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;QUESTION-a</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Algorithm" scheme="http://example.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>äºŒåˆ†ç®—æ³•é¢˜å‹</title>
    <link href="http://example.com/2021/11/26/%E4%BA%8C%E5%88%86%E6%B3%95/"/>
    <id>http://example.com/2021/11/26/%E4%BA%8C%E5%88%86%E6%B3%95/</id>
    <published>2021-11-26T07:25:00.000Z</published>
    <updated>2022-05-30T12:01:00.457Z</updated>
    
    <content type="html"><![CDATA[<h2 id="PREFACE"><a href="#PREFACE" class="headerlink" title="PREFACE"></a>PREFACE</h2><p>æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚</p><h2 id="QUESTION-amp-ANSWER"><a href="#QUESTION-amp-ANSWER" class="headerlink" title="QUESTION &amp; ANSWER"></a>QUESTION &amp; ANSWER</h2><h3 id="704-äºŒåˆ†æŸ¥æ‰¾"><a href="#704-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="704. äºŒåˆ†æŸ¥æ‰¾"></a>704. äºŒåˆ†æŸ¥æ‰¾</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">ç»™å®šä¸€ä¸ªÂ nÂ ä¸ªå…ƒç´ æœ‰åºçš„ï¼ˆå‡åºï¼‰æ•´å‹æ•°ç»„Â nums å’Œä¸€ä¸ªç›®æ ‡å€¼Â target Â ï¼Œå†™ä¸€ä¸ªå‡½æ•°æœç´¢Â numsÂ ä¸­çš„ targetï¼Œå¦‚æœç›®æ ‡å€¼å­˜åœ¨è¿”å›ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› -1ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 9</span><br><span class="line">è¾“å‡º: 4</span><br><span class="line">è§£é‡Š: 9 å‡ºç°åœ¨ nums ä¸­å¹¶ä¸”ä¸‹æ ‡ä¸º 4</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹Â 2:</span><br><span class="line">è¾“å…¥: nums = [-1,0,3,5,9,12], target = 2</span><br><span class="line">è¾“å‡º: -1</span><br><span class="line">è§£é‡Š: 2 ä¸å­˜åœ¨ nums ä¸­å› æ­¤è¿”å› -1</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜ä¸»è¦æ˜¯æ³¨æ„ <code>num.length == 1</code> çš„æƒ…å†µï¼Œå³ <code>left</code> å¯ä¸å¯ä»¥å°äº <code>right</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] &lt; target) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &gt; target) right = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="35-æœç´¢æ’å…¥ä½ç½®"><a href="#35-æœç´¢æ’å…¥ä½ç½®" class="headerlink" title="35. æœç´¢æ’å…¥ä½ç½®"></a>35. æœç´¢æ’å…¥ä½ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">35. æœç´¢æ’å…¥ä½ç½®</span><br><span class="line">ç»™å®šä¸€ä¸ªæ’åºæ•°ç»„å’Œä¸€ä¸ªç›®æ ‡å€¼ï¼Œåœ¨æ•°ç»„ä¸­æ‰¾åˆ°ç›®æ ‡å€¼ï¼Œå¹¶è¿”å›å…¶ç´¢å¼•ã€‚å¦‚æœç›®æ ‡å€¼ä¸å­˜åœ¨äºæ•°ç»„ä¸­ï¼Œè¿”å›å®ƒå°†ä¼šè¢«æŒ‰é¡ºåºæ’å…¥çš„ä½ç½®ã€‚</span><br><span class="line">è¯·å¿…é¡»ä½¿ç”¨æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1:</span><br><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 5</span><br><span class="line">è¾“å‡º: 2</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2:</span><br><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 2</span><br><span class="line">è¾“å‡º: 1</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3:</span><br><span class="line">è¾“å…¥: nums = [1,3,5,6], target = 7</span><br><span class="line">è¾“å‡º: 4</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] &lt; target)  left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &gt; target)  right = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æˆ–è€…æ˜¯ return right + 1;</span></span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"><a href="#34-åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®" class="headerlink" title="34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®"></a>34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">34. åœ¨æ’åºæ•°ç»„ä¸­æŸ¥æ‰¾å…ƒç´ çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªä½ç½®</span><br><span class="line">ç»™å®šä¸€ä¸ªæŒ‰ç…§å‡åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œå’Œä¸€ä¸ªç›®æ ‡å€¼ targetã€‚æ‰¾å‡ºç»™å®šç›®æ ‡å€¼åœ¨æ•°ç»„ä¸­çš„å¼€å§‹ä½ç½®å’Œç»“æŸä½ç½®ã€‚</span><br><span class="line">å¦‚æœæ•°ç»„ä¸­ä¸å­˜åœ¨ç›®æ ‡å€¼ targetï¼Œè¿”å› [-1, -1]ã€‚</span><br><span class="line"></span><br><span class="line">è¿›é˜¶ï¼š</span><br><span class="line">ä½ å¯ä»¥è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º O(log n) çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜å—ï¼Ÿ</span><br><span class="line"> </span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 8</span><br><span class="line">è¾“å‡ºï¼š[3,4]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [5,7,7,8,8,10], target = 6</span><br><span class="line">è¾“å‡ºï¼š[-1,-1]</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line">è¾“å…¥ï¼šnums = [], target = 0</span><br><span class="line">è¾“å‡ºï¼š[-1,-1]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] searchRange(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">if</span>(nums.length == <span class="number">0</span>) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;-<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">pos</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(nums[mid] &lt; target)  left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nums[mid] &gt; target)  right = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                pos = mid;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¦‚æœæ²¡æœ‰åŒ¹é…ä¸Šåˆ™è¿”å›&#123;-1,-1&#125;</span></span><br><span class="line">        <span class="keyword">if</span>(nums[pos] != target)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;-<span class="number">1</span>,-<span class="number">1</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//åŒ¹é…æˆåŠŸ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">begin</span> <span class="operator">=</span> pos;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> pos;</span><br><span class="line">        <span class="keyword">while</span>(end+<span class="number">1</span> &lt; nums.length &amp;&amp; nums[end+<span class="number">1</span>] == target) end++;</span><br><span class="line">        <span class="keyword">while</span>(begin -<span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; nums[begin-<span class="number">1</span>] == target) begin--;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;begin,end&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="69-Sqrt-x"><a href="#69-Sqrt-x" class="headerlink" title="69. Sqrt(x)"></a>69. Sqrt(x)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ç»™ä½ ä¸€ä¸ªéè´Ÿæ•´æ•° x ï¼Œè®¡ç®—å¹¶è¿”å›Â xÂ çš„ ç®—æœ¯å¹³æ–¹æ ¹ã€‚</span><br><span class="line">ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œç»“æœåªä¿ç•™ æ•´æ•°éƒ¨åˆ† ï¼Œå°æ•°éƒ¨åˆ†å°†è¢« èˆå» ã€‚</span><br><span class="line">æ³¨æ„ï¼šä¸å…è®¸ä½¿ç”¨ä»»ä½•å†…ç½®æŒ‡æ•°å‡½æ•°å’Œç®—ç¬¦ï¼Œä¾‹å¦‚ pow(x, 0.5) æˆ–è€… x ** 0.5 ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šx = 4</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šx = 8</span><br><span class="line">è¾“å‡ºï¼š2</span><br><span class="line">è§£é‡Šï¼š8 çš„ç®—æœ¯å¹³æ–¹æ ¹æ˜¯ 2.82842..., ç”±äºè¿”å›ç±»å‹æ˜¯æ•´æ•°ï¼Œå°æ•°éƒ¨åˆ†å°†è¢«èˆå»ã€‚</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mySqrt</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> x;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (mid &gt; x/mid)  right=mid-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (mid &lt; x/mid)  left=mid+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="367-æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°"><a href="#367-æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°" class="headerlink" title="367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°"></a>367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">367. æœ‰æ•ˆçš„å®Œå…¨å¹³æ–¹æ•°</span><br><span class="line">ç»™å®šä¸€ä¸ª æ­£æ•´æ•° num ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚æœ num æ˜¯ä¸€ä¸ªå®Œå…¨å¹³æ–¹æ•°ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› false ã€‚</span><br><span class="line">è¿›é˜¶ï¼šä¸è¦ ä½¿ç”¨ä»»ä½•å†…ç½®çš„åº“å‡½æ•°ï¼Œå¦‚  sqrt ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line">è¾“å…¥ï¼šnum = 16</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line">è¾“å…¥ï¼šnum = 14</span><br><span class="line">è¾“å‡ºï¼šfalse</span><br><span class="line"></span><br><span class="line">æç¤ºï¼š</span><br><span class="line">1 &lt;= num &lt;= 2^31 - 1</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPerfectSquare</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">right</span> <span class="operator">=</span> num;</span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right)&#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left)&gt;&gt;<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(num &lt; mid*mid) right = mid - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(num &gt; mid*mid) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;PREFACE&quot;&gt;&lt;a href=&quot;#PREFACE&quot; class=&quot;headerlink&quot; title=&quot;PREFACE&quot;&gt;&lt;/a&gt;PREFACE&lt;/h2&gt;&lt;p&gt;æœ¬ç¯‡æ–‡ç« é¢˜ç›®å‡æ¥è‡ªåŠ›æ‰£ï¼Œéƒ¨åˆ†å›¾ç‰‡ä¸é¢˜è§£æ¥è‡ªä»£ç éšæƒ³å½•ã€‚&lt;/p&gt;
&lt;h2 id=&quot;QUESTION-a</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
    <category term="Algorithm" scheme="http://example.com/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>å‘ä¸Šè½¬å‹é—®é¢˜</title>
    <link href="http://example.com/2021/07/09/%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B%E9%97%AE%E9%A2%98/"/>
    <id>http://example.com/2021/07/09/%E5%90%91%E4%B8%8A%E8%BD%AC%E5%9E%8B%E9%97%AE%E9%A2%98/</id>
    <published>2021-07-09T07:08:00.000Z</published>
    <updated>2022-05-14T01:08:30.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="æŠ›å‡ºé—®é¢˜"><a href="#æŠ›å‡ºé—®é¢˜" class="headerlink" title="æŠ›å‡ºé—®é¢˜"></a>æŠ›å‡ºé—®é¢˜</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Int2LongOverflow</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// Integer.MAX_VALUE = 2147483647</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b1</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum1</span> <span class="operator">=</span> a + b1;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum2</span> <span class="operator">=</span> <span class="number">2147483647</span> + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">b2</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">long</span> <span class="variable">sum3</span> <span class="operator">=</span> a + b2;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">sum4</span> <span class="operator">=</span> <span class="number">2147483647</span> + <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;sum1 = &quot;</span> + sum1);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum2 = &quot;</span> + sum2);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum3 = &quot;</span> + sum3);</span><br><span class="line">        System.out.println(<span class="string">&quot;sum4 = &quot;</span> + sum4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€ç´¢ä¸€ä¸‹ï¼Œæ˜¯ä¸æ˜¯sum1, sum2, sum3, sum4å‡è¾“å‡º2147483648å‘¢ï¼Ÿ</p><p>ä¸‹é¢æ˜¯ä»£ç è¿è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sum1 = -<span class="number">2147483648</span></span><br><span class="line">sum2 = -<span class="number">2147483648</span></span><br><span class="line">sum3 = <span class="number">2147483648</span></span><br><span class="line">sum4 = <span class="number">2147483648</span></span><br></pre></td></tr></table></figure><h2 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h2><p>çœ‹ä¼¼sum1, sum2, sum3, sum4å‡è®¡ç®—2147483647 + 1çš„ç»“æœï¼Œå¹¶ä¸”ç»“æœç”¨ <b>long</b> ç±»å‹æ¥æ”¶ï¼Œä½†ä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ç§ä¸åŒè®¡ç®—ç»“æœå‘¢ï¼Ÿ</p><ol><li>sum1è®¡ç®—çš„æ˜¯a + b1ï¼Œå…¶ä¸­aå’Œb1å‡ä¸ºintç±»å‹æ•°æ®ã€‚è®¡ç®—é¡ºåºæ˜¯è¿™æ ·çš„ï¼šé¦–å…ˆå–è¡¨è¾¾å¼ä¸­æœ€å¤§çš„ç±»å‹æš‚å­˜è®¡ç®—ç»“æœï¼Œä¹Ÿå°±æ˜¯intç±»å‹æš‚å­˜a + b1çš„ç»“æœï¼Œæ˜¾ç„¶ä¼šå‘ç”Ÿæº¢å‡ºï¼Œæš‚å­˜çš„ç»“æœå°±ä¸º-2147483648ï¼›ç„¶åå†å°†æš‚å­˜çš„ç»“æœèµ‹å€¼ç»™sum1ï¼Œå…¶ä¸­ä¼šå‘ä¸Šéšå¼è½¬å‹ï¼Œäºæ˜¯sum1 &#x3D; -2147483648ã€‚</li><li>sum2è®¡ç®—çš„æ˜¯ä¸¤ä¸ªå­—é¢é‡å€¼çš„å’Œã€‚åœ¨Javaä¸­ï¼Œçº¯æ•°å­—å­—é¢é‡é»˜è®¤ç±»å‹ä¸ºintï¼ˆåœ¨æ•´æ•°ååŠ Lè¡¨ç¤ºlongç±»å‹ï¼Œä¾‹å¦‚12Lè¡¨ç¤ºlongç±»å‹çš„12ï¼‰ï¼Œå› æ­¤ï¼Œsum2çš„è®¡ç®—æ•ˆæœåŒsum1ã€‚</li><li>sum3ä¸sum1å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œå…¶ä¸­b2çš„ç±»å‹å˜ä¸ºlongï¼ˆå€¼ä¿æŒä¸å˜ï¼‰ã€‚å› æ­¤åœ¨è®¡ç®—æ—¶ï¼Œä¼šå°†aå‘ä¸Šè½¬å‹ä¸ºlongï¼Œå†åšlongç±»å‹ä¹‹é—´çš„è¿ç®—ï¼Œè¿ç®—ç»“æœä¸ºlongç±»å‹ï¼Œæœ€åå†èµ‹å€¼ç»™sum3ã€‚è¿™ä¸€ç³»åˆ—æ“ä½œè‡ªç„¶ä¸ä¼šå‘ç”Ÿæº¢å‡ºã€‚</li><li>sum4è¡¨è¾¾å¼ä¸­çš„å­—é¢é‡1Lä¸ºlongç±»å‹ï¼Œè®¡ç®—æ•ˆæœåŒsum3ï¼Œä¸ä¼šå‘ç”Ÿæº¢å‡ºã€‚</li></ol><h2 id="é—®é¢˜æ€»ç»“"><a href="#é—®é¢˜æ€»ç»“" class="headerlink" title="é—®é¢˜æ€»ç»“"></a>é—®é¢˜æ€»ç»“</h2><p>åœ¨Javaä¸­ï¼Œå¦‚æœèµ‹å€¼è¯­å¥çš„å³è¾¹æ˜¯è¡¨è¾¾å¼ï¼Œå¯ä»¥å°†è¯¥è¯­å¥çœ‹æˆä¸‰ä¸ªæ‰§è¡Œè¿‡ç¨‹ã€‚</p><ol><li>å°†è¡¨è¾¾å¼ä¸­æ‰€æœ‰å˜é‡æˆ–å­—é¢é‡éšå¼å‘ä¸Šè½¬å‹ä¸ºå…¶ä¸­çš„æœ€å¤§ç±»å‹ï¼›</li><li>ç”¨è®¡ç®—å¼ä¸­çš„æœ€å¤§ç±»å‹æš‚å­˜è®¡ç®—ç»“æœï¼›</li><li>å°†æš‚å­˜çš„ç»“æœèµ‹å€¼ç»™å·¦ä¾§å˜é‡ï¼Œå¦‚æœæš‚å­˜ç±»å‹ä¸å·¦ä¾§å˜é‡ç±»å‹ä¸ä¸€è‡´ï¼Œéœ€è¦åšæ˜¾å¼ï¼ˆå‘ä¸‹è½¬å‹ï¼‰æˆ–éšå¼ï¼ˆå‘ä¸Šè½¬å‹ï¼‰çš„ç±»å‹è½¬æ¢ã€‚</li></ol><p>è½¬è‡ªï¼š<a href="https://blog.csdn.net/huwei1844352682/article/details/106632488">https://blog.csdn.net/huwei1844352682/article/details/106632488</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;æŠ›å‡ºé—®é¢˜&quot;&gt;&lt;a href=&quot;#æŠ›å‡ºé—®é¢˜&quot; class=&quot;headerlink&quot; title=&quot;æŠ›å‡ºé—®é¢˜&quot;&gt;&lt;/a&gt;æŠ›å‡ºé—®é¢˜&lt;/h2&gt;&lt;p&gt;å…ˆæ¥çœ‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ï¼š&lt;/p&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td c</summary>
      
    
    
    
    
    <category term="Java" scheme="http://example.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€æ®µæ—…ç¨‹</title>
    <link href="http://example.com/2020/10/22/%E5%8D%81%E4%B8%80%E8%90%A5/"/>
    <id>http://example.com/2020/10/22/%E5%8D%81%E4%B8%80%E8%90%A5/</id>
    <published>2020-10-21T16:00:00.000Z</published>
    <updated>2022-05-14T02:10:47.771Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="no Permissions." data-whm="can not Verify.">  <script id="hbeData" type="hbeData" data-hmacdigest="7a1aeb2f442b99835985f3d88f10d8c87999d1e109dea14cde3f6c087b755ebf">5fffa82629056a2726735ceb0192c9af00f26ea83b0d24ba75b73e114aa798022b783825ca1f2e69ad714a8e266e8c11b40b45bf835bd37391d397551e7b9b6db81242ae57ca8999f7019815e4acac00134b9b866eb9c2cad3a1674931f384512e84814711b804c8c1dc3c691cac5318dc186bcef4d777ec805431acb8b2029bfcb55f0fbaee362b3e7ccb69bcc22c851636f209344b8edf5a6fa77e842932cd7504359fe9b6f4a852623dcd9ae976d30f08671d4cd692b5a5a494e5cf445e0d21c2161f9260083baa1660a982d52c48c0ab11248a76103fa1c50d8942797cfe3276295753826b19b19f89f9b7d21f1350c3ad903c6b830d4fbf7d9683c0878de81a5bdf1af5c962d87184167cbe00c55c28e35a94b7a749575446479695d9aecfaf5fff25d35c14c9749e760dc7ca42f977cd3ceb9efe15bc5622c5c55510437cd3f51fd516a069c5c6737b0a85ac68b7c3cb37b5f045e2a7d71f290a4a8e5c8791e5d7f1f4ea1746492cbd26deb2637a299e3bbde488bed10867a8393de447b67f2db7b5c1f98c559f75fce5e0adf6236a9ddcfb80c02dc4c134413c54cff47beb0a86924818618342fcf3835e36e82ed8b2babe9faf7ec46d63e03616a591b58f290f08afa7d86801bf45f9a4dec4914c166f9419716c6bfbf93e1efd56e92132f58061464734168159d39b8fa85608007513230d3f9c49e532b79259a981280b266fc30957b2388c2b22ab7ecade9a87f370a6f7c64a992b57bd90a294bb229cdd84f0780ab2356def1d49fad9280f86bc01dfe2fb06a3627f833da9579162cddad3d5389abf043bf48bfde35be227c569e7e14d7955872485454b80b41e172580489b5c44e6286c6dfde359182af220db62f1f4ddf06a2dccbfd992c4d084c22e2e5456d6fae57ef39beecc0679ecac7e6f451e3bea9ff6b8d64b7d55ceca4ee50862dc7462b03207e0584a2222873980eb42a40c47eee16b1b81ddb10014387dfcc446bb62c59395055a567d4c21c6cd7bc85be3b25c04839643ccc9a0cb4459e19b5c6141d1b3e59f5ca4171d7d2feee6b955e245da90d8c7d72faa8b7d6222e2e11c5f6aab80c07069918551f40cebb18a6d0d295cafe196ff411dc23f23127c1684949c1f5bf2b248a17508ebb64a4ed1713f573074a12f7c021c01331fc5482988544a6a421a79e5ebb825b5529a172df498d686a2b3f4248a8ef70615b1c7cce1dae551bb081d6143c2dbbeeb44b97418fb3ec3c6f8450ec9123994c864d4c92e0f0b9ae7ab6af11dfd9a340ae503711e2ba8be46e43034bf89909b20ead434683af21390c8acd448aaf28a084c40bfa7ba43819d4bb9b46d8904f3d1ebd7b536ad7b8175bfc384b86b32b73bf42f4cb7a0170cc05c6c50b87299b5234432f810206fcbe6d646475470a96dad332e408010c0e650afe0ff007af8dfbf16115cd978d1d4c32e9c2540c86f33a089f62e100d516e3302196d886c162468713fcba0a867b09d6c4e0a731f4803180002b41af5617103793bca4a66465acdce1b535a0c6318ef4e754ea30c31b4dd9ffac4e8e8354da667ef001d00d21337cc431546e3737686cfe6619d0e8bfbb94b49df5a37aaa9e6329301cbe44dc4a53834b671afa2bd5524a04a659671583fe293126b2185648fd3912ada1123ad72cea727325626bdce3bfd4e87032b45129ba4915816ec9569e9e07ab0370cea061a97fc1000fb56816f7376d9c7b4f67b598de79289c2941d607e0d82fe8fff0e7ede9e57c7dcc878792e72b55c09d33b501c823fd8cb95f58e4b2b6468010fd27b581e206fb104839991f6f524813e724cbff2c2f7ab3a8f14ba3380daa78ae0735e5ee5afa09c8cb8dbb85240e82ed058ac7cca6732929ba2fd8dd51150606ddf96588016081b4ecd9f9ba1165e60ca85281f7f0b9ecc605a3b5bb6b06221950337d68f8ab0d04e2f177edf32ccc3ba29f33778d6b37623ba0295c553c885d87fa0225c19df0c24a5746d1c6cc4e22346c35173a072f9409ea712e8fe802d95da065fc2dace537255f044833f13852a34a04a9153823c502d7a05593811f4b8ded6c2edfa8aa1c96775f7d4a1bcd7947fd4adaeb64d80f46dd39dbbf172677d846cb0309d47a965b3de3d3b3b8372695c900ebc774a380dee47bf62d60c65a1083dcb45887bc5890a62d8777e19ccec73d7f32e9220e2952a5a5bd7ec1a9b125d8f0d58c0cae31f83bb45c0234ab9686672bbafe9f920bf150e361e80be22608c42f760ffbbd3767e5008e2e02477a48a4f463b356b370c862cab5f33c2d9e6ee8840a91bdb0bf798f611c611c3d85ff293e7f1dcb00bc27950b217de3413a054d70ab819990b36700b188d301b27fd5335d2a11326d0cfe876a9b40f867db0a113b3c7a26d22a52361bdbe839e57dac0faa3746f7bab4731b2b16ecadbbb5b190cbe8660b288e2ad30064305014716c323e35ad282ebe5cbd62a9ab212fb5dcdc271d2eb0bcbfc9d7fa6486339f2bbe9dbbd456a6e9cc5213fe5255bac694f62aa0a4c44c81dd4504183fdd884d5c97debca9a46e6d91c0150a224b58b55023c69ef26e9ccbe802e4935fd9f05d8facb49fdfebf43773c3f371b2cf812dbddbf7dda65723b0609ef9fe5474562010c5f9c7fa4dc458281c75a1e2884db1a40940129948c20635551ff237c489a16b81e1447c0cdd2c2b629af6d07cebe45de25c340d6c2c8331f184a3473a2d87a1769e2137dc50c928bacff7c43d85b9f9cec89928fbc92ea8b3b097b93941bc6566cc156d0afd1d8b5b29966ddb26d3b8e57be41e5dd1387e3f5568789cc44eb80eb5b4e93ab033ba199d81a928c53c961621a4c6aeec1b30643cee3b7cba4fbda0d2c5f8a3369abd40e68e39fd4aca58eee5f5213093221fe867fb506ab3ed3df7e753b154f192324f38ecc7454dfaa85bbc5e74b15da943944053e9bef602e62b84e6331067a2c266ea5858729414776a62d5555e1d718f9c229c6e12f678554c3fc8a71962255c6aa15377d45fbe4b59d8ebd87efd087f663653fe20eba9c42c232d83f39f54748f6a584a3b416adbaa64d44175d2d08bf8f65813a9d5a7ef5ec11113d52e1bfe2df1043930ceb8667e686975f37ec4869c0a83577932f8c83584b1a1c452dca407f5f152954837e00565a06b94efc5de1859cce859a06f5b0f732bda66e76b61fe0d2651429c4814cd83468a2a2f1dd6a82149887f18cfda0be420cd704ad666f3509080bdd511011a4118f088968cb3f9f34da8c76e8202dcfd726a0f75d26163558a4c53260ce6cab02a3511f53c26cceb228d12e35885598903a7e9e621dc3dfb4c3b38c924ab847053eadafa2992f7bf4ecf6f995e34ffc5187432ae2883ecec101522984141186d6f6cd562f4d9bd4dbfeda52a5e2e6969171a631616a1f06d10e897d4eeebaa8440253368b54467765cabd16ee3f2aa5c3d3175ee9cb8c40b8c667539f9de89324f77e89efb531040c1c2b5dfa444d18411d4c11ccb4b02f55329472167961efd1c42cf2f4cbcdcb2477d2da69407079cd258961b35017b83746daf68068a4378c42091e7ccc184ad72fd5662abd6aee9f9e4e350bcc43f8da39da72e27c4be2be9152302892aefd50449ed6d3543e6a861f14aad1b2fa542c858ae50625d47f8884d3ff585f0f583500b2d9ebf135c0381a40c1320c0977ff3917bcdfda18227b15934146ec8ca1618de8416c85eb857095247b668e75e63eb1e9ac4254a3805be9608a51447a3ac81dcc838292ee75280bb52086d9fb6b520185c53cecf7288a54135cc3d641544a5e92f0d500a285b855ad6a684a7f36d671814579</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Please enter password to read</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Please enter password to read</summary>
    
    
    
    
    <category term="Essay" scheme="http://example.com/tags/Essay/"/>
    
  </entry>
  
  <entry>
    <title>é‡</title>
    <link href="http://example.com/2018/10/05/%E9%81%87/"/>
    <id>http://example.com/2018/10/05/%E9%81%87/</id>
    <published>2018-10-04T16:00:00.000Z</published>
    <updated>2022-05-14T02:05:14.135Z</updated>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="no Permissions." data-whm="can not Verify.">  <script id="hbeData" type="hbeData" data-hmacdigest="8be96cd999ff4a6d60d813fb3f3bf3f6281f2b048dcb079f1013d5ce71abb7cf">5fffa82629056a2726735ceb0192c9afc5ef144e7103aae9647ae4181e2ce3c3b4d72bac8de52182ad2748e66b3e01e03db47cf267366fda2e7eace74eaec3e730173040277dc0f01279919122d8a9f9daa19588236988915e518dbbfe97a6bc04731c3f0792a8f467f09f93937f6bdaabb06a1ec80e118b025868de562c7a9c2d0defe7ea7487bda8200093184849cbfbc13305481cbcd85be6fcb10623d309927bb004469a78ade710cfc0387b2721abeb7a0cb58d1cd9f1e7248f53b1ce0f30c4e9b801c91959a74583b12ef02503ca34ba9894227294422a8b2553ff785a0997ebf51a0ac0847a321c9a852aa53d94f32c941d2f0d1e7c9c3365d1bd3fa1d33563f3f4934ce7f26418d4fb611376b3ae4352d5b55c6b9b43af67ad3b1cd0cddb2d89c7ef11ae3a292b2dbbddd5af09abf26571b2fc072d89fa68f59caceac3e5b999ce545f8cb50e134d5e8c072f4bbc3f89ed793a3289337a64b4ff2ae7876a8f68693bc97f4a5f991e6df1f9cd17c0e22bfd2851dde0ed40a9da40c2fc9899daec4cf6dcd5863ecdf95b8e39f08100172af08faacbe024a5a2d7fbb5908e887131b2da7ff04edf27c008b8489bdfc879ea6d1dbf3e704a5d56056084b11cea70a1ad823223b1609ef9f8f949b7218def1401ec4b3441c97e90956eb19ff2dfce01d62be0d3b77734629ef01ee95d0ab1c88384a93b158d2ad125e3d6ace5a4a2f532fb089c85adfc05cc9359dc2fe1041b6055e35305abf1821d3d47a877b071319e33d0cb98e59afb045fd983492b343f39bbce939f4d2a06f0c09269ecf168da0805a20eafb37cbb8fedab5c8fa55735beadd7c8ce5906dc253c3c67d180f732e964e0df3364c88e104f2343f2c2741f076f021147a11e0ad8de3972049fd72595b348f14ceec8f28dff19a62f575ff5c863f0b6c22ae8e481d789a6cfc8185eac17799e4407a8f0b61602194e108398ed818fde498732f71f2c8f3a25c29eeaf76af751e372e2945e0dd5f26b038b7a23bb7364a7972a185455c051c584942399052e557e3e31f8cf06f00727929ca421e65abcfd0bc2f3f295fec92733f9d665183b85b2aed79ef186bc62fb76df65c1f706d063156f7f84ac9839d4f10cdfa4cc9705f33c194e735e363a3a667ceb062186764ec49b02732b7e7e274d72ab57360b63730dc1d35ab976c57e68fd9ba92a2dbbc09235475b04ee5952f7004f119fbb01d31a70dbb36912c52472b525ab6f58ef965d2310207026d32c9cdbdd102684a501cba2fd9fc22c1dbdf78a0f460f7e0e3e8829f38c67b2dd5fd6ea1db37dc0823ab8fcf83289defc468408784f5bdcd1826ffe5ad8b9eed440c28f9122befd71b73d4b2987f0ce2b21160ee856e9e9f6c457b2669a2b434b12525044ddf3ce24aa55c069ad49b38f36c314ab8dd20ad24ea6ffadcf988ccd4a4dcdf31986187310841615e420100a096a2e1a0ad94bc00fc0fb69e32b87df2439d26ea8c3d2774404cfb7e21373e42fb81961d27b7f1a5efc2a99c4fe04613c551267ea6e893ad092a887b106e3b37534367c8e03af51d846b9a8951a1c82b0d96c2852f16e05424fc41fe508560791f915d8d9cbf9655492daa1c4b3fbeefcaaa0d64e5dd6de39e778ba668e5b46eb261a98463ce19fa65e80fcbacf449db30cc9f433993c114e64946e083f2581d30dd5b79cd5966835215b82cb30e68e64083ab53ecab3eebbad04223bdf39e398d6e721efcd4997c9762c974f00fe7bde632a80f636e016d740dfc4a5ea8dc3a45df38cb20ab604a1b21b63782dd38ff8e849db5c152e37a775eb04b758699957dd0e10cda456d2787d6d47a54bc04847790123a84e2fe9c914a91fff397a88d47f0ed3719a4d95903d331d5d7e61f023cc4b812310848d4f6cfca0c7ceb0f4ba35ebeed893756ba78eff072a0eb1d8e937e4b85ed502d4435f7778a491b8c369edfcedd0b9fcee99da4788be7924270fb9bbdb1a6740d5149b45a7f74ce473cd1e32070cf9829ba0bc14da8e11f5f2e6dd8cf536f9e531af654460031fdcfc40b21865c675f5069a5b089704d6ac620d9ea649d7a7ace177b3012c4088a72f339986a94a278ca64facd6a61fb0844ae7d28412b7a8b99761578be44cb835158c248175f320795ddb2f5f275dd3d52f70a556c28002daede7144e4fa76d9585ce6d2c1b43cfef28d8535429479b5e875fd714b2a9f4eb5c73f8c05293d3429dff86207ae1609e859856ccab278b5c253b7de3169c670c6500d2fca8758c2afebba1bbdab5f6b2ed5b8ddae9f3d932283255365e614b12818bd17817da46ca3b08651271741f6074f6a52dbc2a1f9be429c09d072c8623a8a9910714ef80f092c60c6510aa3c238cb7079e4b5a6c0f4bf6b69fb7d07f267274d305fbf3f2efbfd373779a290ff7a3424ba3db2307679103e4d60d18117344ddc5f39542573d3d1ac5a02aef8b15367c738c017be30d3345b3aaeb2064a0af29164b673d95a5cf8e9fcaecd0b5547a32ddbdb3b9526258212615a2731e00b83a39d0ae1a8bceab9739c7534f12dea7b411fdd1a02f6b58cb2b48e1bdd5dcea71aaf451f1b7ab310eb2cb385df71325f6488f5ce67b51dbfef3c0dc6e5e2ecd02bfd201208b28845b21f103047400f75ca24d6b74a256bfef66cd9d2f36a869d3262f315724773042ac129440f827cc544d0b34b3d457a696dbd6b061ca68296659ee07fa972704ef420c930ed32ed0623a454584d4afdbfafb97827afe3a672001e9d2284e930a00996ee89e2a08cf29071f387aa56adff4a862b3d71b8972daeb28744251a58329bcb65757dddfe6dd44d1b561fc50091780ebf448ecfa4241ca715fe86d8c53bde31d0a9eda3130233ac626d0c0b9988500e5e03b3dd5cf41e4581aea3079807210b52fdd4cabb6efacb0018d6cc2e8558b9dabf986c43e8bec3993308e7b34a25caff9a1a36a6ad3d34d5d0b399870fdb9791ecde0d7ac0107d4ea9e8e18c74fd2f9623b652e7cd4ea24f77f0d708290bc1ed4343cbb1e1599c0fc8afd1213ee0e41b4d6482d6c24d486e00caec6e7ee12cc7573c585a77757fffe5466bcd20309bc6c12af0afffadf1e90f9dd0942e44e1f26a5ecda81052c9dabcdba6c7548724d5ca6d50699ce3038c76c1411e5c7b4cd9f1bd2f1004fe8129376652306b1cd2e08efad47cd24872579989f547a9f562ad5c3a161c4bedebbc84c47c01ab5029662de2b454f6dc4b9582b12c37e78159741a81247c83f5e3f0251c20719c97458aae59b455d4c199052e84e2c192f86c1e9d828529bca64c2c57dc8ef6a3aa7168fb07f2b6430086605655e94065e82417d2f342516b5f0c280619c6853b699f2165961b5b7644ca1e6d093236ea293129691bb95ca955c9b80fe144bb03a366d4e5cc60699952fd5adc08538e687db7f3b75066330890f85cedbb7fed8fe25e199efcd49c6efe982a0aa0be9bb986d47f7a9859d1525994a86e08b7c3882454afd9559ec9759707b14d10c5b9dfc2c5382022931ce7a7d1493ecc9fd30eb9a652580a6e73406b2a79fbf34195f228a5bfc51dcd075213d0878eef57c2092d3a4873a8fd66813b4dbb86181e36b39303a4f3be56a1c5f1b694f80b25f1a7ceaef3cd710d665775d654b933afd601ed051ce551df58e6619c15b71394b76907ea1a50158053c1c9d24aa4855f52c728bbd76ebb861c3935050031e9c8727b8ba9b443f2cddb7c61ec03d7292603584bb0cc453e681adfc9ea25a60c670a53111a5f4329a2c6f10ca8431859e9f87a48460140c596a9a63e42fddef3f102ea0985c830bdd93050b979138037edfb34707fe91c2e8e85a90c7bd5850eba1ef6e66814703b67aa343e267862c76836008b2b58e78e0f9db64815529b5608808905448ffb2df31761d06b0e66c0760b36402aa9948f99c990e3586923012787dc8f6c1cc35bd6b8ac3f016773a3df8738c8d60df669d968e5e408ebea9a5aecfced02f0661ebbd2c180d93c711a01001e8f7d9ddb2f04791b28577af4b02fd1fafb26a50765635079274eedbf3a0797b728a7e5b299d090e6ffcd957be3df25f2e272f961b42eb82d07182f70e4a6135e5e80ca430af6bcffdd5b8064f4e0216924575cb4af6eea934bf193fb1ff862912def4b060d047bbfd38314b5aeb30139eabe825f49ecabb41ce25a8c33fc44036353d59d8ecb87c734a5a10bf53f977ec5bdfd761cecb578da5f5d22328d687e51ef84b6e101e118bc9f8ef3bf5a6652244bf20a3a409d1823845d2d33031afd715216d788084b46d20786749aeb4ead6903ddead34c5f7bf91f2e74f5750c01f8075ca21dd119b1cf9906a22fe5332de9609480e73b1fa613aeaffda8fad0eeded668fd18c231a5ee691bc09114ed6cbea86a34f1ccdfc915b5e0c79cd1512a17fc4529ba9567a6f9e5c164e10778e5bbe042a097dba3f6fc03ac110fb6037b6f9e76f94fff2f7a27af0b8c8fe8f9e856201c6982e9ad176d5ae9eb29f9f5b6056baa37ccd24dc4af9fffc83459e3f6adfcebb289c280e28524ab8a92105d9fb134f8fd7ac71aa0e54a40c1d45e3c99c392213627f2fe1e431207e603584e6daf32b95f16e305d16972503cbc89424d1a203e34c10e014780d09265d1096f427c320fc39a114da36c5c9a82188c1c61454e3512153bd1b53e37c348243614aca9cd6b3ef6433972c96d65a2f409fb90138da1bc15a9c00cfe0ecd874a96675bc25c322cc8db7140a231595522e4c2fb9f9415f722d430794ec39ed982147a61233808c185bef18d076dd807d0dba6cb84c0ce7f3d76af0ed82f2f942cb03b2fe3d29a7fcf29b1c56cf483b96c41b8fb449a205399c5f5afffc3a8043646916022289da8a479701e91be40f1052bb74f28c14a24e3a6580d5b4d67814aabb8197770b2c0127672c5e351cf067e46250af7c9a49a4b72fc8241d0f17b9571e9eb663d67f926e3354d93c0718b18215c3266fa528f0d8808c4b4f33bb1cfdb980740e535ede43a6e0675c182f4043df3858c579ba4ba7b8aa348c724b681ab26205701f7ecb33b9beb2a4568fb0f39b38d7397d7189c2877c3b9d279378a07fa588ff50cf39dc8522f8a7169f04090ef525b8f93ddcddfc259319dc97c5cdecc96363d1782579e7f7529a9b805c45fdbbb3b7908b1e8156ec75e5e9b596b278fc8a74981fdeb934299cd2d57363bb75ccf8e17e27622f2bdf267a087d2dc50f038dfec0d26699cc47a5ce7c4a292ce6c053c1a40f30ee9af0f2452015ebd5f8995f43f968769e659bf9c0b4dc81356a5a861d4884dd50f39a920ebe7c9e85fd6f4b53eb213029bfcc2b5c16ea802f45f5a34f760cd1e89b3a4b4ff2ada0491c3e151cb9bc136eef32b64745e286c172d51f7ad1ce7a899b0cf9a10009e4a965cac2fe5d289bc679a77a347cfd9051fdf881c6bdc8a4c26e0401b6726d9ef1980c3b1da7a7ee26dbeeb7921be101a0e0ac6f83b129c96ea85189e38acae00c0411904a7e2d9b407f878ebf3610804962688db0a72bf0001a462befc3771c135fda34b609af8f8ca5737fe5e374f26069860703ecc5024c4ba46c720e83e6d351c8346bda962e084501877c2e08113d0693b70a9e187b3bd5f2a9a689b29b29cf621a90bcc2d83251fca6230bc49ed0546d38756c2c418511d35314241682f4399cc525c6df8a064a26326dca9464937f2b4c24795672b4e5b55e9f454004eae0a891fc4db7b3d5c4f2a6c1429396dd539b397baf7f863a551e35fb085e0881ac44fe577e738d85bf32172c7b753074826e014f2ee6da996ac77603caf95e934fe882d93e0fd12e89e693eadd73007e5d50ade2fc7c8ba3b4f9b7dbfa3207336a6042ea931e6592a3d8650b4a90cf593d896937f26ea543bb123989efa8d751defa843f92daf64a21f26eb120a947467b20b7a7d89faa70b473ac6081344157de148277b748a6219a96adc30442ec98741417c41cf5cd49b4179356bd18e383d01a56931e726720913aee03ba92b2899719ca6b31cf9de574afb991cffd3320b0c5c6be1e3c78fb90ac5bb93a94da956b841b0111b9b825830205f15d39e23033a1daf27f3cc2dbedf0ce10b2d49baa9da6de2a2155d9c5c4629cc65662a3a77e7fb13191952650d077c4d481cd8118e93cdf7aab10e2d9936d523ae2b24edabb66ef8bc911f2c61556d3ac67ca6f41cbd6</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Please enter password to read</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <summary type="html">Please enter password to read</summary>
    
    
    
    
    <category term="Essay" scheme="http://example.com/tags/Essay/"/>
    
  </entry>
  
</feed>
